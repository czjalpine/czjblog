{
    "version": "https://jsonfeed.org/version/1",
    "title": "失心耀的博客",
    "subtitle": "",
    "icon": "https://xinyao_idiot.gitee.io/zxy/images/favicon.ico",
    "description": "",
    "home_page_url": "https://xinyao_idiot.gitee.io/zxy",
    "items": [
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Android%E5%85%A5%E9%97%A8/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Android%E5%85%A5%E9%97%A8/",
            "title": "Android入门",
            "date_published": "2021-08-27T02:33:18.777Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"android入门\"><a class=\"anchor\" href=\"#android入门\">#</a> Android 入门</h1>\n<h2 id=\"布局管理器\"><a class=\"anchor\" href=\"#布局管理器\">#</a> 布局管理器</h2>\n<h3 id=\"线性布局linearlayout\"><a class=\"anchor\" href=\"#线性布局linearlayout\">#</a> 线性布局（LinearLayout）</h3>\n<h4 id=\"属性\"><a class=\"anchor\" href=\"#属性\">#</a> 属性</h4>\n<ul>\n<li>\n<p><code>android:orientation</code> （专属）</p>\n<ul>\n<li>vertical—— 垂直</li>\n<li>horizontal—— 横向</li>\n</ul>\n</li>\n<li>\n<p><code>android:gravity</code> （子元素的对齐方式）</p>\n</li>\n<li>\n<p><code>android:layout_width</code>  和 <code>android:layout_height</code></p>\n<ul>\n<li>match_parent—— 匹配父空间</li>\n<li>wrap_content—— 包含自身内容</li>\n<li>像素点单位用 dp，字体使用 sp</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"内容平分\"><a class=\"anchor\" href=\"#内容平分\">#</a> 内容平分</h4>\n<p>在子元素中加入 <code>android:layout_weight</code></p>\n<blockquote>\n<p>当其中元素的大小都为 0 时，开始根据权重分配父元素空间；</p>\n<p>当其中元素大小存在数额时，先把数额划分出来。多出的部分再用权重划分</p>\n</blockquote>\n<h3 id=\"相对布局relativelayout\"><a class=\"anchor\" href=\"#相对布局relativelayout\">#</a> 相对布局（RelativeLayout）</h3>\n<h4 id=\"属性-2\"><a class=\"anchor\" href=\"#属性-2\">#</a> 属性</h4>\n<ul>\n<li>对于父容器\n<ul>\n<li>layout_alignParentLeft 左对齐</li>\n<li>layout_alignParentRight 右对齐</li>\n<li>layout_alignParentTop 顶部对齐</li>\n<li>layout_alignParentBottom 底部对齐</li>\n<li>layout_centerHorizontal 水平居中</li>\n<li>layout_ centerVertical 垂直居中</li>\n<li>layout_centerInParent 中间位置</li>\n</ul>\n</li>\n<li>对于兄弟组件\n<ul>\n<li>android:layout_ toLeftOf</li>\n<li>android:layout_ below</li>\n<li>android:layout_ toRightOf</li>\n<li><em>android:layout</em> _alignBottom</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"framelayout框架布局\"><a class=\"anchor\" href=\"#framelayout框架布局\">#</a> FrameLayout（框架布局）</h3>\n<h4 id=\"属性-3\"><a class=\"anchor\" href=\"#属性-3\">#</a> 属性</h4>\n<ul>\n<li>\n<p>android:foreground   设置前景</p>\n</li>\n<li>\n<p>android:foregroundGravity  设置前景图片位置</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>android:foreground=\"@drawable/heng\"</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>android:foregroundGravity=\"bottom|right\"</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!-- 位置可以通过 |，去调整多个角度 --></span></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"tabellayout表格布局\"><a class=\"anchor\" href=\"#tabellayout表格布局\">#</a> TabelLayout（表格布局）</h3>\n<h4 id=\"标签\"><a class=\"anchor\" href=\"#标签\">#</a> 标签</h4>\n<ul>\n<li><code>&lt;TableRow&gt;</code>    当直接在 TableLayout 中使用的话，所有控件都占据一行，若需要在一行展示多个的时候，就需要 <code>&lt;TableRow&gt;</code></li>\n</ul>\n<h4 id=\"属性-4\"><a class=\"anchor\" href=\"#属性-4\">#</a> 属性</h4>\n<ul>\n<li>android:collapseColumns 设置需要被隐藏的列的序号，从 0 开始</li>\n<li>android:stretchColumns 设置允许被拉伸的列的列序号，从 0 开始</li>\n<li>android:shrinkColumns 设置允许被收缩的列的列序号，从开始</li>\n<li>子控件设置属性\n<ul>\n<li>android:layout_ column 显示在第几列</li>\n<li>android:layout_ span 横向跨几列</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"gridlayout网格布局\"><a class=\"anchor\" href=\"#gridlayout网格布局\">#</a> GridLayout（网格布局）</h3>\n<h4 id=\"属性-5\"><a class=\"anchor\" href=\"#属性-5\">#</a> 属性</h4>\n<ul>\n<li>\n<p>android:orientation 调整网格布局是横向还是竖向</p>\n</li>\n<li>\n<p>android:columnCount（与横向使用）规定一行的上限有多少个</p>\n</li>\n<li>\n<p>android:rowCount（与纵向使用）规定一行上线有多少个</p>\n</li>\n<li>\n<p>子控件</p>\n<ul>\n<li>\n<p>android:layout_ column 显示在第几列</p>\n</li>\n<li>\n<p>android:layout_ columnSpan 横向跨几列</p>\n</li>\n<li>\n<p>android:layout_ columnWeight 横向剩余空间分配方式</p>\n</li>\n<li>\n<p>android:layout_ gravity 在网格中的显示位置</p>\n</li>\n<li>\n<p>android:layout_row 显示在第几行</p>\n</li>\n<li>\n<p>android:layout_ rowSpan 横向跨几行</p>\n</li>\n<li>\n<p>android:layout_ rowWeight 纵向剩余空间分配方式</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ui控件\"><a class=\"anchor\" href=\"#ui控件\">#</a> UI 控件</h2>\n<h3 id=\"textview\"><a class=\"anchor\" href=\"#textview\">#</a> TextView</h3>\n<h4 id=\"文字大小-颜色\"><a class=\"anchor\" href=\"#文字大小-颜色\">#</a> 文字大小、颜色</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/tv_1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@string/tv_test1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#000000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>24sp<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><h4 id=\"适应大小写\"><a class=\"anchor\" href=\"#适应大小写\">#</a> 适应大小写</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>android:textAllCaps=\"false\"</pre></td></tr></table></figure><h4 id=\"显示不下使用\"><a class=\"anchor\" href=\"#显示不下使用\">#</a> 显示不下使用...</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 显示不下使用...--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token attr-name\">...</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>maxLines</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>ellipsize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>end<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><h4 id=\"文字icon\"><a class=\"anchor\" href=\"#文字icon\">#</a> 文字 + icon</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 文字 + icon--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token attr-name\">...</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>drawableRight</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/arrow_down<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>drawablePadding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5dp<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><h4 id=\"中划线-下划线\"><a class=\"anchor\" href=\"#中划线-下划线\">#</a> 中划线、下划线</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TextViewActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 第一步先声明</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TextView</span> mtv4<span class=\"token punctuation\">,</span>mtv5<span class=\"token punctuation\">,</span>mtv6<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_text_view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        mtv4 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 找到控件并复制给声明变量</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        mtv4<span class=\"token punctuation\">.</span><span class=\"token function\">getPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setFlags</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Paint</span><span class=\"token punctuation\">.</span>STRIKE_THRU_TEXT_FLAG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 中划线，但是会有锯齿感</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        mtv4<span class=\"token punctuation\">.</span><span class=\"token function\">getPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAntiAlias</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 去除锯齿感</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 下划线        </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        mtv5 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        mtv5<span class=\"token punctuation\">.</span><span class=\"token function\">getPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setFlags</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Paint</span><span class=\"token punctuation\">.</span>UNDERLINE_TEXT_FLAG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">//HTML 方式的下划线</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        mtv6 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        mtv6<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Html</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromHtml</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;u>HTML方式&lt;/u>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"跑马灯\"><a class=\"anchor\" href=\"#跑马灯\">#</a> 跑马灯</h4>\n<ol>\n<li>\n<p>先要在 xml 中配置</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>          <span class=\"token attr-name\">...</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>singleLine</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>ellipsize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>marquee<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>marqueeRepeatLimit</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>marquee_forever<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>focusable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>focusableInTouchMode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>在相对应的类中定义</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TextViewActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 第一步先声明</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TextView</span> mtv7<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_text_view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 跑马灯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        mtv7 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_7<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        mtv7<span class=\"token punctuation\">.</span><span class=\"token function\">setSelected</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"阴影\"><a class=\"anchor\" href=\"#阴影\">#</a> 阴影</h4>\n<blockquote>\n<p>android:shadowColor：设置阴影颜色，需要与 shadowRadus - 起使用<br />\n android:shadowRadius：设置阴影的模糊程度设为 0.1 就变成字体颜色了建议使用 3.0<br />\nandroid:shadowDx：设置阴影在水平方向的偏移，就是水平方向阴影开始的橫坐标位置<br />\n androildshadowDy：设置阴影在竖直方向的偏移就是竖直方向阴影开始的纵坐标位置</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>android:shadowColor=\"#FF00FF\"</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>android:shadowRadius=\"3.0\"</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>android:shadowDy=\"20.0\"</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>android:shadowDx=\"20.0\"</pre></td></tr></table></figure><h3 id=\"button\"><a class=\"anchor\" href=\"#button\">#</a> Button</h3>\n<h4 id=\"文字大小-颜色-2\"><a class=\"anchor\" href=\"#文字大小-颜色-2\">#</a> 文字大小、颜色</h4>\n<p>跟 TextView 控件一样设置，但 20.3.1 版本可能会出现一下情况</p>\n<blockquote>\n<p>设置完颜色之后，按钮还是暗紫色，没有变化。</p>\n<p>[解决] 在 <code>res\\value\\Theme</code>  更改为 <code>Theme.MaterialComponents.DayNight.Bridge</code></p>\n</blockquote>\n<h4 id=\"自定义背景形状\"><a class=\"anchor\" href=\"#自定义背景形状\">#</a> 自定义背景形状</h4>\n<p>请在 <code>drawable</code>  文件夹下新建一个 xml 样式表</p>\n<h4 id=\"自定义按压效果\"><a class=\"anchor\" href=\"#自定义按压效果\">#</a> 自定义按压效果</h4>\n<blockquote>\n<p>其实就是设置点击前一个样子，点击后一个样子</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>selector</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>state_pressed</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>solid</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF9900<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>corners</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>radius</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>45dp<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>state_pressed</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>solid</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF8888<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>corners</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>radius</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>selector</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>同样也可以设置点击了是一个图片，没点击是一个图片</p>\n<p>而且还可以通过 <code>android:backgrounTint</code>  来设置背景图片颜色；</p>\n<p>同样的，当没有存在 <code>android:background</code>  的话，那么就会创建多层重叠的颜色图案</p>\n</blockquote>\n<h4 id=\"点击事件\"><a class=\"anchor\" href=\"#点击事件\">#</a> 点击事件</h4>\n<blockquote>\n<p>存在两种方法。</p>\n<p>方法一：是在 xml 页面中增加 onclik=&quot;方法名&quot;，然后在页面的类中增加这个方法；</p>\n<p>方法二：就是做一个点击监听</p>\n</blockquote>\n<p><strong>方法一</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>android:onClick=\"showTast\"</pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">showTast</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"我被点击了\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>方法二</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ButtonActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> btn_3<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        btn_3 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 点击事件，方法二（常用）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        btn_3<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"我被点击了\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>方法三</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>在main方法中声明后，可在main方法中另外写两个方法。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnTextView<span class=\"token punctuation\">;</span><span class=\"token comment\">//1. 先声明</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnButton<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnEdittext<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnRadioButton<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnCheckButton<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> mbtnImageView<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_main<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        mbtnTextView <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_texview<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 找到该控件</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        mbtnButton <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        mbtnEdittext <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_edittext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        mbtnRadioButton <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_radiobutton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        mbtnCheckButton <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_checkboxbutton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        mbtnImageView <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_ImageViewButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token function\">setListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 重复写单个点击事件很麻烦，所以可以写一个类，去继承点击监听</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">Onclik</span> onclik <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Onclik</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        mbtnTextView<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        mbtnButton<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        mbtnEdittext<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        mbtnTextView<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        mbtnRadioButton<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        mbtnCheckButton<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        mbtnImageView<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Onclik</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">Intent</span> intent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_texview<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">TextViewActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_button<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_edittext<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">EditTextActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_radiobutton<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">RadioButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_checkboxbutton<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">CheackBoxActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_ImageViewButton<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                    intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">ImageViewActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"长按事件\"><a class=\"anchor\" href=\"#长按事件\">#</a> 长按事件</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Button</span> btn_6 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 常规写法</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>btn_6<span class=\"token punctuation\">.</span><span class=\"token function\">setOnLongClickListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnLongClickListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">onLongClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"长按事件产生\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//lambda 表达式</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>btn_6<span class=\"token punctuation\">.</span><span class=\"token function\">setOnLongClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"长按事件产生\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// 当一个控件存在点击事件、长按事件、触摸事件时</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 若这里 return 的是 true，那么这里只会出发长按事件</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 若这里 return 的是 false，那么这里会触发该事件和点击事件</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"触摸事件\"><a class=\"anchor\" href=\"#触摸事件\">#</a> 触摸事件</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Button</span> btn_7 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_7<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//lambda 写法</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>btn_7<span class=\"token punctuation\">.</span><span class=\"token function\">setOnTouchListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">,</span> motionEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string\">\"onTouch: \"</span><span class=\"token operator\">+</span> motionEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"edittext\"><a class=\"anchor\" href=\"#edittext\">#</a> EditText</h3>\n<h4 id=\"属性-6\"><a class=\"anchor\" href=\"#属性-6\">#</a> 属性</h4>\n<p><code>android:inputType</code> —— 输入类型</p>\n<p><code>android:hint</code> —— 文本框默认内容</p>\n<p><code>android:textColorHint</code> —— 文本框默认字体颜色</p>\n<p><code>drawablePadding</code> —— 设置图片和输入内容的间距</p>\n<p><code>drawableXXX</code> —— 设置输入框指定方位添加图片</p>\n<p>[注意]：这里的 background 是设置文本框下划线的颜色</p>\n<h4 id=\"监听属性\"><a class=\"anchor\" href=\"#监听属性\">#</a> 监听属性</h4>\n<blockquote>\n<p>在该页面的类中先声明并绑定控件，然后添加一个文本变化监听器。可以在改变前、改变一个字符时，改变后。三种状态</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>myapplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">androidx<span class=\"token punctuation\">.</span>appcompat<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AppCompatActivity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>os<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bundle</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Editable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TextWatcher</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Log</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>view<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">View</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>widget<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Button</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>widget<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EditText</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">android<span class=\"token punctuation\">.</span>widget<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EditTextActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> btn_login<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EditText</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_edit_text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        btn_login <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_login<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        btn_login<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EditTextActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"登录成功\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        username <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>et_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// 创建一个文字改变监听</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        username<span class=\"token punctuation\">.</span><span class=\"token function\">addTextChangedListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TextWatcher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// 在文字改变之前</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">beforeTextChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CharSequence</span> s<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">// 在文字改变时</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onTextChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CharSequence</span> s<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"edittext\"</span><span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// 在文字改变之后</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterTextChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Editable</span> s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"获取文本框内容\"><a class=\"anchor\" href=\"#获取文本框内容\">#</a> 获取文本框内容</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>控件<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>即可</pre></td></tr></table></figure><h3 id=\"radiobutton多选框和checkbox单选框\"><a class=\"anchor\" href=\"#radiobutton多选框和checkbox单选框\">#</a> RadioButton（多选框）和 CheckBox（单选框）</h3>\n<h4 id=\"常用属性\"><a class=\"anchor\" href=\"#常用属性\">#</a> 常用属性</h4>\n<ul>\n<li>\n<p><code>RadioGroup</code>  标签（专属）</p>\n<ul>\n<li>在 RadioButton 上层包一下，确认 RadioGroup 里面的选项是一体的</li>\n</ul>\n</li>\n<li>\n<p>android:checked（专属）</p>\n<ul>\n<li>true—— 默认选项</li>\n<li>false—— 不为默认选项，可不写</li>\n</ul>\n<p>[注意]：如果需要使用 checked 默认选项的话，需要该控件存在 id</p>\n</li>\n<li>\n<p>android:button（button 系列都有）</p>\n<ul>\n<li>当需要自定义样式的时候可改为 <code>@null</code></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"自定义样式\"><a class=\"anchor\" href=\"#自定义样式\">#</a> 自定义样式</h4>\n<ol>\n<li>\n<p>需要将自定义的控件按钮取消， <code>android:button=&quot;@null&quot;</code></p>\n</li>\n<li>\n<p>在 drawable 文件夹中编写一个 xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>selector</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>state_checked</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>solid</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF9900<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>corners</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>radius</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>45dp<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>state_pressed</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>stroke</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#AA6600<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>corners</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>radius</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>shape</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>selector</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"监听事件\"><a class=\"anchor\" href=\"#监听事件\">#</a> 监听事件</h4>\n<p>使用的方法为 <code>setOnCheckedChangeListener</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RadioButtonActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RadioGroup</span> rg_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_radio_button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        rg_1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>rg_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        rg_1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnCheckedChangeListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RadioGroup<span class=\"token punctuation\">.</span>OnCheckedChangeListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCheckedChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RadioGroup</span> radioGroup<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cheackId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token class-name\">RadioButton</span> radioButton <span class=\"token operator\">=</span> radioGroup<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span>cheackId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RadioButtonActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>radioButton<span class=\"token punctuation\">.</span><span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"imageview\"><a class=\"anchor\" href=\"#imageview\">#</a> ImageView</h3>\n<h4 id=\"button的其他衍生控件togglebutton-switch\"><a class=\"anchor\" href=\"#button的其他衍生控件togglebutton-switch\">#</a> Button 的其他衍生控件：ToggleButton、Switch</h4>\n<h4 id=\"常用属性-2\"><a class=\"anchor\" href=\"#常用属性-2\">#</a> 常用属性</h4>\n<ul>\n<li><code>android:scaleType</code>\n<ul>\n<li>fitXY：撑满控件，宽高比可能发生改变（常用）\n<ul>\n<li>fintStart：等比缩放，置于左上角</li>\n<li>fintCenter：缩放居中</li>\n<li>fintEnd：等比缩放，置于右下角</li>\n</ul>\n</li>\n<li>fitCenter：保持宽高比缩放，直至能够完全显示（常用）</li>\n<li>centerCrop：保持宽高比缩放，直至完全覆盖控件，裁剪显示（常用）</li>\n</ul>\n</li>\n<li><code>android:maxHeight</code> ：最大高度</li>\n<li><code>android:maxWidth</code> ：最大宽度</li>\n<li><code>androld:adjustVlewBounds</code> ：调整 Vlew 的界限</li>\n</ul>\n<h4 id=\"加载网络图片\"><a class=\"anchor\" href=\"#加载网络图片\">#</a> 加载网络图片</h4>\n<ol>\n<li>\n<p>需要在 build.gradle 中导入一个在 github 上的工具<a href=\"https://muyangmin.github.io/glide-docs-cn/\"> <code>Glide</code> </a></p>\n</li>\n<li>\n<p>在 <code>AndroidManifest.xml</code>  中赋予一个获取网络的权限</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.INTERNET<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>然后就可以在需要展示网络图片的页面方法中编写一下内容</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Glide</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span>fragment<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span>imageView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>案例</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageViewActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ImageView</span> iv_4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 下一步需要去 build.grandle 声明</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_image_view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        iv_4 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>iv_4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Glide</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span>iv_4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<hr />\n<h3 id=\"listview列表视图\"><a class=\"anchor\" href=\"#listview列表视图\">#</a> ListView（列表视图）</h3>\n<h4 id=\"常用属性-3\"><a class=\"anchor\" href=\"#常用属性-3\">#</a> 常用属性</h4>\n<h4 id=\"adapter接口\"><a class=\"anchor\" href=\"#adapter接口\">#</a> Adapter 接口</h4>\n<h4 id=\"demo演示\"><a class=\"anchor\" href=\"#demo演示\">#</a> demo 演示</h4>\n<blockquote>\n<p>先在主页面中放置一个 ListView 并给 id，它的父控件必须是 LinearLayout</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 设置分割线颜色和高度，也可以自定义，自己画一个</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        android:divider=\"\"</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        android:dividerHeight=\"\"</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ListView</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/lv_1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>listSelector</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/list_item<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>然后在主方法中先找到 ListView，然后直接个 ListView.setAdapter ()</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">ListView</span> lv_1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_listview<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    lv_1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>lv_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    lv_1<span class=\"token punctuation\">.</span><span class=\"token function\">setAdapter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyListAdapter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ListViewActiveity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>如果是要在外面获取到数据，请先查看一下数据的 json 格式。</p>\n<p>然后再新建一个 Model 类，放置需要取到的数据并给上 get,set 方法</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Model</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> birthday<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">String</span> avatar<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getBirthday</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> birthday<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setBirthday</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> birthday<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>birthday <span class=\"token operator\">=</span> birthday<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getAvatar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> avatar<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAvatar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> avatar<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>avatar <span class=\"token operator\">=</span> avatar<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>新建自己的 Adapter 并继承 BaseAdapter，记得跟主方法中 new 的一致</p>\n<p>然后再重写四个方法</p>\n<p><code>getCount</code> ：获取返回条目数量</p>\n<p><code>getItem</code> ：</p>\n<p><code>getItemId</code> ：</p>\n<p><code>getView</code> ：</p>\n</blockquote>\n<blockquote>\n<p>重写完后，记得写两个变量并给个全参</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Model</span><span class=\"token punctuation\">></span></span> listData<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">MyAdapter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Model</span><span class=\"token punctuation\">></span></span> listData<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>listData <span class=\"token operator\">=</span> listData<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>在 Adapter 中另外写一个 <code>ViewHolder</code>  去绑定 ListView 单条样式中存在的控件</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewHolder</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ImageView</span> imageView<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TextView</span> tvTitle<span class=\"token punctuation\">,</span>tvTime<span class=\"token punctuation\">,</span>tvContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">View</span> <span class=\"token function\">getView</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> position<span class=\"token punctuation\">,</span> <span class=\"token class-name\">View</span> convertView<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ViewGroup</span> parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">ViewHolder</span> holder <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>convertView <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 若返回视图没有数据</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        convertView <span class=\"token operator\">=</span> layoutInflater<span class=\"token punctuation\">.</span><span class=\"token function\">inflate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>layout_list_item<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 将需要返回的视图绑定一下</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        holder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ViewHolder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 将单条 ListView 样式的控件进行绑定</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        holder<span class=\"token punctuation\">.</span>imageView <span class=\"token operator\">=</span> convertView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        holder<span class=\"token punctuation\">.</span>tvTitle <span class=\"token operator\">=</span> convertView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        holder<span class=\"token punctuation\">.</span>tvTime <span class=\"token operator\">=</span> convertView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        holder<span class=\"token punctuation\">.</span>tvContent <span class=\"token operator\">=</span> convertView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        convertView<span class=\"token punctuation\">.</span><span class=\"token function\">setTag</span><span class=\"token punctuation\">(</span>holder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 然后将控件都丢到视图中</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        holder <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewHolder</span><span class=\"token punctuation\">)</span> convertView<span class=\"token punctuation\">.</span><span class=\"token function\">getTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 若视图存在数据，则直接把是视图的东西直接复制给 holder</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 给控件赋值</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    holder<span class=\"token punctuation\">.</span>tvTitle<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这是标题\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    holder<span class=\"token punctuation\">.</span>tvTime<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2008-08-08\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    holder<span class=\"token punctuation\">.</span>tvContent<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这是内容》》》》》\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token class-name\">Glide</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span>holder<span class=\"token punctuation\">.</span>imageView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">return</span> convertView<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"gridview网格视图\"><a class=\"anchor\" href=\"#gridview网格视图\">#</a> GridView（网格视图）</h3>\n<hr />\n<h3 id=\"滚动视图\"><a class=\"anchor\" href=\"#滚动视图\">#</a> 滚动视图</h3>\n<h4 id=\"scrollview竖直滚动\"><a class=\"anchor\" href=\"#scrollview竖直滚动\">#</a> ScrollView（竖直滚动）</h4>\n<h4 id=\"horizontalscrollview水平方向\"><a class=\"anchor\" href=\"#horizontalscrollview水平方向\">#</a> HorizontalScrollView（水平方向）</h4>\n<blockquote>\n<p>注意： <code>ScrollView</code>  和 <code>HorizontalScrollView</code>  的子控件只能有一个，所以一般都是套一个 LinearLayout</p>\n</blockquote>\n<hr />\n<h3 id=\"progressbar进度条\"><a class=\"anchor\" href=\"#progressbar进度条\">#</a> ProgressBar（进度条）</h3>\n<h4 id=\"属性-7\"><a class=\"anchor\" href=\"#属性-7\">#</a> 属性</h4>\n<ul>\n<li>android:max; 进度条的最大值</li>\n<li>android:progress 进度条已完成进度值</li>\n<li>android:indeterminate: 如果设置成 true, 则进度条不精确显示进度</li>\n<li>水平进度条</li>\n</ul>\n<hr />\n<h3 id=\"notification通知\"><a class=\"anchor\" href=\"#notification通知\">#</a> Notification（通知）</h3>\n<ol>\n<li>\n<p>创建一个 NotificationManager</p>\n</li>\n<li>\n<p>使用 Builder 构造器来创建 Notification 对象</p>\n</li>\n<li>\n<p>设立一个点击事件去发送 Notification</p>\n</li>\n<li>\n<p><code>NotificationActivity.class</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotificationActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> btn_1<span class=\"token punctuation\">,</span> btn_2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">NotificationManager</span> manager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Notification</span> notification<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_notification<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        btn_1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        btn_2 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        manager <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NotificationManager</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getSystemService</span><span class=\"token punctuation\">(</span>NOTIFICATION_SERVICE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 创建一个 NotificationManager</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Build</span><span class=\"token punctuation\">.</span>VERSION<span class=\"token punctuation\">.</span>SDK_INT <span class=\"token operator\">>=</span> <span class=\"token class-name\">Build<span class=\"token punctuation\">.</span>VERSION_CODES<span class=\"token punctuation\">.</span>O</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">NotificationChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NotificationChannel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"leo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试通知\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">NotificationManager</span><span class=\"token punctuation\">.</span>IMPORTANCE_HIGH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            manager<span class=\"token punctuation\">.</span><span class=\"token function\">createNotificationChannel</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Intent</span> intent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">NotificationActivity_2</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">PendingIntent</span> pendingIntent <span class=\"token operator\">=</span> <span class=\"token class-name\">PendingIntent</span><span class=\"token punctuation\">.</span><span class=\"token function\">getActivity</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> intent<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        notification <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NotificationCompat<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"leo\"</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 使用 Builder 构造器来创建 Notification 对象</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setContentTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"官方通知\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setContentText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"世界那么大，想去走走吗\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setSmallIcon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>ic_baseline_assignment_ind_24<span class=\"token punctuation\">)</span><span class=\"token comment\">// 小图标</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setColor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseColor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#FF0000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 设置小图标哦颜色</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setLargeIcon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BitmapFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">decodeResource</span><span class=\"token punctuation\">(</span><span class=\"token function\">getResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>heng<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 设置大图标</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setContentIntent</span><span class=\"token punctuation\">(</span>pendingIntent<span class=\"token punctuation\">)</span><span class=\"token comment\">// 点击通知跳转</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">setAutoCancel</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 点击通知后自动取消</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">// 设立一个点击事件去发送 Notification</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        btn_1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            manager<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>notification<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        btn_2<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> manager<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p><code>NotificationActivity_2.class</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotificationActivity_2</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Activity</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: 进入NotificationActivity\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"notificationchannel通知渠道\"><a class=\"anchor\" href=\"#notificationchannel通知渠道\">#</a> NotificationChannel（通知渠道）</h4>\n<p>Android 8.0 引入了通知渠道，其允许您为要显示的每种通知类  型创建用户可自定义的渠道</p>\n<p><strong>通知重要程度设置，NotificationManager 类中</strong></p>\n<p>➢ IMPORTANCE_ NONE 关闭通知</p>\n<p>➢ IMPORTANCE_ MIN 开启通知，不会弹出，但没有提示音，状态栏中无显示</p>\n<p>➢ IMPORTANCE_ Low 开启通知，不会弹出，不发出提示音，状态栏中显示</p>\n<p>➢ IMPORTANCE_ ,DEFAULT 开启通知，不会弹出，发出提示音，状态栏中显示</p>\n<p>➢ IMPORTANCE_ HIGH 开启通知，会弹出，发出提示音，状态栏中显示.</p>\n<h4 id=\"常见方法说明\"><a class=\"anchor\" href=\"#常见方法说明\">#</a> 常见方法说明</h4>\n<p>➢ setContetTtle (tring string)：设置标题</p>\n<p>➢ setContentText (String string)：设置文本内容</p>\n<p>➢ setsmallcon (int icon)：设置小图标</p>\n<p>➢ setLargelcon (Bitmap icon)：设置通知的大图标</p>\n<p>➢ setColor [int argb)：设置小图标的颜色</p>\n<p>➢ setContentIntent (PendingIntent intent)：设置点击通知后的跳转意图</p>\n<p>➢ setAutaoCanel (boolan boolean)：设置点击通知后自动清除通知.</p>\n<p>➢ setWhen (long when)：设置通知被创建的时间</p>\n<h3 id=\"toolbar\"><a class=\"anchor\" href=\"#toolbar\">#</a> ToolBar</h3>\n<blockquote>\n<p>取消系统默认 actionbar：</p>\n<p>​\t\t\t\t\t将 src/main/res/values/themes.xml 下的 style 改为 NoActionBar.Bigder</p>\n</blockquote>\n<h4 id=\"属性-8\"><a class=\"anchor\" href=\"#属性-8\">#</a> 属性</h4>\n<p>android:layout_ <em>width=&quot; match</em> parent&quot;</p>\n<p>android:layout_ height=&quot;?attr/actionBarSize&quot;（与原生 toolbar 高度一致）</p>\n<p>android:background：背景色</p>\n<p>app:navigationlcon：返回图标</p>\n<p>app:title=&quot;主标题&quot;</p>\n<p>app:titleTextColor=&quot; #f0000&quot;</p>\n<p>app:titleMarginStart=&quot; '90dp&quot;</p>\n<p>app:subtitle=&quot;子标题&quot;</p>\n<p>app:subtitleTextCol-=&quot;#ffff</p>\n<p>app:logo=&quot;@mipmap/ic launcher&quot;（在返回标签和主标题之间）</p>\n<h4 id=\"xml配置androidxtoolbar\"><a class=\"anchor\" href=\"#xml配置androidxtoolbar\">#</a> xml 配置 androidx.toolbar</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>androidx.appcompat.widget.Toolbar</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/toolbar<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FFFF00<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>navigationIcon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/ic_baseline_assignment_ind_24<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>标题<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>titleTextColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FF0000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>titleMarginStart</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>90dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>subtitle</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>副标题<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>subtitleTextColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#0000FF<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>logo</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@mipmap/ic_launcher<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>?attr/actionBarSize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><blockquote>\n<p>给返回标签的点击事件</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Toolbar</span> toolbar <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>toolbar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//setOnclikListener 是整个 toolbar 点击了都有效果（不能用）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 所以这里要设置 Navigation 的点击监听</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>toolbar<span class=\"token punctuation\">.</span><span class=\"token function\">setNavigationOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: toolbar点击了\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//toolbar.setOnClickListener(view -> Log.e(\"zxy\",\"onCreate: \"));</span></pre></td></tr></table></figure><h4 id=\"java配置toolbar内容\"><a class=\"anchor\" href=\"#java配置toolbar内容\">#</a> java 配置 Toolbar 内容</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 在 java 中设置 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>androidx.appcompat.widget.Toolbar</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/toolbar2<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FFFF00<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>?attr/actionBarSize<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginTop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20dp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><blockquote>\n<p>Java 的配置</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Toolbar</span> toolbar2 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>toolbar2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>toolbar2<span class=\"token punctuation\">.</span><span class=\"token function\">setNavigationIcon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>ic_baseline_assignment_ind_24<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>toolbar2<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"标题\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>toolbar2<span class=\"token punctuation\">.</span><span class=\"token function\">setNavigationOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: toolbar2点击了\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"标题居中\"><a class=\"anchor\" href=\"#标题居中\">#</a> 标题居中</h4>\n<blockquote>\n<p>建议的方法是将 toolbar 不自包，里面嵌入一层 Textview，并且给 textview 附上 android:layout_gravity 属性</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 设置标题居中 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>androidx.appcompat.widget.Toolbar</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>?attr/actionBarSize<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#FFFF00<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginTop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token attr-name\"><span class=\"token namespace\">app:</span>navigationIcon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/ic_baseline_assignment_ind_24<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/tv_1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>标题<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>androidx.appcompat.widget.Toolbar</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"alertdialog\"><a class=\"anchor\" href=\"#alertdialog\">#</a> AlertDialog</h3>\n<h4 id=\"属性-9\"><a class=\"anchor\" href=\"#属性-9\">#</a> 属性</h4>\n<p>AlertDialog,Builder builder = new AlertDialog Builder (context); 构建 Dialog 的各种参数</p>\n<p>Builder.setlcon (int iconld); 添加 ICON</p>\n<p>BuilersetTitle (CharSequence title); 添加标题</p>\n<p>Builder.setMessage (CharSequence message); 添加消息</p>\n<p>Builder.setView (View view); 设置自定义布局</p>\n<p>Builder.create (); 创建 Dialog</p>\n<p>Bulder.show); 显示对话框</p>\n<p>setPositiveButton 确定按钮</p>\n<p>setNegativeButton 取消按钮</p>\n<p>setNeutralButton 中间按钮</p>\n<h4 id=\"创建对话框\"><a class=\"anchor\" href=\"#创建对话框\">#</a> 创建对话框</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>btn_1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>btn_1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">AlertDialog<span class=\"token punctuation\">.</span>Builder</span> builder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AlertDialog<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    builder<span class=\"token punctuation\">.</span><span class=\"token function\">setIcon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>mipmap<span class=\"token punctuation\">.</span>ic_launcher<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我的对话框\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setView</span><span class=\"token punctuation\">(</span>dialogview<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 后面顺序不能变</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"给对话框增加相应按钮\"><a class=\"anchor\" href=\"#给对话框增加相应按钮\">#</a> 给对话框增加相应按钮</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>btn_1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">AlertDialog<span class=\"token punctuation\">.</span>Builder</span> builder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AlertDialog<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    builder<span class=\"token punctuation\">.</span><span class=\"token function\">setIcon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>mipmap<span class=\"token punctuation\">.</span>ic_launcher<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我的对话框\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setView</span><span class=\"token punctuation\">(</span>dialogview<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setPositiveButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"确定\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>dialogInterface<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onClick: 点击了确定\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setNegativeButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"取消\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>dialogInterface<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onClick: 点击了取消\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">setNeutralButton</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"中间\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>dialogInterface<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onClick: 点击了中间\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 后面顺序不能变</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>样式如下</p>\n<p><img data-src=\"Android%E5%85%A5%E9%97%A8/01.png\" alt=\"\" /><img data-src=\"/zxy/Android%E5%85%A5%E9%97%A8/01.png\" class=\"\"></p>\n<h4 id=\"自定义样式-2\"><a class=\"anchor\" href=\"#自定义样式-2\">#</a> 自定义样式</h4>\n<blockquote>\n<ol>\n<li>先创建一个 layout，然后规定好样式</li>\n<li>然后再 AlertDialog 方法中添加一下代码</li>\n</ol>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 方法外面加</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">View</span> dialogview <span class=\"token operator\">=</span> <span class=\"token function\">getLayoutInflater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">inflate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>dialog_view<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 方法里面加</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 注意！！！此处的链式最后两段必须是.create ().show ()</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">setView</span><span class=\"token punctuation\">(</span>dialogview<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h3 id=\"popupwindow\"><a class=\"anchor\" href=\"#popupwindow\">#</a> PopupWindow</h3>\n<h4 id=\"属性-10\"><a class=\"anchor\" href=\"#属性-10\">#</a> 属性</h4>\n<p>setContentView (View contentView): 设置 PopupWindow 显示的 View</p>\n<p>showAsDropDown (View anchor): 相对某个控件的位置 (正左下方)，无偏移</p>\n<p>showAsDropDown (View anchor, int xoff, int yoff); 相对某个控件的位置，有偏移</p>\n<p>setFocusable (boolean focusable) 设置是否获取焦点</p>\n<p>setBackgroundDrawable (Drawable background) 设置背景</p>\n<p>dismiss () 关闭弹窗</p>\n<p>setAnimationStyle (int animationStyle) 设置加载动画</p>\n<p>setTquchable (boolean touchable) 设置触摸使能</p>\n<p>setOytsideTouchable (boolean touchable) 设置 PopupWindow 外面的触摸使能</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_popup_window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    btn_1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    btn_1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">View</span> popupView <span class=\"token operator\">=</span> <span class=\"token function\">getLayoutInflater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">inflate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_popup_window_view<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Button</span> btn1 <span class=\"token operator\">=</span> popupView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Button</span> btn2 <span class=\"token operator\">=</span> popupView<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">PopupWindow</span> popupWindow <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PopupWindow</span><span class=\"token punctuation\">(</span>popupView<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ViewGroup<span class=\"token punctuation\">.</span>LayoutParams</span><span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                                                  <span class=\"token class-name\">ViewGroup<span class=\"token punctuation\">.</span>LayoutParams</span><span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 第四个参数设置点击空白处，退出弹窗</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        popupWindow<span class=\"token punctuation\">.</span><span class=\"token function\">setBackgroundDrawable</span><span class=\"token punctuation\">(</span><span class=\"token function\">getResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDrawable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>heng<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 给弹窗做出背景</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">//            popupWindow.showAsDropDown (view);// 在控件的正下方显示</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        popupWindow<span class=\"token punctuation\">.</span><span class=\"token function\">showAsDropDown</span><span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">,</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 设置一些位置的更改，X 轴 Y 轴</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        btn1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view1 <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: 你是住在上海吗\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            popupWindow<span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        btn2<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view1 <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: 你是住在上海吗\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            popupWindow<span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"toast\"><a class=\"anchor\" href=\"#toast\">#</a> Toast</h3>\n<h4 id=\"设置显示位置\"><a class=\"anchor\" href=\"#设置显示位置\">#</a> 设置显示位置</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_toast_2<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Toast</span> toastCent <span class=\"token operator\">=</span> <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"居中Toast\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    toastCent<span class=\"token punctuation\">.</span><span class=\"token function\">setGravity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Gravity</span><span class=\"token punctuation\">.</span>CENTER<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    toastCent<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"自定义显示内容\"><a class=\"anchor\" href=\"#自定义显示内容\">#</a> 自定义显示内容</h4>\n<blockquote>\n<p>需要先定义一个 layout。切记：为了能够显示规定大小，需要另外包一层布局</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>android</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.android.com/apk/res/android<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>background</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#99000000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>              <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LinearLayout</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>orientation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vertical<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ImageView</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/iv_toast<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                   <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>scaleType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fitCenter<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TextView</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/tv_1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_marginTop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10dp<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textColor</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@color/white<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                  <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>textSize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>18sp<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LinearLayout</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>接下来只需要绑定一下那个 layout 然后再绑定 layout 下面的控件并附上值即可</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_toast_3<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Toast</span> toastCustom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">(</span><span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">LayoutInflater</span> inflater <span class=\"token operator\">=</span> <span class=\"token class-name\">LayoutInflater</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ToastActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">View</span> view1 <span class=\"token operator\">=</span> inflater<span class=\"token punctuation\">.</span><span class=\"token function\">inflate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>layout_toast<span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">ImageView</span> imageView <span class=\"token operator\">=</span> view1<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>iv_toast<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">TextView</span> textView <span class=\"token operator\">=</span> view1<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>tv_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>imageView<span class=\"token punctuation\">.</span><span class=\"token function\">setImageResource</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>ic_baseline_tag_faces_24<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>textView<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"自定义Toast\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>toastCustom<span class=\"token punctuation\">.</span><span class=\"token function\">setView</span><span class=\"token punctuation\">(</span>view1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>toastCustom<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"简单封装\"><a class=\"anchor\" href=\"#简单封装\">#</a> 简单封装</h4>\n<blockquote>\n<p>由于 Toast 的 <code>Toast.LENGTH_SHORT</code>  在点击多次的时候会有多次的弹出</p>\n<p>所以我们可以选择 <code>Toast.LENGTH_LONG</code>  让弹出存在一次，并且附加上封装成 Util</p>\n</blockquote>\n<blockquote>\n<p>第一步正常的就是先写好 Util 包</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ToastUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Toast</span> mtoast<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">showMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mtoast <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            mtoast <span class=\"token operator\">=</span> <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span>msg<span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_LONG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            mtoast<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        mtoast<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>然后只需要在使用中调用工具包即可</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_toast_4<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">ToastUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">showMsg</span><span class=\"token punctuation\">(</span><span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"包装过的Toast\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><hr />\n<h2 id=\"动画\"><a class=\"anchor\" href=\"#动画\">#</a> 动画</h2>\n<h3 id=\"逐帧动画\"><a class=\"anchor\" href=\"#逐帧动画\">#</a> 逐帧动画</h3>\n<blockquote>\n<p>// 获取动画的 Drawable 资源<br />\n AnimationDrawable anim = (AnimationDrawable) relativeLayout.getBackground ();</p>\n<p>// 启动动画<br />\n anim.start ();</p>\n<p>// 停止动画<br />\n anim.stop ();</p>\n</blockquote>\n<ol>\n<li>\n<p>将逐帧图片放入 drawable 中</p>\n</li>\n<li>\n<p>在 drawable 中新建一个 frame.xml</p>\n<p><img data-src=\"Android%E5%85%A5%E9%97%A8/02.png\" alt=\"\" /><img data-src=\"/zxy/Android%E5%85%A5%E9%97%A8/02.png\" class=\"\"></p>\n</li>\n<li>\n<p>将 <code>selector</code>  改成 <code>animation-list</code> ，并在里面增加 <code>&lt;item&gt;</code>  标签</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>item</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>drawable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@drawable/heng<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>120<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!--android:duration 为持续时间，单位为毫秒，1s = 100 --></span></pre></td></tr></table></figure></li>\n<li>\n<p>然后就在相对应的背景中添加 frame.xml 文件</p>\n</li>\n<li>\n<p>给它增加动画效果</p>\n<ol>\n<li>\n<p>在方法中先找到控件（findViewById）</p>\n</li>\n<li>\n<p>获取到背景（ .getBackground () ）</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">AnimationDrawable</span> anim <span class=\"token operator\">=</span> 控件<span class=\"token punctuation\">.</span><span class=\"token function\">getBackground</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>给控件设置点击事件</p>\n<ol>\n<li>先设置一个标志位变量</li>\n<li>当标志位为 true 的时候启动，反之则停止</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>标志位<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 为 true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    anim<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    标志位 <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    anim<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    标志位 <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ol>\n<hr />\n<h3 id=\"补间动画\"><a class=\"anchor\" href=\"#补间动画\">#</a> 补间动画</h3>\n<h4 id=\"四种形式\"><a class=\"anchor\" href=\"#四种形式\">#</a> 四种形式</h4>\n<ol>\n<li>\n<p>alpha\t透明度（渐变动画）</p>\n<ul>\n<li>\n<p>先在 <code>res</code>  资源文件下新建个包 <code>anim</code> （名字必须一致）并新建 <code>aplha.xml</code>  文件</p>\n</li>\n<li>\n<p>在里面添加 <code>&lt;alpha&gt;</code>  标签</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alpha</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>durantion</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromAlpha</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toAlpha</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!--    android:durantion 持续时间</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    android:fromAlpha 初始时透明度</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    android:toAlpha 结束时透明度 --></span></pre></td></tr></table></figure></li>\n<li>\n<p>找到图片控件并且设置点击事件</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 通过加载 xml 动画设置文件来创建一个 Animation 对象</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">AnimationUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">loadAnimation</span><span class=\"token punctuation\">(</span>显示的页面<span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>anim<span class=\"token punctuation\">.</span>alpha<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>imageView<span class=\"token punctuation\">.</span><span class=\"token function\">starAnimation</span><span class=\"token punctuation\">(</span>animation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>rotate\t旋转</p>\n<ul>\n<li>\n<p>先在 <code>res</code>  资源文件下新建个包 <code>anim</code> （名字必须一致）并新建 <code>rotate.xml</code>  文件</p>\n</li>\n<li>\n<p>在里面添加 <code>&lt;rotate&gt;</code></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rotate</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromDegrees</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>pivotX</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>pivotY</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toDegrees</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>360<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!--android:duration 持续时间</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        android:fromDegrees 从哪个角度开始旋转</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        android:pivotX=\"50%\"    以正中心为点</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        android:pivotY=\"50%\"</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        android:toDegrees=\"360\" 旋转多少度 --></span></pre></td></tr></table></figure></li>\n<li>\n<p>将上方点击事件执行的动画样式改成这个即可</p>\n</li>\n</ul>\n</li>\n<li>\n<p>scale\t缩放</p>\n<ul>\n<li>\n<p>跟上方操作一样</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scale</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromXScale</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromYScale</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>pivotY</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>pivotX</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toXScale</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.5<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>       <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toYScale</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0.5<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">&lt;!--android:duration=\"2000\"     动画总时间</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    android:fromXScale=\"1\"      原来的 X 尺寸</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    android:fromYScale=\"1\"      原来的 Y 尺寸</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    android:pivotY=\"50%\"        以中心点为轴</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    android:pivotX=\"50%\"</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    android:toXScale=\"0.5\"      缩放到原来的 0.5</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    android:toYScale=\"0.5\"--></span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>translate\t平移</p>\n<ul>\n<li>\n<p>跟上方操作一样</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>translate</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>           <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>duration</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>           <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>           <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>fromYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>           <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toXDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>400<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>           <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>toYDelta</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>400<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!--android:duration=\"2000\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        android:fromXDelta=\"0\"      从那里</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        android:fromYDelta=\"0\"</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        android:toXDelta=\"400\"      平移到哪里</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        android:toYDelta=\"400\"--></span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"属性动画\"><a class=\"anchor\" href=\"#属性动画\">#</a> 属性动画</h3>\n<h2 id=\"fragment\"><a class=\"anchor\" href=\"#fragment\">#</a> Fragment</h2>\n<h3 id=\"动态添加fragment\"><a class=\"anchor\" href=\"#动态添加fragment\">#</a> 动态添加 Fragment</h3>\n<blockquote>\n<p>先给 Button 做统一的点击事件。</p>\n<p>可以直接在类上实现 <code>implements View.OnClickListener</code> ；</p>\n<p>也可以重新定义一个类 A，让它去 <code>implements View.OnClickListener</code> ，用主类的方法 B 调用类 A，main 里面使用方法 B</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Button</span> btn1<span class=\"token punctuation\">,</span>btn2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_fragment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    btn1 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    btn2 <span class=\"token operator\">=</span> <span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">OnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">OnClickListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token class-name\">Onclik</span> onclik <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Onclik</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    btn1<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>onclik<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Onclik</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn1<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn2<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>然后在创建方法 <code>replaceFragment</code> ，并且在里面让 fragment 替换成你需要的 fragment</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Fragment</span> fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">FragmentManager</span> fragmentManager <span class=\"token operator\">=</span> <span class=\"token function\">getSupportFragmentManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">FragmentTransaction</span> transaction <span class=\"token operator\">=</span> fragmentManager<span class=\"token punctuation\">.</span><span class=\"token function\">beginTransaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    transaction<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>framelayout<span class=\"token punctuation\">,</span>fragment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 将页面替换上去</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    transaction<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 将上方事件提交</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h4>\n<ol>\n<li>创建一个待处理的 fragment</li>\n<li>获取 FragmentManager，- 般 都是通过 getSupportFragmentManager ()</li>\n<li>开启一个事务 transaction，一般调 用 fragmentManager 的 beginTransaction ()</li>\n<li>使用 transaction 进行 fragment 的替换</li>\n<li>提交事务</li>\n</ol>\n<h3 id=\"activity与fragment通信\"><a class=\"anchor\" href=\"#activity与fragment通信\">#</a> Activity 与 Fragment 通信</h3>\n<h4 id=\"原生方案bundle\"><a class=\"anchor\" href=\"#原生方案bundle\">#</a> 原生方案：Bundle</h4>\n<p><strong>作用</strong>：在 Activity 中传递信息</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Onclik</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn1<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token class-name\">Bundle</span> bundle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                bundle<span class=\"token punctuation\">.</span><span class=\"token function\">putString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token class-name\">BlankFragment</span> bf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                bf<span class=\"token punctuation\">.</span><span class=\"token function\">setArguments</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span>bf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn2<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>只要在另外的界面中自己接一下就可以了</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Bundle</span> bundle <span class=\"token operator\">=</span> <span class=\"token function\">getArguments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">String</span> string <span class=\"token operator\">=</span> bundle<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">Log</span><span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"onCreate: \"</span> <span class=\"token operator\">+</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getArguments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        mParam1 <span class=\"token operator\">=</span> <span class=\"token function\">getArguments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span>ARG_PARAM1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        mParam2 <span class=\"token operator\">=</span> <span class=\"token function\">getArguments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span>ARG_PARAM2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"java方案接口\"><a class=\"anchor\" href=\"#java方案接口\">#</a> Java 方案：接口</h4>\n<blockquote>\n<p>创建一个接口</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IFragmentCallback</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> <span class=\"token function\">getMsgFromActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>在需要展现的 fragment 中增加</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">IFragmentCallback</span> fragmentCallback<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setFragmentCallback</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IFragmentCallback</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    fragmentCallback <span class=\"token operator\">=</span> callback<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>在 main 方法中他们的点击事件里，增加</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bf<span class=\"token punctuation\">.</span><span class=\"token function\">setFragmentCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IFragmentCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getMsgFromActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>为了传递数据，我们在需要展示的页面中增加一个 button</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Button</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@+id/btn_3<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>match_parent<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>wrap_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>layout_gravity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>数据传递<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><blockquote>\n<p>在需要展示的页面类中，新增 <code>onResume</code>  方法并在 <code>onCreateView</code>  中增加那个 button 的点击事件</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">View</span> <span class=\"token function\">onCreateView</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LayoutInflater</span> inflater<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ViewGroup</span> container<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                         <span class=\"token class-name\">Bundle</span> savedInstanceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// Inflate the layout for this fragment</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rootview <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        rootview <span class=\"token operator\">=</span> inflater<span class=\"token punctuation\">.</span><span class=\"token function\">inflate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>fragment_blank<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">Button</span> btn <span class=\"token operator\">=</span> rootview<span class=\"token punctuation\">.</span><span class=\"token function\">findViewById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn_3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    btn<span class=\"token punctuation\">.</span><span class=\"token function\">setOnClickListener</span><span class=\"token punctuation\">(</span>view <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        fragmentCallback<span class=\"token punctuation\">.</span><span class=\"token function\">sendMsgToActivity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello,I'm from Fragment\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">//            String msg = fragmentCallback.getMsgFromActivity(\"null\");</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//            Toast.makeText(BlankFragment.this.getContext(),msg,Toast.LENGTH_SHORT).show();</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">return</span> rootview<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onResume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onResume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>最后只要在 main 方法中增加需要展示页面的接口方法</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Onclik</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">View<span class=\"token punctuation\">.</span>OnClickListener</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">View</span> view<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn1<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token class-name\">Bundle</span> bundle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                bundle<span class=\"token punctuation\">.</span><span class=\"token function\">putString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token class-name\">BlankFragment</span> bf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                bf<span class=\"token punctuation\">.</span><span class=\"token function\">setArguments</span><span class=\"token punctuation\">(</span>bundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                bf<span class=\"token punctuation\">.</span><span class=\"token function\">setFragmentCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IFragmentCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsgToActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                        <span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FragmentActivity</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>msg<span class=\"token punctuation\">,</span><span class=\"token class-name\">Toast</span><span class=\"token punctuation\">.</span>LENGTH_SHORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getMsgFromActivity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello,I'm from getMsgFromActivity\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span>bf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>btn2<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token function\">replaceFragment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BlankFragment2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"其他方案evenbuslivedata\"><a class=\"anchor\" href=\"#其他方案evenbuslivedata\">#</a> 其他方案：evenBus,LiveData...</h4>\n<h2 id=\"activity\"><a class=\"anchor\" href=\"#activity\">#</a> Activity</h2>\n<h3 id=\"生命周期\"><a class=\"anchor\" href=\"#生命周期\">#</a> 生命周期</h3>\n<p><img data-src=\"Android%E5%85%A5%E9%97%A8/image-20210907193934240.png\" alt=\"\" /><img data-src=\"/zxy/Android%E5%85%A5%E9%97%A8/image-20210907193934240.png\" class=\"\"></p>\n<ol>\n<li>\n<p>打开界面</p>\n<p>onCreate() -&gt; onCreateView() -&gt;onActivityCreated() -&gt;onStart() -&gt;onResume()</p>\n</li>\n<li>\n<p>按下主屏键</p>\n<p>onPause() -&gt;onStop()</p>\n</li>\n<li>\n<p>重新打开界面</p>\n<p>onStart() -&gt;onResume()</p>\n</li>\n<li>\n<p>按后退键</p>\n<p>onPause()- &gt;onStop()-&gt;onDestroyView()- &gt;onDestroy()-&gt;onDetach()</p>\n</li>\n</ol>\n<h4 id=\"总结-2\"><a class=\"anchor\" href=\"#总结-2\">#</a> 总结</h4>\n<ol>\n<li>将来开发者会围绕 fragment 生命周期花很多时间来解决问题</li>\n<li>Fragment 的使用一定是需要在生命周期函数 onAttach 与 onDetach 之间</li>\n<li>Fragment 的使用一定要 遵守生命周期管理的规则，在正确的地方写恰当的代码</li>\n</ol>\n<h3 id=\"跳转和数据传递\"><a class=\"anchor\" href=\"#跳转和数据传递\">#</a> 跳转和数据传递</h3>\n<h4 id=\"显式跳转和隐式跳转\"><a class=\"anchor\" href=\"#显式跳转和隐式跳转\">#</a> 显式跳转和隐式跳转</h4>\n<h4 id=\"activity之间的数据传递\"><a class=\"anchor\" href=\"#activity之间的数据传递\">#</a> Activity 之间的数据传递</h4>\n<h4 id=\"startactivityforresult启动activity结束后返回结果\"><a class=\"anchor\" href=\"#startactivityforresult启动activity结束后返回结果\">#</a> StartActivityForResult：启动 Activity，结束后返回结果</h4>\n<h2 id=\"viewpager\"><a class=\"anchor\" href=\"#viewpager\">#</a> ViewPager</h2>\n<h3 id=\"使用流程\"><a class=\"anchor\" href=\"#使用流程\">#</a> 使用流程</h3>\n<blockquote>\n<p>定义 ViewPager</p>\n</blockquote>\n<blockquote>\n<p>为 ViewPager 构建 Adapter</p>\n</blockquote>\n<blockquote>\n<p>创建 Adapter 类并继承 RecyclerView.Adapter</p>\n</blockquote>\n<blockquote>\n<p>构建 ViewPager 要展示页面的 ViewHolder</p>\n</blockquote>\n<blockquote>\n<p>实现必须方法</p>\n</blockquote>\n",
            "tags": [
                "计算机学习",
                "前端",
                "Android",
                "Android"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/",
            "url": "https://xinyao_idiot.gitee.io/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/",
            "title": "操作系统概论",
            "date_published": "2021-08-11T10:27:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"操作系统概论\"><a class=\"anchor\" href=\"#操作系统概论\">#</a> 操作系统概论</h1>\n<h2 id=\"考试题型\"><a class=\"anchor\" href=\"#考试题型\">#</a> 考试题型</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">题型</th>\n<th style=\"text-align:center\">数量</th>\n<th style=\"text-align:center\">分支</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">单选</td>\n<td style=\"text-align:center\">1 分 * 20</td>\n<td style=\"text-align:center\">20 分</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">填空</td>\n<td style=\"text-align:center\">2 分 * 10</td>\n<td style=\"text-align:center\">20 分</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">简答</td>\n<td style=\"text-align:center\">4 分 * 5</td>\n<td style=\"text-align:center\">20 分</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">综合</td>\n<td style=\"text-align:center\">10 分 * 4</td>\n<td style=\"text-align:center\">40 分</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h2 id=\"第一章操作系统简介\"><a class=\"anchor\" href=\"#第一章操作系统简介\">#</a> 第一章：操作系统简介</h2>\n<h3 id=\"11-什么是操作系统\"><a class=\"anchor\" href=\"#11-什么是操作系统\">#</a> 1.1 什么是操作系统</h3>\n<ol>\n<li>\n<p>操作系统的定义</p>\n<p>操作系统（Operating System，OS）是一种复杂的<strong>系统软件</strong>，是不同于<strong>程序代码</strong>、<strong>数据结构</strong>、<strong>数据初始化文件的集合</strong>，可执行。（选择、填空、简答）</p>\n</li>\n<li>\n<p><strong>用户与硬件之间</strong>的接口</p>\n<p>操作系统与<strong>硬件部分相互作用</strong>，比并且为运行在计算机上的<strong>应用程序提供执行环境</strong>。（选择、填空）</p>\n</li>\n<li>\n<p>资源的管理者</p>\n<ul>\n<li>\n<p><strong>处理机管理</strong></p>\n<p>定义：决定把处理机先给哪个程序用，后给哪个程序用</p>\n</li>\n<li>\n<p><strong>内存管理</strong></p>\n<p>定义：给程序分配内存空间</p>\n</li>\n<li>\n<p><strong>设备管理</strong></p>\n<p>定义：完成证明分配设备，分配哪台设备，怎么和设备连接等</p>\n</li>\n<li>\n<p><strong>文件管理</strong></p>\n<p>定义：为每个文件分配空间、建立目录、对目录进行组织管理以及根据用户请求从外存（硬盘）读取数据或将数据写入外存（硬盘）</p>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"12-操作系统的发展\"><a class=\"anchor\" href=\"#12-操作系统的发展\">#</a> 1.2 操作系统的发展</h3>\n<ol>\n<li>\n<p>发展历程</p>\n<ul>\n<li>\n<p><strong>单道 批处理系统</strong></p>\n<ul>\n<li>定义：单道批处理系统<strong>内存中只有一道作业</strong></li>\n<li>特点：<strong>自动性、顺序性、单道性</strong>（选择、填空）</li>\n<li>优点：减少了等待人工操作的时间</li>\n<li>缺点：CPU 资源不能得到充分的利用</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080901.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080901.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>多道 批处理系统</strong></p>\n<ul>\n<li>定义：由操作系统的<strong>作业调度程序按一定策略</strong>从后备作业队列中<strong>选择若干个作业调入内存</strong>，使他们共享 CPU 和系统中的各种资源</li>\n<li>特点：<strong>多道性、无序性、调度性、复杂性</strong>（选择、填空）</li>\n<li>优点：能够提高 CPU、内存和 IO 设备的利用率和系统的吞吐量（选择、简答）</li>\n<li>缺点：系统平均周转时间长（选择、简答）</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080902.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080902.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>分时 操作系统</strong></p>\n<ul>\n<li>定义：允许<strong>多个用户</strong>通过终端机<strong>同时使用</strong>计算机，每个用户通过终端与主机交互时都能得到快速响应。</li>\n<li>特点：<strong>多路性、独立性、及时性、交互性</strong>（选择、填空）</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080903.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080903.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>实时 操作系统</strong></p>\n<ul>\n<li>定义：实时系统必须<strong>及时响应</strong>外部时间的请求，在规定时间内完成对该事件的处理。主要用于<strong>实时控制</strong>和<strong>实时信息处理</strong>领域。（选择、填空）</li>\n<li>特点：<strong>多路性、独立性、及时性、交互性、可靠性</strong>（选择、填空）</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080904.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080904.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>操作系统产品现状（可略）</p>\n<table>\n<thead>\n<tr>\n<th>操作系统</th>\n<th>运行主体</th>\n<th>实例（了解即可）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>主机</strong>操作系统</td>\n<td>大型主机</td>\n<td>IBM 的 OS / 360、OS / 390</td>\n</tr>\n<tr>\n<td><strong>服务器</strong>操作系统</td>\n<td>网络服务器</td>\n<td>Linux、Windows Server</td>\n</tr>\n<tr>\n<td><strong>微机</strong>操作系统</td>\n<td>微型计算机</td>\n<td>Windows7、Mac OS</td>\n</tr>\n<tr>\n<td><strong>嵌入式</strong>操作系统</td>\n<td>嵌入式设备</td>\n<td>Android、iOS</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ol>\n<h3 id=\"13-操作系统特征\"><a class=\"anchor\" href=\"#13-操作系统特征\">#</a> 1.3 操作系统特征</h3>\n<ul>\n<li>现在操作系统都支持<strong>多任务</strong>，具有<strong>并发</strong>、<strong>共享</strong>、<strong>虚拟</strong>和<strong>异步性</strong>特征。\n<ul>\n<li>并发：两个或多个事件在<strong>同一时间间隔</strong>内发生</li>\n<li>共享：系统中的<strong>资源</strong>可供内存中多个并发执行的<strong>进程共同使用</strong>。</li>\n<li>虚拟：最常用<strong>内存虚拟化</strong>，用户感觉到的内存大于实际内存。</li>\n<li>异步性：进程以<strong>不可预知的速度</strong>向前推进。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"14-操作系统的功能\"><a class=\"anchor\" href=\"#14-操作系统的功能\">#</a> 1.4 操作系统的功能</h3>\n<ol>\n<li>\n<p>管理计算机资源</p>\n<ul>\n<li>\n<p>内存管理</p>\n<ul>\n<li>\n<p>含义：</p>\n<p>内存管理的主要任务是为<strong>多道程序的运行提供良好的环境</strong>，方便用户<strong>使用内存</strong>，提高内存的利用率，以及从<strong>逻辑上扩充内存</strong>以实现<strong>虚拟存储</strong>。</p>\n</li>\n<li>\n<p>内容：</p>\n<ol>\n<li>\n<p>内存分配</p>\n<p>主要任务是<strong>为每道程序分配内存空间</strong>，可采用两种分配方式，即<strong>静态分配方式</strong>和<strong>动态分配方式</strong>。</p>\n<ul>\n<li>静态分配方式\n<ul>\n<li>先把内存划分先把内存划分定的区域</li>\n<li>大小数量不再变化</li>\n</ul>\n</li>\n<li>动态分配方式\n<ul>\n<li>根据进程实际，请求分配内存</li>\n<li>大小数量动态变化</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>内存保护</p>\n<ol>\n<li>\n<p>主要任务：</p>\n<p>一是使操作系统<strong>内核的空间</strong>不会被用户随意访问，以保证系统的安全和稳定；</p>\n<p>二是确保<strong>每道用户程序</strong>都在<strong>自己的内存空间</strong>中运行，互不干扰。</p>\n</li>\n<li>\n<p>内存保护的方式：</p>\n<ol>\n<li>\n<p>采用界限寄存器存放允许程序访问的地址区间的上限和下限。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080905.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080905.png\" class=\"\"></p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>地址映射</p>\n<p><strong>含义：<strong>CPU 执行程序过程中访问内存时，需要把</strong>程序的逻辑地址转变为物理地址</strong>，这个转换过程称为<strong>地址映射</strong>。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080906.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080906.png\" class=\"\"></p>\n</li>\n<li>\n<p>内存扩充</p>\n<p><strong>含义：<strong>借助于</strong>虚拟技术</strong>，从<strong>逻辑</strong>上扩充内存容量，使系统能够向用户提供比物理内存大的存储容量。</p>\n<p>➢<strong>请求调入：</strong></p>\n<p>允许系统在<strong>装入一部分用户程序</strong>时就启动该程序运行，在程序运行过程中<strong>若发现要执行的指令或访问的数据尚未装入内存</strong>，通过<strong>请求调入将需要指令或数据装入内存。</strong></p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080907.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080907.png\" class=\"\"></p>\n<p>➢<strong>置换功能：</strong></p>\n<p>在请求调入时，<strong>若发现内存空间不足</strong>，需要<strong>先将内存中的一部分内容换到外存中</strong>，以便<strong>腾出内存空间</strong>装入当前需要的内容。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080908.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080908.png\" class=\"\"></p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>进程管理</p>\n<ul>\n<li>内容：进程的描述与组织、进程控制、进程同步、进程通信及进程调度。</li>\n</ul>\n</li>\n<li>\n<p>设备管理</p>\n<ul>\n<li>含义：设备管理主要完成用户的<strong> I/O 请求</strong>，为用户<strong>分配 I/O 设备</strong>。</li>\n<li>功能：\n<ol>\n<li><strong>缓冲管理</strong></li>\n<li><strong>设备分配</strong></li>\n<li><strong>设备处理</strong></li>\n<li><strong>设备独立性和虚拟设备</strong> (设备独立性功能使应用程序独<br />\n立于物理设备)</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>文件管理</p>\n<ul>\n<li>\n<p>功能：</p>\n<ol>\n<li>\n<p>文件存储空间的管理</p>\n<p>为每个文件分配必要的<strong>外存空间</strong>，<strong>提高外存利用率</strong>，并能有助于<strong>提高访问文件的速度</strong>。</p>\n</li>\n<li>\n<p>目录管理</p>\n<p>为每个文件建立<strong>目录项</strong>并对众多目录项进行有效组织。目录项包括文件名、文件属性及文件的地址等信息。</p>\n</li>\n<li>\n<p>文件的读、写管理和存取控制</p>\n<p>根据用户的请求，<strong>从外存中读取数据</strong>或<strong>将数据写入外存</strong>。防止未经审核的用户存取文件，防止冒名顶替存取文件，防止以不正确的方式使用文件。</p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>提供用户接口</p>\n<ul>\n<li>命令接口\n<ul>\n<li>目的：为了便于用户与计算机系统的交互</li>\n<li>分类：联机用户接口和脱机用户接口</li>\n<li>联机：常命令接口由一组键盘操作命令和命令解释程序组成</li>\n<li>脱机：为批处理作业的用户提供，也称为批处理用户接口</li>\n</ul>\n</li>\n<li>图形用户接口\n<ul>\n<li>用户可以轻松地通过<strong>选择窗口、菜单、对话框、滚动条、图标等</strong>简单的操作来完成对作业和任务的提交与控制。</li>\n</ul>\n</li>\n<li>程序接口\n<ul>\n<li>用户程序接口指的是<strong>应用程序</strong>和系统的<strong>核心程序</strong>的接口，就是<strong>系统调用</strong>。</li>\n<li>系统调用是一组预先定义好的模块，它们提供<strong>一条管道</strong>让应用程序或用户能由此得到<strong>核心程</strong>序的服务。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"15-操作系统的体系结构\"><a class=\"anchor\" href=\"#15-操作系统的体系结构\">#</a> 1.5 操作系统的体系结构</h3>\n<ol>\n<li>简单的监控程序模型\n<ul>\n<li>功能简陋，任意时刻系统中只能运行一个任务 ，保证了对系统信息的互斥访问，保护了系统数据的安全。</li>\n</ul>\n</li>\n<li>单体结构模型一\n<ul>\n<li>所有的软件和数据结构都放置在 - 个逻辑模块中，对外层的用户程序提供一个完整的内核界面 —— 系统调用。</li>\n</ul>\n</li>\n<li>层次结构模型\n<ul>\n<li>基本思想是将操作系统分解为多个小的，容易理解的层。系统功能被隔离在不同层中。</li>\n</ul>\n</li>\n<li>客户 / 服务器模型与微内核结构\n<ul>\n<li>核心思想是核心功能外移，即把传统操作系统内核中的一些组成部分放到内核之外作为 - 个独立的服务器进程来实现。</li>\n</ul>\n</li>\n<li>动态可扩展结构模型\n<ul>\n<li>基本思想就是在运行过程中，能够动态地实现系统行为扩展的结构，也可称之为弹性结构。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"16-指令的执行\"><a class=\"anchor\" href=\"#16-指令的执行\">#</a> 1.6 指令的执行</h3>\n<ol>\n<li>\n<p><strong>指令周期</strong></p>\n<ul>\n<li><strong>程序是具有独立功能的一组指令的集合</strong>，程序的执行就是按照某种控制流执行指令的过程。</li>\n<li>一个<strong>单一指令</strong>需要的<strong>处理</strong>称为<strong>指令周期</strong>。</li>\n<li>一个指令周期可以划分为两个步骤，分别是<strong>取指周期</strong>和<strong>执行周期</strong>。</li>\n<li><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080909.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080909.png\" class=\"\"></li>\n<li>** 程序计数器 (PC)<strong> 保存有下一次要取的指令的地址。取到的指令被放置在处理器的</strong>指令寄存器 (IR)** 中。</li>\n</ul>\n</li>\n<li>\n<p><strong>取指令和执行指令</strong></p>\n<p>指令中包含确定处理器要采取动作的位，处理器解释指令并执行要求的动作。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080910.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21080910.png\" class=\"\"></p>\n<p>➢动作分类：</p>\n<ul>\n<li><strong>处理器与存储器</strong>之间的<strong>指令或数据传送</strong>操作</li>\n<li><strong>处理器与 I/O 设备</strong>之间的<strong>指令或数据传送</strong>操作</li>\n<li><strong>算术运算</strong>操作或<strong>逻辑运算</strong>操作</li>\n<li><strong>控制</strong>操作，即<strong>修改指令的执行顺序</strong>的操作</li>\n</ul>\n</li>\n</ol>\n<hr />\n<h2 id=\"第二章进程管理重点\"><a class=\"anchor\" href=\"#第二章进程管理重点\">#</a> 第二章：进程管理（重点）</h2>\n<h3 id=\"21-进程的描述\"><a class=\"anchor\" href=\"#21-进程的描述\">#</a> 2.1 进程的描述</h3>\n<h4 id=\"211程序的顺序执行与并发执行\"><a class=\"anchor\" href=\"#211程序的顺序执行与并发执行\">#</a> 2.1.1 程序的顺序执行与并发执行</h4>\n<ol>\n<li>\n<p>顺序执行</p>\n<ul>\n<li>含义：先进入内存的程序先执行，在一个程序执行完毕之前，不能执行其他程序</li>\n<li>特点：<strong>顺序性、封闭性、可再现性</strong></li>\n</ul>\n</li>\n<li>\n<p>并发执行</p>\n<ul>\n<li>含义：程序并发执行是指<strong>同一时间间隔内</strong>运行多个程序。一个程序执行结束前，可以运行其他程序</li>\n<li>特点：<strong>间断性、失去封闭性、不可再现性</strong></li>\n</ul>\n</li>\n<li>\n<p><strong>宏观并行</strong>：用户看到多个程序同时向前推进</p>\n<p><strong>微观串行</strong>：任意时刻<strong>一个 CPU</strong> 上只有<strong>一个程序</strong>在执行</p>\n</li>\n</ol>\n<h4 id=\"212进程的概念\"><a class=\"anchor\" href=\"#212进程的概念\">#</a> 2.1.2 进程的概念</h4>\n<ul>\n<li>\n<p>定义：</p>\n<ul>\n<li>\n<p>进程是允许并发执行的<strong>程序</strong>在某个数据集合上的<strong>运行过程</strong></p>\n</li>\n<li>\n<p>进程是由<strong>正文段、用户数据段及进程控制块</strong>共同组成的执行环境</p>\n<table>\n<thead>\n<tr>\n<th>正文段</th>\n<th>存放被执行的机器指令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>用户数据段</strong></td>\n<td><strong>存放用户数据</strong></td>\n</tr>\n<tr>\n<td><strong>进程控制块</strong></td>\n<td><strong>存放进程的运行环境</strong></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n</li>\n<li>\n<p>特征：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">特征</th>\n<th style=\"text-align:center\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">并发性</td>\n<td style=\"text-align:center\">多个进程实体能在一 - 段时间间隔内同时运行 &lt;br /&gt;<strong> 并发性是进程和现代操作系统的重要特征</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">动态性</td>\n<td style=\"text-align:center\">进程是实体的执行过程</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">独立性</td>\n<td style=\"text-align:center\">独立运行和资源调度的基本单位</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">异步性</td>\n<td style=\"text-align:center\">进程的执行时断时续 ，何时执行、何时暂停都无法预知</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">结构特征</td>\n<td style=\"text-align:center\">进程实体包括用户<strong>正文段、 用户数据段</strong>和<strong>进程控制块</strong></td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>进程与程序的比较：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">程序</th>\n<th style=\"text-align:center\">进程</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">静态</td>\n<td style=\"text-align:center\">动态</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">永久</td>\n<td style=\"text-align:center\">暂时</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">指令集合</td>\n<td style=\"text-align:center\">包括正文段、用户数据段、进程控制块</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>进程和程序的联系</p>\n<ol>\n<li>进程是程序的一次执行</li>\n<li>一个程序可以对应多个进程</li>\n<li>同一个程序可以在不同的数据集合上运行，构成不同的进程</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"213-进程控制块pcb\"><a class=\"anchor\" href=\"#213-进程控制块pcb\">#</a> 2.1.3 进程控制块（PCB）</h4>\n<ul>\n<li>进程实体包括用户正文段、用户数据段和进程控制段</li>\n<li>含义：进程控制块是进程实体的一部分，是操作系统中最重要的数据结构。<strong>记录</strong>了操作系统所需要的、用于<strong>描述进程</strong>及<strong>控制进程</strong>运行所需的<strong>全部信息</strong></li>\n<li>包含的信息\n<ol>\n<li>进程标识符信息：用于唯一标识一个进程</li>\n<li>处理机状态信息\n<ol>\n<li>通用寄存器</li>\n<li>指令计数器</li>\n<li>程序状态字 PSW</li>\n<li>用户栈指针</li>\n</ol>\n</li>\n<li>进程调度信息：包括进程状态信息、进程优先级和进程调度所需的其他信息</li>\n<li>进程控制信息：包括程序和数据的地址、进程同步和通信机制、资源清单、以及链接指针</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"214-进程的状态\"><a class=\"anchor\" href=\"#214-进程的状态\">#</a> 2.1.4 进程的状态</h4>\n<ul>\n<li>就绪态</li>\n<li>执行态</li>\n<li>阻塞态</li>\n</ul>\n<h4 id=\"215-进程的组织\"><a class=\"anchor\" href=\"#215-进程的组织\">#</a> 2.1.5 进程的组织</h4>\n<ol>\n<li>\n<p>链接方式</p>\n<ul>\n<li>把系统中具有<strong>相同状态</strong>的进程控制块 PCB 用其中的<strong>链接字</strong>连成一个对联</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081101.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081101.png\" class=\"\"></p>\n</li>\n<li>\n<p>索引方式</p>\n<ul>\n<li>系统根据所有进程的状态，建立索引表，索引表的每 - 一个表项指向一个 PCB 物理块</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081102.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081102.png\" class=\"\"></p>\n</li>\n<li>\n<p>进程队列</p>\n<ul>\n<li>把具有相同状态的进程控制块用队列组织起来</li>\n</ul>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081103.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081103.png\" class=\"\"></p>\n</li>\n</ol>\n<h3 id=\"22-进程的控制\"><a class=\"anchor\" href=\"#22-进程的控制\">#</a> 2.2 进程的控制</h3>\n<h4 id=\"221-创建\"><a class=\"anchor\" href=\"#221-创建\">#</a> 2.2.1 <strong>创建</strong></h4>\n<ul>\n<li>\n<p>什么情况下需要创建新进程呢？</p>\n<p>用户登录\t作业调度\t提供服务\t应用请求</p>\n</li>\n<li>\n<p>如何创建新进程？ /  创建新进程的步骤？</p>\n<ol>\n<li><strong>申请空白 PCB</strong></li>\n<li><strong>为新进程分配资源</strong></li>\n<li><strong>初始化进程控制块</strong></li>\n<li><strong>将新进程插入到就绪队列</strong></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"222-阻塞\"><a class=\"anchor\" href=\"#222-阻塞\">#</a> 2.2.2 <strong>阻塞</strong></h4>\n<ul>\n<li>\n<p>什么情况下会进行进程的阻塞？</p>\n<p>请求系统服务\t启动某种操作\t新数据尚未达到\t无心工作可做</p>\n</li>\n<li>\n<p>完整进程阻塞的过程？</p>\n<ol>\n<li><strong>将进程的状态改为阻塞态</strong></li>\n<li><strong>将进程插入响应的阻塞队列</strong></li>\n<li><strong>转到进程调度程序，从就绪队列中选择进程为分配 CPU</strong></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"223-唤醒\"><a class=\"anchor\" href=\"#223-唤醒\">#</a> 2.2.3 <strong>唤醒</strong></h4>\n<ul>\n<li>进程唤醒的过程？\n<ol>\n<li><strong>将进程从阻塞队列中移出</strong></li>\n<li><strong>将进程状态由阻塞状态改为就绪态</strong></li>\n<li><strong>将进程插入就绪队列</strong></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"224-终止\"><a class=\"anchor\" href=\"#224-终止\">#</a> 2.2.4 <strong>终止</strong></h4>\n<ul>\n<li>完成进程终止的过程\n<ol>\n<li><strong>从进程 PCB 中读取进程状态</strong></li>\n<li><strong>若进程正在执行，则终止进程的执行</strong></li>\n<li><strong>释放资源</strong></li>\n<li><strong>将终止进程的 PCB 移出</strong></li>\n</ol>\n</li>\n</ul>\n<h3 id=\"23-操作系统内核\"><a class=\"anchor\" href=\"#23-操作系统内核\">#</a> 2.3 操作系统内核</h3>\n<p>​\t操作系统内核是计算机<strong>硬件的第一次扩充</strong>，与硬件关系密切</p>\n<h4 id=\"231-操作系统内核\"><a class=\"anchor\" href=\"#231-操作系统内核\">#</a> 2.3.1 操作系统内核</h4>\n<ol>\n<li><strong>支撑功能</strong>：中断处理、始终管理、原语操作（原语操作也称原子操作，是一组在执行过程中不能被中断的操作。）</li>\n<li><strong>资源管理功能</strong>：进程管理、存储管理、设备管理</li>\n</ol>\n<h4 id=\"232-中断\"><a class=\"anchor\" href=\"#232-中断\">#</a> 2.3.2 中断</h4>\n<ul>\n<li>\n<p>什么是中断 ？</p>\n<p>中断是<strong>改变</strong>处理器执行指令顺序的一种<strong>事件</strong>。出现中断时，计算机停止现在程序的运行，转向<strong>对这些中断事件的处理</strong>，处理结束后再<strong>返回到现行程序的间断处</strong></p>\n</li>\n<li>\n<p>为什么需要中断 ？</p>\n<p>引入中断机制后， <strong>CPU 可以与其他设备并行工作</strong>，能有效<strong>提高 CPU 的利用率</strong></p>\n</li>\n<li>\n<p>单重中断处理</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081104.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081104.png\" class=\"\"></p>\n</li>\n</ul>\n<h4 id=\"233-时钟管理\"><a class=\"anchor\" href=\"#233-时钟管理\">#</a> 2.3.3 时钟管理</h4>\n<p>时钟是计算机系统的脉搏，计算机的很多活动都是由定时测量来驱动的</p>\n<ul>\n<li>\n<p>计算机系统中的时钟</p>\n<ol>\n<li>实时时钟 RTC（CMOS）</li>\n<li>OS 时钟</li>\n</ol>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081105.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081105.png\" class=\"\"></p>\n</li>\n<li>\n<p>时钟机制</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081106.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081106.png\" class=\"\"></p>\n</li>\n<li>\n<p>时钟程序功能</p>\n<ol>\n<li>维护日期和时间</li>\n<li>递减当前进程在一个时间片内的剩余执行时间，防止运行超时</li>\n<li>对 CPU 的使用情况记账</li>\n<li>递减报警计数器</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"234-系统调用\"><a class=\"anchor\" href=\"#234-系统调用\">#</a> 2.3.4 系统调用</h4>\n<ul>\n<li>\n<p>什么是系统调用？</p>\n<p>系统调用是（一群）<strong>预先定义好的模块</strong>，提供<strong>一条管道</strong>让应用程序能由此到<strong>核心程序</strong>的服务。系统调用是<strong>系统程序</strong>与<strong>用户程序</strong>之间的<strong>接口</strong></p>\n</li>\n<li>\n<p>系统调用和一般函数调用的区别？</p>\n<p>区别 1: 系统调用运行在<strong>系统态</strong>，一般函数运行在<strong>用户态</strong></p>\n<p>区别 2:<strong> 执行过程不同</strong> (系统调用执行时，当前进程被中断)</p>\n<p>区别 3: 系统调用进行中断处理，多了<strong>系统开销</strong></p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081107.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081107.png\" class=\"\"></p>\n</li>\n<li>\n<p>系统调用的类型</p>\n<ol>\n<li><strong>进程控制类</strong>系统调用。创建、撤销进程；获得、改变进程属性。</li>\n<li><strong>文件操作类</strong>系统调用。创建、删除、打开、关闭和读 / 写文件。</li>\n<li><strong>设备管理类</strong>系统调用。请求、释放设备。</li>\n<li><strong>通信类</strong>系统调用。打开、关闭链接，交换信息。</li>\n<li><strong>信息维护类</strong>系统调用。返回系统当前日期、时间、版本号、用户数、空闲内存和磁盘空间大小等信息。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"24-进程同步\"><a class=\"anchor\" href=\"#24-进程同步\">#</a> 2.4 进程同步</h3>\n<p>操作系统同步机制的<strong>主要任务</strong>就是要<strong>保证</strong>在多任务共享系统资源的情况下，<strong>程序执行能得到正确的结果</strong>。</p>\n<h4 id=\"241-进程同步的基本概念\"><a class=\"anchor\" href=\"#241-进程同步的基本概念\">#</a> 2.4.1 进程同步的基本概念</h4>\n<ol>\n<li>\n<p>两个任务</p>\n<ul>\n<li>一是<strong>对具有资源共享关系的进程</strong>，保证诸进程以<strong>互斥</strong>的方式<strong>访问临界资源</strong>。<strong>临界资源是必须以互斥方式访问的共享资源</strong>。</li>\n<li>二是对具有相互合作关系的进程，保证相互合作的诸进程协调执行。相互合作的进程可能同时存在资源共享的关系。</li>\n</ul>\n</li>\n<li>\n<p><strong>并发问题的解决</strong></p>\n<ul>\n<li>\n<p>如果 PIN 和 POUT<strong> 互斥</strong>地访问 count ，<strong>即 PIN 访问 count 时， POUT 就必须等待 PIN 对 count 的访问完全结束，再开始对 count 的访问</strong>，反之亦然。这样就不会出现计算结果的错误了。</p>\n<p>像 count 这样必须以<strong>互斥方式访问</strong>的<strong>共享资源</strong>称为<strong>临界资源</strong>。</p>\n</li>\n<li>\n<p>这里采用临界区<strong>加锁</strong>的方法，在临界区前加入<strong>进入区代码</strong>，在临界区之后加<strong>退出区代码</strong>来实现</p>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"242-同步机制应遵循的准则\"><a class=\"anchor\" href=\"#242-同步机制应遵循的准则\">#</a> 2.4.2 同步机制应遵循的准则</h4>\n<p>同步机制应遵循的准则可以提供判断、选择和评价同步技术的参考依据。</p>\n<ol>\n<li>\n<p><strong>空闲让进</strong></p>\n<p><strong>当没有进程处于临界区时</strong>，表明临界资源处于空闲状态，应<strong>允许一个</strong>请求进入临界区的进程立即进入自己的临界区，以有效地利用临界资源。</p>\n</li>\n<li>\n<p><strong>忙则等待</strong></p>\n<p>当己有进程进入临界区时，表明临界资源正在被访问，因而其他试图进入临界区的进程必须等待，以保证对临界资源的互斥访问。</p>\n</li>\n<li>\n<p><strong>有限等待</strong></p>\n<p>对要求访问临界资源的进程，应保证在有限时间内能进入自己的临界区，以免进程陷入无限等待的状态。</p>\n</li>\n<li>\n<p><strong>让权等待</strong></p>\n<p><strong>当进程申请不到共享资源的访问权时，应立即释放处理机</strong>，以兔进程陷入 “忙等” 状态，浪费 CPU 资源</p>\n</li>\n</ol>\n<h4 id=\"243-信号量机制\"><a class=\"anchor\" href=\"#243-信号量机制\">#</a> 2.4.3 信号量机制</h4>\n<p>​\t在信号量机制中，用<strong>信号量的取值</strong>来表示资源的使用状况，或某种事件是否发生，以此为基础实现进程的同步。</p>\n<p>​\t对不同的共享资源设置被称为信号量的变量，<strong>用信号量的取值来表示资源的使用状况</strong>，或某种事件是否发生。</p>\n<p>​\t通过信号量的取值来判断进程是否能访问与信号量对应的共享资源。</p>\n<ol>\n<li>\n<p><strong>整形信号量机制</strong></p>\n<p><strong>如果整型量 &gt; 0，说明有可用资源；如果整型量≤0，说明资源忙，进程必须等待。</strong></p>\n<p>对于<strong>一次只允许一个进程访问</strong>的临界资源，可定义一个用于<strong>互斥</strong>的整型信号量，并将其<strong>初始化为 1</strong>。</p>\n<ol>\n<li>\n<p>具体操作</p>\n<p>整型信号量的值只能通过两个特定的原子操作 wait 和 signal 来改变</p>\n<p>wait 和 signal 操作</p>\n<pre><code class=\"language-伪代码\">wait(s) //用于申请资源\n&#123;\n    while s&lt;=0 do no-op;// s &lt;= 0时循环执行空操作\n    s=s-1;\n&#125;\n\nsignal(s) //用于释放资源\n&#123;\n    s=s+1;\n&#125;\n</code></pre>\n</li>\n<li>\n<p>总结</p>\n<ol>\n<li>整型信号量的值只能由 wait 和 siqnal 操作改变。</li>\n<li>wait 和 signal 操作都是<strong>原子操作</strong>，即这两个操作中对信号量的访问<strong>不能被中断</strong>。</li>\n<li>原子操作可以通过关中断来实现。</li>\n<li><strong>不同的资源对应不同的信号量，并不是系统中所有的资源都用同一个信号量表示</strong>。</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>记录型信号量</strong></p>\n<ul>\n<li>优点：是不存在 “忙等” 采取了” 让权等待” 的策略</li>\n</ul>\n</li>\n<li>\n<p><strong>AND 型信号量机制</strong></p>\n<ol>\n<li>基本思想是将进程在整个运行过程中所需要的所有资源一次性地全部分配给进程，待该进程使用完后再一起释放。只要还有一个资源不能分配给该进程，其他所有可能为之分配的资源也不分配给它。</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"244-经典的进程同步问题\"><a class=\"anchor\" href=\"#244-经典的进程同步问题\">#</a> 2.4.4 经典的进程同步问题</h4>\n<ol>\n<li>\n<p>生产者一 消费者问题描述</p>\n<ul>\n<li>\n<p>问题描述</p>\n<ul>\n<li>生产者进程生产消息，并将消息提供给消费者进程消费。在生产者进程和消费者进程之间设置了一个具有 n 个缓冲区的缓冲池，生产者进程可以将它所产生的消息放入缓冲池的一个缓冲区中，消费者进程可以从一个缓冲区中取得一个消息消费。</li>\n<li>任意两个进程必须以互斥的方式访问公共缓冲池。当缓冲池空，没有可供消费的消息时，消费者进程必须阻塞等待。当缓冲池装满消息，没有空闲缓冲区时，生产者进程必须阻塞等待。</li>\n</ul>\n</li>\n<li>\n<p>需要解决的问题</p>\n<ul>\n<li>实现任意两个进程对缓冲池的互斥访问。</li>\n<li>实现对生产者进程和消费者进程的 “协调”</li>\n<li>即缓冲池中有消息时消费者进程才能执行取消息的操作。无消息时，阻塞消费者进程。缓冲池中有空闲缓冲区时，生产者进程才能执行放消息的操作。无空闲缓冲区时，阻塞生产者进程。</li>\n</ul>\n</li>\n<li>\n<p>信号量的设置</p>\n<ul>\n<li>设置一个互斥信号量 mulex ，用于实现对公共缓冲池的互斥访问，初值为 1。</li>\n<li>设置两个资源信号量，分别表示可用资源数。empty : 表示缓冲池中的空缓冲区数，初值为 n。full : 表示装有消息的缓冲区数，初值为 0 (一个缓冲区中放一个消息)。</li>\n</ul>\n</li>\n<li>\n<p>同步程序</p>\n<ul>\n<li>利用记录型信号量机制实现生产者 —— 消费者问题的同步代码如下:</li>\n</ul>\n</li>\n<li>\n<p>生产者进程同步代码</p>\n<pre><code class=\"language-伪代码\">Producer:\nbegin\nrepeat\n...\nproduce an item in nextp;\nwait(empty);//申请空缓冲区\nwait(mutex);//申请公共缓冲池的互斥访问权\nbuffer(in)=nextp; //将消息放入in指针指向的缓冲区\nin=(in+ 1) mod n; //in指针指向下一个空缓冲区\nsignal(mutex); //释放对公共缓冲池的互斥访问权\nsignal(full); //释放消息资源\nuntil false\nend\n</code></pre>\n</li>\n<li>\n<p>消费者进程同步代码</p>\n<pre><code class=\"language-伪代码\">Consumer:\nbegin \nrepeat\n...\nwait(ull); //申请消息\nwait(mutex); //申请公共缓冲池的互斥访问权\nnextc= buffer(out); //从out指针指向的缓冲区中取消息\nout=(out+ 1) mod h; //out指针指向下一个装有消息的缓冲区\nsignal(mutex); //释放对公共缓冲池的互斥访问权\nsignal(empty); //释放空缓冲区\nconsume item in nextc ;\nuntil false\nend\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"245-管程\"><a class=\"anchor\" href=\"#245-管程\">#</a> 2.4.5 管程</h4>\n<ol>\n<li>\n<p>管程的定义</p>\n<p>管程是描述共享资源的数据结构和在数据结构上的共享资源管理程序的集合。其中包括变量的定义、变量的初始化代码，以及管理共享资源的过程。</p>\n</li>\n<li>\n<p>对管程的说明</p>\n<ul>\n<li><strong>管程是可供程序员调用的软件包</strong>，是一个由过程、变量及数据结构等组成的集合，它们组成一个特殊的模块或软件包。<strong>进程可以在任何需要的时候调用管程中的过程</strong>，但不能在管程外的过程中直接访问管程内的数据结构。</li>\n<li>每次只有一个进程调用管程执行，任意时刻管程中只能有一个活跃进程。</li>\n<li>管程是一种编程语言的构件</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"25-进程通信\"><a class=\"anchor\" href=\"#25-进程通信\">#</a> 2.5 进程通信</h3>\n<p>​\t操作系统提供进程通信功能，以支持进程之间的信息交换。</p>\n<h4 id=\"251-共享存储器系统\"><a class=\"anchor\" href=\"#251-共享存储器系统\">#</a> 2.5.1 共享存储器系统</h4>\n<p>​\t在共享存储器系统中，<strong>相互通信的进程共享某些数据结构或共享存储区</strong>，进程之间能够通过这些空间进行通信。共享存储器系统可分为两种类型。</p>\n<ol>\n<li>基于<strong>共享数据结构</strong>的通信方式。要求诸进程公用某些数据结构，以实现进程间的信息交换。</li>\n<li>基于<strong>共享存储区</strong>的通信方式。进程通过对共享存储区中的数据的读或写来实现通信。</li>\n</ol>\n<h4 id=\"252-消息传递系统\"><a class=\"anchor\" href=\"#252-消息传递系统\">#</a> 2.5.2 消息传递系统</h4>\n<p>​\t进程间通过<strong>操作系统提供的一组通信程序</strong>传递格式化的信息。这种方式对应用程序隐藏了通信实现的细节使通信过程对用户是透明的。根据传递消息方式的不同，分为直接通信方式和间接通信方式。</p>\n<ol>\n<li><strong>直接通信方式</strong>。操作系统利用发送程序<strong>直接</strong>把消息发送给目标程序。</li>\n<li><strong>间接通信方式</strong>。进程之间的通信需要通过用于<strong>暂存</strong>消息的共享数据结构来实现，如信箱。该方式可以实现实时通信，又可以实现非实时通信。</li>\n</ol>\n<h4 id=\"253-管道\"><a class=\"anchor\" href=\"#253-管道\">#</a> 2.5.3 管道</h4>\n<p>​\t<strong>管道</strong>是连接读写进程的<strong>一个特殊文件</strong>，也被称为管道文件。管道文件存在于<strong>外存</strong>中，其中的消息没有固定长度，能用于进程间大量的信息通信。向管道提供输入的发送进程以<strong>字符流</strong>的形式将大量的数据送入管道。接受管道输出的接收进程，从管道中接收数据。</p>\n<h4 id=\"254-消息缓冲队列\"><a class=\"anchor\" href=\"#254-消息缓冲队列\">#</a> 2.5.4 消息缓冲队列</h4>\n<p>​\t用于本地进程之间的通信，包括<strong>数据结构、发送原语和接收原语</strong>。</p>\n<p>​\t发送进程<strong>发送消息</strong>时，先<strong>申请一个消息缓冲区</strong>，将要发送的消息<strong>从发送进程的发送区放入消息</strong></p>\n<p><strong>缓冲区</strong>。然后，<strong>调用发送原语</strong>将消息<strong>发送给接收进程</strong>，发送原语将发送缓冲区插入接收进程的消</p>\n<p>息缓冲队列。</p>\n<p>​\t接收消息的进程<strong>通过调用接收原语</strong>将该进程消息缓冲队列中的消息复制到自己的消息接收区。</p>\n<p>​\t消息缓冲区是一个结构型数据结构。</p>\n<p>​\t消息缓冲队列需要被当作<strong>临界资源</strong>，在发送原语和接收原语中<strong>对消息缓冲队列的访问</strong>需要<strong>进行互斥与同步</strong></p>\n<h3 id=\"26-线程\"><a class=\"anchor\" href=\"#26-线程\">#</a> 2.6 线程</h3>\n<h4 id=\"261-线程的描述\"><a class=\"anchor\" href=\"#261-线程的描述\">#</a> 2.6.1 线程的描述</h4>\n<p>​\t<strong>为了进一步提高程序的并发性 ，减少系统开销，在操作系统中引入了线程的概念</strong>。</p>\n<p>​\t引入线程作为独立调度和分派的单位，<strong>不独立拥有资源，而与其他线程共享同一进程的资源</strong>，减少了系统的时空开销。</p>\n<p>​\t<strong>线程的实质是把进程的任务划分成更小，具有独立功能的单位</strong>，以线程的形式来并发执行，以提高程序并发执行的程度。</p>\n<ol>\n<li>\n<p>线程的概念</p>\n<p><strong>线程是进程中的一个实体</strong>，是被系统独立调度和分派的基本单位。<strong>一个线程可以创建和撤销另一个线程。同一进程中的多个线程可以并发执行。</strong></p>\n</li>\n<li>\n<p>线程的分类</p>\n<p>用户级线程和内核级线程。</p>\n</li>\n<li>\n<p>线程的三种基本状态</p>\n<p>就绪、运行和阻塞。</p>\n<p>就绪态是线程一 - 旦获得 CPU 就可以投入运行的状态。</p>\n<p>运行态是线程获得 CPU 正在运行的状态。</p>\n<p>阻塞态是线程由于等待某个事件的发生而暂停执行的状态。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081108.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081108.png\" class=\"\"></p>\n</li>\n<li>\n<p>线程控制块（TCB）</p>\n<p>每个线程都由一个数据结构表示，包括它的<strong>基本状态、标识及记账信息</strong>，这个数据结构就是<strong>线程控制块</strong>。</p>\n<p>线程控制块记录了操作系统所需的，用于描述线程情况及控制线程运行所需的全部信息。</p>\n<p>线程控制块采用<strong>链接</strong>方式来组织，把<strong>同一进程中具有相同状态的 TCB 用指针链接成列</strong>。</p>\n</li>\n<li>\n<p>线程与进程的关系</p>\n<ol>\n<li><strong>资源和调度</strong>。<strong>线程是程序执行的基本单位，进程是拥有资源的基本单位。</strong></li>\n<li><strong>地址空间资源</strong>。<strong>不同进程的地址空间是相互独立的，而同一进程中的各线程共享同一地址空间。</strong></li>\n<li><strong>通信关系</strong>。进程之间的通信必须使用操作系统提供的进程间通信机制，而同一进程中的各线程间可以<strong>通过直接读或写全局变量</strong>来进行通信，甚至无需操作系统的参与。</li>\n<li><strong>并发性</strong>。多进程之间可以并发执行，多线程之间也可以并发执行，同 - 进程中的多个线程之间也可以并发执行。</li>\n<li><strong>系统开销</strong>。创建或撤销进程时，系统都要为之分配或回收资源，系统开销大。</li>\n<li><strong>本人说明：可以理解为线程是 java 的线程，进程是 windows 的一个软件</strong></li>\n</ol>\n</li>\n</ol>\n<h4 id=\"262-线程的控制\"><a class=\"anchor\" href=\"#262-线程的控制\">#</a> 2.6.2 线程的控制</h4>\n<p>​\t线程控制包括创建新线程、终止线程、线程调度和线程切换，以及线程由于等待某个事件的发生而被阻塞与该事件发生后线程被唤醒。</p>\n<p>​\t<strong>用户线程的创建通过调用线程库中的实用程序完成。</strong></p>\n<p>​\t<strong>内核线程的创建由内核完成。</strong></p>\n<p>​\t如果进程中一个用户线程被阻塞，则整个进程必须等待。</p>\n<p>​\t当被阻塞的线程所等待的事件发生时，则由有关进程唤醒原语<strong>将该线程所属的进程唤醒，然后由有关线程唤醒原语将该线程唤醒</strong></p>\n<p>​\t如果进程中的一个内核线程被阻塞，内核可以调度同一个进程中的另一个内核线程运行。</p>\n<p>​\t<strong>一个进程中的所有线程共享同一个地址空间</strong>和诸如打开的文件之类的其他资源。</p>\n<p>​\t<strong>一个线程对资源的任何修改都会影响同一个进程中其他线程的环境。</strong></p>\n<p>​\t<strong>同一进程中线程间共享内存和文件资源</strong>，各线程间可通过<strong>直接读写全局变量</strong>进行通信。</p>\n<p>​\t对于<strong>不同进程的线程间</strong>通信，则必须<strong>使用操作系统提供的线程间</strong>通信机制。</p>\n<hr />\n<h2 id=\"第三章进程调度与死锁重点\"><a class=\"anchor\" href=\"#第三章进程调度与死锁重点\">#</a> 第三章：进程调度与死锁（重点）</h2>\n<h3 id=\"本章考试重点\"><a class=\"anchor\" href=\"#本章考试重点\">#</a> 本章考试重点</h3>\n<ul>\n<li>进程调度\n<ul>\n<li>进程调度算法（选择、填空、简答、综合)</li>\n<li>实时系统中的调度概念及算法 (选择、填空、简答、综合)</li>\n<li>进程切换 (选择、填空、简答)</li>\n<li>多处理器调度 (选择、填空、简答)</li>\n</ul>\n</li>\n<li>死锁\n<ul>\n<li>死锁产生的原因、必要条件 (选择、填空、简答</li>\n<li>死锁的预防和避免 (选择、填空、简答)</li>\n<li>银行家算法 (选择、填空、简答、综合)</li>\n<li>死锁的检测和解除 (选择、填空、简答)</li>\n</ul>\n</li>\n<li>近三年分值分布: 21~ 26 分</li>\n</ul>\n<h3 id=\"31-进程调度的功能与时机\"><a class=\"anchor\" href=\"#31-进程调度的功能与时机\">#</a> 3.1 进程调度的功能与时机</h3>\n<ol>\n<li>\n<p>功能</p>\n<p><strong>进程调度功能</strong>由操作系统内核的<strong>进程调度程序完成</strong>。</p>\n<p>进程调度的功能是<strong>按照某种策略和算法</strong>从<strong>就绪态</strong>进程中为<strong>当前空闲的 CPU</strong> 选择在其上运行的新进程。</p>\n</li>\n<li>\n<p>时机</p>\n<p>当一个进程运行结束、进程阻塞、中断返回、在支持抢占式调度的系统中<strong>有比当前运行进程优先级更高的进程到来</strong>、当前运行进程的<strong>时间片用完</strong>，系统都会通过<strong>执行进程调度程序</strong>重新进行进程调度。（优先级高、当前时间片用完）</p>\n</li>\n</ol>\n<h3 id=\"32-进程调度算法综合题\"><a class=\"anchor\" href=\"#32-进程调度算法综合题\">#</a> 3.2 进程调度算法（综合题）</h3>\n<p>进程调度算法是指从<strong>就绪态</strong>进程中选择一个进程为其分配 CPU ，<strong>使其进入执行态</strong>的算法。也就是说进程调度算法要 **“决定” 把 CPU 分配给就绪队列中的哪个进程 **。</p>\n<p>进程调度由操作系统内核中的进程调度程序完成。</p>\n<h4 id=\"321-选择调度方式和算法的若干准则\"><a class=\"anchor\" href=\"#321-选择调度方式和算法的若干准则\">#</a> 3.2.1 选择调度方式和算法的<strong>若干准则</strong></h4>\n<ol>\n<li>\n<p><strong>周转时间短</strong></p>\n<p><strong>周转时间</strong>是指从<strong>作业被提交给系统开始，到作业完成为止</strong>的这段时间间隔。</p>\n<p>包括<strong> 4 部分</strong>时间：</p>\n<p>➢作业在<strong>外存后备队列上等待调度的时间</strong>，</p>\n<p>➢进程在<strong>就绪队列上等待进程调度的时间</strong>，</p>\n<p>➢进程在<strong> CPU 上执行的时间</strong>，</p>\n<p>➢进程等待<strong> I/O 操作完成的时间</strong>。</p>\n<ul>\n<li>\n<p>如果系统中<strong>有 n 个作业</strong>，系统的<strong>平均周转时间</strong>等于 n 个作业的周转时间<strong>之和除以 n</strong>。</p>\n<p>作业的周转时间 T 与系统为它提供的服务时间 Ts 之比为 W， W 称为<strong>带权周转时间</strong>。</p>\n<p>服务时间<strong> Ts 是一个作业在 CPU 上执行的总时间</strong>。</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>响应时间快</strong></p>\n<p>响应时间是指<strong>用户提交一个请求开始</strong>至<strong>系统首次产生响应</strong>的时间为止的一段时间。</p>\n<p>它包括<strong> 3 部分</strong>时间：从<strong>输入设备信息传送到处理机</strong>的时间、<strong>处理机对请求信息进行处理</strong>的时间，以及<strong>将所形成的响应信息回送到终端显示器</strong>的时间。</p>\n<p><strong>对于交互式系统，响应时间是衡量系统时间性能的重要指标。</strong></p>\n</li>\n<li>\n<p><strong>截止时间的保证</strong></p>\n<p>截止时间是指某个任务<strong>必须开始的最迟时间或必须完成的最迟时间</strong>。是评价实时系统性能的重要指标。</p>\n</li>\n<li>\n<p><strong>系统吞吐量高</strong></p>\n<p><strong>吞吐量</strong>是指<strong>单位时间内完成的作业数</strong>。是评价系统性能的重要指标之一。</p>\n</li>\n<li>\n<p>处理机利用率好</p>\n<p>CPU 是计算机系统中影响时间性能的最重要的硬件资源，在多任务系统中，进程调度算法对 CPU 的利用率有很大影响。因此，在<strong>选择和设计进程调度算法时应该考虑使 CPU 的利用率尽可能高</strong>。</p>\n</li>\n</ol>\n<h4 id=\"322-先来先服务调度算法fcfs\"><a class=\"anchor\" href=\"#322-先来先服务调度算法fcfs\">#</a> 3.2.2 先来先服务调度算法 (<strong>FCFS</strong> )</h4>\n<ol>\n<li>\n<p>调度算法</p>\n<p>在进程调度中，FCFS 就是从就绪队列的队首选择最先到达就绪队列的进程，为该进程分配 CPU。（First-Come ， First- Served）</p>\n</li>\n<li>\n<p>性能分析</p>\n<p>FCFS<strong> 适合长进程</strong>，有利于 CPU 繁忙的进程。</p>\n</li>\n<li>\n<p>综合题</p>\n<pre><code>有3个进程p1、p2和p3 ，分别在0、1、 2时刻进入系统，需要的运行(服务)时间长度分别为24、3、3 .，按照FCFS调度算法， 3个进程的等待时间和周转时间分别是?\n\n[答案]\n等待时间=开始时间-进入时间，周转时间=运行时间+等待时间。\n注意：开始运行时间从0开始计算\n</code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">进程名</th>\n<th style=\"text-align:center\">进入系统时间</th>\n<th style=\"text-align:center\">开始运行</th>\n<th style=\"text-align:center\">运行时间</th>\n<th style=\"text-align:center\">等待时间</th>\n<th style=\"text-align:center\">周转时间</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">p1</td>\n<td style=\"text-align:center\">0</td>\n<td style=\"text-align:center\">0</td>\n<td style=\"text-align:center\">24</td>\n<td style=\"text-align:center\">0</td>\n<td style=\"text-align:center\">24</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">p2</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">24</td>\n<td style=\"text-align:center\">3</td>\n<td style=\"text-align:center\">23</td>\n<td style=\"text-align:center\">26</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">p3</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">27</td>\n<td style=\"text-align:center\">3</td>\n<td style=\"text-align:center\">25</td>\n<td style=\"text-align:center\">28</td>\n</tr>\n</tbody>\n</table>\n<pre><code>此种情况下平均周转时间T和平均带权周转时间W为多少?\n\n[答案] T=(24+26+ 28)/3=26\n\t  W=(24/24+ 26/3+ 28/3)/3-6.33\n\n[解析]\n\t等待时间=开始时间-进入时间\n\t周转时间=运行时间+等待时间\n\t系统的平均周转时间:各个进程的周转时间总和/进程数\n\t带权周转时间:周转时间/运行时间\n\t平均带权周转时间:各个进程的带权周转时间总和/进程数\n</code></pre>\n</li>\n</ol>\n<h4 id=\"323-短进程优先调度算法-shortest-process-firstspf\"><a class=\"anchor\" href=\"#323-短进程优先调度算法-shortest-process-firstspf\">#</a> 3.2.3 短进程优先调度算法 (Shortest-Process-First，SPF)</h4>\n<ul>\n<li>算法的缺陷\n<ol>\n<li><strong>对长进程不利</strong>。如果系统中不断有短进程到来长进程<strong>可能长时间得不到调度</strong>。</li>\n<li><strong>不能保证紧迫进程的及时处理</strong>，因<strong>本算法不考虑进程的紧迫程度</strong>。</li>\n<li><strong>进程的长度由用户估计而定，可能有偏差</strong>。</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"324-优先权调度算法\"><a class=\"anchor\" href=\"#324-优先权调度算法\">#</a> 3.2.4 优先权调度算法</h4>\n<ol>\n<li>\n<p>调度算法</p>\n<p>​\t在使用优先权调度的系统中， 每个进程都有一个与之关联的优先权。</p>\n<p>​\t当使用优先权调度算法进行进程调度时，系统将 CPU 分配给就绪队列中<strong>优先权值最高</strong>的进程。</p>\n</li>\n<li>\n<p>优先权调度算法的分类</p>\n<p>① 非抢占式优先权调度算法高优先权进程一旦得到处理机， 便一直运行下去直到完成或由于某事件使该进程主动放弃处理机。</p>\n<p>​\t即使更高优先权进程到来，也不能剥夺当前进程的 CPU 使用权，只能在就绪队列中等待。</p>\n<p>② 抢占式优先权调度算法</p>\n<p>​\t新到达的就绪进程与正在运行进程的优先权相比较，若<strong>新到达进程的优先权高于当前正在运行进程的优先权</strong>，则<strong>系统会抢占 CPU</strong> ，分配给新到达的进程，正在执行的进程暂停执行。</p>\n</li>\n<li>\n<p>优先权的类型</p>\n<p>根据优先权的变化特点将优先权的类型分为<strong>静态和动态</strong>。</p>\n<p>① <strong>静态优先权</strong>。在创建时确定，在进程的整个运行期间不变。</p>\n<p>② <strong>动态优先权</strong>。进程创建时被赋予的优先权，随进程的推进或随其等待时间的增加而改变。<strong>动态优先权调度算法可以使系统获得更好的调度性能</strong>。</p>\n</li>\n<li>\n<p>优先权调度算法存在的问题和解决方案</p>\n<p>① 问题。无穷阻塞或称饥饿问题。指就绪态进程因得不到 CPU 而等待的状态。优先权调度算法可能使某个低优先权进程无穷等待。</p>\n<p>② 解决方案。<strong>老化 (Aging) 技术。逐渐增加在系统中等待时间很长进程的优先权。</strong></p>\n</li>\n</ol>\n<h4 id=\"325时间片轮转调度算法\"><a class=\"anchor\" href=\"#325时间片轮转调度算法\">#</a> 3.2.5 时间片轮转调度算法</h4>\n<p>​\t时间片轮转调度算法在现代分时系统中广泛使用， UNIX、Linux、 Windows 操作 系统都采用基于时间片轮转、支持优先权和抢占式调度的混合式进程调度算法。</p>\n<ol>\n<li>\n<p>时间片轮转调度算法</p>\n<p>时间片是一个较小的时间单位，通常为 10~ 100ms。每当进程在 CPU_上连续运行的时间等于一一个时间片长度时，操作系统在时钟中断处理过程中会抢占 CPU，进行进程切换，用新的就绪进程替代当前进程，<strong>被替换的当前进程重新回到就绪队列中</strong>。</p>\n</li>\n<li>\n<p>时间片大小的确定</p>\n<p><strong>时间片太长</strong>，可降低进程的周转时间，但可能造成交互用户的响应时间过长。</p>\n<p><strong>时间片太短</strong>，会增加进程切换和调度的开销，系统的平均周转时间也较长。</p>\n<p>① <strong>系统对响应时间的要求</strong>。响应时间越短，时间片取值应该越小。</p>\n<p>设系统响应时间为 T ，进程数目为 N，时间片为 q ，则有 T=Nq ，即在 N - 定的情况下， T 的大小取决于 q。</p>\n<p>② <strong>就绪队列中进程的数目</strong>。进程越多，响应时间越长。当设定了系统的最长响应时间值后，时间片的大小就与系统允许的最大进程数成反比。</p>\n<p>③ <strong>系统的处理能力</strong>。必须保证系统支持的基本命令能在一个时间片内执行完。</p>\n</li>\n<li>\n<p>时间片轮转调度算法的性能评价</p>\n<p>时间片轮转调度算法的性能<strong>依赖于时间片的大小</strong>。</p>\n<p>时间片很大，与先来先服务算法一样。</p>\n<p>时间片很小，会增加 CPU 用于进程切换和进程调度的开销。</p>\n</li>\n</ol>\n<h4 id=\"326-多级队列调度\"><a class=\"anchor\" href=\"#326-多级队列调度\">#</a> 3.2.6 多级队列调度</h4>\n<p>​\t通常根据<strong>不同进程对响应时间要求的不同</strong>，采用<strong>多级队列调度算法</strong></p>\n<p>​\t多级队列调度算法，根据<strong>进程占用内存的大小、优先权或进程类型</strong>，将就绪队列分成多个独立队列，<strong>进程被永久地分配到一个队列，每个队列有自己的调度算法</strong>。<strong>降低了进程调度的开销</strong></p>\n<h4 id=\"327多级反馈队列调度\"><a class=\"anchor\" href=\"#327多级反馈队列调度\">#</a> 3.2.7 多级反馈队列调度</h4>\n<p>​\t采用多级队列调度，对低优先权进程会存在无穷阻塞 (饥饿) 的问题。</p>\n<p>​\t多级反馈队列调度算法可以弥补这些不足。在采用多级反馈队列调度的系统中建立多个优先权不同的就绪队列，为每个队列赋予大小不同的时间片。</p>\n<p>​\t有一种<strong>反馈策略规定</strong>：队列优先权越高，时间片越短。新进程被创建后，先插入预先权最高的队列。仅当高优先权队列空时，才调度优先权次之的队列。同一队列中， 采用时间片轮转调度算法。使用 CPU 时间过多的进程会被移到优先权较低的队列中，在较低优先权队列中等待时间过长的进程会被移到较高优先权队列中。</p>\n<p>​\t多级反馈队列调度算法的设计要考虑以下几个方面的问题。</p>\n<ol>\n<li>就绪队列的数量。</li>\n<li>根据进程优先权确定进程应该进入哪个就绪队列的算法。</li>\n<li>用以确定进程何时转移到较高优先权队列的算法。</li>\n<li>用以确定进程何时转移到较低优先权队列的算法。</li>\n<li>用以确定进程在需要服务时应该进入哪个队列的算法。</li>\n</ol>\n<h3 id=\"33-实时系统中的调度\"><a class=\"anchor\" href=\"#33-实时系统中的调度\">#</a> 3.3 实时系统中的调度</h3>\n<h4 id=\"331-实现实时调度的基本条件\"><a class=\"anchor\" href=\"#331-实现实时调度的基本条件\">#</a> 3.3.1 实现实时调度的基本条件</h4>\n<p>​\t为了满足实时系统对截止时间的要求，实现实时调度应具备下列几个条件:</p>\n<ol>\n<li>\n<p><strong>提供必要的调度信息</strong><br />\n① 就绪时间<br />\n② 开始截止时间和完成截止时间<br />\n③ 处理时间<br />\n④ 资源要求<br />\n⑤优先级</p>\n</li>\n<li>\n<p><strong>系统处理能力强</strong></p>\n<p>（具体没啥用，随便看看）</p>\n<p>​\t在实时系统中，通常有多个实时进程，若处理机的处理能力不够强，处理速度不够快，若使某些实时进程不能得到及时处理，可能发生难以预料的后果。</p>\n<p>​\t可通过提高处理机的处理能力或增加处理机的数量以提高系统的处理能力。</p>\n</li>\n<li>\n<p><strong>采用抢占式调度机制</strong></p>\n<ol>\n<li><strong>基于时钟中断的抢占式优先权调度算法</strong><br />\n若高优先权大于正在执行的进程，就等当前进程到时钟中断的时候抢占</li>\n<li><strong>立即抢占的优先权调度算法</strong><br />\n一旦接收到就给当前执行的进程一个中断信号，然后抢占</li>\n</ol>\n</li>\n<li>\n<p>具有快速切换机制<br />\n就是需要进程<strong>对外部中断做出快速响应</strong>和<strong>快速的进程切换</strong></p>\n</li>\n</ol>\n<h4 id=\"332-常用的实时调度算法\"><a class=\"anchor\" href=\"#332-常用的实时调度算法\">#</a> 3.3.2 常用的实时调度算法</h4>\n<ol>\n<li>\n<p>最早截止时间优先 EDF 算法</p>\n<p>根据进程的开始截止时间确定进程的优先级，<strong>截止时间越早，进程的优先级越高</strong>，越优先获得处理机。</p>\n</li>\n<li>\n<p>最低松弛度优先 LLF 算法</p>\n<p>​\t<strong>松弛度用来表示个实时进程的紧迫程度</strong>。</p>\n<p>​\t如果一个进程的完成截止时间为 T ，当前时间为 Tc 处理完该任务还需要的时间为 Ts，则松弛度 L 的计算式表示为: L=T-Tc-Ts</p>\n<p>​\t<strong>调度时，每次选择松弛度最小的进程</strong>。该算法按松弛度排序，<strong>让松弛度最小的进程排在就绪队列队首</strong>。</p>\n</li>\n</ol>\n<h3 id=\"34-进程切换\"><a class=\"anchor\" href=\"#34-进程切换\">#</a> 3.4 进程切换</h3>\n<p>​\t含义：<strong>用新选择的进程替换原来的进行进程</strong></p>\n<ul>\n<li>进程切换包括的步骤如下:\n<ol>\n<li><strong>保存 CPU 上下文环境。</strong></li>\n<li><strong>更新进程控制块。</strong></li>\n<li><strong>修改进程状态，把执行态改为就绪态或者阻塞态。</strong></li>\n<li><strong>将被替换进程的进程控制块移到就绪队列或阻塞队列。</strong></li>\n<li><strong>执行新进程，并更新改进程的进程控制块。</strong></li>\n<li><strong>更新内存管理的数据结构。</strong></li>\n<li><strong>恢复上下文。</strong></li>\n</ol>\n</li>\n</ul>\n<h3 id=\"35-多处理器调度\"><a class=\"anchor\" href=\"#35-多处理器调度\">#</a> 3.5 多处理器调度</h3>\n<h4 id=\"351-多处理器系统的类型\"><a class=\"anchor\" href=\"#351-多处理器系统的类型\">#</a> 3.5.1 多处理器系统的类型</h4>\n<p>根据处理器的耦合程度，分为紧密耦合和松弛耦合；根据处理器的结构，分为对称和非对称。</p>\n<ol>\n<li>\n<p>紧密耦合和松弛耦合</p>\n<ol>\n<li>紧密耦合</li>\n<li>松弛耦合</li>\n</ol>\n</li>\n<li>\n<p>对称和非对称</p>\n<p>对称属于同构，非对称在功能和结构上各不相同。</p>\n</li>\n</ol>\n<h4 id=\"352-多处理器系统中的进程分配方式\"><a class=\"anchor\" href=\"#352-多处理器系统中的进程分配方式\">#</a> 3.5.2 多处理器系统中的进程分配方式</h4>\n<ol>\n<li>\n<p>对称多处理器系统中的进程分配方式</p>\n<ol>\n<li>\n<p>静态分配</p>\n<p>操作系统为每个处理器建立 - 个专门的就绪队列</p>\n</li>\n<li>\n<p>动态分配</p>\n<p>每个进程经过多次调度，每次获得的不一定是同一个处理器。</p>\n</li>\n</ol>\n</li>\n<li>\n<p>非对称多处理器系统 (MPS) 中的进程分配方式</p>\n<p>采<strong>用主一从式</strong>操作系统，操作系统的核心部分驻留在一台主机上，而从机上只运行用户程序，只有主机 执行调度程序，所有从机的进程都是由主机分配的。</p>\n</li>\n</ol>\n<h4 id=\"353-进程线程调度方式\"><a class=\"anchor\" href=\"#353-进程线程调度方式\">#</a> 3.5.3 进程（线程）调度方式</h4>\n<ol>\n<li>\n<p>自调度</p>\n<p>采用自调度的系统中设置<strong>有个公共的就绪队列，任何一个空闲的处理器都可以自行从该就绪队列中选取一个进程或者一个线程运行</strong>。</p>\n<ul>\n<li>\n<p>优点</p>\n<p>➢ 易移植</p>\n<p>➢ 有利于提高 CPU 的利用率</p>\n</li>\n<li>\n<p>缺点</p>\n<p>➢ 瓶颈问题，容易产生并发问题</p>\n<p>➢ 低效性，高速缓冲的命中率较低</p>\n<p>➢ 线程切换频繁</p>\n</li>\n</ul>\n</li>\n<li>\n<p>成组调度</p>\n<p>系统<strong>将一组相互合作的进程或线程同时分配到一组处理器上运行，进程或线程与处理器对应</strong>。</p>\n<ul>\n<li>优点:<br />\n➢ 减少线程切换，改善系统性能。<br />\n➢ 减少调度开销。一次调度一组，减少调度频率。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"36-死锁\"><a class=\"anchor\" href=\"#36-死锁\">#</a> 3.6 死锁</h3>\n<h4 id=\"361-产生死锁的原因和必要条件\"><a class=\"anchor\" href=\"#361-产生死锁的原因和必要条件\">#</a> 3.6.1 产生死锁的原因和必要条件</h4>\n<p>​\t<strong>当多个进程可能竞争数量有限的资源。若一个进程所申请的资源被其他处于阻塞状态的进程占有，该进程就会因为不能获得所申请的资源而被阻塞。</strong></p>\n<p>​\t这种由于多个进程竞争共享资源而引起的<strong>进程不能向前推进的僵持状态</strong>称为<strong>死锁</strong>。</p>\n<p><strong>产生死锁的原因</strong>：竞争共享资源且分配资源的顺序不当。</p>\n<p>产生死锁的必要条件：</p>\n<ol>\n<li>\n<p><strong>互斥条件</strong></p>\n<p>指一个进程在访问资源的过程中，其他进程不能访问该资源</p>\n</li>\n<li>\n<p><strong>请求和保持条件</strong></p>\n<p>进程已经保持了至少一个资源，又提出了新的资源要求且已经被其他进程占有，此时进程阻塞，但又对已经获得的资源保持不放，使得其他进程无法使用被保持的资源。</p>\n</li>\n<li>\n<p><strong>不剥夺条件</strong></p>\n<p>进程已经获得的资源不能被剥夺，只能由进程自己释放。</p>\n</li>\n<li>\n<p><strong>环路等待条件</strong></p>\n<p>在发生死锁时，必然存在一个进程申请资源的环形链。</p>\n<p>注意：只有上述 4 个条件同时满足时才会发生死锁。</p>\n</li>\n</ol>\n<h4 id=\"362-处理死锁的基本方法\"><a class=\"anchor\" href=\"#362-处理死锁的基本方法\">#</a> 3.6.2 处理死锁的基本方法</h4>\n<p>处理死锁的基本方法有<strong>预防死锁、避免死锁、检测并解除死锁和忽略死锁</strong>问题。</p>\n<ol>\n<li>\n<p>死锁的预防</p>\n<p>通过保证至少其中一个条件不成立来达到预防发生死锁的目的。</p>\n<ol>\n<li>\n<p><strong>摒弃请求和保持条件</strong><br />\n所有进程执行前要一次性地申请在整个运行过程中所需要的全部资源</p>\n</li>\n<li>\n<p><strong>摒弃不剥夺条件</strong></p>\n<p>一个已保持了某些资源的进程，当它再提出新的资源要求而不能立即得到满足时，必须释放它已经保持的所有资源。</p>\n</li>\n<li>\n<p><strong>摒弃环路等待条件</strong></p>\n<p>进程必须按规定的顺序申请资源</p>\n</li>\n</ol>\n</li>\n<li>\n<p>死锁的避免</p>\n<p>​\t<strong>避免死锁的方法是把系统的资源分配状态分为安全状态和不安全状态</strong>，只要资源分配使系统资源分配状态处于安全状态，死锁就不会发生。</p>\n<p>​\t在避免死锁的方法中，允许进程动态地电请资源。</p>\n</li>\n</ol>\n<h4 id=\"363-银行家算法\"><a class=\"anchor\" href=\"#363-银行家算法\">#</a> 3.6.3 银行家算法</h4>\n<p>​\t1965 年 Dijkstra (迪杰斯特拉) 提出了种能够避免死锁的资源分配算法。</p>\n<p>​\t其基本思想是<strong>一个进程提出资源请求后，系统先进行资源的试分配。然后检测本次的试分配是否使系统处于安全状态，若安全则按试分配方案分配资源，否则不分配资源</strong>。</p>\n<pre><code>\t银行家算法的由来是银行家贷款给客户这一问题。银行家(操作系统)把一定数量的资金(资源)供多个用户(进程)周转使用。当顾客对资金的最大申请量不超过银行家现金时就可接纳一个新顾客。银行可以对顾客的借款推迟支付，但一定使顾客总能在有限的时间内得到借款;当顾客得到全部资金后，他一定能在有限的时间里归还(回收)所有资金(资源)。\n</code></pre>\n<p>银行家算法分为两个过程:<br />\n 一是进行资源试分配的过程；<br />\n 二是对试分配后系统的状态做安全性检测的过程。</p>\n<h4 id=\"364-死锁的检测和解除\"><a class=\"anchor\" href=\"#364-死锁的检测和解除\">#</a> 3.6.4 死锁的检测和解除</h4>\n<p>何时调用检测算法？</p>\n<p>​\t➢ 死锁可能发生的频率</p>\n<p>​\t➢ 当死锁发生时受影响的进程数量</p>\n<p>死锁定理</p>\n<p>​\t➢ 死锁状态的充分条件是当且仅当资源分配状态是不可完全简化的。</p>\n<p>死锁的解除</p>\n<p>​\t➢ 终止处于死锁状态的进程</p>\n<p>​\t➢ 抢占死锁进程占有的资源</p>\n<p>单选题</p>\n<pre><code>某系统中有n (n为大于1的整数)个并发进程，每个进程需要同类资源m个(m为大于0的整数), 请问该系统不会发生死锁的最少资源数是( C )。\n\nA. n+m\nB.n*m\nC.n*(m-1)+1\nD.以上都对\n\n[解析]\n例如,若某系统中有4个并发进程,每个进程需要同类资源3个,则只要分配4*(3-1)+ 1共9个资源,该系统就不会发生死锁。每个进程都申请到两个资源后,还有1个资源,无论哪个进程获得这个资源都可以继续向前推进,当获得这个资源的进程执行完后,可以释放3个资源再分配给其他3个进程,因此不会发生死锁。\n</code></pre>\n<hr />\n<h2 id=\"第四章内存管理重点\"><a class=\"anchor\" href=\"#第四章内存管理重点\">#</a> 第四章：内存管理（重点）</h2>\n<h3 id=\"考试重点\"><a class=\"anchor\" href=\"#考试重点\">#</a> 考试重点</h3>\n<p>​\t➢ 存储器的层次结构 (选择、填空、简答)</p>\n<p>​\t➢ 程序的链接和装入 (选择、填空、简答)</p>\n<p>​\t➢ 连续分配存储管理、动态分区分配算法 (选择、填空、简答、综合)</p>\n<p>​\t➢ 分页、快表、两级页表 (选择、填空、简答、综合)</p>\n<p>​\t➢ 虚拟存储、缺页、页分配策略 (选择、填空、简答)</p>\n<p>​\t➢ 页置换算法 (选择、填空、简答、综合)</p>\n<p>​\t➢ 分段系统、段表、段页式存储管理 (选择、填空、简答)</p>\n<p><strong>本章近 3 年分值: 19~22 分</strong></p>\n<h3 id=\"41-存储器的层次结构\"><a class=\"anchor\" href=\"#41-存储器的层次结构\">#</a> 4.1 存储器的层次结构</h3>\n<p>​\t内存是计算机存储系统的一部分，为了更好地理解后续章节内容，先了解存储器系统的层次结构。存储器系统是一个具有不同容量、成本和访问时间的存储设备的层次结构。</p>\n<p>在这个层次系统中，从高层到底层 (L0~L5)，较低层的存储设备速度更慢、容量更大、价格更便宜。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081201.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081201.png\" class=\"\"></p>\n<p>如果存储在高速缓存中，需要 1~ 10 个周期。</p>\n<p>如果存放在主存中，访问它们需要 50~ 100 个周期。</p>\n<p>如果存放在磁盘中，访问它们需要大约 2000 万个周期。</p>\n<p>​\t➢ 程序的执行遵循<strong>局部性</strong>原理。</p>\n<p>​\t程序在执行时呈现出局部性规律，即在一段较短的时间内，程序的执行仅局限于某个部分，相应地，它所访问的存储空间也局限于某个区域。</p>\n<ol>\n<li>程序执行时，除了少部分的转移和过程调用指令，<strong> 大多数情况下是顺序执行</strong></li>\n<li><strong>过程调用</strong>将会使程序的执行轨迹由一部分内存区域转移到另一部分内存区域</li>\n<li>程序中存在很多<strong>循环</strong>结构，它们虽然由少数指令构成但<strong>多次执行</strong></li>\n<li>程序中往往包括许多对数据结构的处理，如对数组操作，它们往往<strong>局限在很小的范围内</strong></li>\n</ol>\n<p>➢ 总的来说，<strong> 局部性</strong>原理<strong>表现为时间和空间的局部性</strong><br />\n➢ 时间局部性。如果程序中的某条指令一旦执行则不久后该指令可能再次执行。<br />\n➢ 空间局部性。一旦程序访问了某个单元，不久后其附近的存储单元也将被访问</p>\n<h3 id=\"42-程序的链接和装入\"><a class=\"anchor\" href=\"#42-程序的链接和装入\">#</a> 4.2 程序的链接和装入</h3>\n<p>高级语言程序必须经过编译、链接才能成为可执行程序。操作系统需要为程序的执行分配内存空间。下面介绍链接程序的功能和程序被装入内存的几种方式。</p>\n<h4 id=\"421-程序的链接\"><a class=\"anchor\" href=\"#421-程序的链接\">#</a> 4.2.1 程序的链接</h4>\n<p><strong>链接程序</strong>要解决的问题是<strong>将编译后的目标模块装配成一个可执行的程序</strong>。根据链接进行的时间和实现方式的不同，可以把链接分为静态链接和动态链接。<br />\n➢ <strong>静态链接</strong></p>\n<p>​\t在程序运行前，用链接程序将目标模块链接成一个完整的装入模块。运行速度快，占用大</p>\n<p>➢ <strong>动态链接</strong></p>\n<p>​\t将部分目标模块链接推迟到其中函数被调用执行。采用动态链接节省空间，方便开发，速度慢</p>\n<h4 id=\"422-程序的装入\"><a class=\"anchor\" href=\"#422-程序的装入\">#</a> 4.2.2 程序的装入</h4>\n<p>​\t将源程序变为可执行程序须经过<strong>编译、链接和装入</strong> 3 个阶段。</p>\n<p>​\t可执行程序以<strong>二进制可执行文件</strong>的形式存储在磁盘上，为执行程序，操作系统需要把程序调入内存。程序装入内存的方式分为<strong>绝对装入、可重定位装入 (静态重定位) 和动态运行时装入</strong></p>\n<ol>\n<li>\n<p><strong>绝对装入方式</strong></p>\n<p>编译程序事先已知程序在内存中的驻留位置，编译时产生物理地址的目标代码。因此装入模块被装入内存后，无需对程序和数据的地址进行修改。</p>\n</li>\n<li>\n<p><strong>可重定位装入方式</strong> (静态重定位)</p>\n<p>​\t如果<strong>编译时不知道</strong>目标程序将驻留在内存的什么位置，则编译时就必须生成可重定位的代码，其中的地址都是<strong>逻辑地址</strong>（相对地址）, 在程序被装入内存时，再把这些逻辑地址映射为物理地址</p>\n<p>​\t在程序装入时对目标程序中的指令和数据地址的修改过程称为<strong>重定位</strong>。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081202.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081202.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>动态运行时装入</strong> (动态重定位)</p>\n<p>​\t一个进程在被换出之前所在的内存位置与后来被从外存重新调入时内存位置不同，这种装入方式称为<strong>动态运行时装入</strong>。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081203.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081203.png\" class=\"\"></p>\n</li>\n</ol>\n<h3 id=\"43-连续分配存储管理方式\"><a class=\"anchor\" href=\"#43-连续分配存储管理方式\">#</a> 4.3 连续分配存储管理方式</h3>\n<p>连续分配是指操作系统分配内存时，为每个进程分配块物理地址连续的内存空间，连续分配方式有 3 种类型。</p>\n<p>➢ 单一连续区分配方式<br />\n➢ 固定分区分配方式<br />\n➢ 动态分区分配方式</p>\n<h4 id=\"431-单一连续区分配方式\"><a class=\"anchor\" href=\"#431-单一连续区分配方式\">#</a> 4.3.1 单一连续区分配方式</h4>\n<p>​\t适用于单用户、单任务的操作系统，把内存分为<strong>系统区和用户区</strong>。系统区用于驻留操作系统，用户区用于分配给用户进程使用。</p>\n<p>​\t在单用户、单任务操作系统中较常用的方法是设置<strong>一个基址寄存器和一个界限寄存器</strong>。</p>\n<p>​\t<strong>基址寄存器</strong>中<strong>存放程序在物理内存中的最小地址</strong></p>\n<p>​\t<strong>界限寄存器</strong>中<strong>存放装入用户区程序的地址范围</strong></p>\n<p>​\t在 CPU 访问内存时，检查 CPU 要访问的内存单元的地址是否大于界限寄存器的值，如果大于，则是非法地址，表示用户进程访存越界，程序执行会被中断。</p>\n<h4 id=\"432-固定分区分配方式\"><a class=\"anchor\" href=\"#432-固定分区分配方式\">#</a> 4.3.2 固定分区分配方式</h4>\n<p>​\t将内存用户区划分成若干个固定大小的区域，每个用户区中驻留一道程序。当有一个空闲分区时，可从外存的后备队列中选择一个大小适当的作业装 入该分区</p>\n<ul>\n<li>\n<p>划分分区的方法</p>\n<ul>\n<li>\n<p>分区大小相等</p>\n<p>把用户区划分成大小相等的若干个分区。</p>\n<p>缺点是内存利用率比较低。程序太小浪费空间，程序太大装不下</p>\n</li>\n<li>\n<p>分区大小不相等</p>\n<p>先划分多个大小不同、数量固定的若干个分区。分配的时候看哪个更接近就分配哪个。减少了浪费。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081204.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081204.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"433-动态分区分配方式\"><a class=\"anchor\" href=\"#433-动态分区分配方式\">#</a> 4.3.3 动态分区分配方式</h4>\n<p>​\t系统初始只有一个大空闲区，根据进程需要的空间大小分配内存。内存中<strong>分区的大小和数量是变化的</strong>。动态分区方式比固定分区方式<strong>显著地提高了内存利用率</strong>。系统维护一个记录当前空闲分区情况的数据结构，<strong>当进程请求内存时，系统从所有空闲区中找到大小合适的空闲分区进行分配</strong>。</p>\n<p>​\t常用的数据结构有<strong>空闲分区表</strong>和<strong>空闲分区链</strong></p>\n<p>➢ <strong>空闲分区表</strong></p>\n<p>​\t<img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081205.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081205.png\" class=\"\"></p>\n<p>​\t缺点：设置太多表项会浪费内存空间；设置太少无法记录所有空闲分区情况</p>\n<p>➢ <strong>空闲分区链</strong></p>\n<p>​\t可以<strong>动态地为每一个空闲分区建立一 个结点</strong>，每个结点包括分区大小、分区起始地址、指向前一个空闲分区结点的指针，以及指向后一个空闲分区结点的指针。空闲分区链中的<strong>每个结点占用的内存可以动态分配动态回收</strong>。</p>\n<p>➢ <strong>动态分区分配算法</strong></p>\n<p>​\t当进程需要内存空间时，操作系统通过执行动态分区分配算法从多个空闲分区中选定一个合适的分区分配给进程。</p>\n<p>​\t内存分配功能由内存分配程序完成。内存不再需要时，由系统调用内存回收程序回收原来被占的内存。</p>\n<ol>\n<li>\n<p>首次适应算法 FF (First Fit)</p>\n<p>​\t要求空闲分区链以<strong>地址递增</strong>的顺序链接。在内存分配时，从链首开始顺序查找，直至找到一个能满足进程大小要求的空闲分区为止。余下的空闲分区仍留在空闲链中。</p>\n<p>​\t该算法先分配低地址部分的内存空间，容易使低地址部分留下小分区，而高地址部分大空闲区较多。当进程请求大空间时，要找到合适的空闲分区，<strong> 时间开销大</strong>。</p>\n</li>\n<li>\n<p>循环首次适应算法 NF (Next Fit)</p>\n<p>​\t为进程分配内存空间时，<strong> 从上次找到的空闲分区的下一个空闲分区开始查找直到找到第个能满足要求的空闲分区</strong>，并从中划出一块与请求的大小相等的内存空间分配给进程。</p>\n<p>​\t为实现该算法，应设置一个起始查找指针，以指示下一次起始查找的空闲分区，并采用<strong>循环查找方式</strong>。循环首次适应算法的优点是:<strong> 空闲区分布均匀，查找开销较小。缺点是容易使系统缺乏大空闲区</strong>。</p>\n</li>\n<li>\n<p>最佳适应算法 BF (Best Fit)</p>\n<p>​\t该算法每次分配内存，把大小与进程所请求的<strong>内存大小最接近分配给进程</strong>。该算法要求将所有的空闲区按分区大小递增顺序形成一个空闲区链。</p>\n<p>​\t优点：避免大材小用，提高内存利用率，但容易留下难以利用的小空闲区</p>\n</li>\n</ol>\n<p>外部碎片 / 外碎片：低地址部分的空闲分区反复被划分，可能留下许多很小的空闲分区<br />\n内部碎片 / 内碎片：分配给进程的分区若大于进程请求的分区，分区内会有部分未利用的空间</p>\n<h3 id=\"44-基本本页存储管理方式\"><a class=\"anchor\" href=\"#44-基本本页存储管理方式\">#</a> 4.4 基本本页存储管理方式</h3>\n<p>➢ <strong>离散内存管理方式</strong></p>\n<p>​\t\t把进程<strong>离散地</strong>存储在内存中物理地址不连续的区域中</p>\n<p>​\t根据离散内存管理分配内存空间的基本单位不同，分为 3 种管理方式:<strong> 分页存储管理、分段存储管理和段页式存储管理</strong>。</p>\n<h4 id=\"441-分页存储管理的基本概念\"><a class=\"anchor\" href=\"#441-分页存储管理的基本概念\">#</a> 4.4.1 分页存储管理的基本概念</h4>\n<ol>\n<li>\n<p>基础概念</p>\n<ol>\n<li>\n<p>页（Page）：将一个进程的<strong>逻辑地址空间</strong>分成多个大小相同的片</p>\n</li>\n<li>\n<p>页框 / 页帧：将<strong>物理内存空间</strong>分成与页大小相同的多个存储块</p>\n</li>\n<li>\n<p>分页存储：为进程分配内存时，<strong>以页框为单位</strong>将进程的若干个页<strong>装入多个不相邻的页框中</strong></p>\n</li>\n<li>\n<p>页内碎片：进程的最后一页装不满一个页框时，剩下的碎片</p>\n</li>\n<li>\n<p>页表：<strong>系统为进程建立的数据结构，实现从页号到页框号的映射</strong></p>\n</li>\n</ol>\n</li>\n</ol>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081206.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081206.png\" class=\"\"></p>\n<h3 id=\"45-基于分页的虚拟存储系统\"><a class=\"anchor\" href=\"#45-基于分页的虚拟存储系统\">#</a> 4.5 基于分页的虚拟存储系统</h3>\n<p>​\t<strong>虚拟存储器</strong>是指具有<strong>请求调入功能和置换功能</strong>，能从逻辑上对内存容量进行扩充的一种存储器系统。在虚拟存储器系统中，<strong> 进程无需全部装入</strong>，只要装入一部分即可运行。</p>\n<p>​\t虚拟存储技术实现的思想：先将进程一部分装入内存，其余部分需要时再请求系统装入，这就是请求调入。</p>\n<p>​\t置换：如果请求调入时，没有足够的内存，则由操作系统选择一部分内存中的内容换到外存。</p>\n<p>优点：</p>\n<ol>\n<li>提高内存利用率；</li>\n<li>提高多道程序度；</li>\n<li>把逻辑地址空间和物理地址空间分开，程序员不再关心物理内存的容量对编程的限制。</li>\n</ol>\n<p>虚拟存储系统具有以下几个主要特征：</p>\n<ol>\n<li>\n<p>离散性</p>\n<p>指进程可以分散地存储在物理内存中。分页、分段和段页式存储都属于离散的内存管理方式。离散性是实现虚拟存储管理的基础。</p>\n</li>\n<li>\n<p>多次性</p>\n<p>指不必把进程一 - 次性全部装入内存，可分多次装入。</p>\n</li>\n<li>\n<p>对换性</p>\n<p>指在内存中的进程可以换出，以腾出内存空间换入外存中的进程。</p>\n</li>\n<li>\n<p>虚拟性</p>\n<p>把逻辑地址空间和物理地址空间分开，程序员不再关心物理内存的容量对编程的限制。虚拟性是实现虚拟存储系统的最重要目标。</p>\n</li>\n</ol>\n<p>​\t<strong>请求分页系统</strong>是<strong>最基本、最常用的虚拟存储系统</strong>的实现方式。其基本原理是，把进程的逻辑地址空间分成大小相同的页，操作系统创建进程时只把进程的一部分页调入内存。进程运行过程中访问内存、若访问页不在内存中，则<strong>产生一个缺页异常信号</strong>，系统响应缺页异常，<strong> 请求调入缺页</strong>。</p>\n<p>​\t若调入缺页时内存已满，则需要先从内存中选择一个或若千个页换出到外存空间，以腾出内存空间容纳请求调入的缺页。</p>\n<h4 id=\"451-请求分页中的硬件支持\"><a class=\"anchor\" href=\"#451-请求分页中的硬件支持\">#</a> 4.5.1 请求分页中的硬件支持</h4>\n<p>​\t为了实现请求分页，需要特殊的页表 (相对基本分页而言)、缺页异常机构和支持请求分页的地址变换机构。</p>\n<ol>\n<li>\n<p>页表</p>\n<p>是支持请求分页系统最重要的数据结构，其作用是记录描述页的各种数据，包括在实现逻辑地址到物理地址映射时需要的页号与页框号的对应关系。</p>\n<p>​\t除了页号和页框号之外，页表中增加了请求换入和页置换时需要的数据。</p>\n<p>​\t在支持请求分页的系统中一般包含以下基本字段:</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081601.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081601.png\" class=\"\"></p>\n<p>​\t页框号：存放页所在的页框号。</p>\n<p>​\t状态位 P : 标识页是否在内存中。可规定 0 不在，1 在。</p>\n<p>​\t访问字段 A : 用于记录页最近被访问的情况。系统总是希望根据 A 的值把最近、最久未访问的页换出到外存。</p>\n<p>​\t修改位 M : 标识页最近是否被修改过。</p>\n<p>​\t保护位：标识页的访问权限，如 1 表示可读可写 0 表示只读。</p>\n</li>\n<li>\n<p>缺页异常机构</p>\n<p>​\t主要作用是在访问内存过程中发现缺页时产生缺页异常信息，使 CPU 中断当前控制流的执行，转去执行操作系统的缺页异常处理程序，完成请求调页。</p>\n</li>\n<li>\n<p>地址变换</p>\n<p>请求分页系统中的地址变化过程如下:</p>\n<ol>\n<li>\n<p>由分页地址变换机构从逻辑地址中分离出页号和页内偏移地址</p>\n</li>\n<li>\n<p>以页号为索引查找快表，若快表中有该页的页表项，则读出页框号，计算物理地址</p>\n</li>\n<li>\n<p>若快表中无该页信息，转到内存页表中查找。若页表中的状态位 P 显示该页调入内存，则从相应的页表项读出页所在的页框号，并计算物理地址，然后把该页表项写入快表</p>\n</li>\n<li>\n<p>若该页尚末调入内存，则产生缺页异常请求操作系统从外存中把该页调入内存，然后修改页表，重新执行被中断的指令。</p>\n<p>​\t\t\t\t\t\t\t\t请求分页中的地址变换过程，如下图</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081602.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081602.png\" class=\"\"></p>\n</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"452-页分配策略\"><a class=\"anchor\" href=\"#452-页分配策略\">#</a> 4.5.2 页分配策略</h4>\n<ol>\n<li>\n<p>最少页框数</p>\n<p>指能保证进程正常运行所需要的最少的页框数。为了保证进程顺利执行，操作系统为进程分配的初始页数应该大于或等于最少页框数。</p>\n</li>\n</ol>\n<h4 id=\"453-页调入策略\"><a class=\"anchor\" href=\"#453-页调入策略\">#</a> 4.5.3 页调入策略</h4>\n<ol>\n<li>\n<p>何时调入页<br />\n大多数系统都采用<strong>预先凋入页</strong>的策略，将预计不久之后会被访问的页预先调入内存，而不是缺哪一页时再调入该页。</p>\n<p>​\t在实际系统中，通常是在<strong>调入缺页时，把与所缺页相邻的若千页也调入内存</strong>。</p>\n</li>\n<li>\n<p>从何处调入页</p>\n<p>当系统拥有足够的对换空间时，若发生缺页请求则从对换区调入页。从对换区调入页比从文件区调入页的速度快。对换区中的页是进程运行前从文件区复制到对换区的。</p>\n</li>\n</ol>\n<h4 id=\"454-页置换算法\"><a class=\"anchor\" href=\"#454-页置换算法\">#</a> 4.5.4 页置换算法</h4>\n<p>​\t页置换算法是从内存中选择换出页的算法。</p>\n<ol>\n<li>\n<p>最佳置换算法和先进先出置换算法</p>\n<p>( 1 )<strong> 最佳置换算法</strong></p>\n<p>​\t选择以后永远不会被访问的页或者在未来最长时间内不再被访问的页作为换出页。该算法主要用于<strong>理论研究</strong>。</p>\n<p>( 2 )<strong> 先进先出页置换算法</strong></p>\n<p>​\t为每个页记录该项调入内存的时间，当选择换出页时，选择进入内存时间最早的页。</p>\n<p>​\t实现简单，但<strong>效率低</strong>，会导致较高的缺页率，有的页刚被换出，可能又要立即被访问。</p>\n</li>\n<li>\n<p>最近最久未使用 LRU 置换算法</p>\n<p>​\t<strong>选择最近最久末使用的页换出</strong>。同样的页引用序列，LRU 算法<strong>置换次数</strong>较先进先出算法少，性能较好。</p>\n</li>\n<li>\n<p>其他置换算法</p>\n<p>​\t附加引用位算法、简单 Clock 置换算法、 改进型 Clock 算法、最少使用置换算法。</p>\n</li>\n</ol>\n<h4 id=\"综合题\"><a class=\"anchor\" href=\"#综合题\">#</a> 综合题</h4>\n<p>[答案] 先进先出页置换算法</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081603.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081603.png\" class=\"\"></p>\n<h4 id=\"455-请求分页系统的性能分析\"><a class=\"anchor\" href=\"#455-请求分页系统的性能分析\">#</a> 4.5.5 请求分页系统的性能分析</h4>\n<p>请求调入和置换技术都是以时间换空间的技术。</p>\n<ol>\n<li>\n<p>缺页率对有效访问时间的影响</p>\n<p>​\t进程执行中访存发生缺页时，需要请求从外存调入缺页。如果内存中没有空闲页框，还需要进行页置换，调入缺页后，指令需要重新执行。因此，一旦发生缺页，进程会存在因为访存而带来的时间延迟。</p>\n<p>​\t有效访问时间正比于缺页率。</p>\n</li>\n<li>\n<p>工作集</p>\n<p>​\t引入<strong>工作集机制</strong>是为了<strong>能有效降低缺页率</strong>，从而提高访存的时间效率。程序运行时<strong>对页的访问是不均匀的</strong>，往往在<strong>某段时间内集中于访问某些页</strong>。若能将<strong>某段时间间隔内要访问的页提前调入内存</strong>，将会大大降低缺页率，从而减少置换次数，提高 CPU 的利用率。<strong>工作集</strong>就是<strong>在某段时间间隔内，进程实际要访问的页的集合</strong>。</p>\n</li>\n<li>\n<p>抖动产生的原因和预防方法</p>\n<p>​\t多道程序度太高，使运行进程的大部分时间都用于进行页的换入、换出，而几乎不能完成任何有效工作的状态称为抖动。<br />\n​\t引起<strong>抖动的原因</strong>是<strong>系统中的进程数量太多，每个进程能分配到的页框态少</strong>，以至于进程运行过程中频繁请求调页。</p>\n<p>抖动的预防:<br />\n( 1 )<strong> 采取局部置换策略</strong>。仅在进程自己的内存空间范围内置换页。<br />\n(2) 在 CPU 调度程序中<strong>引入工作集</strong>算法。<br />\n( 3 )<strong> 挂起若干进程</strong>。腾出进程占用的空间。</p>\n</li>\n</ol>\n<h3 id=\"46-分段存储管理\"><a class=\"anchor\" href=\"#46-分段存储管理\">#</a> 4.6 分段存储管理</h3>\n<h4 id=\"461-分段机制的引入\"><a class=\"anchor\" href=\"#461-分段机制的引入\">#</a> 4.6.1 分段机制的引入</h4>\n<p>​\t在分页存储管理方式中，逻辑地址是维的，一个进程的逻辑地址形成个地址空间。 这种逻辑空间的使用方式对于程序员来说很不方便，分段能为进程提供多个地址空间，把逻辑上关联的部分放在一个地址空间中逻辑上没有关联也没有共同特征的部分放在不同的地址空间中。这样不仅方便用户编程，而且能很好地解决部分存储空间动态增长、信息共享和信息保护问题。</p>\n<p>​\t把分别存放逻辑上相关的信息、相互独立的逻辑地址空间称为一个段，每个段由一个从 0 到最大线性地址的逻辑地址空间构成。</p>\n<p>​\t各个段的长度可以是 0 到最大值之间的任何一个值不同段的长度可以不相同，段的长度在进程运行期间可以改变。</p>\n<p>​\t在使用分段存储管理的系统中，程序员使用二维的逻辑地址，一个数用来表示段，另一个数用来表示段内偏移。段是一个逻辑实体，程序员可以通过使用二维地址来访问不同的逻辑段。</p>\n<p>​\t一个段可能包括一个过程，或者一个数组、一个堆栈、一些数值变量，但是一般不会同时包含多种不同的内容。</p>\n<h4 id=\"462-分段系统的基本原理\"><a class=\"anchor\" href=\"#462-分段系统的基本原理\">#</a> 4.6.2 分段系统的基本原理</h4>\n<ol>\n<li>\n<p>分段</p>\n<p>​\t在分段的存储管理方式中，进程的地址空间被划分成若千个段。每个段定义了一组逻辑信息，每个段的大小由相应的逻辑信息组的长度确定，段的大小不一样 **, 每个段的逻辑地址从 0 开始，采用一段连续的地址空间 **。系统为每个段分配一个连续的物理内存区域，各个不同的段<strong>可以离散地放入物理内存不同的区域</strong>。</p>\n</li>\n<li>\n<p>分段的逻辑地址结构<br />\n分段机制的逻辑地址是二维的，由段号和段内地址组成。</p>\n<p>32 位系统中分段的地址形式为:</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081604.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081604.png\" class=\"\"></p>\n</li>\n<li>\n<p>段表</p>\n<p>​\t段表是<strong>由操作系统维护</strong>的用于支持分段存储管理地址映射的<strong>数据结构</strong>。通常，<strong> 每个进程有一个段表</strong>，段表由段表项构成。每个段表项包含<strong>段号、段基址</strong> (段的起始地址) 和<strong>段长</strong> (段大小) 3 个部分。一个进程可能包含若干个段，每一个段在段表中有一个段表项与之对应。根据段表可以知道一个段在物理内存中的位置。</p>\n</li>\n<li>\n<p>分段系统的地址变换</p>\n<p>​\t逻辑地址由段号 s 和段内偏移 d 构成。<br />\n​\t已知逻辑单元的地址为 s:d， 求物理地址的步骤为:<br />\n​\t(1) 以 s 为索引，从段表中找到段号为 s 的段表项。<br />\n​\t(2) 从找到的段表项中读出 s 段的基地址和段大小。<br />\n​\t(3) 如果<strong> d &lt; = 段大小</strong>，则将<strong>段基址与段内偏移 d 相加，得到与逻辑单元 s:d 对应的物理单元地址</strong>。</p>\n</li>\n<li>\n<p>分页和分段的主要区别</p>\n<ol>\n<li>页是按物理单位划分的，分页的引入是为了提高内存的利用率和支持虚拟存储。而段是按逻辑单位划分的，一个段含有一 - 组意义相对完整的信息。引入分段的目的是为了方便程序员编程。</li>\n<li>页的大小是固定的，而段的大小不固定，取决于用户编写的程序和编译器。</li>\n<li>分页的地址空间是一维的，程序员给出的地址只是一个助记符，已知的逻辑地址是一个整数。分段的地址空间是二维的，程序员在标识一个逻辑地址时需要给出两个数：一个是段号，一个是段内偏移。</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"463-段页式存储管理\"><a class=\"anchor\" href=\"#463-段页式存储管理\">#</a> 4.6.3 段页式存储管理</h4>\n<ol>\n<li>\n<p>段页式存储管理的基本原理</p>\n<p>​\t在段页式存储管理系统中，将用户进程的逻辑空间先划分成若干个段，每个段再划分成若千个页。进程以页为单位在物理内存中离散存放，每个段中被离散存放的页具有逻辑相关性。</p>\n</li>\n<li>\n<p>地址变换过程</p>\n<p>​\t在段页式存储管理系统中，逻辑地址与分段系统的逻辑地址相同，由段号 s 和段内地址 d 构成，地址变换过程如下<br />\n (1) 以段号 s 作索引，找到段 s 的段表项，得到该段页表的起始地址。<br />\n(2) 通过分页机制从<strong>段内偏移 d 中分离出页号 P 和页内偏移 W</strong>。<br />\n(3) 以段内页号<strong> P 作索引</strong>，从段 s 的页表中<strong>搜索</strong>页号<strong> P</strong> 对应的<strong>页表项</strong>。<br />\n(4) 从页表项中<strong>得到</strong>页所在的<strong>页框号</strong>。<br />\n(5) 由<strong>页框号</strong>与<strong>页内偏移 W</strong> 得到某逻辑地址对应的物理地址。</p>\n<p>物理地址 = 页框号 * 页框大小 + 页内偏移 W<br />\n 采用段页式存储管理的好处是，程序员可以使用分段的逻辑地址，而实际上进程却以页为单位存放于物理内存中。段页式系统的地址变换如下图。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081607.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081607.png\" class=\"\"></p>\n</li>\n</ol>\n<h4 id=\"464-综合题\"><a class=\"anchor\" href=\"#464-综合题\">#</a> 4.6.4 综合题</h4>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081605.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081605.png\" class=\"\"><br />\n<img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081606.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081606.png\" class=\"\"></p>\n<h3 id=\"47-linux的伙伴系统\"><a class=\"anchor\" href=\"#47-linux的伙伴系统\">#</a> 4.7 Linux 的伙伴系统</h3>\n<p>略</p>\n<hr />\n<h2 id=\"第五章文件管理\"><a class=\"anchor\" href=\"#第五章文件管理\">#</a> 第五章：文件管理</h2>\n<h3 id=\"考试重点-2\"><a class=\"anchor\" href=\"#考试重点-2\">#</a> 考试重点</h3>\n<p>文件结构、类型、存取、属性 (选择、填空、简答）<br />\n目录结构、路径名 (选择、填空、简答)<br />\n 实现文件、实现目录 (选择、填空、简答、综合)</p>\n<p>本章近 3 年分值: 14~19 分</p>\n<p><strong>操作系统中处理文件的部分称为文件系统</strong>，文件系统包括了文件及管理文件的软件集合。</p>\n<h3 id=\"51-文件\"><a class=\"anchor\" href=\"#51-文件\">#</a> 5.1 文件</h3>\n<h4 id=\"511-文件命名\"><a class=\"anchor\" href=\"#511-文件命名\">#</a> 5.1.1 文件命名</h4>\n<p>​\t<strong>文件名</strong>向用户提供了简单、直观的文件<strong>访问方式</strong>。<strong>按名存取</strong>。</p>\n<p>​\t所有操作系统都支持<strong> 1 ~8 个字母组成的字符串</strong>作为文件名。许多操作系统支持<strong>长达 255 个字符</strong>的文件名。</p>\n<p>​\tUNIX 文件系统区分大小写，MS-DOS 系统不区分。</p>\n<h4 id=\"512-文件结构\"><a class=\"anchor\" href=\"#512-文件结构\">#</a> 5.1.2 文件结构</h4>\n<ol>\n<li>\n<p>无结构字节序列</p>\n<p>也称为流式文件，如程序。</p>\n</li>\n<li>\n<p>固定长度记录序列</p>\n<p>构成文件的基本单位是具有固定长度的记录。</p>\n</li>\n<li>\n<p>树形结构</p>\n<p>文件由一棵记录树构成，记录长度不固定，在记录的固定位置包含一个关键字域，记录树按该域排序。</p>\n</li>\n</ol>\n<h4 id=\"513-文件类型\"><a class=\"anchor\" href=\"#513-文件类型\">#</a> 5.1.3 文件类型</h4>\n<p>​\t一般分为 ASCII 文件和 2 进制文件。ASCI 文件。由多行正文组成，各行的长度不必相同。可以显示和打印，也可以用通常的文本编辑器进行编辑。</p>\n<p>​\t二进制文件。具有一定的内部结构，如可执行的.exe 文件。用通常的文本编辑器不能直接显示或打印。</p>\n<h4 id=\"514-文件存取\"><a class=\"anchor\" href=\"#514-文件存取\">#</a> 5.1.4 文件存取</h4>\n<p>​\t文件存取方式有两种：顺序存取和随机存取。</p>\n<p>​\t顺序存取：进程从文件开始处读取文件中的所有字节或记录，不能掉过某些内容（磁带）</p>\n<p>​\t随机存取：又称直接存取，可以任意顺序读取文件中的字节或记录（磁盘）</p>\n<h4 id=\"515-文件属性\"><a class=\"anchor\" href=\"#515-文件属性\">#</a> 5.1.5 文件属性</h4>\n<p>​\t文件的创建日期、文件大小和修改时间等，这些附加信息称为文件属性。一些常用的文件属性有：口令、创建者、所有者，只读标志、隐藏标志、大小、类型等。</p>\n<h4 id=\"516-文件操作\"><a class=\"anchor\" href=\"#516-文件操作\">#</a> 5.1.6 文件操作</h4>\n<p>CREATE：创建文件，并设置文件的一些属性。</p>\n<p>DELETE：删除文件并释放磁盘空间。</p>\n<p>OPEN：使用文件之前，必须先打开文件。</p>\n<p>CLOSE：存取结束后，关闭文件以释放内存空间。</p>\n<p>READ：从文件中读取数据。</p>\n<p>WRITE：往文件中写数据。</p>\n<p>APPEND：在文件末尾添加数据。</p>\n<p>SEEK：对于随机存取文件，要指定从何处开始取数据。</p>\n<p>GETAT TRIBUTES：用于获取文件的属性。</p>\n<p>SETAT TRIBUTES：用于修改文件的属性。</p>\n<p>RENAME：修改已有文件的文件名。</p>\n<h3 id=\"52-目录\"><a class=\"anchor\" href=\"#52-目录\">#</a> 5.2 目录</h3>\n<p>​\t文件系统通常提供目录或文件夹用于记录文件很多系统中目录本身也是文件，目录是文件系统中实现按名访问文件的重要数据结构。</p>\n<h4 id=\"521-层次目录系统\"><a class=\"anchor\" href=\"#521-层次目录系统\">#</a> 5.2.1 层次目录系统</h4>\n<ol>\n<li>\n<p>目录文件的结构</p>\n</li>\n<li>\n<p>目录结构</p>\n<ol>\n<li>\n<p>单层目录</p>\n<p>​\t也被称为根目录，在整个系统中设置一张线性目录表，表中包括了所有文件的描述信息。</p>\n</li>\n<li>\n<p>两级目录</p>\n<p>​\t第一级为<strong>主目录</strong>。第二级为<strong>用户目录</strong>。两级目录解决了文件重名和共享问题。</p>\n</li>\n<li>\n<p>树形目录</p>\n<p>​\t也称多级目录，最高层为根目录，最底层为文件。用户可以创建任意数量的<strong>子目录</strong>。优点：便于文件的分类，层次结构清晰，便于管理和保护，解决了重名问题，查找速度快。</p>\n</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"522-路径名\"><a class=\"anchor\" href=\"#522-路径名\">#</a> 5.2.2 路径名</h4>\n<p>​\t常用的方法有两种：绝对路径名和相对路径名。</p>\n<p>​\t绝对路径名由从根目录到文件的路径组成。绝对路径名总是从根目录开始，并且是唯一的。在 Windows 系统中，路径各部分之间用 &quot;&quot; 分隔，如：C:\\program\\practice\\test</p>\n<p>​\t相对路径名。当一个文件系统的目录包含很多级时，可以允许用户指定一个目录作为当前的工作目录。所有的不从根目录开始的路径名都是相对于工作目录的。</p>\n<h3 id=\"53-文件系统的实现\"><a class=\"anchor\" href=\"#53-文件系统的实现\">#</a> 5.3 文件系统的实现</h3>\n<h4 id=\"531-实现文件\"><a class=\"anchor\" href=\"#531-实现文件\">#</a> 5.3.1 实现文件</h4>\n<p>​\t将分配给文件的<strong>连续扇区构成的磁盘块称为簇</strong>。</p>\n<ol>\n<li>\n<p>连续分配</p>\n<p>​\t把每个文件作为一连串连续数据块存储在磁盘上。每个文件都从新的簇开始存放。</p>\n<p>​\t优点：实现简单，读操作性能好。</p>\n<p>​\t缺点：随着时间的推移，碎片太多，难以利用</p>\n</li>\n<li>\n<p>使用磁盘链接表的分配</p>\n<p>​\t该方法为每个文件构造簇的链接表，每个簇前几个字节用于存放下一个簇的簇号。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081701.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081701.png\" class=\"\"></p>\n<p>​</p>\n<p>​\t优点：充分利用每个簇，不会浪费存储空间，管理简单</p>\n<p>​\t缺点：随机存取相当缓慢，要获取文件的第 n 块都要从头开始读取前面的 n- 1 块。</p>\n</li>\n<li>\n<p>使用内存的链接表分配</p>\n<p>​\t该方法是<strong>将</strong>文件所在的磁盘的<strong>簇号存放在内存的表中</strong>。</p>\n<p>​\t缺点：必须把整个表都存放在内存中，不适合大容量磁盘。</p>\n</li>\n<li>\n<p>i - 结点</p>\n<p>​\t该方法为每个文件赋予一个被称为 i 结点的数据结构，其中列出了文件属性和文件块的磁盘地址。给定一个文件的结点，就有可能找到文件的所有块。</p>\n<p>​\t当访问文件时，系统先根据文件名搜索文件所在的目录文件，从该文件对应的目录项中找到文件的结点号，根据 i 结点号从磁盘中将结点信息读入内存，文件在磁盘中的地址信息都存放在 i 结点中。</p>\n</li>\n</ol>\n<h4 id=\"532-实现目录\"><a class=\"anchor\" href=\"#532-实现目录\">#</a> 5.3.2 实现目录</h4>\n<p>​\t打开文件时，操作系统利用用户给出的路径名找到相应的目录项，目录项中提供了查找文件簇所需要的信息。（略）</p>\n<h4 id=\"533-磁盘空间管理\"><a class=\"anchor\" href=\"#533-磁盘空间管理\">#</a> 5.3.3 磁盘空间管理</h4>\n<p>​\t磁盘空间管理是文件系统的重要功能，包括记录空闲磁盘信息、设计文件的存储方式，以及规定文件系统的簇大小等内容。</p>\n<ol>\n<li>\n<p>簇大小</p>\n<p>​\t文件系统为文件分配磁盘空间是以簇为单位。簇的大小是<strong> 2 的整数次幂</strong>个连续的扇区。</p>\n</li>\n<li>\n<p>记录空闲块</p>\n<ol>\n<li>\n<p>空闲簇链接表</p>\n<p>​\t用一些空闲簇存放空闲簇的簇号。一个簇存放尽可能多的空闲簇的簇号，并专留出最后几个字节存放指向下一个存放空闲簇的指针。</p>\n</li>\n<li>\n<p>位图</p>\n<p>​\t用 n 位位图对应磁盘的 n 个簇，在位图中，空闲簇用 1 表示，已分配簇用 0 表示。每个簇只用一个二级制位标识，所需空间少。</p>\n</li>\n</ol>\n</li>\n</ol>\n<hr />\n<h2 id=\"第六章设备管理\"><a class=\"anchor\" href=\"#第六章设备管理\">#</a> 第六章：设备管理</h2>\n<h3 id=\"考试重点-3\"><a class=\"anchor\" href=\"#考试重点-3\">#</a> 考试重点</h3>\n<p>I/O 系统的结构、I/O 设备分类、设备控制器 (选择、填空、简答)<br />\n 轮询、中断、DMA 控制方式 (选择、填空、简答)<br />\n 缓冲管理 (选择、填空、简答)<br />\n 设备分配、独立性、SPOOLing 技术 (选择、 填空、简答)<br />\n I/O 软件管理 (选择、填空、简答)<br />\n 磁盘结构 (选择、填空、简答)<br />\n 磁盘调度 (选择、填空、简答、综合)</p>\n<p>本章近 3 年分值: 12~20 分</p>\n<h3 id=\"61-io系统的组成\"><a class=\"anchor\" href=\"#61-io系统的组成\">#</a> 6.1 I/O 系统的组成</h3>\n<h4 id=\"611-io系统的组成的概述\"><a class=\"anchor\" href=\"#611-io系统的组成的概述\">#</a> 6.1.1 I/O 系统的组成的概述</h4>\n<p>I/O 设备包括：I/O 设备、设备控制器、通道。</p>\n<h4 id=\"612-io系统的结构\"><a class=\"anchor\" href=\"#612-io系统的结构\">#</a> 6.1.2 I/O 系统的结构</h4>\n<ol>\n<li>\n<p>微机 I/O 系统</p>\n<p>CPU 不能直接跟 I/O 设备交换，需要设备控制器</p>\n</li>\n<li>\n<p>主机 I/O 系统</p>\n<p>I/O 系统采用四级结构：主机、通道、控制器、设备。一个通道可控制多个控制器，一个控制器可控制多个设备</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081801.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081801.png\" class=\"\"></p>\n</li>\n</ol>\n<h4 id=\"613-io设备的分类\"><a class=\"anchor\" href=\"#613-io设备的分类\">#</a> 6.1.3 I/O 设备的分类</h4>\n<ol>\n<li>\n<p>按传输速率</p>\n<ol>\n<li>低速设备：键盘、鼠标</li>\n<li>中速设备：打印机</li>\n<li>高速设备：磁带机、磁盘机、光盘机</li>\n</ol>\n</li>\n<li>\n<p>按信息交换的单位</p>\n<ol>\n<li>\n<p>块设备</p>\n<p>数据存储以数据块为单位，块大小固定，一次只传输一块，通过块号访问数据</p>\n</li>\n<li>\n<p>字符设备</p>\n<p>传输字节流；打印机、鼠标都是</p>\n</li>\n</ol>\n</li>\n<li>\n<p>按设备的共享属性</p>\n<ol>\n<li>\n<p>独占设备</p>\n<p>必须作为临界资源以互斥方式访问，在当前进程未使用完，其他进程不可使用</p>\n</li>\n<li>\n<p>共享设备</p>\n<p>允许多个进程同时访问，但同一时刻只能单个进程对磁盘读写</p>\n</li>\n<li>\n<p>虚拟设备</p>\n<p>将物理设备虚拟成若干个逻辑设备</p>\n</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"614-设备控制器\"><a class=\"anchor\" href=\"#614-设备控制器\">#</a> 6.1.4 设备控制器</h4>\n<p>CPU 与 I/O 设备的<strong>接口</strong>。</p>\n<ol>\n<li>功能\n<ul>\n<li>接收和识别</li>\n<li>数据交换\n<ol>\n<li>将驱动器的比特流汇聚在控制器的缓冲区，形成字节块</li>\n<li>在 CPU 和控制器双向传输</li>\n<li>将控制器的命令传给设备控制器</li>\n</ol>\n</li>\n<li>设备状态的了解和报告</li>\n<li>地址识别</li>\n<li>数据缓存</li>\n<li>差错控制</li>\n</ul>\n</li>\n<li>组成\n<ol>\n<li>与处理机的接口：数据线、控制线、地址线</li>\n<li>与设备的接口：存在三类信号，分别是数据、状态、控制信号</li>\n<li>I/O 逻辑：指令译码器、地址译码器</li>\n</ol>\n</li>\n</ol>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081802.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081802.png\" class=\"\"></p>\n<h4 id=\"614-io通道\"><a class=\"anchor\" href=\"#614-io通道\">#</a> 6.1.4 I/O 通道</h4>\n<p>​\t用于大型主机系统控制 I/O 设别，替代主机的设备控制器，提高 CPU 利用率和系统吞吐量</p>\n<h3 id=\"62-io控制方式\"><a class=\"anchor\" href=\"#62-io控制方式\">#</a> 6.2 I/O 控制方式</h3>\n<h4 id=\"621-轮询\"><a class=\"anchor\" href=\"#621-轮询\">#</a> 6.2.1 轮询</h4>\n<p>​\t在对设别发出 I/O 指令前，反复确认设备控制器状态寄存器的忙 / 闲标志。若空闲则发指令</p>\n<p>​\t缺点：极大浪费 CPU，影响系统的吞吐量</p>\n<h4 id=\"622-中断\"><a class=\"anchor\" href=\"#622-中断\">#</a> 6.2.2 中断</h4>\n<p>​\t当 I/O 设备忙，进程阻塞；工作完毕之后发出中断请求信号，CPU 响应</p>\n<p>​\t优点：使 CPU 与 I/O 设备在某些时间段上并行时间，提高 CPU 利用率和系统吞吐量</p>\n<h4 id=\"623-dma控制方式\"><a class=\"anchor\" href=\"#623-dma控制方式\">#</a> 6.2.3 DMA 控制方式</h4>\n<p>​\t为提高 I/O 的速度和 CPU 与 I/O 的并行速度。</p>\n<p>​\t逻辑组成包括三部分：主机与 DMA 接口、DMA 与设备的接口、I/O 控制逻辑。</p>\n<p>​\t为了主机与设备管理器成块数据传送，设计了四类寄存器：</p>\n<ol>\n<li>命令 / 状态寄存器 CR：接受 CPU 的 I/O 命令和有关控制信息、设别状态</li>\n<li>内存地址寄存器 MAR：存放内存地址</li>\n<li>数据计数器 DC：指示 DMA，本次向 CPU 发中断信号要读或写数据的次数</li>\n<li>数据寄存器 DR：暂存 DMA 传输中输入输出的数据</li>\n</ol>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081803.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21081803.png\" class=\"\"></p>\n<h3 id=\"63-缓冲管理\"><a class=\"anchor\" href=\"#63-缓冲管理\">#</a> 6.3 缓冲管理</h3>\n<h4 id=\"缓冲管理的概述\"><a class=\"anchor\" href=\"#缓冲管理的概述\">#</a> 缓冲管理的概述</h4>\n<p>​\t用于保存程序与程序、程序与设备之间传输数据的内存区域</p>\n<p>​\t为了尽可能使 CPU 与设备并行工作，提高系统的性能，需要操作系统在设备管理软件中提供缓冲区管理功能。</p>\n<h4 id=\"631-缓冲的引入\"><a class=\"anchor\" href=\"#631-缓冲的引入\">#</a> 6.3.1 缓冲的引入</h4>\n<p>引入缓冲区的原因主要有一下两点:</p>\n<ol>\n<li>处理数据流的生产者与消费者之间的速度差异。</li>\n<li>协调传输数据大小不一致的设备</li>\n</ol>\n<h4 id=\"632-单缓冲\"><a class=\"anchor\" href=\"#632-单缓冲\">#</a> 6.3.2 单缓冲</h4>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082501.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082501.png\" class=\"\"></p>\n<h4 id=\"633-双缓冲\"><a class=\"anchor\" href=\"#633-双缓冲\">#</a> 6.3.3 双缓冲</h4>\n<p>​\t对单缓冲进行了改进，性能提高，增加了复杂性</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082502.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082502.png\" class=\"\"></p>\n<h4 id=\"634-循环缓冲\"><a class=\"anchor\" href=\"#634-循环缓冲\">#</a> 6.3.4 循环缓冲</h4>\n<p>​\t当数据的输入和输出差别很大时，需要增大缓冲区数量，也就采用了循环缓冲</p>\n<p>➢ 循环缓冲的组成：</p>\n<ol>\n<li>多个缓冲区\n<ul>\n<li>空缓冲区 R</li>\n<li>已满数据的缓冲区 G</li>\n<li>现行工作缓冲区 C</li>\n</ul>\n</li>\n<li>多个指针\n<ul>\n<li>Nextg（消费者，装满数据的缓冲区）</li>\n<li>Nexti（生产者，空缓冲区）</li>\n<li>Current（进程正在使用）</li>\n</ul>\n</li>\n</ol>\n<p>➢ 循环缓冲的概念</p>\n<p>​\t生产者和消费者并行执行。循环缓冲的缓冲区构成一个环。Nextg 和 Nexti 指针不断沿顺时针方向移动。当一方追上另一方时，便会阻塞该进程。</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082503.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082503.png\" class=\"\"></p>\n<h4 id=\"635-缓冲池\"><a class=\"anchor\" href=\"#635-缓冲池\">#</a> 6.3.5 缓冲池</h4>\n<p>一种广泛应用的缓冲管理技术，存在多个可供多个进程共享的缓冲区，提高了效率</p>\n<p>➢ 循环缓冲的组成：</p>\n<p>​\t可输入也可输出，至少包含 3 种类型的缓冲区、3 种缓冲队列、四种工作缓冲区</p>\n<ol>\n<li>缓冲区\n<ul>\n<li>空缓冲区</li>\n<li>装满输入数据的缓冲区</li>\n<li>装满输出数据的缓冲区</li>\n</ul>\n</li>\n<li>缓冲队列\n<ul>\n<li>空缓冲队列</li>\n<li>输入队列</li>\n<li>输出队列</li>\n</ul>\n</li>\n<li>工作缓冲区\n<ul>\n<li>收容输入</li>\n<li>提取输入</li>\n<li>收容输出</li>\n<li>提取输出</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"64-设备分配\"><a class=\"anchor\" href=\"#64-设备分配\">#</a> 6.4 设备分配</h3>\n<p>​\t不允许用户自行使用，需要系统分配，且需要记录设备情况的数据结构和设备分配算法</p>\n<h4 id=\"641-设备分配中的数据结构\"><a class=\"anchor\" href=\"#641-设备分配中的数据结构\">#</a> 6.4.1 设备分配中的数据结构</h4>\n<p>​\t支持设备分配的数据结构：<strong>记录设备的状态 (忙或空闲)</strong>、<strong>设备类型</strong><br />\n​\t设备分配方案：<strong>设备控制表</strong>、<strong>控制器控制表</strong>、<strong>通道控制表和系统设备表</strong></p>\n<ol>\n<li>\n<p>设备控制表 DCT (Device Control Table)</p>\n<p>系统为每个设备建立一张设备控制表，多台设备的设备控制表构成设备控制表集合。</p>\n<p>设备控制表包含下列信息：</p>\n<ul>\n<li>设备类型</li>\n<li>设备标志符</li>\n<li>设备状态：忙 / 闲</li>\n<li>指向控制器表的指针</li>\n<li>重复执行的次数或时间</li>\n<li>设备 (请求) 队列的队首指针</li>\n</ul>\n</li>\n<li>\n<p>控制器控制表 COCT (Controller Control Table)</p>\n<p>系统为每个控制器设置一 - 张用于记录该控制器信息的控制器控制表，控制器控制表中包含以下几个字段:</p>\n<ul>\n<li>控制器标识符</li>\n<li>控制器状态</li>\n<li>与控制器相连接的通道表指针</li>\n<li>控制器队列的队首指针</li>\n<li>控制器队列的队尾指针</li>\n</ul>\n</li>\n<li>\n<p>通道控制表 CHCT (Channel Control Table)</p>\n<p>在一些主机系统中还有通道设备，系统会为每个通道设备设置一 - 张通道控制表，通道控制表包括以下几个字段。</p>\n<ul>\n<li>控制器标识符</li>\n<li>控制器状态</li>\n<li>与通道连接的控制器表首址</li>\n<li>通道队列的队首指针</li>\n<li>通道队列的队尾指针</li>\n</ul>\n</li>\n<li>\n<p>系统设备表 SDT (System Device Table)</p>\n<p>​\t记录了系统中全部设备的情况。每个设备占一个表目，其中包括设备类型、设备标识符、设备控制表及设备驱动程序的入地址。</p>\n</li>\n</ol>\n<h4 id=\"642-设备分配\"><a class=\"anchor\" href=\"#642-设备分配\">#</a> 6.4.2 设备分配</h4>\n<p>系统分配时需要考虑 3 个因素：<strong>设备的固有属性</strong>、<strong>设备分配算法</strong>、<strong>设备分配时的安全性</strong></p>\n<ol>\n<li><strong>设备的固有属性</strong>\n<ul>\n<li>独占性（利用不充分、容易死锁）</li>\n<li>共享性（需要对先后顺序进行合理调度）</li>\n<li>可虚拟性</li>\n</ul>\n</li>\n<li><strong>设备分配算法</strong></li>\n<li><strong>设备分配时的安全性</strong></li>\n</ol>\n<h4 id=\"643-设备独立性\"><a class=\"anchor\" href=\"#643-设备独立性\">#</a> 6.4.3 设备独立性</h4>\n<ol>\n<li>\n<p>概念</p>\n<p>应用程序独立于具体使用的物理设备</p>\n</li>\n<li>\n<p>好处</p>\n<ul>\n<li>应用程序与物理设备无关</li>\n<li>易于处理 I/O 设备的故障</li>\n<li>提高系统可靠性</li>\n</ul>\n</li>\n<li>\n<p>设备独立软件</p>\n<ol>\n<li>执行所有设备的公有操作</li>\n<li>向用户层软件提供统一的接口</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"644-独占设备的分配程序\"><a class=\"anchor\" href=\"#644-独占设备的分配程序\">#</a> 6.4.4 独占设备的分配程序</h4>\n<p>​\t对于具有 / O 通道的系统，在进程提出 I/O 请求后，系统的设备分配程序可按下列步骤进行设备分配</p>\n<ol>\n<li>\n<p>分配设备</p>\n<p>根据用户请求的设备的物理名，查找系统设备表，从中找出该设备的设备控制表，检查设备控制表中的设备状态字。</p>\n</li>\n<li>\n<p>分配控制器</p>\n<p>若系统为进程分配了其请求的设备，就到该设备的控制表中找出与该设备连接的控制器的 COCT , 即设备控制器控制表，检查其中的状态字段。</p>\n</li>\n<li>\n<p>分配通道</p>\n<p>在有通道的系统中，还需要从相应的设备控制器控制表中找到与该控制器连接的通道控制表，检查表中的通道状态字段。</p>\n</li>\n</ol>\n<h4 id=\"645-spooling技术\"><a class=\"anchor\" href=\"#645-spooling技术\">#</a> 6.4.5 SPOOLing 技术</h4>\n<p>​\t在联机情况下实现的同时外围操作成为 SPOOLing</p>\n<ol>\n<li>\n<p>SPOOLing 的组成</p>\n<ul>\n<li>\n<p>输入井和输出井（大量输入输出的缓存）</p>\n</li>\n<li>\n<p>输入缓冲区和输出换红曲（把井的数据存放缓冲区，再传给输出设备）</p>\n</li>\n<li>\n<p>输入进程和输出进程</p>\n</li>\n<li>\n<p>请求 I/O 队列</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082504.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082504.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>利用 SPOOLing 技术实现共享打印机</p>\n<ol>\n<li>当用户进程提出打印请求时，SPOOLing 系统先为用户做下列两件事。\n<ol>\n<li>由输出<strong>进程</strong>在输出<strong>井</strong>中<strong>申请空闲盘块区</strong>，并将要打印的数据送入其中</li>\n<li>输出<strong>进程</strong>再<strong>为用户申请</strong>并填写一张<strong>用户请求打印表</strong>，将该表<strong>挂到请求打印队列</strong></li>\n</ol>\n</li>\n<li>打印机开始打印时\n<ol>\n<li>从队首取一张请求打印表</li>\n<li>将打印数据从井送到缓冲区</li>\n<li>打印</li>\n<li>完成</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>特点</p>\n<ol>\n<li>提高速度</li>\n<li>将独占设备改造成逻辑的共享设备</li>\n<li>实现了虚拟设备功能</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"65-io软件原理\"><a class=\"anchor\" href=\"#65-io软件原理\">#</a> 6.5 I/O 软件原理</h3>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082505.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082505.png\" class=\"\"></p>\n<h4 id=\"651-设备管理软件的功能\"><a class=\"anchor\" href=\"#651-设备管理软件的功能\">#</a> 6.5.1 设备管理软件的功能</h4>\n<ol>\n<li>实现 I/O 设备的独立性</li>\n<li>错误处理（先低层，解决不了就往上抛）</li>\n<li>异步传输</li>\n<li>缓冲管理</li>\n<li>设备的分配和释放</li>\n<li>实现 I/O 控制方式</li>\n</ol>\n<h4 id=\"652-中断处理程序\"><a class=\"anchor\" href=\"#652-中断处理程序\">#</a> 6.5.2 中断处理程序</h4>\n<p>​\t作用：将发出 I/O 请求而被阻塞的进程唤醒</p>\n<h4 id=\"653-设备驱动程序\"><a class=\"anchor\" href=\"#653-设备驱动程序\">#</a> 6.5.3 设备驱动程序</h4>\n<p>​\t是 VO 进程与设备控制器之间的通信程序。主要任务是<strong>接受上层软件发来的抽象的 I/O 请求</strong>。</p>\n<p>当有读第 n 块磁盘的请求时，磁盘驱动程序工作如下:</p>\n<ol>\n<li>计算出所请求块的物理地址。</li>\n<li>检查驱动器电机是否正在运转。</li>\n<li>检查磁头臂是否定位在正确的柱面。</li>\n<li>确定需要哪些控制器命令及命令的执行顺序。</li>\n<li>向设备控制器的设备寄存器中写入命令。</li>\n<li>I/O 完成后，向上层软件传送数据。</li>\n</ol>\n<h4 id=\"654-与硬件无关的io软件\"><a class=\"anchor\" href=\"#654-与硬件无关的io软件\">#</a> 6.5.4 与硬件无关的 I/O 软件</h4>\n<ul>\n<li>设备无关 I/O 软件的功能如下:\n<ul>\n<li>设备命名：将设备名映射到相应的驱动程序</li>\n<li>设备保护：为设备设置合理的访问权限</li>\n<li>提供独立于设备的块大小</li>\n<li>为块设备和字符设备提供必要的缓冲技术</li>\n<li>块设备的存储分配</li>\n<li>分配和释放独立设备</li>\n<li>错误处理</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"66-磁盘管理\"><a class=\"anchor\" href=\"#66-磁盘管理\">#</a> 6.6 磁盘管理</h3>\n<p>重要目标：提高磁盘吕勇率和磁盘访问速度</p>\n<h4 id=\"661-磁盘结构\"><a class=\"anchor\" href=\"#661-磁盘结构\">#</a> 6.6.1 磁盘结构</h4>\n<ol>\n<li>数据的组织和格式\n<ol>\n<li>磁盘设备包括一个或多个<strong>盘片</strong>，盘片又分一个或两个<strong>存储面</strong>，每个盘面被组织成若干个<strong>同心环</strong>，又称<strong>磁道</strong>每条磁盘存储相同数目的二进制位，磁盘密度是内层磁道大于外层。每条磁道又被划分成若干个<strong>扇区</strong>\n<ul>\n<li>一个扇区上存储一个物理记录。磁盘上存储的物理记录数目是由扇区数、磁道数及磁盘面数决定的</li>\n<li>每个扇区包括两个字段：标识符字段、数据字段</li>\n</ul>\n</li>\n<li>磁盘的类型\n<ol>\n<li>固定头磁盘\n<ul>\n<li>每条磁道上都有磁头，提高磁盘读写速度。用于大容量磁盘</li>\n</ul>\n</li>\n<li>移动头磁盘\n<ul>\n<li>每个盘面一个磁头，磁头可移动并寻道，速度较慢，结构简单，用于中小磁盘设备</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>磁盘的访问时间\n<ol>\n<li>寻道时间</li>\n<li>旋转延迟时间</li>\n<li>访问时间</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"662-磁盘调度\"><a class=\"anchor\" href=\"#662-磁盘调度\">#</a> 6.6.2 磁盘调度</h4>\n<p>磁盘为多个进程共享，需采用一种最佳调度算法，<strong>使各进程对磁盘的平均访问时间最短</strong></p>\n<ol>\n<li>\n<p>先来先服务（FCFS）</p>\n<ul>\n<li>\n<p>最简单的磁盘调度算法，平均寻道时间较长，适用于进程数较少的场合</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082601.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082601.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>最短寻道时间优先（SSTF）</p>\n<ul>\n<li>\n<p>要求访问的磁道与当前磁头所在的磁道距离最近。能使每次的寻道时间最短，单不能保证平均寻道时间</p>\n</li>\n<li>\n<p>缺点：可能导致某个进程发生 “饥饿” 现象（进来的进程总是离磁头较近）</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082602.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082602.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>扫描算法（SCAN）算法</p>\n<ul>\n<li>\n<p>优先考虑磁头当前的移动方向（先往一边走，这边走完了再返回去走反方向）</p>\n</li>\n<li>\n<p>缺点：当磁头刚越过磁道 A，又来一个进程需要访问磁道 A，则需要等待很长时间</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082603.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082603.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>循环扫描算法（CSCAN）</p>\n<ul>\n<li>\n<p>规定磁头只能单向移动，不能变更方向</p>\n<p><img data-src=\"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082604.png\" alt=\"\" /><img data-src=\"/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/21082604.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>NStepSCAN 和 FSCAN 算法</p>\n<p>​\t在前面几种算法中，可能会出现磁盘臂停留在某处、不动的情况。如有一个或多个进程对某一磁道有较高的访问频率，从而垄断了整个磁盘设备。把这一现象称为 “磁臂粘着”, 在高密度磁盘上容易出现此情况。</p>\n<ul>\n<li>\n<p>NStepSCAN 算法：</p>\n<p>将磁盘请求队列分成若干个子队列，依次去调度，新来的放到后面的队列，防止一直请求同一个磁道，避免磁臂粘着</p>\n</li>\n<li>\n<p>FSCAN 算法：</p>\n<p>是 NStepSCAN 的简化，之分成两个队列。一个当前处理，一个是扫描期间新出现的</p>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"663-提高磁盘io速度的方法\"><a class=\"anchor\" href=\"#663-提高磁盘io速度的方法\">#</a> 6.6.3 提高磁盘 I/O 速度的方法</h4>\n<ol>\n<li>提前读</li>\n<li>延迟写\n<ul>\n<li>内存的东西不立刻丢，除非要使用才丢</li>\n</ul>\n</li>\n<li>优化物理块的分布\n<ul>\n<li>适当地集中数据在磁盘存放的位置，可以减少磁臂移动距离，提高效率。需采用优化文件物理块分布的方法</li>\n</ul>\n</li>\n<li>虚拟盘\n<ul>\n<li>用内存空间去仿真磁盘，又称 RAM 盘</li>\n</ul>\n</li>\n<li>磁盘高速缓冲\n<ul>\n<li>拿内存的一块存储空间暂存磁盘中的信息</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "人生经历",
                "本科",
                "计算机科学与技术",
                "操作系统概论"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/",
            "url": "https://xinyao_idiot.gitee.io/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/",
            "title": "数据库系统原理",
            "date_published": "2021-08-09T06:14:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"数据库系统原理\"><a class=\"anchor\" href=\"#数据库系统原理\">#</a> 数据库系统原理</h1>\n<h2 id=\"第一章-数据库系统概念\"><a class=\"anchor\" href=\"#第一章-数据库系统概念\">#</a> 第一章、数据库系统概念</h2>\n<h3 id=\"第一节数据库基本概念\"><a class=\"anchor\" href=\"#第一节数据库基本概念\">#</a> 第一节：数据库基本概念</h3>\n<h4 id=\"一数据\"><a class=\"anchor\" href=\"#一数据\">#</a> 一。数据：</h4>\n<p>​\t\t数据（Data）是描述事物的符号记录，是只用无里符号记录下来的、可以鉴别的信息。</p>\n<h4 id=\"二数据库\"><a class=\"anchor\" href=\"#二数据库\">#</a> 二。数据库</h4>\n<p>​\t\t数据库（Database，DB）通俗地被称为存储数据的仓库，知识这个仓库是存储在计算机存储设备上的，并且其所存储的数据是按一定的格式进行存储的。</p>\n<p><strong>特点：具有较小的冗余度、较高的数据独立性，系统易于扩展，并可以被多个用户共享。</strong></p>\n<p>** 三个基本特点：** 具有永久存储、有组织和可共享三个基本特点</p>\n<h4 id=\"三数据库管理系统\"><a class=\"anchor\" href=\"#三数据库管理系统\">#</a> 三。数据库管理系统</h4>\n<p>数据库管理系统（Database Managenment System，DBMS）是专门用于建立和管理数据库的一套软件，介于应用程序和操作系统之间。负责<strong>科学有效的组织和存储数据</strong>，并帮助数据库的使用者从大量的数据中快速地获取所需数据，以及提供必要的<strong>安全性</strong>和<strong>完整性</strong>等统一控制机制，实现对数据有效的管理与维护。</p>\n<h4 id=\"四数据库的主要功能\"><a class=\"anchor\" href=\"#四数据库的主要功能\">#</a> 四。数据库的主要功能</h4>\n<ol>\n<li>数据定义功能</li>\n<li>数据操纵功能</li>\n<li>数据库的运行管理功能</li>\n<li>数据库的建立和维护功能</li>\n<li>数据组织、存储和管理功能</li>\n<li>其他功能（主要包括与其他软件<strong>网络通信</strong>、不同数据库系统之间的<strong>数据传输和相互访问</strong>）</li>\n</ol>\n<h4 id=\"五数据库系统\"><a class=\"anchor\" href=\"#五数据库系统\">#</a> 五。数据库系统</h4>\n<p>数据库系统（DBS）是指在计算机中引入数据库技术之后的系统</p>\n<p>数据库管理员（DBA）是专门负责对数据库进行维护的专业人员</p>\n<hr />\n<h3 id=\"第二节数据管理技的发展\"><a class=\"anchor\" href=\"#第二节数据管理技的发展\">#</a> 第二节：数据管理技的发展</h3>\n<h4 id=\"数据管理\"><a class=\"anchor\" href=\"#数据管理\">#</a> 数据管理：</h4>\n<ol>\n<li><strong>针对组织业务的管理</strong>，负责指定并执行郑个组织中关于数据的定义、组织、保护与有效使用的策略、过程和计划</li>\n<li><strong>依靠技术</strong>，负责实现数据作为一个资源的集中控制管理</li>\n</ol>\n<p>** 数据组织：** 用便于处理的某种方式收集数据，并将记录在纸介文件上的数据转换成计算机可处理的形式；然后将手机的数据进行适当的构造</p>\n<ul>\n<li>逻辑组织：用户或应用程序所使用的数据结构形式</li>\n<li>物理组织：数据在无里存储设备上的结构形式</li>\n<li>检索：为了向用户提供信息，存储的数据要能够方便地选择提取</li>\n</ul>\n<p>随着计算机技术的发展及应用，数据挂你了技术共经历了<strong>人工管理</strong>、<strong>文件系统</strong>和<strong>数据库系统</strong>三个阶段</p>\n<h4 id=\"一人工管理阶段\"><a class=\"anchor\" href=\"#一人工管理阶段\">#</a> 一。人工管理阶段：</h4>\n<p><strong>20 世纪 50 年代中期以前</strong>，所设计的数据处理基本依靠<strong>手工方式</strong>进行，具有以下特点：</p>\n<ol>\n<li>数据不保存（<strong>存储容量有限，价格昂贵</strong>）</li>\n<li>应用程序管理数据（<strong>即没有专门的数据管理软件</strong>）</li>\n<li>数据与面向应用（<strong>即一组数据面对一个应用程序</strong>）</li>\n</ol>\n<h4 id=\"二文件系统阶段\"><a class=\"anchor\" href=\"#二文件系统阶段\">#</a> 二。文件系统阶段：</h4>\n<p><strong>20 世纪 20 年代后期到 60 年代中期</strong>，计算机硬件和软件发展到了一定阶段，配备了专门的数据管理软件，即<strong>文件系统</strong>。文件系统将数据的<strong>逻辑结构</strong>和<strong>物理结构</strong>分离，当物理结构发生改变的时候，不会导致应用程序的修改（<strong>数据的物理独立结构</strong>）。</p>\n<p>特点如下：</p>\n<ul>\n<li>数据的管理者：文件系统，数据可长期保存（<strong>有硬盘和专门的文件系统</strong>）</li>\n<li>数据面向的对象：某一应用程序</li>\n<li>数据的共享程度：<strong>共享性差、冗余度大</strong></li>\n<li>数据的结构化：记录有结构，整体无结构 (<strong>不能</strong>实现数据的普通共享，<strong>只能</strong>实现文件级的共享）</li>\n<li>数据的独立性：独立性差，提供了物理数据独立性（<strong>使数据共享成为可能</strong>）</li>\n<li>数据控制能力：应用程序自己控制</li>\n</ul>\n<h4 id=\"三数据库系统阶段\"><a class=\"anchor\" href=\"#三数据库系统阶段\">#</a> 三。数据库系统阶段：</h4>\n<p><strong>20 世纪 60 年代后期以来</strong>，<strong>解决了数据的冗余</strong>；数据变更时，能节省对多个数据副本的变更操作，<strong>大大缩小计算机运算时间开销</strong>，还要求数据具有更高的独立性，不但<strong>具有物理独立性</strong>，而且<strong>具有逻辑独立性</strong>，从而<strong>节省应用程序开发的维护和代价</strong>数据库系统孕育而生。</p>\n<p>特点如下：</p>\n<ol>\n<li>数据集成\n<ul>\n<li><strong>数据的集成是数据库管理系统的主要目的</strong>，可<strong>使数据得到最大程度的共享，且冗余最小</strong></li>\n</ul>\n</li>\n<li>数据共享性高\n<ul>\n<li><strong>一个数据可以为多个不同的用户共同使用</strong></li>\n</ul>\n</li>\n<li>数据冗余小</li>\n<li>数据一致性\n<ul>\n<li>通过消除或控制数据冗余，可以在一定范围内避免数据的不一致性。<strong>引起不一致的根源是数据冗余</strong></li>\n</ul>\n</li>\n<li>数据独立性高\n<ul>\n<li><strong>数据定义</strong>与<strong>使用数据的应用程序分离</strong>被称为<strong>数据独立</strong>（数据或应用程序的修改不会彼此引起另一方的修改，两层数据独立）</li>\n</ul>\n</li>\n<li>实施统一管理与控制\n<ul>\n<li>主要包括数据<strong>安全性</strong>、<strong>完整性</strong>、<strong>并发控制</strong>、<strong>故障恢复</strong>等，即<strong>数据库保护</strong></li>\n<li>数据的安全性：<strong>保护数据</strong>，放置不合法的使用造成数据泄密和破坏</li>\n<li>数据的完整性：对数据的<strong>正确性</strong>、<strong>有效性</strong>和<strong>相容性</strong>要求</li>\n<li>并发控制：规避多线程并发造成的安全问题</li>\n<li>故障恢复：在出现问题时，数据库系统（DBMS）必须具有将数据库从错误状态恢复到某一已知的正确状态的功能</li>\n</ul>\n</li>\n<li>减少应用程序开发与维护的工作量\n<ul>\n<li>由于数据库<strong>数据具有共享性、独立性</strong>，在开发与维护新的应用<strong>所花费的代价和时间大大减少</strong></li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"第三节数据库系统的结构\"><a class=\"anchor\" href=\"#第三节数据库系统的结构\">#</a> 第三节：数据库系统的结构</h3>\n<h4 id=\"一三级模式结构的两层映像与数据独立性\"><a class=\"anchor\" href=\"#一三级模式结构的两层映像与数据独立性\">#</a> 一。三级模式结构的两层映像与数据独立性</h4>\n<ol>\n<li><strong>外模式 / 模式映像</strong>（逻辑独立性）</li>\n<li><strong>模式 / 内模式映像</strong>（物理独立性）</li>\n</ol>\n<p>数据库系统</p>\n<ul>\n<li>内部系统结构（采用三级模式结构）\n<ul>\n<li>模式\n<ul>\n<li>模式也被称为<strong>概念模式</strong>或<strong>逻辑模式</strong>（实际上时数据库数据在逻辑级上的视图）</li>\n</ul>\n</li>\n<li>外模式\n<ul>\n<li>外模式也被称为<strong>子模式</strong>或<strong>用户模式</strong>（数据库用户能够看到和使用的局部数据）</li>\n</ul>\n</li>\n<li>内模式\n<ul>\n<li>内模式也被称为存储模式（对数据库中数据物理结构和存储方式 id 描述）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>外部系统结构</li>\n</ul>\n<p>【单选题】数据库系统的数据独立性是指（不会因为系统数据库存储结构与数据逻辑结构的变化而影响应用程序）</p>\n<h4 id=\"二数据库系统的运行与应用结构\"><a class=\"anchor\" href=\"#二数据库系统的运行与应用结构\">#</a> 二。数据库系统的运行与应用结构</h4>\n<ol>\n<li>客户 / 服务器（<strong>Client/Server，C/S</strong>）模式\n<ul>\n<li>QQ、桌面客户端游戏</li>\n</ul>\n</li>\n<li>浏览器 / 服务器（<strong>Browser/Server，B/S</strong>）模式\n<ul>\n<li>网站、在线 web 游戏</li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"第四节数据模型\"><a class=\"anchor\" href=\"#第四节数据模型\">#</a> 第四节：数据模型</h3>\n<h4 id=\"一数据特征与数据模型组成要素\"><a class=\"anchor\" href=\"#一数据特征与数据模型组成要素\">#</a> 一。数据特征与数据模型组成要素</h4>\n<ol>\n<li>\n<p>数据结构</p>\n<p>数据结构描述的是系统的<strong>静态特性</strong>，即数据对象的数据类型、内容、属性以及书对象之间的联系。</p>\n</li>\n<li>\n<p>数据操作</p>\n<p>数据操作描述的是系统的<strong>动态特性</strong>，是对各种对象的实例允许执行的操作的集合，包括操作及有关的操作规则</p>\n</li>\n<li>\n<p>数据的约束条件</p>\n<p>数据约束描述数据结构中数据见的语法和语义关联，包括相互制约与依存关系以及数据动态变化规则，以保证数据的<strong>正确性、有效性与相容性</strong>。</p>\n</li>\n</ol>\n<h4 id=\"二数据模型的分类\"><a class=\"anchor\" href=\"#二数据模型的分类\">#</a> 二。数据模型的分类</h4>\n<ol>\n<li>\n<p><strong>概念层数据模型</strong></p>\n<p>信息世界中的基本概念</p>\n<ul>\n<li>\n<p>实体（Entity）</p>\n<p>客观存在并可相互区别的事物称为实体。可以是具体的人、事、物或抽象的概念。</p>\n</li>\n<li>\n<p>属性（Attribute）</p>\n<p>实体所具有的某一特征称为属性。一个实体可以由若干个属性来刻画。</p>\n</li>\n<li>\n<p>码（Key）</p>\n<p><strong>唯一</strong>表示实体的<strong>属性集</strong>称为码。</p>\n</li>\n<li>\n<p>域（Domain）</p>\n<p>属性的<strong>取值范围</strong>称为该属性的域。</p>\n</li>\n<li>\n<p>实体型（Entity Type）</p>\n<p>用实体名及<strong>其属性</strong>名集合来抽象和刻画。同类实体称为<strong>实体型</strong>。</p>\n</li>\n<li>\n<p>实体集（Entity Set）</p>\n<p>同型实体的集合称为实体集。</p>\n</li>\n<li>\n<p>联系（Relationship）</p>\n<p>显示世界中事物内部以及事物之间的联系在信息世界中反应为实体内部的联系和实体之间的联系。</p>\n<p>实体型间联系：</p>\n<ul>\n<li>一对多\t1：N</li>\n<li>一对一    1：1</li>\n<li>多对多    N：M</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>概念模型（对应外模式）</strong></p>\n<ul>\n<li>\n<p>概念模型：用来描述现实世界的事物，与具体的计算机系统无关</p>\n<p><img data-src=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/E-R%E5%9B%BE.png\" alt=\"\" /><img data-src=\"/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/E-R%E5%9B%BE.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>逻辑层数据模型（对应模式）</strong></p>\n<ol>\n<li>层次模型；</li>\n<li>网状模型；</li>\n<li><strong>关系模型；</strong></li>\n<li>面向对象模型；</li>\n</ol>\n</li>\n<li>\n<p><strong>物理层数据模型（对应内模式）</strong></p>\n<p>物理层数据模型，也称为数据的<strong>物理模型</strong>（Physical Model），其描述数据在<strong>存储介质</strong>上的组织结构，是逻辑模型的物理实现，即每一种逻辑模型在实现时都有与其对应的物理模型。</p>\n</li>\n</ol>\n<hr />\n<h2 id=\"第二章-关系数据库\"><a class=\"anchor\" href=\"#第二章-关系数据库\">#</a> 第二章、关系数据库</h2>\n<h3 id=\"第一节关系数据库概述\"><a class=\"anchor\" href=\"#第一节关系数据库概述\">#</a> 第一节：关系数据库概述</h3>\n<h4 id=\"一基本简介\"><a class=\"anchor\" href=\"#一基本简介\">#</a> 一。基本简介</h4>\n<p>系统而严格提出关系模型的是<strong>美国 IBM 公司的 E.F.Codd</strong></p>\n<ul>\n<li><strong>1970 年</strong>提出<strong>关系数据模型</strong>；</li>\n<li>1970 年<strong> E.F.Codd</strong> 发表了《Communication of the ACM》</li>\n<li>之后提出了，<strong>关系代数和关系演算的概念</strong>；</li>\n<li><strong>1972 年</strong>提出了关系的<strong>第一、第二、第三范式</strong>；</li>\n<li><strong>1974 年</strong>提出了关系的<strong> BC 范式</strong>。</li>\n</ul>\n<p>关系数据库应用<strong>数学方法</strong>来<strong>处理数据库的数据</strong></p>\n<p>80 年代后，关系数据库系统成为最重要、最流行的数据库系统。</p>\n<ul>\n<li>典型的实验系统：\n<ul>\n<li>System R</li>\n<li>University INGRES</li>\n</ul>\n</li>\n<li>典型商用系统\n<ul>\n<li>ORACLE</li>\n<li>SYBASE</li>\n<li>INFORMIX</li>\n<li>IBM DB2</li>\n<li>SQL service</li>\n</ul>\n</li>\n</ul>\n<p>关系模型的数据结构（类似于 Excel）</p>\n<h4 id=\"二基本术语\"><a class=\"anchor\" href=\"#二基本术语\">#</a> 二。基本术语</h4>\n<ol>\n<li>\n<p><strong>表（Table）</strong></p>\n</li>\n<li>\n<p><strong>关系（Relation）</strong></p>\n</li>\n<li>\n<p><strong>列（Column）</strong></p>\n<p>也被称为<strong>字段</strong>或者<strong>属性</strong></p>\n</li>\n<li>\n<p><strong>属性（Attribute）</strong></p>\n<p>在数据表中，<strong>一列即为一个属性</strong>，给每一个属性起一个名称即为属性名。与之同义的术语是”<strong> 列</strong> “。表中的<strong>属性的个数称为关系的元或度</strong>。<strong>列的值称为属性值</strong>；<strong>属性值的取值范围称为值域</strong>；</p>\n</li>\n<li>\n<p><strong>行（Row）</strong></p>\n<p>表中行（Row），也称作元组（Tuple）或记录</p>\n</li>\n<li>\n<p><strong>元组（Tuple）</strong></p>\n<p>表中的一行即为一个元组（一条数据即为一个元组）</p>\n</li>\n<li>\n<p><strong>分量（Component）</strong></p>\n<p>元组中的一个属性值，称为分量</p>\n</li>\n<li>\n<p><strong>码或键（Key）</strong></p>\n<p>如果在一个关系中，存在这样的属性（或属性组），使得在该关系的任何一个关系状态中的两个元组，在该属性（或属性组）上值的组合都不相同，即这些属性（或属性组）的值都能用来唯一标识该关系的元组，称此属性（或属性组）为该关系的码或键</p>\n</li>\n<li>\n<p><strong>超码或超键（Super Key）</strong></p>\n<p>如果在关系的一个码中移去某个属性，它仍然是这个关系的码，则称这样的码或键为该关系的超码或超键</p>\n</li>\n<li>\n<p><strong>候选码或候选键（Candidate Key）</strong></p>\n<p>如果在关系的一个码或键中，不能从中移去任何一个属性，否则它就不是这个关系的码或键，则称这样的码或键为该关系的候选码或候选键</p>\n</li>\n<li>\n<p><strong>主码或主键（Primary Key）</strong></p>\n<p>在一个关系的若干个候选码或候选键中指定一个用来唯一标识关系的元组，则称这个被指定的候选码或候选键为该关系的主码或主键</p>\n</li>\n<li>\n<p><strong>全码或全键（All-Key）</strong></p>\n<p>一个关系模式的所有属性集合是这个关系的主码或主键，则称这样的主码或主键为全码或全键</p>\n</li>\n<li>\n<table>\n<thead>\n<tr>\n<th>列</th>\n<th>列的值被称为属性值</th>\n<th>属性的个数称为元或度</th>\n<th>属性值的取值范围叫做值域</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>行</strong></td>\n<td><strong>行被称为元组或记录</strong></td>\n<td><strong>元组的一个属性值称为分量</strong></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><img data-src=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E7%A0%81.png\" alt=\"\" /><img data-src=\"/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E7%A0%81.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>主属性（Primary Attribute）和非主属性（Nonprimary Attribute）</strong></p>\n<p>在候选码中的属性称为主属性或码属性；</p>\n<p>不在候选码中的属性称为非主属性或非码属性。</p>\n</li>\n<li>\n<p><strong>外码或外键（Foreign Key）</strong></p>\n<p>该表的某个属性是其他表的主键，则是这个关系的外码或外键</p>\n</li>\n<li>\n<p><strong>参照关系（Referencing Relation）和被参照关系（Referenced Relation）</strong></p>\n<p>以外键为主键的表称为被参照关系；外键所在的表为参照关系。被参照关系和参照关系是通过外键相联系的，这种联系通常是一对多</p>\n</li>\n<li>\n<p><strong>域（Domain）</strong></p>\n<p>表示属性的取值范围</p>\n</li>\n<li>\n<p><strong>数据类型（Data Type）</strong></p>\n<p>每个字段名都有相对应的数据类型</p>\n</li>\n<li>\n<p><strong>关系模式（Relation Schema）</strong></p>\n<p>数据库存在 “型” 和 “值” 之分，关系数据库中，关系模式是型，关系是值；关系模式是静态的，关系是动态的。关系模式是对关系的描述.</p>\n</li>\n<li>\n<p><strong>关系数据库（Relation Datebase）</strong></p>\n<p>关系数据库是以关系模式为数据的逻辑模型，并采用关系作为数据组织方式的一类数据库，其数据库建立在关系代数上</p>\n</li>\n</ol>\n<hr />\n<h3 id=\"第二节关系数据库模型\"><a class=\"anchor\" href=\"#第二节关系数据库模型\">#</a> 第二节：关系数据库模型</h3>\n<h4 id=\"一基本的关系集合\"><a class=\"anchor\" href=\"#一基本的关系集合\">#</a> 一。基本的关系集合</h4>\n<ol>\n<li>关系数据语言的分类\n<ul>\n<li>关系操作的能力用两种方式表示：<strong>代数方式</strong>和<strong>逻辑方式</strong>\n<ul>\n<li>代数方式主要有关系代数，通过对关系的操作来达到查询</li>\n<li>逻辑方式主要有关系演算，通过使用位于来表达查询要求的方式</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"二关系的完整性约束\"><a class=\"anchor\" href=\"#二关系的完整性约束\">#</a> 二。关系的完整性约束</h4>\n<ol>\n<li>关系的完整约束\n<ul>\n<li>主键不能为空</li>\n</ul>\n</li>\n<li>参照完整性约束\n<ul>\n<li>外键需要一一对应</li>\n</ul>\n</li>\n<li>用户定义完整性约束\n<ul>\n<li>对数据进行的约束；例：数据类型，数据长度</li>\n</ul>\n</li>\n<li>关系模型完整性约束的检验\n<ol>\n<li>执行插入操作</li>\n<li>执行删除操作</li>\n<li>执行更新操作</li>\n</ol>\n</li>\n</ol>\n<hr />\n<h3 id=\"第三节关系数据库的规范化理论重点\"><a class=\"anchor\" href=\"#第三节关系数据库的规范化理论重点\">#</a> 第三节：关系数据库的规范化理论（重点）</h3>\n<h4 id=\"一关系模型中可能存在的冗余和异常问题\"><a class=\"anchor\" href=\"#一关系模型中可能存在的冗余和异常问题\">#</a> 一。关系模型中可能存在的冗余和异常问题</h4>\n<ol>\n<li>数据冗余</li>\n<li>更新异常</li>\n<li>插入异常</li>\n<li>删除异常</li>\n</ol>\n<h4 id=\"二函数依赖的关键字\"><a class=\"anchor\" href=\"#二函数依赖的关键字\">#</a> 二。函数依赖的关键字</h4>\n<ol>\n<li>\n<p>完全函数依赖</p>\n<p>$ X \\to Y$ 但是 x 真子集不能依赖 Y, 则 Y 完全依赖于 X</p>\n</li>\n<li>\n<p>部分函数依赖</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X → Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span>, 但是 X 真子集可以依赖 Y，则 Y 部分依赖于 X</p>\n</li>\n<li>\n<p>传递函数依赖</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X → Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span>，且<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi><mi mathvariant=\"normal\">¬</mi><mo>→</mo><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">Y \\neg\\to X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">¬</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi><mo>→</mo><mi>Z</mi></mrow><annotation encoding=\"application/x-tex\">Y → Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span></span></span></span>，则<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Z</mi></mrow><annotation encoding=\"application/x-tex\">X → Z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span></span></span></span></p>\n</li>\n<li>\n<p>关键字</p>\n<p>当<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">X → Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> 时，则 X 为 Y 的候选关键字</p>\n</li>\n</ol>\n<h4 id=\"三范式与关系规范化过程\"><a class=\"anchor\" href=\"#三范式与关系规范化过程\">#</a> 三。范式与关系规范化过程</h4>\n<ol>\n<li>\n<p>第一范式：行和列不可再分</p>\n</li>\n<li>\n<p>第二范式：不可冗余</p>\n</li>\n<li>\n<p>第三范式、BC 范式：保证主键唯一</p>\n</li>\n<li>\n<p>关系规范化理论的应用</p>\n</li>\n</ol>\n<hr />\n<h2 id=\"第三章数据库设计\"><a class=\"anchor\" href=\"#第三章数据库设计\">#</a> 第三章：数据库设计</h2>\n<h3 id=\"第一节数据库设计概述\"><a class=\"anchor\" href=\"#第一节数据库设计概述\">#</a> 第一节：数据库设计概述</h3>\n<h4 id=\"一生命周期\"><a class=\"anchor\" href=\"#一生命周期\">#</a> 一。生命周期</h4>\n<ol>\n<li>\n<p>数据库分析与设计阶段</p>\n<ul>\n<li>需求分析</li>\n<li>概念设计</li>\n<li>逻辑设计</li>\n<li>物理设计</li>\n</ul>\n</li>\n<li>\n<p>数据库实现与操作阶段</p>\n<ul>\n<li>数据库的实现</li>\n<li>操作与监督</li>\n<li>修改与调整</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"二数据库设计的目标\"><a class=\"anchor\" href=\"#二数据库设计的目标\">#</a> 二。数据库设计的目标</h4>\n<ul>\n<li>满足应用功能需求</li>\n<li>良好的数据库性能</li>\n</ul>\n<h4 id=\"三数据库设计的内容\"><a class=\"anchor\" href=\"#三数据库设计的内容\">#</a> 三。数据库设计的内容</h4>\n<ol>\n<li>数据库结构设计</li>\n<li>数据库行为设计</li>\n</ol>\n<h4 id=\"四数据库设计的方法\"><a class=\"anchor\" href=\"#四数据库设计的方法\">#</a> 四。数据库设计的方法</h4>\n<ol>\n<li>直观设计法（不可取）</li>\n<li>规范设计法\n<ol>\n<li>新奥尔良设计方法</li>\n<li>基于 E-R 模型的数据库设计方法</li>\n<li>基于第三范式的设计方法</li>\n</ol>\n</li>\n<li>计算机辅助设计法</li>\n</ol>\n<h4 id=\"五数据库设计的过程\"><a class=\"anchor\" href=\"#五数据库设计的过程\">#</a> 五。数据库设计的过程</h4>\n<p><img data-src=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%BF%87%E7%A8%8B.png\" alt=\"\" /><img data-src=\"/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%BF%87%E7%A8%8B.png\" class=\"\"></p>\n<hr />\n<h3 id=\"第二节数据库设计的基本步骤\"><a class=\"anchor\" href=\"#第二节数据库设计的基本步骤\">#</a> 第二节：数据库设计的基本步骤</h3>\n<h4 id=\"一需求分析\"><a class=\"anchor\" href=\"#一需求分析\">#</a> 一。需求分析</h4>\n<p>​\t\t数据库设计中最重要的一个阶段，即确定数据库应支持哪些功能</p>\n<ol>\n<li>\n<p>应用过程分析</p>\n<p>指了解并分析数据与数据处理间的关系。在数据库范围确定后，设计人员应逐次廖尔吉每个功能需要用到哪些数据、数据使用的顺序、对数据做何处理的策略以及处理的结果</p>\n</li>\n<li>\n<p>收集与分析数据</p>\n<ol>\n<li>\n<p>静态结构</p>\n<p>指不是加应用操作于其上时数据的原始状况，可通过数据分类表和数据元素表进行说明</p>\n<p>例：公司表中部门名称这一字段名基本不变</p>\n</li>\n<li>\n<p>动态结构</p>\n<p>指应用操作施加于数据之上后数据的状况，可通过任务分类表和数据操作特征表进行说明。</p>\n</li>\n<li>\n<p>数据约束</p>\n</li>\n</ol>\n</li>\n<li>\n<p>编写需求分析</p>\n<ol>\n<li>数据库的应用功能目标\n<ul>\n<li>功能要求</li>\n<li>性能要求</li>\n</ul>\n</li>\n<li>标明不同用户视图范围</li>\n<li>应用处理过程需求说明</li>\n<li>数据字典</li>\n<li>数据量</li>\n<li>数据约束</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"二概念结构设计\"><a class=\"anchor\" href=\"#二概念结构设计\">#</a> 二。概念结构设计</h4>\n<p>​\t\t在需求分析的基础按照特定的方法设计满足应用需求的用户信息结构，该信息结构通常称为概念模型。其中 E-R 图为概念模型的描述工具。</p>\n<h4 id=\"三逻辑结构设计\"><a class=\"anchor\" href=\"#三逻辑结构设计\">#</a> 三。逻辑结构设计</h4>\n<p><img data-src=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.png\" alt=\"\" /><img data-src=\"/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.png\" class=\"\"></p>\n<h4 id=\"四物理设计\"><a class=\"anchor\" href=\"#四物理设计\">#</a> 四。物理设计</h4>\n<p>​\t\t指对于一个给定的数据逻辑结构，研究并构造物理结构的过程。主要任务时确定数据库在存储设别上的存储结构及存取方法。</p>\n<h4 id=\"五数据库实施\"><a class=\"anchor\" href=\"#五数据库实施\">#</a> 五。数据库实施</h4>\n<ol>\n<li>加载数据</li>\n<li>应用程序设计</li>\n<li>数据库试运行</li>\n</ol>\n<h4 id=\"六数据库运行和维护\"><a class=\"anchor\" href=\"#六数据库运行和维护\">#</a> 六。数据库运行和维护</h4>\n<p>当数据库投入到实际生产中标志这设计和应用开发基本完成，但不代表设计和应用开发工作的终止。系统维护最困难的工作时数据库重组和重构。</p>\n<hr />\n<h3 id=\"第三节关系数据库设计方法\"><a class=\"anchor\" href=\"#第三节关系数据库设计方法\">#</a> 第三节：关系数据库设计方法</h3>\n<h4 id=\"一关系数据库设计过程于各级模式\"><a class=\"anchor\" href=\"#一关系数据库设计过程于各级模式\">#</a> 一。关系数据库设计过程于各级模式</h4>\n<h4 id=\"二概念结构设计方法\"><a class=\"anchor\" href=\"#二概念结构设计方法\">#</a> 二。概念结构设计方法</h4>\n<ol>\n<li><strong>E-R 图的表示方法</strong>\n<ol>\n<li>实体类型，用矩形表示，框内写明实体的名称</li>\n<li>属性，用椭圆表示，将与之相应的实体连接起来</li>\n<li>联系，用菱形表示，框内写明联系的名称，同时在旁边表上联系的类型（1：1、1：N 或者 M：N）</li>\n</ol>\n</li>\n<li><strong>局部信息结构设计</strong>\n<ol>\n<li><strong>确定局部范围</strong>：主要依据需求分析报告中标明的用户视图范围来确定</li>\n<li><strong>选择实体</strong>：在确认局部范围内选择一些合适的信息单位作为局部信息结构的基本实体</li>\n<li><strong>选择实体关键字</strong></li>\n<li><strong>确定实体间联系</strong>：数据间的联系必须在概念设计时确定</li>\n<li><strong>确定实体的属性</strong>：分为标识属性和说明属性两类。\n<ul>\n<li>标识属性用作实体的关键字</li>\n<li>说明属性用作描述实体的一般特征</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><strong>全局信息结构设计</strong>\n<ol>\n<li>属性冲突</li>\n<li>命名冲突</li>\n<li>结构冲突</li>\n</ol>\n</li>\n</ol>\n<hr />\n<h2 id=\"第四章sql与关系数据库基本操作\"><a class=\"anchor\" href=\"#第四章sql与关系数据库基本操作\">#</a> 第四章：SQL 与关系数据库基本操作</h2>\n<h3 id=\"第一节sql概述\"><a class=\"anchor\" href=\"#第一节sql概述\">#</a> 第一节：SQL 概述</h3>\n<ol>\n<li>\n<h4 id=\"sql的发展\"><a class=\"anchor\" href=\"#sql的发展\">#</a> SQL 的发展</h4>\n<p><strong>1974 年</strong>由<strong> Boyce</strong> 和<strong> Chamberlin</strong> 提出的</p>\n<p>20 世纪 80 年代以来，SQL 一直是数据库管理系统的标准语言。</p>\n<p>至今 SQL 成为了一个通用的、功能极强的关系数据库语言</p>\n<p>SQL 是一个<strong>综合的</strong>、<strong>功能强大的</strong>且<strong>简洁易懂</strong>的语言；</p>\n<p>SQL 的目的就是要能够很好的提供一种从数据库中读取数据的简单而有效的方法</p>\n</li>\n<li>\n<h4 id=\"sql的特点\"><a class=\"anchor\" href=\"#sql的特点\">#</a> SQL 的特点</h4>\n<ol>\n<li>SQL 不是某个特定数据库供应商专有的语言</li>\n<li>SQL 简单易学</li>\n<li>SQL 看上去简单，但实际上是一种强有力的语言，灵活使用可以进行非常复杂和高级的数据库操作，并且不区分大小写</li>\n</ol>\n</li>\n<li>\n<h4 id=\"sql的组成\"><a class=\"anchor\" href=\"#sql的组成\">#</a> SQL 的组成</h4>\n<ol>\n<li>数据定义语言（DDL）</li>\n<li>数据操纵语言（DML）</li>\n<li>数据控制语言（DCL）</li>\n<li>嵌入式和动态 SQL 规则</li>\n<li>SQL 条用和会话规则</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"第二节mysql预备知识\"><a class=\"anchor\" href=\"#第二节mysql预备知识\">#</a> 第二节：Mysql 预备知识</h3>\n<h4 id=\"一mysql使用基础\"><a class=\"anchor\" href=\"#一mysql使用基础\">#</a> 一.MySQL 使用基础</h4>\n<ol>\n<li>LAMP（Linux+Apache+Mysql+PHP/Perl+Python）</li>\n<li>WAMP（Windows+Apache+Mysql+PHP/Perl/Python）</li>\n</ol>\n<h4 id=\"二mysql中的sql\"><a class=\"anchor\" href=\"#二mysql中的sql\">#</a> 二.MySQL 中的 SQL</h4>\n<ol>\n<li>常量\n<ol>\n<li>字符串常量</li>\n<li>数值常量\n<ul>\n<li>整数常量</li>\n<li>浮点数常量</li>\n</ul>\n</li>\n<li>十六进制常量（转换时使用，cast (...as unsigned)）</li>\n<li>日期时间常量\n<ul>\n<li>包括年、月、日，数据类型为 DATE</li>\n<li>包括小时数、分钟数、秒数及微秒数，数据类型为 TIME</li>\n</ul>\n</li>\n<li>位字段值（了解）</li>\n<li>布尔值</li>\n<li>NUll 值</li>\n</ol>\n</li>\n<li>变量\n<ol>\n<li>用户变量：用户在表达式中使用自己定义的变量，用户变量前加 @用来区分列名</li>\n</ol>\n</li>\n<li>运算符\n<ol>\n<li>算术运算符：+、-、*、/</li>\n<li>位运算符：&amp;（与）、|（位）、^（位异或）、~（位取反）、&gt;&gt;（位右移，除以 2）、&lt;&lt;（位左移，乘以 2）<br />\n3. 比较运算符： 逻辑非、逻辑与、逻辑或、逻辑异或</li>\n</ol>\n</li>\n<li>表达式</li>\n<li>内置函数\n<ul>\n<li>数学函数：ABS（）—— 绝对值、SORT（）—— 去开</li>\n<li>聚合函数：COUNT（）—— 计数</li>\n<li>字符串函数：ASCII（）—— 转换成 ASCII 码、CHAR（）—— 转换城字符串</li>\n<li>日期和时间函数：NOW（）—— 截取当前是时间值、Year（）—— 截取当前年份</li>\n<li>加密函数：encode（）、encrypt（）</li>\n<li>类型转换：cast（）</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"第三节数据定义\"><a class=\"anchor\" href=\"#第三节数据定义\">#</a> 第三节：数据定义</h3>\n<h4 id=\"一数据库模式定义\"><a class=\"anchor\" href=\"#一数据库模式定义\">#</a> 一。数据库模式定义</h4>\n<ol>\n<li>新建数据库：create database 数据库名</li>\n<li>选择数据库：use 数据库名</li>\n<li>修改数据库：alter database 数据库名</li>\n<li>删除数据库：drop database [if exists] 数据库名 （括号的可加可不加）</li>\n<li>查看数据库：show database</li>\n</ol>\n<h4 id=\"二表定义\"><a class=\"anchor\" href=\"#二表定义\">#</a> 二。表定义</h4>\n<ol>\n<li>创建表：create [temporary] table 表名（增加了括号的关键字，只是临时表）</li>\n<li>更新表：alter table 数据库名。表名\n<ol>\n<li>添加字段：add column 字段名 数据类型 是否为空 default  after 字段名（after 在哪个字段后面增加）</li>\n<li>修改字段：change column | alter | modify 现在的字段名 更改的字段名 数据类型 是否为空 default' '\n<ul>\n<li>alter 只能修改和删除默认值</li>\n<li>change 可以修改表中字段名，类型，默认值</li>\n<li>modify 只可以修改现有字段的类型和默认值等</li>\n</ul>\n</li>\n<li>删除字段名：alter table 表名 drop column 字段名</li>\n</ol>\n</li>\n<li>重命名数据表：\n<ul>\n<li>alter table 原表名 rename 新表名；</li>\n<li>alter table 原表名 to 新表名</li>\n</ul>\n</li>\n<li>删除表：drop table [if exists] 表名</li>\n<li>查看表：show columns from 表名；(desc)</li>\n</ol>\n<h4 id=\"三索引定义\"><a class=\"anchor\" href=\"#三索引定义\">#</a> 三。索引定义</h4>\n<p>索引</p>\n<ul>\n<li>用途索引\n<ul>\n<li>普通索引（index）</li>\n<li>唯一性索引（unique）</li>\n<li>主键（primary key）</li>\n<li>全文索引（fulltext）[引擎 Myisam]</li>\n<li>聚簇索引 [引擎 InnoDB]</li>\n</ul>\n</li>\n<li>列级索引\n<ul>\n<li>单列索引</li>\n<li>组合索引</li>\n</ul>\n</li>\n<li>添加方法：create [unique] index 索引名 on 表名 （创建索引的列名 [(length)] [ASC|DESC]）</li>\n<li>查看索引：show index from 数据库名。表名</li>\n<li>删除索引：drop index 索引名 on 表名</li>\n</ul>\n<h3 id=\"第四节数据更新\"><a class=\"anchor\" href=\"#第四节数据更新\">#</a> 第四节：数据更新</h3>\n<h4 id=\"一插入数据\"><a class=\"anchor\" href=\"#一插入数据\">#</a> 一。插入数据</h4>\n<ul>\n<li>insert into 表名（字段名）values (数据),(数据)</li>\n<li>insert 表名 set 字段名 = {}</li>\n</ul>\n<h4 id=\"二删除数据\"><a class=\"anchor\" href=\"#二删除数据\">#</a> 二。删除数据</h4>\n<ul>\n<li>delete from 表名 where</li>\n<li>truncate 表名 ——（全部清空）</li>\n</ul>\n<h4 id=\"三修改数据\"><a class=\"anchor\" href=\"#三修改数据\">#</a> 三。修改数据</h4>\n<ul>\n<li>update 表名 set 字段名 = 数据</li>\n</ul>\n<h3 id=\"第五节数据查询\"><a class=\"anchor\" href=\"#第五节数据查询\">#</a> 第五节：数据查询</h3>\n<h4 id=\"一selecet语句\"><a class=\"anchor\" href=\"#一selecet语句\">#</a> 一.selecet 语句</h4>\n<h4 id=\"二列的选择与指定\"><a class=\"anchor\" href=\"#二列的选择与指定\">#</a> 二。列的选择与指定</h4>\n<h4 id=\"三from子句与多表连接查询\"><a class=\"anchor\" href=\"#三from子句与多表连接查询\">#</a> 三.from 子句与多表连接查询</h4>\n<h3 id=\"第六节视图\"><a class=\"anchor\" href=\"#第六节视图\">#</a> 第六节：视图</h3>\n<h4 id=\"一创建视图\"><a class=\"anchor\" href=\"#一创建视图\">#</a> 一。创建视图</h4>\n<h4 id=\"二删除视图\"><a class=\"anchor\" href=\"#二删除视图\">#</a> 二。删除视图</h4>\n<h4 id=\"三修改视图\"><a class=\"anchor\" href=\"#三修改视图\">#</a> 三。修改视图</h4>\n<h4 id=\"四查看视图定义\"><a class=\"anchor\" href=\"#四查看视图定义\">#</a> 四。查看视图定义</h4>\n<h4 id=\"五更新视图数据\"><a class=\"anchor\" href=\"#五更新视图数据\">#</a> 五。更新视图数据</h4>\n<h4 id=\"六查询视图数据\"><a class=\"anchor\" href=\"#六查询视图数据\">#</a> 六。查询视图数据</h4>\n<hr />\n<h2 id=\"第五章数据库编程\"><a class=\"anchor\" href=\"#第五章数据库编程\">#</a> 第五章：数据库编程</h2>\n<h3 id=\"第一节存储过程\"><a class=\"anchor\" href=\"#第一节存储过程\">#</a> 第一节：存储过程</h3>\n<h4 id=\"一存储过程的基本概念\"><a class=\"anchor\" href=\"#一存储过程的基本概念\">#</a> 一。存储过程的基本概念</h4>\n<p>就是一组为了完成某项特定功能的 SQL 语句集，实质上就是一段存储在数据库中的代码</p>\n<p>优点如下:</p>\n<ol>\n<li>提高运行速度；</li>\n<li>增强了 SQL 的功能的灵活性；</li>\n<li>可以降低网络的通信量；</li>\n<li>减轻了程序编写的工作量；</li>\n<li>间接实现了安全控制功能；</li>\n</ol>\n<h4 id=\"二创建存储过程\"><a class=\"anchor\" href=\"#二创建存储过程\">#</a> 二。创建存储过程</h4>\n<ul>\n<li>delimiter $$ —— 修改结束符为 $$，因为在使用的封装的时候会经常使用；号，程序会识别出错，为了避免，所以在使用 procedure 的时候，需要先把结束符更改一下</li>\n<li>create procedure [IN | OUT | INPUT] 参数名 数据类型</li>\n</ul>\n<h4 id=\"三存储过程体\"><a class=\"anchor\" href=\"#三存储过程体\">#</a> 三。存储过程体</h4>\n<ol>\n<li>\n<p><strong>局部变量</strong></p>\n<ul>\n<li>声明局部变量：declare 变量名 数据类型；若不给的话，默认数据类型为 null</li>\n</ul>\n</li>\n<li>\n<p>局部变量赋值</p>\n<ul>\n<li>SET 变量名 = 数值</li>\n<li>select 字段名 into 要赋值的变量名 表名（返回的结果集只能有一行）</li>\n</ul>\n</li>\n<li>\n<p>流程控制语句</p>\n<ul>\n<li>If    else  end if</li>\n<li>case    when 条件 then 语句    end case</li>\n<li>while  do  end while |  repeat  until   end repeat  | loop     end loop</li>\n</ul>\n</li>\n<li>\n<p>游标（可以存多个变量，因为 select into 只能保存一行数据，所以可以建立一个游标，再从游标中获取单行数据放入局部变量中）</p>\n<ul>\n<li></li>\n<li>打开游标：open 游标名</li>\n<li>读取游标：fetch 游标名 into 变量</li>\n<li>关闭游标：close 游标名</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"四调用存储过程\"><a class=\"anchor\" href=\"#四调用存储过程\">#</a> 四。调用存储过程</h4>\n<p>其实就是调用方法</p>\n<ul>\n<li>调用方法\n<ul>\n<li>CALL 存储过程名（）</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"五删除存储过程\"><a class=\"anchor\" href=\"#五删除存储过程\">#</a> 五。删除存储过程</h4>\n<ul>\n<li>drop procedure [if exists] 存储过程名；</li>\n</ul>\n<h4 id=\"六样式案例\"><a class=\"anchor\" href=\"#六样式案例\">#</a> 六。样式案例</h4>\n<pre><code class=\"language-mariadb\">use 数据库名\t\t\t先调用\ndelimiter $$\t\t  修改结束符,关闭终端后，会更改回;\ncreate procedure 存储过程名 (IN p_no varchar(10),IN p_name varchar(255))\n\nbegin\ndeclare a int default 0;\ndeclare b int;\ndeclare c int;\nset b = 10;\nselect Id into c from pro where pno='001';\n\n\tinsert into pro(pno,pname) values (p_no,p_name);\nend $$\n\ncall 存储过程名 (实参)\t\t不用觉得很难，其实就是封装\n</code></pre>\n<h4 id=\"七教材案例\"><a class=\"anchor\" href=\"#七教材案例\">#</a> 七。教材案例</h4>\n<pre><code class=\"language-mariadb\">delimiter $$\ncreate procedure pro_num (OUT ROWS INT)\nbegin\ndeclare cid INT;\ndeclare found boolean default true;\ndeclare cur_cid cursor for\n\tselect pno form pro;\ndeclare continue handler for not found \n\tset found = 0;\nset ROWS =0;\nopen cur_cid;\nfetch cur_cid into cid;\nwhile found do\nset ROWS=ROWS+1;\nfetch cur_cid into cid;\nend while;\ncolse cur_cid\nend $$\n</code></pre>\n<h3 id=\"第二节存储函数\"><a class=\"anchor\" href=\"#第二节存储函数\">#</a> 第二节：存储函数</h3>\n<h4 id=\"一创建存储函数\"><a class=\"anchor\" href=\"#一创建存储函数\">#</a> 一。创建存储函数</h4>\n<p>create function 函数名 (形参 形参的数据类型)</p>\n<h4 id=\"二调用存储函数\"><a class=\"anchor\" href=\"#二调用存储函数\">#</a> 二。调用存储函数</h4>\n<p>select 函数名 (实参)</p>\n<h4 id=\"三删除存储函数\"><a class=\"anchor\" href=\"#三删除存储函数\">#</a> 三。删除存储函数</h4>\n<p>drop function [if exists] 函数名；</p>\n<pre><code class=\"language-mariadb\">use 数据库名;\ndelimiter $$\ncreate function 函数名(形参+形参的数据类型)\n\treturns 返回值类型\n\tdeterministic\t\t\t\t表示函数的 返回值完全由输入参数决定\nbegin\n\nend $$\ndelimiter ;\n</code></pre>\n<hr />\n<h2 id=\"第六章数据库安全与保护\"><a class=\"anchor\" href=\"#第六章数据库安全与保护\">#</a> 第六章：数据库安全与保护</h2>\n<h3 id=\"第一节数据库完整性\"><a class=\"anchor\" href=\"#第一节数据库完整性\">#</a> 第一节：数据库完整性</h3>\n<h4 id=\"一完整性约束条件的作用对象\"><a class=\"anchor\" href=\"#一完整性约束条件的作用对象\">#</a> 一。完整性约束条件的作用对象</h4>\n<ol>\n<li>\n<p>列级约束</p>\n<p>列级约束主要指对列的类型、取值范围、精度等的约束</p>\n<ul>\n<li>对数据类型的约束</li>\n<li>对数据格式的约束</li>\n<li>对取值范围或取值集合的约束</li>\n<li>对空值的约束</li>\n</ul>\n</li>\n<li>\n<p>元组约束</p>\n<p>元组约束指元组中各个字段之间的相互约束，例如某个活动的开始日期小于结束日期</p>\n</li>\n<li>\n<p>表级约束</p>\n<p>表级约束指若干元组之间、关系之际的联系的约束，常用在外键上</p>\n</li>\n</ol>\n<p>二。定义与实现完整性约束</p>\n<ol>\n<li>\n<p>实体完整性：保证记录不重复，至少有一列值不重复，用 primary key 添加约束</p>\n<p>候选键约束用关键字 unique 进行约束</p>\n<ul>\n<li>一个表只能由一个主键，但是候选键可以有若干个</li>\n</ul>\n</li>\n<li>\n<p>参照完整性：主要指两个表之间的关系，比如课程表开设依赖于教师表，没有教师就不能由教师的课，保证数据的正确性</p>\n<ul>\n<li>\n<pre><code class=\"language-mariadb\">foreign key(本表字段)\n\treferences 外键表(外键的字段名)\n\t\ton delete (restrict|cascade|set null|no action)\n\t\ton update (restrict|cascade|set null|no action)\n\t\t\nrestrict\t\t当被参照表进行删除或更新时，系统拒绝该操作\ncascade\t\t\t两边可以实时更新\nset null|\t\t被参照表（主表）更新时，另一边更改为null\nno action\t\t当被参照表进行删除或更新时，系统拒绝该操作,与restrict相同\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>自定义完整性：</p>\n<ul>\n<li>非空约束：在创建表或更新表结构的时候在字段后面增加 <code>not null</code>  表示该字段不能为空</li>\n<li>check 约束：在创建表或更新表结构的时候使用，可作用在整张表或者单个字段上，用法跟 <code>not null</code>  一致，不过是增加了 sql 的限定条件。例：年龄不允许小于等于 0。\n<ul>\n<li>作用在字段上，则是基于列的 check 约束</li>\n<li>作用在表上，则是基于表的 check 约束</li>\n<li>语法：check (sql 表达式)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>命名完整性约束</p>\n<p>就是给约束起一个名字，方便后面对这个约束进行删除或修改等</p>\n<ul>\n<li>\n<p>给约束起一个名字</p>\n<pre><code class=\"language-mariadb\">mysql&gt; create table t_user(\n    -&gt; id int(10),\n    -&gt; name varchar(32) not null,\n    -&gt; constraint t_user_id_pk primary key(id)\n    -&gt; );\nQuery OK, 0 rows affected (0.01 sec)\n</code></pre>\n</li>\n<li>\n<p>完整性约束不能直接被修改。若要修改某个约束，其实是先把约束删除，在添加约束</p>\n<ul>\n<li>添加约束\n<ul>\n<li><code>alter table 表名 add [constraint 约束名字]primary key(主键字段)</code></li>\n<li><code>alter table 表名 add [constraint 约束名字]foreign key(外键字段名) refernces 被参照表(主键字段)</code></li>\n<li><code>alter table 表名 add [constraint 约束名字]unique key(主键字段)</code></li>\n</ul>\n</li>\n<li>删除约束\n<ul>\n<li><code>alter table 表名 drop foreign key 外键约束名</code></li>\n<li><code>alter table 表名 drop primary key</code></li>\n<li><code>alter table 表名 drop 约束名|候选键字段名</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"第二节触发器\"><a class=\"anchor\" href=\"#第二节触发器\">#</a> 第二节：触发器</h3>\n<p>触发器是保护表数据的数据对象，当指定的表发生插入、更新、删除的时候触发，进行相应的动作。<strong>注：查询不会触发</strong></p>\n<ul>\n<li>\n<p>创建触发器</p>\n<ul>\n<li>\n<pre><code class=\"language-mariadb\">create trigger 触发器名 触发器触发的时刻 触发事件 \n\ton 与触发器绑定的表名 for each row 触发器主体（可以是单条sql语句，也可以是多条执行语句，但需要使用begin...end）\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>删除触发器</p>\n<ul>\n<li><code>drop trigger [if exists][触发器所在的数据库名.]触发器名</code> ，若没有指定则为当前默认数据库，修改前需要先删除后创建</li>\n</ul>\n</li>\n<li>\n<p>使用数据库</p>\n<ul>\n<li>可以使用 NEW 或者 OLD 这两张虚拟表\n<ul>\n<li>NEW 表示为最新的虚拟表</li>\n<li>OLD 表示为 sql 语句执行前的表，且全部数据为只读，不能被更新</li>\n</ul>\n</li>\n<li>在触发器涉及对触发表自身的更新操作时、，只能使用 before update 触发器，after update 不被允许</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"第三节安全性与访问控制\"><a class=\"anchor\" href=\"#第三节安全性与访问控制\">#</a> 第三节：安全性与访问控制</h3>\n<p>数据库的安全性是指<strong>保护数据库以防止不合法的使用而造成数据泄露、更改或破坏，所以安全性对于任何一个 DBMS 来说都是至关重要的</strong></p>\n<p>在 mysql 中，<strong>数据库系统对数据定 安全管理是使用身份验证、数据库用户权限确认等访问控制措施，来保护数据库中的信息资源，以防止这些数据遭受破坏</strong></p>\n<h4 id=\"一用户账号管理\"><a class=\"anchor\" href=\"#一用户账号管理\">#</a> 一。用户账号管理</h4>\n<ol>\n<li>\n<p>创建用户账号</p>\n<pre><code class=\"language-mariadb\"> create user 'user_name'@'host_name' IDENTIFIED BY [PASSWORD]password\n</code></pre>\n<ul>\n<li>创建的时候，需要当前登录的用户拥有 mysql 数据库的 insert 权限或全局的 create insert 权限</li>\n<li>创建用户时，若用户名一直，主机名不同，则为两个账号；</li>\n<li>新创建的用户权限是能 show，不用 use 数据库，因而无法访问数据库表；</li>\n<li>create user 时可以不使用密码，但 mysql 允许该操作，但不推荐</li>\n<li>创建用户时，用户名和主机名都重复了会报错</li>\n</ul>\n</li>\n<li>\n<p>删除用户</p>\n<pre><code class=\"language-mariadb\">drop user '用户名'@'主机名'\n</code></pre>\n<ul>\n<li>删除用户的时候可以删除一个或多个，并且消除它们的权限</li>\n<li>要删除用户的话，必须当前用户拥有 mysql 的删除权限或者全局的删除权限</li>\n<li>删除的时候没有给主机名，默认为 %</li>\n<li>用户的删除不会影响他们创建的表、索引或其他数据库对象，因为数据库没有记录是谁创建了这些对象</li>\n</ul>\n</li>\n<li>\n<p>修改用户</p>\n<pre><code class=\"language-mariadb\">rename user '当前用户名'@'主机号' to '新的用户名'@'主机号'\n</code></pre>\n<ul>\n<li>需要拥有相对应的权限</li>\n<li>若系统中旧帐户不存在或者新账户已存在，则会报错</li>\n</ul>\n</li>\n<li>\n<p>修改用户密码</p>\n<pre><code class=\"language-mariadb\">set password for '用户名'@'主机名' = password('更改的新密码')|已经用password函数加密过的散列值\n</code></pre>\n<ul>\n<li>直接写明文是不可以的，因为存储在 mysql.user 表中，都是以 password 函数加密后的形式展示，但是真正输入密码的时候还是使用 password 加密前的密码。</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"二账号权限管理\"><a class=\"anchor\" href=\"#二账号权限管理\">#</a> 二。账号权限管理</h4>\n<ol>\n<li>\n<p>权限的授予：</p>\n<p>新的 SQL 用户不允许访问属于其他 SQL 用户的表，也不能创建自己的表，它必须被授权。</p>\n<ul>\n<li><strong>列权限</strong>：和表中的一个具体列相关</li>\n<li><strong>表权限</strong>：和一个具体表中的所有数据相关</li>\n<li><strong>数据库权限</strong>：和一个具体的数据库中的所有表相关</li>\n<li><strong>用户权限</strong>：和 mysql 所有的数据库相关</li>\n</ul>\n</li>\n<li>\n<p>查看用户的权限： <code>show grants for '用户名'@'主机名'</code></p>\n</li>\n<li>\n<p>案例演示</p>\n<ul>\n<li>\n<p>授予用户 <code>zhangsan</code>  在数据库 <code>mysql_test</code>  的表 <code>customers</code>  上拥有对列的 <code>cust_id</code>  和列 <code>cust_name</code>  的 SELECT 权限</p>\n<pre><code class=\"language-mariadb\">grant select(cust_id,cust_name)\n\tON mysql_test.customers\n\tTO 'zhangsan'@'localhost';\n</code></pre>\n</li>\n<li>\n<p>当前系统不存储在用户 <code>liming</code>  和用户 <code>huang</code> ，要求创建这两个用户，并设置对应的系统登录口令，同时授权他们在数据库 <code>mysql_test</code>  的表 <code>customers</code>  上拥有的 SLECT 和 UPDATE 的权限</p>\n<pre><code class=\"language-mariadb\">grant SELECT,UPDATE\n\tON mysql_test.customers\n\tTO 'liming'@'localhost' IDENTIFIED BY '123',\n\t\t'huang'@'localhost' IDENTIFIED BY '456';\n</code></pre>\n</li>\n<li>\n<p>授予系统中已存在用户 <code>wangwu</code>  可以在数据库 <code>mysql_test</code>  中执行所有数据库操作的权限</p>\n<pre><code class=\"language-mariadb\">grant all\n\tON mysql_test.*\n\tTO 'wangwu'@'localhost';\n</code></pre>\n</li>\n<li>\n<p>授予当前系统中已存在用户 <code>wangwu</code>  拥有创建用户的权限</p>\n<pre><code class=\"language-mariadb\">grant CREATE USER\n\tON *.*\n\tTO 'wangwu'@'localhost';\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"三权限的转移\"><a class=\"anchor\" href=\"#三权限的转移\">#</a> 三。权限的转移</h4>\n<p>权限转移的语句其实就是在 grant 中增加 with 子句，其中 <code>with grant option</code>  表示将授予当前用户的权限授予给其他用户，无论其他用户有没有这个权限，且自己的权限不会消失</p>\n<ul>\n<li>\n<p>授予使用限制：</p>\n<ul>\n<li>max_questions：用户每小时允许执行的查询操作次数。</li>\n<li>max_updates：用户每小时允许执行连接操作次数。</li>\n<li>max_connections：用户每小时允许执行的连接操作次数。</li>\n<li>max_user_connections：用户允许同时建立的连接次数。</li>\n</ul>\n</li>\n<li>\n<p>修改方式</p>\n<pre><code class=\"language-mariadb\">update user set 限制的权限名 = 0 where user = '用户名';\nflush privileges;\t\t——记得需要刷新之后才能生效（不用grant语句去修改授权表的时候，都需要手动刷新）\n</code></pre>\n</li>\n<li>\n<p>演示案例</p>\n<ul>\n<li>授予当前系统中一个不存在的用户 zhou 在数据库 mysql_test 的表 customers 上拥有 SELECT 和 UPDATE 的权限，并允许可以将自身的这个权限授予给其他用户</li>\n</ul>\n<pre><code class=\"language-mariadb\">grant SELECT,UPDATE\n\tON mysql_test.customers\n\tTO 'zhou'@'localhost' IDENTIFIED BY '123'\n\twith grant option;\n</code></pre>\n</li>\n</ul>\n<h4 id=\"四权限的撤销\"><a class=\"anchor\" href=\"#四权限的撤销\">#</a> 四。权限的撤销</h4>\n<p>就是回收用户的权限，操作语句跟授予（grant）很相似，但是<strong>需要操作者账户拥有对全局的创建和更新权限</strong>。语句上就是把 <code>grant</code>  更改为 <code>revoke</code> ，把 <code>TO</code>  改成 <code>FROM</code> 。可以收回特定用户的部分权限，也可以收回特定用户的全部权限。</p>\n<ul>\n<li>\n<p>操作案例</p>\n<ul>\n<li>\n<p>回收系统中已存在的用户 zhou 在数据库 mysql_test 的表 customers 上的 SELECT 权限</p>\n<pre><code class=\"language-mariadb\">revoke SELECT\n\tON mysql_test.customers\n\tFROM 'zhou'@'localhost';\n</code></pre>\n</li>\n<li>\n<p>回收系统中已存在的用户 zhou 在数据库 mysql_test 的表 customers 上的所有权限</p>\n<pre><code class=\"language-mariadb\">revoke all\n\tON mysql_test.customers\n\tFROM 'zhou'@'localhost';\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"第四节事务与并发控制\"><a class=\"anchor\" href=\"#第四节事务与并发控制\">#</a> 第四节：事务与并发控制</h3>\n<h3 id=\"一事务的概念\"><a class=\"anchor\" href=\"#一事务的概念\">#</a> 一。事务的概念</h3>\n<p>​\t事务是用户定义的一个数据操作序列，这些操作可欧威一个完整的工作单元，<strong>要么全部执行，要么全部不执行，是一个不可分割的工作单位</strong>。</p>\n<p>** 事务与程序的不同：** 程序是静止的，事务是动态的，是程序的执行而不是程序本身；同一程序的多个独立执行可以同时进行，而每一步执行则是一个不同的事务</p>\n<h3 id=\"二事务的acid特征\"><a class=\"anchor\" href=\"#二事务的acid特征\">#</a> 二。事务的 ACID 特征</h3>\n<ul>\n<li>原子性（Atomieity）\n<ul>\n<li>事务的原子性保证事务包含的一组更新操作是原子不可分的，即事务是不可分割的最小工作单位，所包含的这些操作是一个整体。</li>\n</ul>\n</li>\n<li>一致性（Consistency）\n<ul>\n<li>一致性要求事务必须满足于数据库的完整性约束，且事务执行完毕后将数据库由一个一致性状态转变到另一个一致性状态。数据库的一致性撞他是一种以一致性规则为基础的逻辑属性，一致性和原子性密切相关</li>\n</ul>\n</li>\n<li>隔离性（Isolation）\n<ul>\n<li>隔离性要求事务是彼此独立的、隔离的，即一个事务的执行不能被其他事务所干扰，一个事务对数据库变更的结果必须在它 COMMIT 后，另一个事务才能存取。</li>\n<li>多个事务并发执行时，其结果等价于它们的一种顺序执行的结果，就如同串行调度执行事务一般。这一特性也称为<strong>可串行性</strong></li>\n</ul>\n</li>\n<li>持续性（Durability）\n<ul>\n<li>持久性也称为永久性，是指一个事务一单提交，它对数据库中数据的改变就应该是永久性的，且接下来的其他操作或故障不应该改对其执行结果有任何影响</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"三并发操作问题\"><a class=\"anchor\" href=\"#三并发操作问题\">#</a> 三。并发操作问题</h3>\n<p><strong>事务的并发控制的基本单位</strong>，保证事务的 ACID 特征是事务处理的重要任务。</p>\n<ol>\n<li>典型的并发操作问题（破坏了事务的隔离性）\n<ul>\n<li>丢失更新\n<ul>\n<li>两个事务同时修改数据，导致一方的修改被丢失，这就是由于对数据的并发操作而带来的数据不一致性</li>\n</ul>\n</li>\n<li>不可重复读\n<ul>\n<li>指事务一读取数据后，事务二更新数据后，事务一无法读取到前一次的读取结果</li>\n</ul>\n</li>\n<li>读 “脏” 数据\n<ul>\n<li>银行取款问题</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>解决并发操作的数据不一致性问题的方法有\n<ul>\n<li>封锁</li>\n<li>时间戳</li>\n<li>乐观控制法</li>\n<li>多版本并发控制</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"四封锁\"><a class=\"anchor\" href=\"#四封锁\">#</a> 四。封锁</h3>\n<p>封锁是最常用的并发控制技术。基本思想是：需要时，事物通过向系统请求对它所希望的数据对象（如数据库中的记录）加锁，以确保它不被非预期改变</p>\n<ol>\n<li>\n<p><strong>锁</strong></p>\n<p>一个锁实质上是允许或阻止一个事物对一个数据对象的存取特权，基本的封锁类型有两种</p>\n<ul>\n<li>排他锁（Exclusive Lock，X 锁），一般写操作要求用 X 锁</li>\n<li>共享锁（SharedLock，S 锁），一般读操作要求用 S 锁</li>\n</ul>\n</li>\n<li>\n<p><strong>用封锁进行并发控制</strong></p>\n<ol>\n<li>若事务 T 对数据 D 加锁，则所有的事务对数据 D 的锁请求都需要等到事务 T 放锁</li>\n<li>若事务 T 对数据 D 加了 S 锁，则别的事务还可以对数据 D 请求 S 锁</li>\n<li>事务执行数据库操作时都要先请求响应的锁，即对读请求 S 锁，对更新（插入、删除、修改）请求 X 锁。这个过程一般时有 DBMS 在执行操作时自动隐含地进行</li>\n<li>事务一直占有获得的锁直到事务 commit 或 rollback 时释放</li>\n</ol>\n<p>因此封锁机制可以解决上述并发操作所带来的三个不一致性问题</p>\n</li>\n<li>\n<p><strong>封锁的粒度</strong></p>\n<p>通常以粒度来描述封锁的<strong>数据单元的大小</strong>。</p>\n<p>DBMS 可以决定不同粒度的锁。由最底层的数据元素到最高层的整个数据库，粒度越细，并发性越大，但软件复杂性和系统开销也就越大</p>\n</li>\n<li>\n<p><strong>封锁的级别</strong></p>\n<ol>\n<li>\n<p>0 级封锁</p>\n<p>封锁的事务不重写其他非 0 级封锁事务的未提交的更新数据。这种状态实际上实用价值不大</p>\n</li>\n<li>\n<p>1 级封锁</p>\n<p>被封锁的事务不允许重写未提交的更新数据。这防止了丢失更新的发生。</p>\n</li>\n<li>\n<p>2 级封锁</p>\n<p>被封锁的事务既不重写也不读未提交的更新数据。这除了 1 级封锁的效果外还防止了读脏数据</p>\n</li>\n<li>\n<p>3 级封锁</p>\n<p>被封锁的事务不读未提交的更新数据，不写任何（包括读操作的）未提交的数据</p>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>死锁和活锁</strong></p>\n<ul>\n<li>\n<p>活锁</p>\n<ul>\n<li>级别低的事务无法执行</li>\n<li>避免方法：采用先来先服务的策略</li>\n</ul>\n</li>\n<li>\n<p>死锁（两个以上事务循环等待被同组中的另一事务锁住的数据单元的清醒，称为 “死锁 “）</p>\n<ul>\n<li>一次性锁请求</li>\n<li>锁请求排序</li>\n<li>序列化处理</li>\n<li>资源剥夺</li>\n</ul>\n<p>对待死锁的另一种办法时不去防止，而让其发生并随时进行检测，一旦检测到系统已发生了死锁再进行解除处理</p>\n</li>\n</ul>\n</li>\n<li>\n<p>可串行性</p>\n<p>一组事务的一个调度就是它们的基本操作的一种排序。若在一个调度中，对于任意两个事务 T1 和 T2，要么 T1 的所有操作都在 T2 前面，要么反之，则该调度是串行的</p>\n</li>\n<li>\n<p><strong>两段封锁法</strong></p>\n<p>封锁是一种并发控制技术，而可串行性是并发控制（调度）的正确性标准。</p>\n<p>两段封锁法（Two-Phase Locking，2PL）是一种最简单而有效的保障封锁其调度是可串行性的方法</p>\n<p>两端封锁法是<strong>事务遵循两段锁协议</strong>的调度方法。所谓协议，就是所有事物都必须遵循的关于基本操作执行顺序的一种限制</p>\n<ol>\n<li>\n<p>发展（Growing）或加锁阶段</p>\n<p>在此段期间，对任一数据对象进行任何操作之前，事物都要获得该对象的一个相应的锁</p>\n</li>\n<li>\n<p>收缩（Shrinking）或释放锁阶段</p>\n<p>一旦事务释放了一个锁，则标明它已进入了此阶段，此后它就不能再请求任何另外的锁</p>\n</li>\n<li>\n<p>定理：遵循两端锁协议的事务的任何并发调度都是可串行化的</p>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"第五节备份与恢复\"><a class=\"anchor\" href=\"#第五节备份与恢复\">#</a> 第五节：备份与恢复</h3>\n<p>为了保证数据库的<strong>可靠性</strong>和<strong>完整性</strong>，DBMS 通常会采用各种有效的措施来进行维护。</p>\n<p>造成数据库中的数据丢失或被破坏可能是由于以下原因</p>\n<ul>\n<li>计算机硬件故障</li>\n<li>计算机软件故障</li>\n<li>病毒</li>\n<li>认为误操作</li>\n<li>自然灾害</li>\n<li>盗窃</li>\n</ul>\n<p>数据库备份时通过导出数据或者赋值表文件的方式来制作数据库的复本；数据库恢复则是当数据库出现故障或遭到破坏时，将备份的数据库加载到系统，从而使数据库从错误状态恢复到备份时的正确状态</p>\n<p>数据库恢复时以备份未基础，它是与备份相对应的系统维护和管理操作。系统进行恢复操作时，先执行一些系统安全性的检查，包括检查要恢复的数据库是否存在、数据库是否变化及数据库文件是否兼容等，然后根据锁曹志勇的数据库备份类型采取相应的恢复措施</p>\n<ul>\n<li>使用 SQL 语句备份与恢复数据库表数据的方法有一点不足：只能导出或导入数据的内容，而不包括表的结构，如果表的结构文件损坏，则必须先设法恢复原来表的结构</li>\n</ul>\n<h3 id=\"一备份数据\"><a class=\"anchor\" href=\"#一备份数据\">#</a> 一．备份数据</h3>\n<pre><code class=\"language-mariadb\">SELECT sql语句 INTO OUTFILE '导出的路径+文件名'\nFIELDS  TERMINATED BY ','\t每个字段之间用,号隔开\nOPTIONALLY ENCLOSED BY &quot;&quot;\t每个字段用&quot;&quot;包裹起来\nESCAPED BY '*' \t\t\t\t将转义符\\改成*\nLINES TERMINATED BY '？'\t\t每一行数据用?隔开\n</code></pre>\n<h3 id=\"二导入数据\"><a class=\"anchor\" href=\"#二导入数据\">#</a> 二。导入数据</h3>\n<pre><code class=\"language-mariadb\">LOAD DATA INFILE '路径+文件名'\nINTO TABLE '导入到的数据库表名'\n[ FIELDS TERMINATED BY \nOPTIONALLY ENCLOSED BY\nESCAPED BY \nLINES TERMINATED BY ] \t这里的设置需要跟备份时的设置保持一致，否则会导入出错\n</code></pre>\n<hr />\n<h2 id=\"第七章数据库应用设计与开发实例\"><a class=\"anchor\" href=\"#第七章数据库应用设计与开发实例\">#</a> 第七章：数据库应用设计与开发实例</h2>\n<h3 id=\"第一节需求描述与分析\"><a class=\"anchor\" href=\"#第一节需求描述与分析\">#</a> 第一节：需求描述与分析</h3>\n<h4 id=\"一功能性需求\"><a class=\"anchor\" href=\"#一功能性需求\">#</a> 一。功能性需求</h4>\n<h4 id=\"二非功能性需求\"><a class=\"anchor\" href=\"#二非功能性需求\">#</a> 二。非功能性需求</h4>\n<table>\n<thead>\n<tr>\n<th>质量需求名称</th>\n<th>质量需求的详细要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>可靠性</td>\n<td><strong>在不运行期间</strong>，每个月最多出现一次由外界因素造成的系统故障；&lt;br /&gt;<strong> 在运行期间</strong>，除非遇到特殊情况，否则要<strong>保证正常使用</strong></td>\n</tr>\n<tr>\n<td>正确性</td>\n<td>需要<strong>保证</strong>数据库中的<strong>数据正确</strong>和系统的各个<strong>功能模块的业务逻辑正确</strong></td>\n</tr>\n<tr>\n<td>兼容性</td>\n<td>可以在与 IE 内核兼容的任一主流浏览器上运行 (B/S 结构)</td>\n</tr>\n<tr>\n<td>健壮性</td>\n<td>要经常进行健壮性测试，不断加强对非格式化操作的应变能力</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"第二节系统设计\"><a class=\"anchor\" href=\"#第二节系统设计\">#</a> 第二节：系统设计</h3>\n<h3 id=\"第三节系统实现\"><a class=\"anchor\" href=\"#第三节系统实现\">#</a> 第三节：系统实现</h3>\n<h3 id=\"第四节系统测试与维护\"><a class=\"anchor\" href=\"#第四节系统测试与维护\">#</a> 第四节：系统测试与维护</h3>\n<hr />\n<h2 id=\"第八章数据库管理技术的发展\"><a class=\"anchor\" href=\"#第八章数据库管理技术的发展\">#</a> 第八章：数据库管理技术的发展</h2>\n<h3 id=\"第一节数据库技术发展概述\"><a class=\"anchor\" href=\"#第一节数据库技术发展概述\">#</a> 第一节：数据库技术发展概述</h3>\n<h4 id=\"一第一代数据库系统\"><a class=\"anchor\" href=\"#一第一代数据库系统\">#</a> 一。第一代数据库系统</h4>\n<ul>\n<li>代表\n<ul>\n<li>IMS，层次模型，IBM 公司做的，1969 年</li>\n<li>CODASYL，网状模式，DBTG 公司制作，1970 年 u</li>\n</ul>\n</li>\n<li>特点\n<ul>\n<li>支持三级模式（层次模型、网状模型、关系模型都支持三级模式）</li>\n<li>用存取路径表示联系</li>\n<li>独立的 DDL</li>\n<li>导航的 DML</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"二第二代数据库系统\"><a class=\"anchor\" href=\"#二第二代数据库系统\">#</a> 二。第二代数据库系统</h4>\n<ul>\n<li>关系数据库系统\n<ul>\n<li>E.F.Codd 提出<strong>关系代数、范式</strong>，1970 年</li>\n</ul>\n</li>\n<li>系统原型\n<ul>\n<li>IBM System R</li>\n<li>Berkeley INGRES</li>\n<li>1980 年后，新开发的系统都是关系型的</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"三新一代数据库系统\"><a class=\"anchor\" href=\"#三新一代数据库系统\">#</a> 三。新一代数据库系统</h4>\n<p>OODB 第三代的代表？</p>\n<p>没有被市场普遍接受</p>\n<p>ORDB，新一代将是多种模型并存</p>\n<p>” 第三代 “的基本特征：</p>\n<ol>\n<li>应支持<strong>数据管理</strong>、<strong>对象管理</strong>和<strong>知识管理</strong></li>\n<li>保持或继承 RDB 的技术</li>\n<li>开放性</li>\n</ol>\n<p>应用：数据仓库、工程数据库、统计数据库、空间数据库、科学数据库等多种数据库</p>\n<h3 id=\"第二节数据仓库与数据挖掘\"><a class=\"anchor\" href=\"#第二节数据仓库与数据挖掘\">#</a> 第二节：数据仓库与数据挖掘</h3>\n<h4 id=\"一从数据库到数据仓库\"><a class=\"anchor\" href=\"#一从数据库到数据仓库\">#</a> 一。从数据库到数据仓库</h4>\n<p>数据仓库主要特征：</p>\n<ol>\n<li><strong>面向主题</strong></li>\n<li><strong>集成性</strong></li>\n<li><strong>数据的非易失性</strong></li>\n<li><strong>数据的时变性</strong></li>\n</ol>\n<p>数据仓库具有三个常用的重要概念，即粒度、分割和维</p>\n<ol>\n<li>\n<p>粒度</p>\n<p>粒度问题是设计数据仓库的一个最重要的方面。粒度是指数据仓库的数据单位中保存数据的细化或综合程度的级别</p>\n</li>\n<li>\n<p>分割</p>\n<p>分割时将数据分散到各自的物理单元中，以便能分别处理，以提高数据处理的效率</p>\n</li>\n<li>\n<p>维</p>\n<p>维时人们观察数据的特定角度，是考虑问题时的一类属性</p>\n</li>\n</ol>\n<h4 id=\"二数据挖掘技术\"><a class=\"anchor\" href=\"#二数据挖掘技术\">#</a> 二。数据挖掘技术</h4>\n<p>数据挖掘具备下列几种功能：</p>\n<ol>\n<li>概念描述</li>\n<li>关联分析</li>\n<li>分类与预测</li>\n<li>聚类</li>\n<li>孤立点检测</li>\n<li>趋势和演变分析</li>\n</ol>\n<h3 id=\"第三节大数据管理技能\"><a class=\"anchor\" href=\"#第三节大数据管理技能\">#</a> 第三节：大数据管理技能</h3>\n<h4 id=\"一大数据的定义\"><a class=\"anchor\" href=\"#一大数据的定义\">#</a> 一。大数据的定义</h4>\n<p>数据尚无统一的定义，通常被认为是数据量很大、数据形式多样化的数据</p>\n<p>特征：</p>\n<ol>\n<li>数据量巨大，即大量化（Volume）</li>\n<li>数据种类繁多，即多样化（Variety）</li>\n<li>处理速度快，即快速化（Velocity）</li>\n<li>价值 (Value) 密度低</li>\n</ol>\n<h4 id=\"二大数据管理技术典型代表\"><a class=\"anchor\" href=\"#二大数据管理技术典型代表\">#</a> 二。大数据管理技术典型代表</h4>\n<ol>\n<li>\n<p>大数据存储</p>\n</li>\n<li>\n<p>NoSQL 数据管理系统</p>\n<ol>\n<li>键值（Key-value）存储：常见的键值存储数据库包括 Tokyo Cabinet/Tyrant、Redis 和 Oracle BDB 等</li>\n<li>文档存储：常见的文档性数据库由 CouchDB、MongoDB 等</li>\n<li>列存储：常见的列存储数据库由 Hbase</li>\n<li>图存储：图存储数据库是基于图理论构建的，使用节点、属性和边的概念</li>\n</ol>\n</li>\n<li>\n<p>MapReduce 技术</p>\n<p>MapReduce 是一种并行变成模型。它把计算过程分解为两个阶段，即 Map 阶段和 Reduce 阶段</p>\n</li>\n</ol>\n",
            "tags": [
                "人生经历",
                "本科",
                "计算机科学与技术",
                "数据库系统原理"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/%E7%A7%91%E7%9B%AE%E4%B8%80%E7%AC%94%E8%AE%B0/",
            "url": "https://xinyao_idiot.gitee.io/zxy/%E7%A7%91%E7%9B%AE%E4%B8%80%E7%AC%94%E8%AE%B0/",
            "title": "科目一笔记",
            "date_published": "2021-07-14T05:22:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"科目一笔记\"><a class=\"anchor\" href=\"#科目一笔记\">#</a> 科目一笔记</h2>\n<h3 id=\"1法律-法规及道路交通信号\"><a class=\"anchor\" href=\"#1法律-法规及道路交通信号\">#</a> 1. 法律、法规及道路交通信号</h3>\n<h4 id=\"11-许可-种类-有效期和申请条件\"><a class=\"anchor\" href=\"#11-许可-种类-有效期和申请条件\">#</a> 1.1、许可、种类、有效期和申请条件</h4>\n<ol>\n<li>\n<p>机动车驾驶许可</p>\n<ul>\n<li>驾驶证存在九种类型，分别是 A、B、C、D、E、F、M、N（有轨电车）、P（无轨电车）九种。</li>\n<li>除外 N、P 可分成<strong>方向盘式</strong>（A、B、C、M）和<strong>方向把式</strong>（D、E、F）</li>\n</ul>\n</li>\n<li>\n<p>机动车驾驶证种类、准假车型</p>\n<ul>\n<li>初次申请不得报 A1，A2、B1</li>\n<li><img data-src=\"%E7%A7%91%E7%9B%AE%E4%B8%80%E7%AC%94%E8%AE%B0/image-20210714133622486.png\" alt=\"\" /><img data-src=\"/zxy/%E7%A7%91%E7%9B%AE%E4%B8%80%E7%AC%94%E8%AE%B0/image-20210714133622486.png\" class=\"\"></li>\n</ul>\n</li>\n<li>\n<p>驾驶证有效期（重点）</p>\n<ul>\n<li>有效期分为 6 年、10 年和长期</li>\n</ul>\n</li>\n<li>\n<p>驾驶证的申请条件（重点）</p>\n<ul>\n<li>存在影响驾驶的 <code>疾病</code></li>\n<li>三年内 <code>吸食、注射毒品</code> 行为或者接触强制隔离戒毒措施未满三年、或者长期服用依赖性精神药品成瘾尚未戒除的</li>\n<li>造成 <code>交通事务后逃逸</code> 构成犯罪的</li>\n<li>饮酒后或者 <code>醉酒驾驶</code> 机动车发生重大交通事故构成犯罪的</li>\n<li>醉酒驾驶营运机动车依法被吊销机动车驾驶证未满十年的</li>\n<li>因其他清醒依法被吊销机动车驾驶证未满二年的</li>\n<li>驾驶许可依法被撤销未满三年的</li>\n<li>法律行政法规定的其他情形</li>\n</ul>\n<p>申请时需要体检</p>\n<ol>\n<li>C1、C2 的视力要求为 4.9 以上</li>\n<li>无红绿色盲</li>\n<li>两耳分别距音叉 50 厘米能辨别声源的方向</li>\n<li>双手健全</li>\n<li>下肢健全</li>\n<li>年龄满 18 岁以上即可</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"12-驾驶证申领与考试\"><a class=\"anchor\" href=\"#12-驾驶证申领与考试\">#</a> 1.2、驾驶证申领与考试</h4>\n<ol>\n<li>驾驶员考试内容和合格标准\n<ol>\n<li>内容\n<ul>\n<li>科目一（机考）90 分</li>\n<li>科目二（实操）80 分\n<ul>\n<li>倒车入库</li>\n<li>坡道定点停车和起步</li>\n<li>侧方停车</li>\n<li>曲线行驶</li>\n<li>直角转弯</li>\n</ul>\n</li>\n<li>科目三（实操）90 分</li>\n<li>科目四（机考）90 分</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>学习驾驶证明使用规定和考试预约要求\n<ul>\n<li>申请人已欺骗、贿赂等\n<ul>\n<li>撤销驾驶许可、三年内部的再次申领驾驶证</li>\n</ul>\n</li>\n<li>伪造、变造或使用伪造的驾驶证\n<ul>\n<li>处 2000 以上 5000 以下罚款，构成犯罪的，依法追究刑事责任</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"13-驾驶证的使用与管理\"><a class=\"anchor\" href=\"#13-驾驶证的使用与管理\">#</a> 1.3、驾驶证的使用与管理</h4>\n<ol>\n<li>机动车驾驶证实习期\n<ul>\n<li>有 12 个月实习期，实习期间需要在车后贴或者悬挂统一式样的实习标志</li>\n<li>实习期不得上高速，或者有三年以上的老师傅带着</li>\n</ul>\n</li>\n<li>有效期满、转入、变更换证\n<ul>\n<li>有效期：6 年、10 年、永久</li>\n<li>有效期过了还有 90 天的换证申请期，超过驾驶证有效期一年以上将会注销</li>\n<li>迁户口，应当向迁入地车辆管理所申请换证</li>\n<li>居住，向居住地车辆管理所申请换证</li>\n</ul>\n</li>\n<li>驾驶证意识补证\n<ol>\n<li>驾驶证遗失的，向机动车驾驶证核发地的车辆管理所申请补发。之前的驾驶证作废</li>\n<li>驾驶证被依法扣留、扣押、暂扣期间不可补发</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"14-道路交通安全违法行为及积分分值\"><a class=\"anchor\" href=\"#14-道路交通安全违法行为及积分分值\">#</a> 1.4、道路交通安全违法行为及积分分值</h4>\n<ol>\n<li>\n<p>道路交通安全违法行为积分规则及分类</p>\n<ul>\n<li>一个周期 12 个月，一共 12 分</li>\n<li>扣分分值：12 分、6 分、3 分、2 分、1 分</li>\n</ul>\n</li>\n<li>\n<p>各种道路交通安全违法行为的积分分值</p>\n<ul>\n<li>十二分\n<ol>\n<li>驾驶与准假车型不符的机动车</li>\n<li>饮酒后驾车</li>\n<li>驾驶营运客车，超载 20%</li>\n<li>造成交通事故后逃逸，尚不构成犯罪</li>\n<li>上道路的机动车未悬挂车牌号、或者故意遮挡、无损、不安规定安装机动车号牌的</li>\n<li>使用伪造、变造的车牌号、行驶证、驾驶证、校车标牌或者使用其他机动车号牌的行驶证</li>\n<li>机动车在高速公路上倒车、逆行、穿越中央分隔带掉头的</li>\n<li>驾驶中型以上的载客载货汽车、小车、危险物品运输车辆超速 20%、在高速公路、城市快速路意外的道路上超速 50%、驾驶其他机动车实行超速 50% 的</li>\n<li>连续驾车 4 小时未休息 20 分钟的</li>\n</ol>\n</li>\n<li>六分\n<ol>\n<li>机动车驾驶证被暂扣期间驾驶机动车</li>\n<li><strong>闯红灯</strong></li>\n<li>驾驶营运客车（不包括公交汽车）、载客汽车载人超过核定人数未达 20%</li>\n<li>驾驶中型以上的载客载货汽车、校车、危险武平运输车车辆在高速公路、城市快速路上行驶超速，但没有超过 20% 的</li>\n<li>超速 20% 以上未达到 50%</li>\n<li>载物货车超载 30%</li>\n<li>在高速公路上停车</li>\n<li>违法占用应急车道</li>\n<li>低能见度情况下，在高速公路上不按照规定驾驶的</li>\n<li>驾驶机动车运载超限的不可解体的武平，为按指定的时间、路线、速度、行驶或者为悬挂明显标志的</li>\n<li>载运易燃易爆物品等未按照指定时间、路线、速度行驶或者未悬挂警示标志并采取必要的安全措施的</li>\n<li>连续驾驶 4 小时未停车休息或休息小于 20 分钟</li>\n<li><strong>不按照规定避让校车</strong></li>\n</ol>\n</li>\n<li>三分\n<ul>\n<li>驾驶机动车经过人行道不按规定减速、停车、避让行人的</li>\n<li>在道路上车辆发生故障未按规定使用灯光和设置警告标志</li>\n<li>上道路的机动车未按照规定进行安全技术检验的</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>违法记分清楚处理要求</p>\n<ol>\n<li>满 12 分需要重新考科目一</li>\n<li>未满 12 分的需要缴纳罚款</li>\n<li>未满 12 分且不缴纳罚款，扣的分值将继承到下一周期</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"15-交通信号灯的分类-含义-识别和作用\"><a class=\"anchor\" href=\"#15-交通信号灯的分类-含义-识别和作用\">#</a> 1.5、交通信号灯的分类、含义、识别和作用</h4>\n<ol>\n<li>机动车信号灯和非机动车信号灯\n<ul>\n<li>机动车信号灯分为圆饼灯和方向灯\n<ul>\n<li>圆饼灯只管向前，不管左右</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>闪光警告信号灯\n<ul>\n<li>提示车辆、行人通行时注意瞭望，确认安全后通过</li>\n</ul>\n</li>\n<li>方向指向信号灯</li>\n<li>车道信号灯\n<ul>\n<li>一般设置在车道上方</li>\n</ul>\n</li>\n<li>铁道平交道口信号灯\n<ul>\n<li>两个红灯交替闪烁或一个红灯亮，表示禁止车辆、行人通行</li>\n<li>红灯熄灭，方可允许通行</li>\n</ul>\n</li>\n<li>人行横道信号灯</li>\n</ol>\n<h4 id=\"16-交警手势信号的分类-含义-识别和作用\"><a class=\"anchor\" href=\"#16-交警手势信号的分类-含义-识别和作用\">#</a> 1.6、交警手势信号的分类、含义、识别和作用</h4>\n<p>等级划分：交警 ——&gt; 信号灯</p>\n<ul>\n<li>单手信号\n<ul>\n<li>停止</li>\n<li>左转弯</li>\n<li>减速</li>\n<li>变道</li>\n</ul>\n</li>\n<li>双手信号\n<ul>\n<li>左转弯</li>\n<li>右转弯</li>\n<li>靠边停车</li>\n<li>直行</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"17-交通标识的分类-含义-识别和作用\"><a class=\"anchor\" href=\"#17-交通标识的分类-含义-识别和作用\">#</a> 1.7、交通标识的分类、含义、识别和作用</h4>\n<ol>\n<li>\n<p>警告标志</p>\n<ul>\n<li>黄色</li>\n</ul>\n</li>\n<li>\n<p>禁令标志</p>\n<ul>\n<li>红色</li>\n</ul>\n</li>\n<li>\n<p>指示标志</p>\n<ul>\n<li>蓝色</li>\n</ul>\n</li>\n<li>\n<p>高速、城市指路标志</p>\n<ul>\n<li>绿色</li>\n</ul>\n</li>\n<li>\n<p>旅游区标志</p>\n<ul>\n<li>棕色</li>\n</ul>\n</li>\n<li>\n<p>其他类型标志</p>\n<ul>\n<li>一般都很小的矩形、白色</li>\n<li>辅助、告示、作业区 标志</li>\n</ul>\n</li>\n<li>\n<p>交通标线</p>\n<ol>\n<li>指示标线\n<ul>\n<li>白色线条、黄色虚线、白色虚线</li>\n<li>双黄线、单虚单实、双白虚线、三白虚线</li>\n</ul>\n</li>\n<li>禁止标线\n<ul>\n<li>黄色实线、白色实线</li>\n</ul>\n</li>\n<li>警告标线</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"18-道路通行规则内容概述\"><a class=\"anchor\" href=\"#18-道路通行规则内容概述\">#</a> 1.8、道路通行规则内容概述</h4>\n<ul>\n<li>机动车靠右侧通行</li>\n<li>有划分车道和无划分车道\n<ul>\n<li>无划分车道，应该在道路中间行驶</li>\n<li>有划分车道\n<ol>\n<li>当存在两条同方向车道时，左侧为快速车道，右侧为慢速车道</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>按交通信号通行\n<ul>\n<li>直行 ——&gt; 左转 ——&gt; 右转</li>\n</ul>\n</li>\n<li>灯光和喇叭的使用\n<ul>\n<li>转向灯</li>\n<li>前照灯，夜间照明</li>\n<li>制动灯</li>\n<li>倒车指示灯</li>\n</ul>\n</li>\n<li>能见度低时（不得使用远光灯）\n<ul>\n<li>雨、雪、沙尘、冰雹：使用前照灯、示廓灯、后位灯</li>\n<li>雾天：使用雾灯、危险报警闪光灯、前照灯、示廓灯、后位灯</li>\n</ul>\n</li>\n<li>夜间行车\n<ul>\n<li>在没有中心线时，150 内不能使用远光灯</li>\n<li>窄桥等地不得使用远光灯</li>\n<li>夜间没有路灯、照明不良或者遇到雾、雨、雪、沙尘等能见度低的情况下行驶时，与前车近距离不可使用远光灯</li>\n<li>通过急弯或没有信号灯控制的路口时，应交替使用远近光灯示意</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"19-道路通行基本规则\"><a class=\"anchor\" href=\"#19-道路通行基本规则\">#</a> 1.9、道路通行基本规则</h4>\n<ol>\n<li>保持车距\n<ul>\n<li>100km/h 需要保持 40 米车距</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"110-特殊路况与路段通行\"><a class=\"anchor\" href=\"#110-特殊路况与路段通行\">#</a> 1.10、特殊路况与路段通行</h4>\n<h4 id=\"111-避让行人与特殊车辆\"><a class=\"anchor\" href=\"#111-避让行人与特殊车辆\">#</a> 1.11、避让行人与特殊车辆</h4>\n<h4 id=\"112-机动车载人载物及停车规定\"><a class=\"anchor\" href=\"#112-机动车载人载物及停车规定\">#</a> 1.12、机动车载人载物及停车规定</h4>\n<h4 id=\"113-机动车牵引挂车规定及故障处理\"><a class=\"anchor\" href=\"#113-机动车牵引挂车规定及故障处理\">#</a> 1.13、机动车牵引挂车规定及故障处理</h4>\n<h4 id=\"114-高速公路通信规则\"><a class=\"anchor\" href=\"#114-高速公路通信规则\">#</a> 1.14、高速公路通信规则</h4>\n<h4 id=\"115-道路通行规则综合模拟及实际应用\"><a class=\"anchor\" href=\"#115-道路通行规则综合模拟及实际应用\">#</a> 1.15、道路通行规则综合模拟及实际应用</h4>\n<h4 id=\"116-驾驶机动车禁止行为\"><a class=\"anchor\" href=\"#116-驾驶机动车禁止行为\">#</a> 1.16、驾驶机动车禁止行为</h4>\n<h4 id=\"117-行政强制措施\"><a class=\"anchor\" href=\"#117-行政强制措施\">#</a> 1.17、行政强制措施</h4>\n<h4 id=\"118-违法处罚种类及违规处罚\"><a class=\"anchor\" href=\"#118-违法处罚种类及违规处罚\">#</a> 1.18、违法处罚种类及违规处罚</h4>\n<h4 id=\"119-机动车登记\"><a class=\"anchor\" href=\"#119-机动车登记\">#</a> 1.19、机动车登记</h4>\n<h4 id=\"120-机动车号牌的申领和使用\"><a class=\"anchor\" href=\"#120-机动车号牌的申领和使用\">#</a> 1.20、机动车号牌的申领和使用</h4>\n<h4 id=\"121-机动车安全技术检验\"><a class=\"anchor\" href=\"#121-机动车安全技术检验\">#</a> 1.21、机动车安全技术检验</h4>\n<h4 id=\"122-机动车强制报废\"><a class=\"anchor\" href=\"#122-机动车强制报废\">#</a> 1.22、机动车强制报废</h4>\n<h4 id=\"123-交通事故现场\"><a class=\"anchor\" href=\"#123-交通事故现场\">#</a> 1.23、交通事故现场</h4>\n<h3 id=\"2机动车基本知识\"><a class=\"anchor\" href=\"#2机动车基本知识\">#</a> 2. 机动车基本知识</h3>\n<h3 id=\"3综合复习及考核\"><a class=\"anchor\" href=\"#3综合复习及考核\">#</a> 3. 综合复习及考核</h3>\n",
            "tags": [
                "人生经历",
                "驾照",
                "驾照"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/%E9%A9%BE%E7%85%A7/",
            "url": "https://xinyao_idiot.gitee.io/zxy/%E9%A9%BE%E7%85%A7/",
            "title": "驾照",
            "date_published": "2021-07-14T05:17:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"文章内容\"><a class=\"anchor\" href=\"#文章内容\">#</a> 文章内容</h2>\n<p>之后会按照科目考试顺序增加一些心得笔记，怕到时候忘记了。</p>\n",
            "tags": [
                "人生经历",
                "驾照",
                "驾照"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/",
            "url": "https://xinyao_idiot.gitee.io/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/",
            "title": "SpringCloud（尚硅谷）",
            "date_published": "2021-06-29T01:10:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"springcloud\"><a class=\"anchor\" href=\"#springcloud\">#</a> SpringCloud</h1>\n<h3 id=\"一-微服务架构理论\"><a class=\"anchor\" href=\"#一-微服务架构理论\">#</a> 一、微服务架构理论</h3>\n<h4 id=\"1-什么是微服务\"><a class=\"anchor\" href=\"#1-什么是微服务\">#</a> 1. 什么是微服务</h4>\n<blockquote>\n<p>In short, the <strong>microservice architectural style</strong> is an approach to developing a single application as a <strong>suite of small services</strong>, each <strong>running in its own process</strong> and communicating with <strong>lightweight</strong> mechanisms, often an <strong>HTTP</strong> resource API. These services are built around <strong>business capabilities</strong> and <strong>independently deployable</strong> by fully <strong>automated deployment</strong> machinery. There is a bare minimum of centralized management of these services, which may be <strong>written in different programming languages</strong> and use different data storage technologies.——James Lewis and Martin Fowler (2014)</p>\n</blockquote>\n<p>整体而言，可以理解为：</p>\n<ul>\n<li>微服务是一种架构风格</li>\n<li>是把一个应用拆分为一组小型服务的集合体</li>\n<li>每个服务运行在自己的进程内，也就是可以独立部署和升级</li>\n<li>服务之间使用轻量级 HTTP 交互</li>\n<li>服务围绕业务功能拆分</li>\n<li>可以由全自动部署机制独立部署</li>\n<li>去中心化、服务资质。服务可以使用不同的语言、不同的存储技术</li>\n</ul>\n<p><strong>举个栗子：</strong></p>\n<p>我们本身相当于一个应用，而我们所用的手机、电脑、智能家居、箱包首饰、耳机等配件是一个个小型服务。若我们所有的配件都是出自苹果的，那么这一系列配件之间的契合度相当高；若我们所有的配件都来自与不同的品牌，那么这一系列配件之间的契合度的就不是很高。如果要适合的话，就需要去搭配。而我们的 SpringCloud 就是为我们将不同品牌的配件搭配在一起，做到合适的穿搭。</p>\n<h4 id=\"2-分布式微服务架构-落地维度\"><a class=\"anchor\" href=\"#2-分布式微服务架构-落地维度\">#</a> 2. 分布式微服务架构 - 落地维度</h4>\n<p>满足哪些维度？支撑起这些维度的具体技术？</p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62901.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62901.png\" class=\"\"></p>\n<ul>\n<li>服务调用</li>\n<li>服务降级</li>\n<li>服务注册与发现</li>\n<li>服务熔断</li>\n<li>负载均衡</li>\n<li>服务消息队列</li>\n<li>服务网关</li>\n<li>配置中心管理</li>\n<li>自动化构建部署</li>\n<li>服务监控</li>\n<li>全链路追踪</li>\n<li>服务定时任务</li>\n<li>调度操作</li>\n</ul>\n<h4 id=\"3-springcloud是什么\"><a class=\"anchor\" href=\"#3-springcloud是什么\">#</a> 3. SpringCloud 是什么</h4>\n<p>SpringCloud 是分布式微服务架构的站式解决方案，是多种微服务架构落地技术的集合体，俗称微服务全家桶，全家桶如下：</p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62902.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62902.png\" class=\"\"></p>\n<p><strong>“微” 力十足，互联网大厂微服务架构案例</strong></p>\n<ul>\n<li>京东\n<ul>\n<li><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62903.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62903.png\" class=\"\"></li>\n</ul>\n</li>\n<li>阿里\n<ul>\n<li><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62904.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62904.png\" class=\"\"></li>\n</ul>\n</li>\n<li>京东物流\n<ul>\n<li><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62905.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62905.png\" class=\"\"></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"二-boot和cloud版本选择\"><a class=\"anchor\" href=\"#二-boot和cloud版本选择\">#</a> 二、Boot 和 Cloud 版本选择</h3>\n<p>因为 SpringCloud 对 SpringBoot 的版本有做要求，所以需要去官网查看版本进行使用</p>\n<h4 id=\"方法一\"><a class=\"anchor\" href=\"#方法一\">#</a> 方法一：</h4>\n<p>可以在 <code>https://spring.io/projects/spring-cloud#overview</code>  中查看所有的版本号。之前的 SpringCloud 版本号是根据首字母大写的顺序来排的（据说是根据啥英国地铁啥的），现在的版本是 2020.0.x 之类的</p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62906.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62906.png\" class=\"\"></p>\n<h4 id=\"方法二\"><a class=\"anchor\" href=\"#方法二\">#</a> 方法二：</h4>\n<p>可以在 <code>https://spring.io/projects/spring-cloud#learn</code>  中选择自己需要的版本，点击 <code>Reference Doc</code>  可以查看到</p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62907.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62907.png\" class=\"\"></p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62908.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62908.png\" class=\"\"></p>\n<hr />\n<h3 id=\"三-cloud组件定更说明\"><a class=\"anchor\" href=\"#三-cloud组件定更说明\">#</a> 三、Cloud 组件定更说明</h3>\n<p>停更引发的<strong>升级惨案</strong></p>\n<p><img data-src=\"SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62909.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/62909.png\" class=\"\"></p>\n<hr />\n<h3 id=\"四-微服务架构编码构建\"><a class=\"anchor\" href=\"#四-微服务架构编码构建\">#</a> 四、微服务架构编码构建</h3>\n<h4 id=\"1-创建工程\"><a class=\"anchor\" href=\"#1-创建工程\">#</a> 1. 创建工程</h4>\n<h4 id=\"2-设置字符编码\"><a class=\"anchor\" href=\"#2-设置字符编码\">#</a> 2. 设置字符编码</h4>\n<p>​\t由于 IDEA 中需要设置在当前项目的字符编码和当新建项目的字符编码，所以请记住设置两次！！!</p>\n<h4 id=\"3-注解激活生效\"><a class=\"anchor\" href=\"#3-注解激活生效\">#</a> 3. 注解激活生效</h4>\n<h4 id=\"4-java编译版本选8\"><a class=\"anchor\" href=\"#4-java编译版本选8\">#</a> 4. java 编译版本选 8</h4>\n<p>​\t若电脑中没有多个版本的 java，可不用</p>\n<h4 id=\"5-file-type过滤\"><a class=\"anchor\" href=\"#5-file-type过滤\">#</a> 5. File Type 过滤</h4>\n<p>可以将.idea 等文件过滤显示</p>\n<pre><code>*.hprof;*.idea;*.iml;*.pyc;*.pyo;*.rbc;*.yarb;*~;.DS_Store;.git;.hg;.svn;CVS;__pycache__;_svn;vssver.scc;vssver2.scc;\n</code></pre>\n",
            "tags": [
                "计算机学习",
                "后端",
                "SpringCloud",
                "SpringCloud"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/",
            "url": "https://xinyao_idiot.gitee.io/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/",
            "title": "SpringCloud笔记心得",
            "date_published": "2021-06-23T03:10:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"springcloud笔记\"><a class=\"anchor\" href=\"#springcloud笔记\">#</a> SpringCloud 笔记</h1>\n<h2 id=\"1-前言\"><a class=\"anchor\" href=\"#1-前言\">#</a> 1、前言</h2>\n<h3 id=\"11-前提需要\"><a class=\"anchor\" href=\"#11-前提需要\">#</a> 1.1、前提需要</h3>\n<pre><code>数据库、Mybatis、Spring、SpringMVC、SpringBoot、Dubbo、Zookeeper、分布式基础、Maven、Git、Ajax、Json\n</code></pre>\n<p><strong>这个阶段该如何学习</strong></p>\n<pre><code>三层架构 + MVC\n\n框架：\n\tSpring IOC AOP：简化开发\n\t\n\tSpringBoot：新一代的javaEE开发标准，自动装配\n\t\n\t模块化 all in one\n\t\n\t模块化的开发=====&gt;all in one 代码没有变化\n\t\n微服务架构四个核心问题？\n\t1.服务很多，客户端怎么访问？\n\t2.这么多服务？服务之间如何通信？\n\t3.这么多服务？如何治理？\n\t4.服务挂了怎么办？\n\t\n解决方案：\n\tSpring Cloud 不是技术，而是生态！，就是解决微服务架构四个核心问题 SprintBoot\n\t\n\t1.Spring Cloud NetFlix 一站式解决方案\n\t\tapi网关：zuul组件\n\t\t通信：Feign ---- HttpClient ---- Http通信方式,同步,阻塞\n\t\t服务注册和发现：Eureka\n\t\t熔断机制：Hystrix\n\t\t......\n\n    2. Apache Dubbo Zookeeper：半自动！需要整合别人的\n    \tAPI网关：没有,找第三方组件(比如整合zuul组件),或者自己实现\n    \t通信：Dubbo 是一个基于Java的高性能的RPC通信框架(性能比Feign强大)\n    \t服务注册和发现：Zookeeper\n    \t熔断机制：没有,需要借助Hystrix\n    \t\n    \tDubbo这个方案并不完善\n\n    3. Spring Cloud Alibaba：目前最新的一站式解决方案！可解决上述4个核心问题,更简单\n    \tAPI网关：\n    \t通信：\n\t\t服务注册和发现：\n\t\t熔断机制：\n\t\t\n新概念：服务网格~ Server Mesh\n\tistio\n\t\n万变不离其宗4个问题：\n\t1. API网关\n\t2. HTTP,RPC通信\n\t3. 注册和发现\n\t4. 熔断机制\n\t\n网络不可靠！\n</code></pre>\n<h3 id=\"12-常见面试题\"><a class=\"anchor\" href=\"#12-常见面试题\">#</a> 1.2 、常见面试题</h3>\n<p>1.1、 什么是微服务？</p>\n<p>1.2 、微服务之间是如何独立通讯的？</p>\n<p>1.3 、SpringCloud 和 Dubbo 有那些区别？</p>\n<p>1.4 、SpringBoot 和 SpringCloud，请谈谈你对他们的理解</p>\n<p>1.5 、什么是服务熔断？什么是服务降级？</p>\n<p>1.6 、微服务的优缺点分别是什么？说下你在项目开发中遇到的坑</p>\n<p>1.7 、你所知道的微服务技术栈有哪些？列举一二</p>\n<p>1.8、 Eureka 和 Zookeeper 都可以提供服务注册与发现的功能，请说说两者的区别</p>\n<h2 id=\"2-微服务概述\"><a class=\"anchor\" href=\"#2-微服务概述\">#</a> 2. 微服务概述</h2>\n<h4 id=\"21-什么是微服务\"><a class=\"anchor\" href=\"#21-什么是微服务\">#</a> 2.1 什么是微服务？</h4>\n<p>** 什么是微服务？** 微服务 (Microservice Architecture) 是近几年流行的一种架构思想，关于它的概念很难一言以蔽之。</p>\n<p>究竟什么是微服务呢？我们在此引用 ThoughtWorks 公司的首席科学家 Martin Fowler 于 2014 年提出的一段话：</p>\n<p>原文：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYXJ0aW5mb3dsZXIuY29tL2FydGljbGVzL21pY3Jvc2VydmljZXMuaHRtbA==\">https://martinfowler.com/articles/microservices.html</span></p>\n<p>汉化：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGl1bmluZzgwMjMvcC80NDkzMTU2Lmh0bWw=\">https://www.cnblogs.com/liuning8023/p/4493156.html</span></p>\n<ul>\n<li>就目前而言，对于微服务，业界并没有一个统一的，标准的定义。</li>\n<li>但通常而言，微服务架构是一种架构模式，或者说是一种架构风格，<strong>它体长将单一的应用程序划分成一组小的服务</strong>，每个服务运行在其独立的自己的进程内，服务之间互相协调，互相配置，为用户提供最终价值，服务之间采用轻量级的通信机制 (<strong>HTTP</strong>) 互相沟通，每个服务都围绕着具体的业务进行构建，并且能狗被独立的部署到生产环境中，另外，应尽量避免统一的，集中式的服务管理机制，对具体的一个服务而言，应该根据业务上下文，选择合适的语言，工具 (<strong>Maven</strong>) 对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。</li>\n</ul>\n<p><strong>再来从技术维度角度理解下：</strong></p>\n<ul>\n<li>微服务化的核心就是将传统的一站式应用，根据业务拆分成一个一个的服务，彻底地去耦合，每一个微服务提供单个业务功能的服务，一个服务做一件事情，从技术角度看就是一种小而独立的处理过程，类似进程的概念，能够自行单独启动或销毁，拥有自己独立的数据库。</li>\n</ul>\n<h4 id=\"22-微服务与微服务架构\"><a class=\"anchor\" href=\"#22-微服务与微服务架构\">#</a> 2.2 微服务与微服务架构</h4>\n<p><strong>微服务</strong></p>\n<p>强调的是服务的大小，它关注的是某一个点，是具体解决某一个问题 / 提供落地对应服务的一个服务应用，狭义的看，可以看作是 IDEA 中的一个个微服务工程，或者 Moudel。</p>\n<pre><code>IDEA 工具里面使用Maven开发的一个个独立的小Moudel，它具体是使用SpringBoot开发的一个小模块，专业的事情交给专业的模块来做，一个模块就做着一件事情。\n强调的是一个个的个体，每个个体完成一个具体的任务或者功能。\n</code></pre>\n<p><strong>微服务架构</strong></p>\n<p>一种新的架构形式，Martin Fowler 于 2014 年提出。</p>\n<p>微服务架构是一种架构模式，它体长将单一应用程序划分成一组小的服务，服务之间相互协调，互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务与服务之间采用轻量级的通信机制 **(如 HTTP)<strong> 互相协作，每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境中，另外，应尽量避免统一的，集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具</strong> (如 Maven)** 对其进行构建。</p>\n<h4 id=\"23-微服务优缺点\"><a class=\"anchor\" href=\"#23-微服务优缺点\">#</a> 2.3 微服务优缺点</h4>\n<p><strong>优点</strong></p>\n<ul>\n<li>单一职责原则；</li>\n<li>每个服务足够内聚，足够小，代码容易理解，这样能聚焦一个指定的业务功能或业务需求；</li>\n<li>开发简单，开发效率高，一个服务可能就是专一的只干一件事；</li>\n<li>微服务能够被小团队单独开发，这个团队只需 2-5 个开发人员组成；</li>\n<li>微服务是松耦合的，是有功能意义的服务，无论是在开发阶段或部署阶段都是独立的；</li>\n<li>微服务能使用不同的语言开发；</li>\n<li>易于和第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如 jenkins，Hudson，bamboo；</li>\n<li>微服务易于被一个开发人员理解，修改和维护，这样小团队能够更关注自己的工作成果，无需通过合作才能体现价值；</li>\n<li>微服务允许利用和融合最新技术；</li>\n<li><strong>微服务只是业务逻辑的代码，不会和 HTML，CSS，或其他的界面混合；</strong></li>\n<li><strong>每个微服务都有自己的存储能力，可以有自己的数据库，也可以有统一的数据库；</strong></li>\n</ul>\n<p><strong>缺点</strong></p>\n<ul>\n<li>开发人员要处理分布式系统的复杂性；</li>\n<li>多服务运维难度，随着服务的增加，运维的压力也在增大；</li>\n<li>系统部署依赖问题；</li>\n<li>服务间通信成本问题；</li>\n<li>数据一致性问题；</li>\n<li>系统集成测试问题；</li>\n<li>性能和监控问题；</li>\n</ul>\n<h4 id=\"24-微服务技术栈有那些\"><a class=\"anchor\" href=\"#24-微服务技术栈有那些\">#</a> 2.4 微服务技术栈有那些？</h4>\n<table>\n<thead>\n<tr>\n<th><strong>微服务技术条目</strong></th>\n<th>落地技术</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>服务开发</td>\n<td>SpringBoot、Spring、SpringMVC 等</td>\n</tr>\n<tr>\n<td>服务配置与管理</td>\n<td>Netfix 公司的 Archaius、阿里的 Diamond 等</td>\n</tr>\n<tr>\n<td>服务注册与发现</td>\n<td>Eureka、Consul、Zookeeper 等</td>\n</tr>\n<tr>\n<td>服务调用</td>\n<td>Rest、PRC、gRPC</td>\n</tr>\n<tr>\n<td>服务熔断器</td>\n<td>Hystrix、Envoy 等</td>\n</tr>\n<tr>\n<td>负载均衡</td>\n<td>Ribbon、Nginx 等</td>\n</tr>\n<tr>\n<td>服务接口调用 (客户端调用服务的简化工具)</td>\n<td>Fegin 等</td>\n</tr>\n<tr>\n<td>消息队列</td>\n<td>Kafka、RabbitMQ、ActiveMQ 等</td>\n</tr>\n<tr>\n<td>服务配置中心管理</td>\n<td>SpringCloudConfig、Chef 等</td>\n</tr>\n<tr>\n<td>服务路由 (API 网关)</td>\n<td>Zuul 等</td>\n</tr>\n<tr>\n<td>服务监控</td>\n<td>Zabbix、Nagios、Metrics、Specatator 等</td>\n</tr>\n<tr>\n<td>全链路追踪</td>\n<td>Zipkin、Brave、Dapper 等</td>\n</tr>\n<tr>\n<td>数据流操作开发包</td>\n<td>SpringCloud Stream (封装与 Redis，Rabbit，Kafka 等发送接收消息)</td>\n</tr>\n<tr>\n<td>事件消息总栈</td>\n<td>SpringCloud Bus</td>\n</tr>\n<tr>\n<td>服务部署</td>\n<td>Docker、OpenStack、Kubernetes 等</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"25-为什么选择springcloud作为微服务架构\"><a class=\"anchor\" href=\"#25-为什么选择springcloud作为微服务架构\">#</a> 2.5 为什么选择 SpringCloud 作为微服务架构</h4>\n<ol>\n<li>\n<p>选型依据</p>\n<ul>\n<li>整体解决方案和框架成熟度</li>\n<li>社区热度</li>\n<li>可维护性</li>\n<li>学习曲线</li>\n</ul>\n</li>\n<li>\n<p>当前各大 IT 公司用的微服务架构有那些？</p>\n<ul>\n<li>阿里：Dubbo+HFS</li>\n<li>京东：JSF</li>\n<li>新浪：Motan</li>\n<li>当当网：DubboX</li>\n<li>......</li>\n</ul>\n</li>\n<li>\n<p>各微服务框架对比</p>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th><strong>功能点 / 服务框架</strong></th>\n<th>Netflix/SpringCloud</th>\n<th>Motan</th>\n<th>gRPC</th>\n<th>Thrift</th>\n<th>Dubbo/DubboX</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>功能定位</td>\n<td>完整的微服务框架</td>\n<td>RPC 框架，但整合了 ZK 或 Consul，实现集群环境的基本服务注册发现</td>\n<td>RPC 框架</td>\n<td>RPC 框架</td>\n<td>服务框架</td>\n</tr>\n<tr>\n<td>支持 Rest</td>\n<td>是，Ribbon 支持多种可拔插的序列号选择</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n<tr>\n<td>支持 RPC</td>\n<td>否</td>\n<td>是 (Hession2)</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>支持多语言</td>\n<td>是 (Rest 形式)</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n</tr>\n<tr>\n<td>负载均衡</td>\n<td>是 (服务端 zuul + 客户端 Ribbon)，zuul - 服务，动态路由，云端负载均衡 Eureka（针对中间层服务器）</td>\n<td>是 (客户端)</td>\n<td>否</td>\n<td>否</td>\n<td>是 (客户端)</td>\n</tr>\n<tr>\n<td>配置服务</td>\n<td>Netfix Archaius，Spring Cloud Config Server 集中配置</td>\n<td>是 (Zookeeper 提供)</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n<tr>\n<td>服务调用链监控</td>\n<td>是 (zuul)，zuul 提供边缘服务，API 网关</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n<tr>\n<td>高可用 / 容错</td>\n<td>是 (服务端 Hystrix + 客户端 Ribbon)</td>\n<td>是 (客户端)</td>\n<td>否</td>\n<td>否</td>\n<td>是 (客户端)</td>\n</tr>\n<tr>\n<td>典型应用案例</td>\n<td>Netflix</td>\n<td>Sina</td>\n<td>Google</td>\n<td>Facebook</td>\n<td></td>\n</tr>\n<tr>\n<td>社区活跃程度</td>\n<td>高</td>\n<td>一般</td>\n<td>高</td>\n<td>一般</td>\n<td>2017 年后重新开始维护，之前中断了 5 年</td>\n</tr>\n<tr>\n<td>学习难度</td>\n<td>中等</td>\n<td>低</td>\n<td>高</td>\n<td>高</td>\n<td>低</td>\n</tr>\n<tr>\n<td>文档丰富程度</td>\n<td>高</td>\n<td>一般</td>\n<td>一般</td>\n<td>一般</td>\n<td>高</td>\n</tr>\n<tr>\n<td>其他</td>\n<td>Spring Cloud Bus 为我们的应用程序带来了更多管理端点</td>\n<td>支持降级</td>\n<td>Netflix 内部在开发集成 gRPC</td>\n<td>IDL 定义</td>\n<td>实践的公司比较多</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3-springcloud入门概述\"><a class=\"anchor\" href=\"#3-springcloud入门概述\">#</a> 3. SpringCloud 入门概述</h2>\n<h3 id=\"31-springcloud是什么\"><a class=\"anchor\" href=\"#31-springcloud是什么\">#</a> 3.1 SpringCloud 是什么？</h3>\n<p>Spring 官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmcuaW8v\">https://spring.io/</span></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923145639432.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923145639432.png\" class=\"\"></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923150331806.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923150331806.png\" class=\"\"></p>\n<p><strong>原文</strong></p>\n<p>Spring Cloud provides tools for developers to quickly build some of the common patterns in distributed systems (e.g. configuration management, service discovery, circuit breakers, intelligent routing, micro-proxy, control bus, one-time tokens, global locks, leadership election, distributed sessions, cluster state). Coordination of distributed systems leads to boiler plate patterns, and using Spring Cloud developers can quickly stand up services and applications that implement those patterns. They will work well in any distributed environment, including the developer’s own laptop, bare metal data centres, and managed platforms such as Cloud Foundry.</p>\n<p><strong>翻译：</strong><br />\nSpringCloud, 基于 SpringBoot 提供了一套微服务解决方案，包括服务注册与发现，配置中心，全链路监控，服务网关，负载均衡，熔断器等组件，除了基于 NetFlix 的开源组件做高度抽象封装之外，还有一些选型中立的开源组件。</p>\n<p>SpringCloud 利用 SpringBoot 的开发便利性，巧妙地简化了分布式系统基础设施的开发，SpringCloud 为开发人员提供了快速构建分布式系统的一些工具，<strong>包括配置管理，服务发现，断路器，路由，微代理，事件总线，全局锁，决策竞选，分布式会话等等</strong>，他们都可以用 SpringBoot 的开发风格做到一键启动和部署。</p>\n<p>SpringBoot 并没有重复造轮子，它只是将目前各家公司开发的比较成熟，经得起实际考研的服务框架组合起来，通过 SpringBoot 风格进行再封装，屏蔽掉了复杂的配置和实现原理，<strong>最终给开发者留出了一套简单易懂，易部署和易维护的分布式系统开发工具包</strong></p>\n<p>SpringCloud 是分布式微服务架构下的一站式解决方案，是各个微服务架构落地技术的集合体，俗称微服务全家桶。</p>\n<h3 id=\"32-springcloud和springboot的关系\"><a class=\"anchor\" href=\"#32-springcloud和springboot的关系\">#</a> 3.2 SpringCloud 和 SpringBoot 的关系</h3>\n<ul>\n<li>SpringBoot 专注于开苏方便的开发单个个体微服务；-jar</li>\n<li>SpringCloud 是关注全局的微服务协调整理治理框架，它将 SpringBoot 开发的一个个单体微服务，整合并管理起来，为各个微服务之间提供：配置管理、服务发现、断路器、路由、为代理、事件总栈、全局锁、决策竞选、分布式会话等等集成服务；</li>\n<li>SpringBoot 可以离开 SpringCloud 独立使用，开发项目，但 SpringCloud 离不开 SpringBoot，属于依赖关系；</li>\n<li><strong>SpringBoot 专注于快速、方便的开发单个个体微服务，SpringCloud 关注全局的服务治理框架；</strong></li>\n</ul>\n<h3 id=\"33-dubbo-和-springcloud技术选型\"><a class=\"anchor\" href=\"#33-dubbo-和-springcloud技术选型\">#</a> 3.3 Dubbo 和 SpringCloud 技术选型</h3>\n<p><strong>1. 分布式 + 服务治理 Dubbo</strong></p>\n<p>目前成熟的互联网架构，应用服务化拆分 + 消息中间件</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210428205432426.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210428205432426.png\" class=\"\"></p>\n<p><strong>2. Dubbo 和 SpringCloud 对比</strong></p>\n<p>可以看一下社区活跃度：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2R1YmJv\">https://github.com/dubbo</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1jbG91ZA==\">https://github.com/spring-cloud</span></p>\n<p><strong>对比结果：</strong></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Dubbo</th>\n<th>SpringCloud</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>服务注册中心</td>\n<td>Zookeeper</td>\n<td>Spring Cloud Netfilx Eureka</td>\n</tr>\n<tr>\n<td>服务调用方式</td>\n<td>RPC</td>\n<td>REST API</td>\n</tr>\n<tr>\n<td>服务监控</td>\n<td>Dubbo-monitor</td>\n<td>Spring Boot Admin</td>\n</tr>\n<tr>\n<td>断路器</td>\n<td>不完善</td>\n<td>Spring Cloud Netfilx Hystrix</td>\n</tr>\n<tr>\n<td>服务网关</td>\n<td>无</td>\n<td>Spring Cloud Netfilx Zuul</td>\n</tr>\n<tr>\n<td>分布式配置</td>\n<td>无</td>\n<td>Spring Cloud Config</td>\n</tr>\n<tr>\n<td>服务跟踪</td>\n<td>无</td>\n<td>Spring Cloud Sleuth</td>\n</tr>\n<tr>\n<td>消息总栈</td>\n<td>无</td>\n<td>Spring Cloud Bus</td>\n</tr>\n<tr>\n<td>数据流</td>\n<td>无</td>\n<td>Spring Cloud Stream</td>\n</tr>\n<tr>\n<td>批量任务</td>\n<td>无</td>\n<td>Spring Cloud Task</td>\n</tr>\n</tbody>\n</table>\n<p><strong>最大区别：Spring Cloud 抛弃了 Dubbo 的 RPC 通信，采用的是基于 HTTP 的 REST 方式</strong></p>\n<p>严格来说，这两种方式各有优劣。虽然从一定程度上来说，后者牺牲了服务调用的性能，但也避免了上面提到的原生 RPC 带来的问题。而且 REST 相比 RPC 更为灵活，服务提供方和调用方的依赖只依靠一纸契约，不存在代码级别的强依赖，这个优点在当下强调快速演化的微服务环境下，显得更加合适。</p>\n<p><strong>品牌机和组装机的区别</strong></p>\n<p>很明显，Spring Cloud 的功能比 DUBBO 更加强大，涵盖面更广，而且作为 Spring 的拳头项目，它也能够与 SpringFramework、Spring Boot、Spring Data、Spring Batch 等其他 Spring 项目完美融合，这些对于微服务而言是至关重要的。使用 Dubbo 构建的微服务架构就像组装电脑，各环节我们的选择自由度很高，但是最终结果很有可能因为一条内存质量不行就点不亮了，总是让人不怎么放心，但是如果你是一名高手，那这些都不是问题；而 SpringCloud 就像品牌机，在 Spring Source 的整合下，做了大量的兼容性测试，保证了机器拥有更高的稳定性，但是如果要在使用非原装组件外的东西，就需要对其基础有足够的了解。</p>\n<p><strong>社区支持与更新力度的区别</strong></p>\n<p>最为重要的是，DUBBO 停止了 5 年左右的更新，虽然 2017.7 重启了。对于技术发展的新需求，需要由开发者自行拓展升级（比如当当网弄出了 DubboX)，这对于很多想要采用微服务架构的中小软件组织，显然是不太合适的，中小公司没有这么强大的技术能力去修改 Dubbo 源码 + 周边的一整套解决方案，并不是每一个公司都有阿里的大牛 + 真实的线上生产环境测试过。</p>\n<p><strong>设计模式 + 微服务拆分思想：不一定善于表达，软实力</strong></p>\n<p><strong>总结：</strong></p>\n<p><strong>二者解决的问题域不一样：Dubbo 的定位是一款 RPC 框架，而 SpringCloud 的目标是微服务架构下的一站式解决方案。</strong></p>\n<h3 id=\"34-springcloud能干嘛\"><a class=\"anchor\" href=\"#34-springcloud能干嘛\">#</a> 3.4 SpringCloud 能干嘛？</h3>\n<ul>\n<li>Distributed/versioned configuration 分布式 / 版本控制配置</li>\n<li>Service registration and discovery 服务注册与发现</li>\n<li>Routing 路由</li>\n<li>Service-to-service calls 服务到服务的调用</li>\n<li>Load balancing 负载均衡配置</li>\n<li>Circuit Breakers 断路器</li>\n<li>Distributed messaging 分布式消息管理</li>\n<li>…</li>\n</ul>\n<h3 id=\"35-springcloud下载\"><a class=\"anchor\" href=\"#35-springcloud下载\">#</a> 3.5 SpringCloud 下载</h3>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cDovL3Byb2plY3RzLnNwcmluZy5pby9zcHJpbmctY2xvdWQv\">http://projects.spring.io/spring-cloud/</span></p>\n<p>版本号有点特别：</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923154944463.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923154944463.png\" class=\"\"></p>\n<p><strong>spring cloud</strong> 是一个由众多独立子项目组成的大型综合项目，每个子项目有不同的发行节奏，都维护着自己的发布版木号。<strong>spring cloud</strong> 通过一个资源清单 **BOM (Bill of Materials）** 来管理每个版木的子项目清单。为避免与子项目的发布号混淆，所以没有采用版本号的方式，而是通过命名的方式。</p>\n<p>SpringCloud 没有采用数字编号的方式命名版本号，而是采用了伦敦地铁站的名称，<strong>同时根据字母表的顺序来对应版本时间顺序</strong>，比如最早的 Realse 版本：Angel，第二个 Realse 版本：Brixton，然后是 Camden、Dalston、Edgware，目前最新的是 Hoxton SR4 CURRENT GA 通用稳定版。</p>\n<p><strong>自学参考书：</strong></p>\n<ul>\n<li>SpringCloud Netflix 中文文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmdjbG91ZC5jYy9zcHJpbmctY2xvdWQtbmV0ZmxpeC5odG1s\">https://springcloud.cc/spring-cloud-netflix.html</span></li>\n<li>SpringCloud 中文 API 文档 (官方文档翻译版)：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmdjbG91ZC5jYy9zcHJpbmctY2xvdWQtZGFsc3Rvbi5odG1s\">https://springcloud.cc/spring-cloud-dalston.html</span></li>\n<li>SpringCloud 中国社区：<span class=\"exturl\" data-url=\"aHR0cDovL3NwcmluZ2Nsb3VkLmNuLw==\">http://springcloud.cn/</span></li>\n<li>SpringCloud 中文网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmdjbG91ZC5jYw==\">https://springcloud.cc</span></li>\n</ul>\n<h2 id=\"4-springcloud-rest学习环境搭建服务提供者\"><a class=\"anchor\" href=\"#4-springcloud-rest学习环境搭建服务提供者\">#</a> 4. SpringCloud Rest 学习环境搭建：服务提供者</h2>\n<h3 id=\"41-介绍\"><a class=\"anchor\" href=\"#41-介绍\">#</a> 4.1 介绍</h3>\n<ul>\n<li>我们会使用一个 Dept 部门模块做一个微服务通用案例 Consumer 消费者 (Client) 通过 REST 调用 Provider 提供者 (Server) 提供的服务。</li>\n<li>回顾 Spring，SpringMVC，Mybatis 等以往学习的知识。</li>\n<li>Maven 的分包分模块架构复习。</li>\n</ul>\n<pre><code>一个简单的Maven模块结构是这样的：\n\n-- app-parent: 一个父项目(app-parent)聚合了很多子项目(app-util\\app-dao\\app-web...)\n  |-- pom.xml\n  |\n  |-- app-core\n  ||---- pom.xml\n  |\n  |-- app-web\n  ||---- pom.xml\n  ......\n1234567891011\n</code></pre>\n<p>一个父工程带着多个 Moudule 子模块</p>\n<p>MicroServiceCloud 父工程 (Project) 下初次带着 3 个子模块 (Module)</p>\n<ul>\n<li>microservicecloud-api 【封装的整体 entity / 接口 / 公共配置等】</li>\n<li>microservicecloud-consumer-dept-80 【服务消费者】</li>\n<li>microservicecloud-provider-dept-8001 【服务提供者】</li>\n</ul>\n<h3 id=\"42-springcloud版本选择\"><a class=\"anchor\" href=\"#42-springcloud版本选择\">#</a> 4.2 SpringCloud 版本选择</h3>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184946548.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184946548.png\" class=\"\"></p>\n<p><strong>大版本说明</strong></p>\n<table>\n<thead>\n<tr>\n<th>SpringBoot</th>\n<th>SpringCloud</th>\n<th>关系</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.2.x</td>\n<td>Angel 版本 (天使)</td>\n<td>兼容 SpringBoot1.2x</td>\n</tr>\n<tr>\n<td>1.3.x</td>\n<td>Brixton 版本 (布里克斯顿)</td>\n<td>兼容 SpringBoot1.3x，也兼容 SpringBoot1.4x</td>\n</tr>\n<tr>\n<td>1.4.x</td>\n<td>Camden 版本 (卡姆登)</td>\n<td>兼容 SpringBoot1.4x，也兼容 SpringBoot1.5x</td>\n</tr>\n<tr>\n<td>1.5.x</td>\n<td>Dalston 版本 (多尔斯顿)</td>\n<td>兼容 SpringBoot1.5x，不兼容 SpringBoot2.0x</td>\n</tr>\n<tr>\n<td>1.5.x</td>\n<td>Edgware 版本 (埃奇韦尔)</td>\n<td>兼容 SpringBoot1.5x，不兼容 SpringBoot2.0x</td>\n</tr>\n<tr>\n<td>2.0.x</td>\n<td>Finchley 版本 (芬奇利)</td>\n<td>兼容 SpringBoot2.0x，不兼容 SpringBoot1.5x</td>\n</tr>\n<tr>\n<td>2.1.x</td>\n<td>Greenwich 版本 (格林威治)</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><strong>实际开发版本关系</strong></p>\n<table>\n<thead>\n<tr>\n<th>spring-boot-starter-parent</th>\n<th></th>\n<th>spring-cloud-dependencles</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>版本号</strong></td>\n<td><strong>发布日期</strong></td>\n<td><strong>版本号</strong></td>\n<td><strong>发布日期</strong></td>\n</tr>\n<tr>\n<td>1.5.2.RELEASE</td>\n<td>2017-03</td>\n<td>Dalston.RC1</td>\n<td>2017-x</td>\n</tr>\n<tr>\n<td>1.5.9.RELEASE</td>\n<td>2017-11</td>\n<td>Edgware.RELEASE</td>\n<td>2017-11</td>\n</tr>\n<tr>\n<td>1.5.16.RELEASE</td>\n<td>2018-04</td>\n<td>Edgware.SR5</td>\n<td>2018-10</td>\n</tr>\n<tr>\n<td>1.5.20.RELEASE</td>\n<td>2018-09</td>\n<td>Edgware.SR5</td>\n<td>2018-10</td>\n</tr>\n<tr>\n<td>2.0.2.RELEASE</td>\n<td>2018-05</td>\n<td>Fomchiey.BULD-SNAPSHOT</td>\n<td>2018-x</td>\n</tr>\n<tr>\n<td>2.0.6.RELEASE</td>\n<td>2018-10</td>\n<td>Fomchiey-SR2</td>\n<td>2018-10</td>\n</tr>\n<tr>\n<td>2.1.4.RELEASE</td>\n<td>2019-04</td>\n<td>Greenwich.SR1</td>\n<td>2019-03</td>\n</tr>\n</tbody>\n</table>\n<p><strong>使用后两个</strong></p>\n<h3 id=\"43-创建工程\"><a class=\"anchor\" href=\"#43-创建工程\">#</a> 4.3 创建工程</h3>\n<p><strong>1、创建父工程</strong></p>\n<ul>\n<li>新建父工程项目 springcloud，切记<strong> Packageing 是 pom 模式</strong></li>\n<li>主要是定义 POM 文件，将后续各个子模块公用的 jar 包等统一提取出来，类似一个抽象父类</li>\n</ul>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923165201425.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923165201425.png\" class=\"\"></p>\n<ul>\n<li>\n<p><strong>父工程 pom.xml</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>springcloud-provider-dept-8001<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 打包方式 pom--></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>maven.compiler.source</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>maven.compiler.source</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>maven.compiler.target</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>maven.compiler.target</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>junit.version</span><span class=\"token punctuation\">></span></span>4.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>junit.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lombok.version</span><span class=\"token punctuation\">></span></span>1.18.18<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lombok.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>log4j.version</span><span class=\"token punctuation\">></span></span>1.2.17<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>log4j.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">&lt;!--springcloud 的依赖 --></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-dependencies --></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>Greenwich.SR6<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">&lt;!--SpringBoot--></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">&lt;!-- 数据库 --></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>8.0.23<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token comment\">&lt;!-- 数据源 --></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>druid<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token comment\">&lt;!--SpringBoot 启动器 --></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis.spring.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.1.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token comment\">&lt;!-- 日志测试 --></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>ch.qos.logback<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>logback-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>            <span class=\"token comment\">&lt;!--junit--></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;junit.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token comment\">&lt;!--lombok--></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;lombok.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token comment\">&lt;!--log4j--></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;log4j.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>2、创建子模块 springcloud-api</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923165810738.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200923165810738.png\" class=\"\"></p>\n<ul>\n<li>\n<p><strong>pom 配置：</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 当前的 Module 自己需要的依赖，如果父依赖中已经配置了版本，这里就不用写了 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p><strong>数据库的创建</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200924193905223.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200924193905223.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>实体类的编写</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505141519461.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505141519461.png\" class=\"\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>pojo</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoArgsConstructor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span>experimental<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Accessors</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Serializable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* Author: Administrator</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* Date: 2021/5/5 13:10</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* Description: 实体类  orm 类表关系映射</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@Accessors</span><span class=\"token punctuation\">(</span>chain <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 链式写法</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Dept</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">;</span><span class=\"token comment\">// 主键</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dname<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token comment\">// 这个数据存在那个数据库的字段， 微服务， 一个服务对应一个数据库 同一个信息可能存在不同的数据库</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> db_source<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> dname<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dname <span class=\"token operator\">=</span> dname<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  * 链式写法：</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  *   Dept dept = new Dept ();</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  *   dept.setDeptNo (11).setDname ('ssss').setDb_source ('001');</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  * */</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>3、子模块 springcloud-provider-dept-8001 服务的提供者的编写</strong></p>\n<p>​\t<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505141647668.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505141647668.png\" class=\"\"></p>\n<p><strong>pom 配置：</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-provider-dept-8001<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 我们需要拿到实体类，所以要配置 api module--></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">&lt;!--junit--></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 数据库 --></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 数据源 --></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>druid<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 日志门面 --></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>ch.qos.logback<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>logback-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">&lt;!--mybatis-spring-boot-starter--></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis.spring.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis-spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">&lt;!--test--></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token comment\">&lt;!--jetty--></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-jetty<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>application.yml 的配置</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># mybatis 配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">mybatis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">type-aliases-package</span><span class=\"token punctuation\">:</span> com.mao.springcloud.pojo</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">config-location</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mybatis<span class=\"token punctuation\">-</span>config.xml</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">mapper-locations</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mapper/<span class=\"token important\">*.xml</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># spring 的配置</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/db01<span class=\"token punctuation\">?</span>serverTimezone=UTC<span class=\"token important\">&amp;useUnicode=true&amp;characterEncoding=utf-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> root</pre></td></tr></table></figure><p><strong>mybatis-config.xml 的配置</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 开启二级缓存 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cacheEnabled<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>DeptMapper.xml 的编写</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.mao.springcloud.dao.DeptDao<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>addDept<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dept<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        insert into dept (dname,db_source) </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        values (#&#123;dname&#125;,DatABASE());</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dept<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Long<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        select * from dept where deptno = #&#123;deptno&#125;;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queryAll<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dept<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        select * from dept;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>接口 DeptController 的编写</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>pojo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DeptService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PathVariable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PostMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * Date: 2021/5/5 13:57</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * Description: 部门 controller 层</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// 提供 Restful 服务</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DeptService</span> deptService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/add\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> deptService<span class=\"token punctuation\">.</span><span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span>dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/get/&#123;deptno&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> deptService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">return</span> deptService<span class=\"token punctuation\">.</span><span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>整体目录结构</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505142330092.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505142330092.png\" class=\"\"></p>\n<p><strong>4、子模块 springcloud-consumer-dept-80 的编写</strong></p>\n<ul>\n<li>\n<p>pom 依赖编写</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-consumer-dept-80<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 实体类 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr></table></figure></li>\n<li>\n<p>** 将 RestTemplate 注册到 spring 中：**ConfigBean.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * Date: 2021/5/5 14:33</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * Description: 注册 RestTemplate 到容器中</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfigBean</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// @Configuration -- spring applicationContext.xml</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestTemplate</span> <span class=\"token function\">getRestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>DeptConsumerController.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud<span class=\"token punctuation\">.</span>pojo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PathVariable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RequestBody</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RequestMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * Date: 2021/5/5 14:27</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * Description:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumerController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 理解：消费者， 不应该有 service 层</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// RestTemplate ...... 模板有很多的方法供我们直接调用就可以了 注册到容器中</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// （url,Class&lt;T> responseType, 实体：Map&lt;String, ?> uriVariables)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestTemplate</span> restTemplate<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 提供多种便捷访问远程 http 服务的方法，简单的 Restful 服务模板</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> REST_URL_PREFIX <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost:8001\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">//http://localhost:8001/dept/list</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/add\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">postForObject</span><span class=\"token punctuation\">(</span>REST_URL_PREFIX<span class=\"token operator\">+</span><span class=\"token string\">\"/dept/add\"</span><span class=\"token punctuation\">,</span>dept<span class=\"token punctuation\">,</span><span class=\"token keyword\">boolean</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/get/&#123;deptno&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">return</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForObject</span><span class=\"token punctuation\">(</span>REST_URL_PREFIX<span class=\"token operator\">+</span><span class=\"token string\">\"/dept/get/\"</span><span class=\"token operator\">+</span>deptno<span class=\"token punctuation\">,</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">return</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForObject</span><span class=\"token punctuation\">(</span>REST_URL_PREFIX<span class=\"token operator\">+</span><span class=\"token string\">\"/dept/list\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>** 启动服务: **DeptConsumer_80</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * Date: 2021/5/5 14:47</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * Description: 消费者主启动类</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumer_80</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptConsumer_80</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>整体目录结构</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505163517853.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505163517853.png\" class=\"\"></p>\n<blockquote>\n<p>小插曲</p>\n</blockquote>\n<p>在使用 80 端口消费者增加部门时，输入 <code>http://localhost/condumer/dept/add?dname=&quot;游戏部&quot;</code>  虽然返回的是 true，数据库表中也有添加的记录，但是记录显示 dname 为 null，这是因为 <code>DeptConsumerController</code>  中的 <code>&quot;/consumer/dept/add&quot;</code>  接口接受用户输入的 dname 时自动转换成了一个 json 格式的 dept，然后将这个 dept 作为参数调用服务提供者的 <code>&quot;/dept/add&quot;</code>  接口的参数，而此时参数是 json 格式的，服务提供者所需要的参数是 Dept 实体类，所以后端无法将 json 格式的字符串转换为 Dept 实体类实例，就会造成此时的参数 dept 的属性是 null，进而添加到数据库中的数据也为 null。</p>\n<blockquote>\n<p>解决方法</p>\n</blockquote>\n<p>在服务提供者接口参数前面添加 <code>@RequestBody</code>  注解</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505164346778.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505164346778.png\" class=\"\"></p>\n<p>那这就关系到 <code>@RequestBody</code>  注解的用法了，这个注解有什么用呢？</p>\n<blockquote>\n<p>@RequestBody 注解</p>\n</blockquote>\n<p>这个注解是将前端请求的 json 格式的参数转换为相应的 JavaBean 实体类，比如说前端传递</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"lloam\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"password\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"123465\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>，这个时候如果我恰好有一个 JavaBean 实体类 User，那么如果我请求的接口参数编写为</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>此时前端请求的 json 格式的参数就会自动转换为 User 实体类，并将 json 字符串的值赋给 user 对应的属性，需要注意的是传递的 json 参数字符串应该与 user 的属性名相对应，不然也是转换不了的。</p>\n</li>\n</ul>\n<h2 id=\"5-eureka服务注册与发现\"><a class=\"anchor\" href=\"#5-eureka服务注册与发现\">#</a> 5、Eureka 服务注册与发现</h2>\n<h3 id=\"51-什么是eureka\"><a class=\"anchor\" href=\"#51-什么是eureka\">#</a> 5.1 什么是 Eureka</h3>\n<ul>\n<li>Eureka：怎么读</li>\n<li>Netflix 在涉及 Eureka 时，遵循的就是 API 原则.</li>\n<li>Eureka 是 Netflix 的有个子模块，也是核心模块之一。Eureka 是基于 REST 的服务，用于定位服务，以实现云端中间件层服务发现和故障转移，服务注册与发现对于微服务来说是非常重要的，有了服务注册与发现，只需要使用服务的标识符，就可以访问到服务，而不需要修改服务调用的配置文件了，功能类似于 Dubbo 的注册中心，比如 Zookeeper.</li>\n</ul>\n<h3 id=\"52-原理理解\"><a class=\"anchor\" href=\"#52-原理理解\">#</a> 5.2 原理理解</h3>\n<ul>\n<li>\n<p><strong>Eureka 基本的架构</strong></p>\n<ul>\n<li>\n<p>Springcloud 封装了 Netflix 公司开发的 Eureka 模块来实现服务注册与发现 (对比 Zookeeper).</p>\n</li>\n<li>\n<p>Eureka 采用了 C-S 的架构设计，EurekaServer 作为服务注册功能的服务器，他是服务注册中心.</p>\n</li>\n<li>\n<p>而系统中的其他微服务，使用 Eureka 的客户端连接到 EurekaServer 并维持心跳连接。这样系统的维护人员就可以通过 EurekaServer 来监控系统中各个微服务是否正常运行，Springcloud 的一些其他模块 (比如 Zuul) 就可以通过 EurekaServer 来发现系统中的其他微服务，并执行相关的逻辑.</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926091541672.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926091541672.png\" class=\"\"></p>\n</li>\n<li>\n<p>和 Dubbo 架构对比</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926091720464.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926091720464.png\" class=\"\"></p>\n</li>\n<li>\n<p>Eureka 包含两个组件：<strong>Eureka Server</strong> 和 <strong>Eureka Client</strong>.</p>\n</li>\n<li>\n<p>Eureka Server 提供服务注册，各个节点启动后，会在 EurekaServer 中进行注册，这样 Eureka Server 中的服务注册表中将会储存所有可用服务节点的信息，服务节点的信息可以在界面中直观的看到.</p>\n</li>\n<li>\n<p>Eureka Client 是一个 Java 客户端，用于简化 EurekaServer 的交互，客户端同时也具备一个内置的，使用轮询负载算法的负载均衡器。在应用启动后，将会向 EurekaServer 发送心跳 (默认周期为 30 秒) 。如果 Eureka Server 在多个心跳周期内没有接收到某个节点的心跳，EurekaServer 将会从服务注册表中把这个服务节点移除掉 (默认周期为 90s).</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>三大角色</strong></p>\n<ul>\n<li>Eureka Server：提供服务的注册与发现   就跟 zookeeper 一样</li>\n<li>Service Provider：服务生产方，将自身服务注册到 Eureka 中，从而使服务消费方能够找到</li>\n<li>Service Consumer：服务消费方，从 Eureka 中获取注册服务列表，从而找到消费服务</li>\n</ul>\n</li>\n<li>\n<p>目前工程状况</p>\n</li>\n</ul>\n<h3 id=\"53-构建步骤\"><a class=\"anchor\" href=\"#53-构建步骤\">#</a> 5.3 构建步骤</h3>\n<p><strong>1. eureka-server</strong></p>\n<ol>\n<li>\n<p>springcloud-eureka-7001 模块建立</p>\n</li>\n<li>\n<p>pom.xml 配置</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-eureka-7001<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 导包 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka-server<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.6.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Eureka 配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> localhost <span class=\"token comment\"># Eureka 服务端的实例名称</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 表示是否向 Eureka 注册中心注册自己</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">fetch-registry</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># fetch-registry 如果为 false，则表示自己为注册中心</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 与 Eureka 注册中心交互的地址，就是监控页面</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">&#123;</span>eureka.instance.hostname<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">&#123;</span>server.port<span class=\"token punctuation\">&#125;</span>/eureka/</pre></td></tr></table></figure><p>源码中 Eureka 的默认端口以及访问路径:</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184244614.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184244614.png\" class=\"\"></p>\n</li>\n<li>\n<p>主启动类 EurekaServer_7001.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>springcloud</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>eureka<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableEurekaServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * Date: 2021/5/5 18:03</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * Description: Eureka 主启动类</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaServer</span>  <span class=\"token comment\">// EnableEurekaServer 服务端的启动类，可以接受别人注册进来</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EurekaServer_7001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EurekaServer_7001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>启动成功后访问 <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo3MDAxLw==\">http://localhost:7001/</span> 得到以下页面</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184405312.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505184405312.png\" class=\"\"></p>\n</li>\n</ol>\n<p><strong>2. eureka-client</strong></p>\n<ul>\n<li>\n<p><strong>调整之前创建的 springlouc-provider-dept-8081</strong></p>\n<ul>\n<li>\n<p><strong>导入 Eureca 依赖</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>application.yml 中新增 Eureca 配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Eureka 的配置，服务注册到哪里</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>7001/eureka/</pre></td></tr></table></figure></li>\n<li>\n<p>为主启动类添加 @EnableEurekaClient 注解</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span> <span class=\"token comment\">// 在启动之后会自己注册到 Eureka 中</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptProvider_8001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptProvider_8001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>先启动 7001 服务端后启动 8001 客户端进行测试，然后访问监控页 http://localhost:7001/ 产看结果如图，成功</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926120411242.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200926120411242.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>修改 Eureka 上的默认描述信息</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Eureka 的配置，服务注册到哪里</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>7001/eureka/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept<span class=\"token punctuation\">-</span><span class=\"token number\">8001</span> <span class=\"token comment\">#修改 Eureka 上的默认描述信息</span></pre></td></tr></table></figure><p><strong>结果如图：</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194607682.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194607682.png\" class=\"\"></p>\n<p><strong>等 30s 后 监控会开启保护机制</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194756538.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194756538.png\" class=\"\"></p>\n</li>\n<li>\n<p><strong>配置关于服务加载的监控信息</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194844920.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505194844920.png\" class=\"\"></p>\n<p><strong>pom.xml 中添加依赖</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--actuator 完善监控信息 --></span>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>application.yml 中添加配置</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># info 配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">info</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">app.name</span><span class=\"token punctuation\">:</span> lloam<span class=\"token punctuation\">-</span>springcloud <span class=\"token comment\"># 项目的名称</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">company.name</span><span class=\"token punctuation\">:</span> blog.lloam.com <span class=\"token comment\"># 公司的名称</span></pre></td></tr></table></figure><p><strong>刷新页面，点击</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505195027132.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505195027132.png\" class=\"\"></p>\n</li>\n</ul>\n<p><strong>3. EureKa 自我保护机制：好死不如赖活着</strong></p>\n<p>一句话总结就是：<strong>某时刻某一个微服务不可用，eureka 不会立即清理，依旧会对该微服务的信息进行保存！</strong></p>\n<ul>\n<li>默认情况下，当 eureka server 在一定时间内没有收到实例的心跳，便会把该实例从注册表中删除（<strong>默认是 90 秒</strong>），但是，如果短时间内丢失大量的实例心跳，便会触发 eureka server 的自我保护机制，比如在开发测试时，需要频繁地重启微服务实例，但是我们很少会把 eureka server 一起重启（因为在开发过程中不会修改 eureka 注册中心），<strong>当一分钟内收到的心跳数大量减少时，会触发该保护机制</strong>。可以在 eureka 管理界面看到 Renews threshold 和 Renews (last min)，当后者（Eureka Server 最后 1 分钟收到客户端实例续约的总数）小于前者（Eureka Server 期望每分钟收到客户端实例续约的总数）的时候，触发保护机制，会出现红色的警告：**EMERGENCY!EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY’RE NOT.RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEGING EXPIRED JUST TO BE SAFE.** 从警告中可以看到，eureka 认为虽然收不到实例的心跳，但它认为实例还是健康的，eureka 会保护这些实例，不会把它们从注册表中删掉。</li>\n<li>该保护机制的目的是避免网络连接故障，在发生网络故障时，微服务和注册中心之间无法正常通信，但服务本身是健康的，不应该注销该服务，如果 eureka 因网络故障而把微服务误删了，那即使网络恢复了，该微服务也不会重新注册到 eureka server 了，因为只有在微服务启动的时候才会发起注册请求，后面只会发送心跳和服务列表请求，这样的话，该实例虽然是运行着，但永远不会被其它服务所感知。所以，eureka server 在短时间内丢失过多的客户端心跳时，会进入自我保护模式，该模式下，eureka 会保护注册表中的信息，不在注销任何微服务，当网络故障恢复后，eureka 会自动退出保护模式。自我保护模式可以让集群更加健壮。</li>\n<li>但是我们在开发测试阶段，需要频繁地重启发布，如果触发了保护机制，则旧的服务实例没有被删除，这时请求有可能跑到旧的实例中，而该实例已经关闭了，这就导致请求错误，影响开发测试。所以，在开发测试阶段，我们可以把自我保护模式关闭，只需在 eureka server 配置文件中加上如下配置即可：<strong>eureka.server.enable-self-preservation=false</strong>·</li>\n</ul>\n<p><strong>4. 注册进来的微服务，获取一些消息（团队开发会用到）</strong></p>\n<ul>\n<li>\n<p>启动类添加注解 <code>@EnableDiscoveryClient</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Date: 2021/5/5 14:05</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * Description: 主启动类</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span> <span class=\"token comment\">// 在启动之后会自己注册到 Eureka 中</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@EnableDiscoveryClient</span> <span class=\"token comment\">// 开启服务发现</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptProvider_8001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptProvider_8001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>DeptController.java 新增方法</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 获取一些配置的信息，得到具体的微服务！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">DiscoveryClient</span> client<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 注册进来的微服务，可以通过服务发现获取一些消息 通过服务端调用某一个请求拿到对应的消息</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/discovery\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">discovery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 获取微服务列表的清单</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> services <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getServices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"discovery=>services:\"</span> <span class=\"token operator\">+</span> services<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 得到一个具体的微服务信息，通过具体的 service ID，applicationName</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ServiceInstance</span><span class=\"token punctuation\">></span></span> instances <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getInstances</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SPRINGCLOUD-PROVIDER-DEPT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServiceInstance</span> instance <span class=\"token operator\">:</span> instances<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    instance<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    instance<span class=\"token punctuation\">.</span><span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    instance<span class=\"token punctuation\">.</span><span class=\"token function\">getUri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    instance<span class=\"token punctuation\">.</span><span class=\"token function\">getServiceId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> client<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>结果</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213525888.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213525888.png\" class=\"\"></p>\n</li>\n</ul>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213556478.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213556478.png\" class=\"\"></p>\n<h3 id=\"54-eureka集群环境配置\"><a class=\"anchor\" href=\"#54-eureka集群环境配置\">#</a> 5.4 Eureka：集群环境配置</h3>\n<p><strong>1. 初始化</strong></p>\n<ul>\n<li>\n<p>新建 springcloud-eureka-7002、springcloud-eureka-7003 模块</p>\n</li>\n<li>\n<p>为 pom.xml 添加依赖 (与 springcloud-eureka-7001 相同)</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 导包 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka-server<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.6.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>application.yml 配置 (与 springcloud-eureka-7001 相同)</p>\n<p>端口号分别换成 7002 和 7003</p>\n</li>\n<li>\n<p>主启动类 (与 springcloud-eureka-7001 相同)</p>\n</li>\n</ul>\n<p><strong>2. 集群成员相互关联</strong></p>\n<ul>\n<li>\n<p>配置一些自定义本机名字，找到本机 hosts 文件并打开</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200927163816917.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200927163816917.png\" class=\"\"></p>\n</li>\n<li>\n<p>在 hosts 文件最后加上，要访问的本机名称，默认是 localhost</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200927163907513.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20200927163907513.png\" class=\"\"></p>\n</li>\n<li>\n<p>修改 application.yml 的配置，如图为 springcloud-eureka-7001 配置，springcloud-eureka-7002/springcloud-eureka-7003 同样分别修改为其对应的名称即可</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213912290.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505213912290.png\" class=\"\"></p>\n</li>\n<li>\n<p>在集群中使 springcloud-eureka-7001 关联 springcloud-eureka-7002、springcloud-eureka-7003</p>\n<p>以 7001 为例：完整的 springcloud-eureka-7001 下的 application.yml 如下</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Eureka 配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> eureka7001.com <span class=\"token comment\"># Eureka 服务端的实例名称</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 表示是否向 Eureka 注册中心注册自己</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">fetch-registry</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># fetch-registry 如果为 false，则表示自己为注册中心</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 与 Eureka 注册中心交互的地址，就是监控页面</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">#重写 Eureka 的默认端口以及访问路径 --->http://localhost:7001/eureka/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\"># 单机： defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\"># 集群（关联）： defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr></table></figure></li>\n<li>\n<p>通过 springcloud-provider-dept-8001 下的 yml 配置文件，修改<strong> Eureka 配置：配置服务注册中心地址</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Eureka 的配置，服务注册到哪里</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept<span class=\"token punctuation\">-</span><span class=\"token number\">8001</span>  <span class=\"token comment\"># 修改 Eureka 上的默认描述信息</span></pre></td></tr></table></figure></li>\n<li>\n<p>这样模拟集群就搭建号了，就可以把一个项目挂载到三个服务器上了</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505214205808.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210505214205808.png\" class=\"\"></p>\n</li>\n</ul>\n<h3 id=\"55-对比和zookeeper区别\"><a class=\"anchor\" href=\"#55-对比和zookeeper区别\">#</a> 5.5 对比和 Zookeeper 区别</h3>\n<p><strong>1. 回顾 CAP 原则</strong></p>\n<ul>\n<li>\n<p>RDBMS (MySQL\\Oracle\\sqlServer) ===&gt; ACID</p>\n</li>\n<li>\n<p>NoSQL (Redis\\MongoDB) ===&gt; CAP</p>\n</li>\n</ul>\n<p><strong>2. ACID 是什么？</strong></p>\n<ul>\n<li>A (Atomicity) 原子性</li>\n<li>C (Consistency) 一致性</li>\n<li>I (Isolation) 隔离性</li>\n<li>D (Durability) 持久性</li>\n</ul>\n<p><strong>3. CAP 是什么？</strong></p>\n<blockquote>\n<p>C (Consistency) 强一致性</p>\n</blockquote>\n<p>在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlODglODYlRTUlQjglODMlRTUlQkMlOEYlRTclQjMlQkIlRTclQkIlOUYvNDkwNTMzNg==\">分布式系统</span>中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）</p>\n<blockquote>\n<p>A (Availability) 可用性</p>\n</blockquote>\n<p>保证每个请求不管成功或者失败都有响应。</p>\n<blockquote>\n<p>P (Partition tolerance) 分区容错性</p>\n</blockquote>\n<p>系统中任意信息的丢失或失败不会影响系统的继续运作。</p>\n<p>CAP 的三进二：CA、AP、CP</p>\n<p><strong>4.<mark>CAP 理论的核心</mark></strong></p>\n<ul>\n<li>一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求</li>\n<li>根据 CAP 原理，将 NoSQL 数据库分成了满足 CA 原则，满足 CP 原则和满足 AP 原则三大类\n<ul>\n<li>CA：单点集群，满足一致性，可用性的系统，通常可扩展性较差</li>\n<li>CP：满足一致性，分区容错的系统，通常性能不是特别高</li>\n<li>AP：满足可用性，分区容错的系统，通常可能对一致性要求低一些</li>\n</ul>\n</li>\n</ul>\n<p><strong>5. 作为分布式服务注册中心，Eureka 比 Zookeeper 好在哪里？</strong></p>\n<p>著名的 CAP 理论指出，一个分布式系统不可能同时满足 C (一致性) 、A (可用性) 、P (容错性)，由于分区容错性 P 再分布式系统中是必须要保证的，因此我们只能再 A 和 C 之间进行权衡。</p>\n<ul>\n<li>Zookeeper 保证的是 CP</li>\n<li>Eureka 保证的是 AP</li>\n</ul>\n<p>一般来说<mark>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接收服务直接 down 掉不可用。也就是说，<strong>服务注册功能对可用性的要求要高于一致性</strong>。</mark></p>\n<p><strong>Zookeeper 保证的是 CP</strong></p>\n<p>但 zookeeper 会出现这样一种情况，当 master 节点因为网络故障与其他节点失去联系时，剩余节点会重新进行 leader 选举。问题在于，选举 leader 的时间太长，30-120s，且选举期间整个 zookeeper 集群是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因为网络问题使得 zookeeper 集群失去 master 节点是较大概率发生的事件，虽然服务最终能够恢复，但是，漫长的选举时间导致注册长期不可用，是不可容忍的。</p>\n<p><strong>Eureka 保证的是 AP</strong></p>\n<p>Eureka 看明白了这一点，因此在设计时就优先保证可用性。<strong>Eureka 各个节点都是平等的</strong>，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而 Eureka 的客户端在向某个 Eureka 注册时，如果发现连接失败，则会自动切换至其他节点，只要有一台 Eureka 还在，就能保住注册服务的可用性，只不过查到的信息可能不是最新的，除此之外，Eureka 还有之中自我保护机制，如果在 15 分钟内超过 85% 的节点都没有正常的心跳，那么 Eureka 就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：</p>\n<ul>\n<li>Eureka 不在从注册列表中移除因为长时间没收到心跳而应该过期的服务</li>\n<li>Eureka 仍然能够接受新服务的注册和查询请求，但是不会被同步到其他节点上 (即保证当前节点依然可用)</li>\n<li>当网络稳定时，当前实例新的注册信息会被同步到其他节点中</li>\n</ul>\n<p><mark>因此，Eureka 可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像 zookeeper 那样使整个注册服务瘫痪</mark></p>\n<h2 id=\"6-ribbon负载均衡基于客户端\"><a class=\"anchor\" href=\"#6-ribbon负载均衡基于客户端\">#</a> 6. Ribbon：负载均衡 (基于客户端)</h2>\n<h3 id=\"61-负载均衡以及ribbon\"><a class=\"anchor\" href=\"#61-负载均衡以及ribbon\">#</a> 6.1 负载均衡以及 Ribbon</h3>\n<p><strong>Ribbon 是什么？</strong></p>\n<ul>\n<li>Spring Cloud Ribbon 是基于 Netflix Ribbon 实现的一套<strong>客户端负载均衡的工具</strong>。</li>\n<li>简单的说，Ribbon 是 Netflix 发布的开源项目，主要功能是提供客户端的软件负载均衡算法，将 Netflix 的中间层服务连接在一起。Ribbon 的客户端组件提供一系列完整的配置项，如：连接超时、重试等。简单的说，就是在配置文件中列出 LoadBalancer (简称 LB：负载均衡) 后面所有的及其，Ribbon 会自动的帮助你基于某种规则 (如简单轮询，随机连接等等) 去连接这些机器。我们也容易使用 Ribbon 实现自定义的负载均衡算法！</li>\n<li>面试造飞机，工作拧螺丝</li>\n</ul>\n<p><strong>Ribbon 能干嘛？</strong></p>\n<ul>\n<li>LB，即负载均衡 (LoadBalancer) ，在微服务或分布式集群中经常用的一种应用。</li>\n<li>负载均衡简单的说就是<strong>将用户的请求平摊的分配到多个服务上，从而达到系统的 HA (高用)。</strong></li>\n<li>常见的负载均衡软件有 Nginx、Lvs 等等。</li>\n<li>Dubbo、SpringCloud 中均给我们提供了负载均衡，<strong>SpringCloud 的负载均衡算法可以自定义</strong>。</li>\n<li>负载均衡简单分类：\n<ul>\n<li>集中式 LB\n<ul>\n<li>即在服务的提供方和消费方之间使用独立的 LB 设施，如 Nginx，由该设施负责把访问请求通过某种策略转发至服务的提供方！</li>\n</ul>\n</li>\n<li>进程式 LB\n<ul>\n<li>将 LB 逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选出一个合适的服务器。</li>\n<li>&lt;font color=red&gt;Ribbon 就属于进程内 LB&lt;/font&gt;，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址！</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"62-集成ribbon\"><a class=\"anchor\" href=\"#62-集成ribbon\">#</a> 6.2 集成 Ribbon</h3>\n<ul>\n<li>\n<p><strong>springcloud-consumer-dept-80</strong> 向 pom.xml 中添加 Ribbon 和 Eureka 依赖，这里 Ribbon 我使用 netflix-ribbon</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--Ribbon--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-ribbon<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.6.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">&lt;!--eureka--></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>在 application.yml 文件中配置 Eureka</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Eureka 配置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 不想 Eureka 中注册自己</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\"># 从哪个地方拿</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr></table></figure></li>\n<li>\n<p>主启动类加上 @EnableEurekaClient 注解，开启 Eureka</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Ribbon 和 Eureka 整合以后，客户端可以直接调用，不用 IP 地址和端口号</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumer_80</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptConsumer_80</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>自定义 Spring 配置类：ConfigBean.java 配置负载均衡实现 RestTemplate，只需一个注解搞定 Ribbon 实现负载均衡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfigBean</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// @Configuration -- spring applicationContext.xml</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 配置负载均衡 实现 RestTemplate</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@LoadBalanced</span> <span class=\"token comment\">// Ribbon 实现负载均衡</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestTemplate</span> <span class=\"token function\">getRestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>在 DeptConsumerController 中之前是将获取服务的地址写死了，我们应该用一个变量来访问服务提供者，通过服务名来访问</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestTemplate</span> restTemplate<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 提供多种便捷访问远程 http 服务的方法，简单的 Restful 服务模板</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// Ribbon , 我们这里的地址，应该是一个变量，通过服务名来访问</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//    private static final String REST_URL_PREFIX = \"http://localhost:8001\";</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> REST_URL_PREFIX <span class=\"token operator\">=</span> <span class=\"token string\">\"http://SPRINGCLOUD-PROVIDER-DEPT\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">//http://localhost:8001/dept/list</span></pre></td></tr></table></figure><p><code>我们通过集群仍然能够访问到服务</code></p>\n</li>\n</ul>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506221557204.png\" alt=\"\" /><img class=\"-20210506221557204.png\"></p>\n<p>​\t<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506221707950.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506221707950.png\" class=\"\"></p>\n<h3 id=\"63-使用ribbon实现负载均衡\"><a class=\"anchor\" href=\"#63-使用ribbon实现负载均衡\">#</a> 6.3 使用 Ribbon 实现负载均衡</h3>\n<p><strong>1. 实现负载均衡</strong></p>\n<ul>\n<li>\n<p>流程图：</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506221811781.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506221811781.png\" class=\"\"></p>\n</li>\n<li>\n<p>创建 db02 和 db03 数据库 (一样的)</p>\n<pre><code class=\"language-mysql\">CREATE DATABASE /*!32312 IF NOT EXISTS*/`db02` /*!40100 DEFAULT CHARACTER SET utf8 */ /*!80016 DEFAULT ENCRYPTION='N' */;\n\nUSE `db02`;\n\n/*Table structure for table `dept` */\n\nDROP TABLE IF EXISTS `dept`;\n\nCREATE TABLE `dept` (\n  `deptno` BIGINT NOT NULL AUTO_INCREMENT,\n  `dname` VARCHAR(60) DEFAULT NULL,\n  `db_source` VARCHAR(60) DEFAULT NULL,\n  PRIMARY KEY (`deptno`)\n) ENGINE=INNODB DEFAULT CHARSET=utf8 COMMENT='部门表';\n\n/*Data for the table `dept` */\n\nINSERT  INTO `dept`(`deptno`,`dname`,`db_source`) VALUES (1,'开发部','db01'),(2,'人事部','db01'),(3,'财务部','db01'),(4,'市场部','db01'),(5,'运维部','db01');\n\nINSERT INTO db01.dept (dname, db_source) VALUES('开发部',DATABASE());\nINSERT INTO db01.dept (dname, db_source) VALUES('人事部',DATABASE());\nINSERT INTO db01.dept (dname, db_source) VALUES('财务部',DATABASE());\nINSERT INTO db01.dept (dname, db_source) VALUES('市场部',DATABASE());\nINSERT INTO db01.dept (dname, db_source) VALUES('运维部',DATABASE());\nSELECT * FROM dept;\n</code></pre>\n</li>\n<li>\n<p>新建两个服务提供者 Moudle：springcloud-provider-dept-8002、springcloud-provider-dept-8003</p>\n</li>\n<li>\n<p>参照 springcloud-provider-dept-8001 依次为另外两个 Moudle 添加 pom.xml 依赖 、resourece 下的 mybatis 和 application.yml 配置，Java 代码</p>\n<p><mark>三个服务（<span class=\"exturl\" data-url=\"aHR0cDovL3NwcmluZy5hcHBsaWNhdGlvbi5uYW1l\">spring.application.name</span>）的名称必须一致，本质就是三个服务连接的数据库分别是 db01,db02,db03</mark></p>\n</li>\n<li>\n<p>启动所有服务测试 (根据自身电脑配置决定启动服务的个数)，访问 http://eureka7001.com:7001 / 查看结果</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222114631.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222114631.png\" class=\"\"></p>\n</li>\n<li>\n<p>测试访问 http://localhost/consumer/dept/list 这时候随机访问的是服务提供者，可能是 8001，也可能是 8002，8003、</p>\n<p>此时是 8002</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222237427.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222237427.png\" class=\"\"></p>\n</li>\n<li>\n<p>再次访问 http://localhost/consumer/dept/list 这时候随机的是服务提供者 8003</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222315286.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222315286.png\" class=\"\"></p>\n</li>\n<li>\n<p>再次访问 http://localhost/consumer/dept/list 这时候随机的是服务提供者 8001</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222344137.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210506222344137.png\" class=\"\"></p>\n</li>\n</ul>\n<p>以上这种<strong>每次访问 http://localhost/consumer/dept/list 随机访问集群中某个服务提供者，这种情况叫做轮询</strong>，轮询算法在 SpringCloud 中可以自定义。</p>\n<p><strong>2. 如何切换或者自定义规则呢？</strong></p>\n<ul>\n<li>\n<p>在 springcloud-provider-dept-80 模块下的 ConfigBean 中进行配置，切换使用不同的规则</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfigBean</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//@Configuration -- spring  applicationContext.xml</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * IRule:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * RoundRobinRule 轮询</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     * RandomRule 随机</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * AvailabilityFilteringRule ： 会先过滤掉，跳闸，访问故障的服务～，对剩下的进行轮询～</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * RetryRule ： 会先按照轮询获取服务～，如果服务获取失败，则会在指定的时间内进行，重试</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@LoadBalanced</span> <span class=\"token comment\">// 配置负载均衡实现 RestTemplate</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestTemplate</span> <span class=\"token function\">getRestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">IRule</span> <span class=\"token function\">myRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RandomRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 使用随机规则</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>也可以自定义规则，在 myRule 包下自定义一个配置类 MyRule.java，注意：<strong>&lt;font color=red&gt; 该包不要和主启动类同级，要跟主启动类所在包同级 &lt;/font&gt;</strong>：<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507210206544.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507210206544.png\" class=\"\"></p>\n</li>\n<li>\n<p>MyRule.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyRule</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">IRule</span> <span class=\"token function\">myRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyRandomRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 默认是轮循，现在我们自定义</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>主启动类开启负载均衡并指定自定义的 MyRule 配置类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Ribbon 和 Eureka 整合以后，客户端可以直接调用，不用 IP 地址和端口号</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 在微服务启动的时候就能去加载我们自定义 Ribbon 类</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token annotation punctuation\">@RibbonClient</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"SPRINGCLOUD-PROVIDER-DEPT\"</span><span class=\"token punctuation\">,</span>configuration <span class=\"token operator\">=</span> <span class=\"token class-name\">LloamRule</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 开启负载均衡，并指定自定义的规则</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumer_80</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptConsumer_80</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>自定义的规则 (这里我们参考 Ribbon 中默认的规则代码自己稍微改动)：MyRandomRule.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Copyright 2013 Netflix, Inc.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * Licensed under the Apache License, Version 2.0 (the \"License\");</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * you may not use this file except in compliance with the License.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * You may obtain a copy of the License at</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * http://www.apache.org/licenses/LICENSE-2.0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * Unless required by applicable law or agreed to in writing, software</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * distributed under the License is distributed on an \"AS IS\" BASIS,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * See the License for the specific language governing permissions and</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * limitations under the License.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>mao<span class=\"token punctuation\">.</span>myRule</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IClientConfig</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>loadbalancer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractLoadBalancerRule</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>loadbalancer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ILoadBalancer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>loadbalancer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Server</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadLocalRandom</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LloamRandomRule</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractLoadBalancerRule</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">/* 自定义算法 */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// 每个服务，访问 5 次，访问完 5 次，换下一个服务（假设服务有 3 个）</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// 每个服务的访问次数，total = 0，默认为 0，如果 = 5，则指向下一个服务节点</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 当前提供的服务下标，currentIndex = 0，默认 0，如果 total = 5，则 total 重置为 0，index+1，</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> total <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 被调用的次数</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> currentIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前是谁在提供服务</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token comment\">// @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = \"RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE\")</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Server</span> <span class=\"token function\">choose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ILoadBalancer</span> lb<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lb <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token class-name\">Server</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>server <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Server</span><span class=\"token punctuation\">></span></span> upList <span class=\"token operator\">=</span> lb<span class=\"token punctuation\">.</span><span class=\"token function\">getReachableServers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取还活着的服务</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Server</span><span class=\"token punctuation\">></span></span> allList <span class=\"token operator\">=</span> lb<span class=\"token punctuation\">.</span><span class=\"token function\">getAllServers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取全部的服务</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">int</span> serverCount <span class=\"token operator\">=</span> allList<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>serverCount <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">//            int index = chooseRandomInt (serverCount); // 生成区间随机数</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//            server = upList.get (index); // 从活着的服务中随机获取一个</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token comment\">// ============================== 自定义算法 ================================</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>total <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                server <span class=\"token operator\">=</span> upList<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>currentIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                total<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                total <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                currentIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>currentIndex <span class=\"token operator\">>=</span> upList<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    currentIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                server <span class=\"token operator\">=</span> upList<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>currentIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 从活着的服务中心，获取指定的服务来进行操作</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                total<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>server <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token keyword\">return</span> server<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token comment\">// ========================================================================</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> <span class=\"token function\">chooseRandomInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> serverCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ThreadLocalRandom</span><span class=\"token punctuation\">.</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span>serverCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Server</span> <span class=\"token function\">choose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">choose</span><span class=\"token punctuation\">(</span><span class=\"token function\">getLoadBalancer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initWithNiwsConfig</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IClientConfig</span> clientConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token comment\">// TODO Auto-generated method stub</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"7feign负载均衡基于服务端\"><a class=\"anchor\" href=\"#7feign负载均衡基于服务端\">#</a> 7.Feign：负载均衡 (基于服务端)</h2>\n<h3 id=\"71-feign简介\"><a class=\"anchor\" href=\"#71-feign简介\">#</a> 7.1 Feign 简介</h3>\n<p>Feign 是声明式 Web Service 客户端，它让微服务之间的调用变得更简单，类似 controller 调用 service。SpringCloud 集成了 Ribbon 和 Eureka，可以使用 Feigin 提供负载均衡的 http 客户端</p>\n<p><strong>只需要创建一个接口，然后添加注解即可～</strong></p>\n<p>Feign，主要是社区版，大家都习惯面向接口编程。这个是很多开发人员的规范。调用微服务访问两种方法</p>\n<ol>\n<li>微服务名字 【ribbon】</li>\n<li>接口和注解 【feign】</li>\n</ol>\n<p><strong>Feign 能干什么？</strong></p>\n<ul>\n<li>Feign 旨在使编写 Java Http 客户端变得更容易</li>\n<li>前面在使用 Ribbon + RestTemplate 时，利用 RestTemplate 对 Http 请求的封装处理，形成了一套模板化的调用方法。但是在实际开发中，由于对服务依赖的调用可能不止一处，往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一个客户端类来包装这些依赖服务的调用。所以，Feign 在此基础上做了进一步的封装，由他来帮助我们定义和实现依赖服务接口的定义，&lt;font color=red&gt; 在 Feign 的实现下，我们只需要创建一个接口并使用注解的方式来配置它 (类似以前 Dao 接口上标注 Mapper 注解，现在是一个微服务接口上面标注一个 Feign 注解即可 &lt;/font&gt;)，即可完成对服务提供方的接口绑定，简化了使用 Spring Cloud Ribbon 时，自动封装服务调用客户端的开发量。</li>\n</ul>\n<p><strong>Feign 默认集成了 Ribbon</strong></p>\n<ul>\n<li>利用 Ribbon 维护了 MicroServiceCloud-Dept 的服务列表信息，并且通过轮询实现了客户端的负载均衡，而与 Ribbon 不同的是，通过 Feign 只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务调用。</li>\n</ul>\n<h3 id=\"72-feign的使用步骤\"><a class=\"anchor\" href=\"#72-feign的使用步骤\">#</a> 7.2 Feign 的使用步骤</h3>\n<ol>\n<li>\n<p>改造 springcloud-api 模块</p>\n<p>pom.xml 添加 feign 依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-feign<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>新建 service 层，并新建 DeptClientService.java 接口，</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// @FeignClient ：为服务客户端注解，value：指定为服务的名字，这样就可以使 Feign 客户端直接找到对应的微服务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"SPRINGCLOUD-PROVIDER-DEPT\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">DeptClientService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/get/&#123;deptno&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/add\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>创建 springcloud-consumer-dept-feign 模块</p>\n<p>拷贝 springcloud-consumer-dept-80 模块下的 pom.xml，resource，以及 java 代码到 springcloud-consumer-feign 模块，并添加 feign 依赖。</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-feign<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>通过 Feign 实现 DeptConsumerController.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumerController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 理解：消费者， 不应该有 service 层</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// RestTemplate ...... 模板有很多的方法供我们直接调用就可以了 注册到容器中</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// （url,Class&lt;T> responseType, 实体：Map&lt;String, ?> uriVariables)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//    @Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//    private RestTemplate restTemplate; // 提供多种便捷访问远程 http 服务的方法，简单的 Restful 服务模板</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 这里使用 feign，注入 api 中的客户端接口 DeptClientService</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DeptClientService</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/add\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span>dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/get/&#123;deptno&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/consumer/dept/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>主配置类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span> <span class=\"token comment\">// 开启 Eureka 客户端</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@EnableFeignClients</span><span class=\"token punctuation\">(</span>basePackages <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"com.mao.springcloud\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FeignDeptConsumer_80</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FeignDeptConsumer_80</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>结果</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507223456397.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507223456397.png\" class=\"\"></p>\n</li>\n</ol>\n<h3 id=\"73-feign和ribbon如何选择\"><a class=\"anchor\" href=\"#73-feign和ribbon如何选择\">#</a> 7.3 Feign 和 Ribbon 如何选择？</h3>\n<p><strong>根据个人习惯而定，如果喜欢 REST 风格使用 Ribbon；如果喜欢社区版的面向接口风格使用 Feign.</strong></p>\n<h2 id=\"8-hystrix服务熔断\"><a class=\"anchor\" href=\"#8-hystrix服务熔断\">#</a> 8. Hystrix：服务熔断</h2>\n<p><strong>分布式系统面临的问题</strong></p>\n<p>复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免失败！</p>\n<h3 id=\"81-服务雪崩\"><a class=\"anchor\" href=\"#81-服务雪崩\">#</a> 8.1 服务雪崩</h3>\n<p>多个微服务之间调用的时候，假设微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其他的微服务，这就是所谓的 “扇出”，如果扇出的链路上<strong>某个微服务的调用响应时间过长，或者不可用</strong>，对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的 “雪崩效应”。</p>\n<p>对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几十秒内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障，这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。</p>\n<p><strong>我们需要，弃车保帅</strong></p>\n<h3 id=\"82-什么是hystrix\"><a class=\"anchor\" href=\"#82-什么是hystrix\">#</a> 8.2 什么是 Hystrix？</h3>\n<p>Hystrix 是一个应用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时，异常等，Hystrix 能够保证在一个依赖出问题的情况下，不会导致整个体系服务失败，避免级联故障，以提高分布式系统的弹性。</p>\n<p>“断路器” 本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控 (类似熔断保险丝) ，<strong>向调用方返回一个服务预期的，可处理的备选响应 (FallBack) ，而不是长时间的等待或者抛出调用方法无法处理的异常，这样就可以保证了服务调用方的线程不会被长时间，不必要的占用</strong>，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</p>\n<h3 id=\"83-hystrix能干嘛\"><a class=\"anchor\" href=\"#83-hystrix能干嘛\">#</a> 8.3 Hystrix 能干嘛？</h3>\n<ul>\n<li>服务降级</li>\n<li>服务熔断</li>\n<li>服务限流</li>\n<li>接近实时的监控</li>\n<li>…</li>\n</ul>\n<p>当一切正常时，请求流可以如下所示：</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/11.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/11.png\" class=\"\"></p>\n<p>当许多后端系统中有一个服务发生故障时，它可以阻止整个用户请求：</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/1.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/1.png\" class=\"\"></p>\n<p>随着大容量通信量的增加，单个后端依赖项的潜在性会导致所有服务器上的所有资源在几秒钟内饱和。</p>\n<p>应用程序中通过网络或客户端库可能导致网络请求的每个点都是潜在故障的来源。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，从而备份队列、线程和其他系统资源，从而导致更多跨系统的级联故障。</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/2.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/2.png\" class=\"\"></p>\n<p>当使用 hystrix 包装每个基础依赖项时，上面的图表中所示的体系结构会发生类似于以下关系图的变化。每个依赖项是相互隔离的，限制在延迟发生时它可以填充的资源中，并包含在回退逻辑中，该逻辑决定在依赖项中发生任何类型的故障时要做出什么样的响应：</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002155904957.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002155904957.png\" class=\"\"></p>\n<p><a href=\"https://github.com/Netflix/Hystrix/wiki\"><strong>官网资料</strong></a>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05ldGZsaXgvSHlzdHJpeC93aWtpJUVGJUJDJThDJUU1JTlCJUJFJUU3JTg5JTg3JUU1JThBJUEwJUU4JUJEJUJEJUU0JUI4JThEJUU1JTg3JUJBJUU2JTlEJUE1JUU4JUFGJUI3JUU3JTlDJThCJUU1JThGJUE2JUU0JUI4JTgwJUU3JUFGJTg3JUU2JTk2JTg3JUU3JUFCJUEw\">https://github.com/Netflix/Hystrix/wiki，图片加载不出来请看另一篇文章</span>   <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDYzNTE5OC9hcnRpY2xlL2RldGFpbHMvMTA4OTAyNjcx\">github 加载图片失败问题</span></p>\n<h3 id=\"84-服务熔断\"><a class=\"anchor\" href=\"#84-服务熔断\">#</a> 8.4、服务熔断</h3>\n<h4 id=\"841-什么是服务熔断\"><a class=\"anchor\" href=\"#841-什么是服务熔断\">#</a> <strong>8.4.1、什么是服务熔断</strong></h4>\n<p>熔断机制是对应雪崩效应的一种微服务链路保护机制。</p>\n<p>在微服务架构中，微服务之间的数据交互通过远程调用完成，微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其它的微服务，此时如果链路上某个微服务的调用响应时间过长或者不可用，那么对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，导致 “雪崩效应”。</p>\n<p>服务熔断是应对雪崩效应的一种微服务链路保护机制。例如在高压电路中，如果某个地方的电压过高，熔断器就会熔断，对电路进行保护。同样，在微服务架构中，熔断机制也是起着类似的作用。当调用链路的某个微服务不可用或者响应时间太长时，会进行服务熔断，不再有该节点微服务的调用，快速返回错误的响应信息。当检测到该节点微服务调用响应正常后，恢复调用链路。</p>\n<p>当扇出链路的某个微服务不可用或者响应时间太长时，会进行服务的降级，<strong>进而熔断该节点微服务的调用，快速返回错误的响应信息</strong>。检测到该节点微服务调用响应正常后恢复调用链路。在 SpringCloud 框架里熔断机制通过 Hystrix 实现。Hystrix 会监控微服务间调用的状况，当失败的调用到一定阀值缺省是 5 秒内 20 次调用失败，就会启动熔断机制。熔断机制的注解是：<strong>&lt;font color=red&gt;@HystrixCommand&lt;/font&gt;</strong> 。</p>\n<p>服务熔断解决如下问题：</p>\n<ul>\n<li>当所依赖的对象不稳定时，能够起到快速失败的目的</li>\n<li>快速失败后，能够根据一定的算法动态试探所依赖对象是否恢复</li>\n</ul>\n<h4 id=\"842-入门案例\"><a class=\"anchor\" href=\"#842-入门案例\">#</a> 8.4.2、入门案例</h4>\n<p>新建 springcloud-provider-dept-hystrix-8001 模块并拷贝 springcloud-provider-dept–8001 内的 pom.xml、resource 和 Java 代码进行初始化并调整。</p>\n<p><strong>导入 hystrix 依赖</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-hystrix<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>调整 yml 配置文件</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Eureka 的配置，服务注册到哪里</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept<span class=\"token punctuation\">-</span><span class=\"token number\">8001</span>  <span class=\"token comment\"># 修改 Eureka 上的默认描述信息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">prefer-ip-address</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># 可以显示服务的 IP 地址</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># info 配置</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">info</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">app.name</span><span class=\"token punctuation\">:</span> lloam<span class=\"token punctuation\">-</span>springcloud <span class=\"token comment\"># 项目的名称</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">company.name</span><span class=\"token punctuation\">:</span> blog.lloam.com <span class=\"token comment\"># 公司的名称</span></pre></td></tr></table></figure><p>prefer-ip-address: false：显示 localhost</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507235337602.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507235337602.png\" class=\"\"></p>\n<p>prefer-ip-address: true：显示服务的 IP 地址</p>\n<p><img data-src=\"../../../A-git_tmp/springcloud/%E7%AC%94%E8%AE%B0/springcloud.assets/image-20210507235400650.png\" alt=\"image-20210507235400650\" /></p>\n<p><strong>修改 controller</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 提供 Restful 服务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DeptService</span> deptService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/get/&#123;deptno&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@HystrixCommand</span><span class=\"token punctuation\">(</span>fallbackMethod <span class=\"token operator\">=</span> <span class=\"token string\">\"hystrixGet\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Dept</span> dept <span class=\"token operator\">=</span> deptService<span class=\"token punctuation\">.</span><span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>dept <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id=>\"</span> <span class=\"token operator\">+</span> deptno <span class=\"token operator\">+</span> <span class=\"token string\">\",不存在该用户，或者信息无法找到\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> dept<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 备选方法</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">hystrixGet</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deptno\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setDeptno</span><span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setDname</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id=>\"</span><span class=\"token operator\">+</span>deptno<span class=\"token operator\">+</span><span class=\"token string\">\"没有对应的信息，null--@Hystrix\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setDb_source</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no this database in MySQL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>为主启动类添加对熔断的支持注解 @EnableCircuitBreaker</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Date: 2021/5/5 14:05</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * Description: 主启动类</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span> <span class=\"token comment\">// 在启动之后会自己注册到 Eureka 中</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@EnableDiscoveryClient</span> <span class=\"token comment\">// 开启服务发现</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 添加对熔断的支持</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@EnableCircuitBreaker</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptProviderHystrix_8001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptProviderHystrix_8001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>测试</strong>：</p>\n<p>使用熔断后，当访问一个存在的 id 时，前台页展示数据如下</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234555489.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234555489.png\" class=\"\"></p>\n<p>使用熔断后，当访问一个不存在的 id 时，前台页展示数据如下</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234721069.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234721069.png\" class=\"\"></p>\n<p>而不适用熔断的 springcloud-provider-dept–8001 模块访问相同地址会出现下面状况，抛出异常，出现错误页面</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234759395.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210507234759395.png\" class=\"\"></p>\n<p>因此，<strong>为了避免因某个微服务后台出现异常或错误而导致整个应用或网页报错，使用熔断是必要的</strong></p>\n<h3 id=\"85-服务降级\"><a class=\"anchor\" href=\"#85-服务降级\">#</a> 8.5 服务降级</h3>\n<h4 id=\"什么是服务降级\"><a class=\"anchor\" href=\"#什么是服务降级\">#</a> 什么是服务降级</h4>\n<p>​         服务降级是指 当服务器压力剧增的情况下，根据实际业务情况及流量，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心业务正常运作或高效运作。说白了，就是尽可能的把系统资源让给优先级高的服务。<br />\n  资源有限，而请求是无限的。如果在并发高峰期，不做服务降级处理，一方面肯定会影响整体服务的性能，严重的话可能会导致宕机某些重要的服务不可用。所以，一般在高峰期，为了保证核心功能服务的可用性，都要对某些服务降级处理。比如当双 11 活动时，把交易无关的服务统统降级，如查看蚂蚁森林，查看历史订单等等。</p>\n<p>服务降级主要用于什么场景呢？当整个微服务架构整体的负载超出了预设的上限阈值或即将到来的流量预计将会超过预设的阈值时，为了保证重要或基本的服务能正常运行，可以将一些 不重要 或 不紧急 的服务或任务进行服务的 延迟使用 或 暂停使用。<br />\n  降级的方式可以根据业务来，可以延迟服务，比如延迟给用户增加积分，只是放到一个缓存中，等服务平稳之后再执行 ；或者在粒度范围内关闭服务，比如关闭相关文章的推荐。</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002182707872.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002182707872.png\" class=\"\"></p>\n<p>由上图可得，<strong>当某一时间内服务 A 的访问量暴增，而 B 和 C 的访问量较少，为了缓解 A 服务的压力，这时候需要 B 和 C 暂时关闭一些服务功能，留下更多的资源内存给 A 服务，叫做服务降级</strong>。</p>\n<h4 id=\"服务降级需要考虑的问题\"><a class=\"anchor\" href=\"#服务降级需要考虑的问题\">#</a> 服务降级需要考虑的问题</h4>\n<ul>\n<li>1）哪些服务是核心服务，哪些服务是非核心服务</li>\n<li>2）哪些服务可以支持降级，哪些服务不能支持降级，降级策略是什么</li>\n<li>3）除服务降级之外是否存在更复杂的业务放通场景，策略是什么？</li>\n</ul>\n<h4 id=\"自动降级分类\"><a class=\"anchor\" href=\"#自动降级分类\">#</a> 自动降级分类</h4>\n<p>1）超时降级：主要配置好超时时间和超时重试次数和机制，并使用异步机制探测回复情况</p>\n<p>2）失败次数降级：主要是一些不稳定的 api，当失败调用次数达到一定阀值自动降级，同样要使用异步机制探测回复情况</p>\n<p>3）故障降级：比如要调用的远程服务挂掉了（网络故障、DNS 故障、http 服务返回错误的状态码、rpc 服务抛出异常），则可以直接降级。降级后的处理方案有：默认值（比如库存服务挂了，返回默认现货）、兜底数据（比如广告挂了，返回提前准备好的一些静态页面）、缓存（之前暂存的一些缓存数据）</p>\n<p>4）限流降级：秒杀或者抢购一些限购商品时，此时可能会因为访问量太大而导致系统崩溃，此时会使用限流来进行限制访问量，当达到限流阀值，后续请求会被降级；降级后的处理方案可以是：排队页面（将用户导流到排队页面等一会重试）、无货（直接告知用户没货了）、错误页（如活动太火爆了，稍后重试）。</p>\n<h4 id=\"入门案例\"><a class=\"anchor\" href=\"#入门案例\">#</a> 入门案例</h4>\n<p>在 springcloud-api 模块下的 service 包中新建降级回调工厂 DeptClientServiceFallBackFactory.java</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 降级</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptClientServiceFallbackFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FallbackFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DeptClientService</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeptClientService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dept</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> deptno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setDeptno</span><span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">setDname</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id=>\"</span><span class=\"token operator\">+</span>deptno<span class=\"token operator\">+</span><span class=\"token string\">\"，没有对应的信息，客户端提供了降级的信息，这个服务现在已经被关闭\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                        <span class=\"token punctuation\">.</span><span class=\"token function\">setDb_source</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no this database in MySQL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在 DeptClientService 中指定降级配置类 DeptClientServiceFallBackFactory</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//@FeignClient: 微服务客户端注解，value: 指定微服务的名字，这样就可以使 Feign 客户端直接找到对应的微服务</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@FeignClient</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"SPRINGCLOUD-PROVIDER-DEPT\"</span><span class=\"token punctuation\">,</span>fallbackFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">DeptClientServiceFallBackFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">DeptClientService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/get/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">Dept</span> <span class=\"token function\">queryById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/list\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dept</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">queryAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dept/add\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">addDept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dept</span> dept<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在 springcloud-consumer-dept-feign（也就是消费者）模块中开启降级</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 开启降级 feign.hystrix</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">feign</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">hystrix</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><p><strong>测试</strong></p>\n<p>正常访问</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508115557087.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508115557087.png\" class=\"\"></p>\n<p>关掉服务 DeptProvider_8001 继续访问</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508115611641.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508115611641.png\" class=\"\"></p>\n<h3 id=\"86-服务熔断和降级的区别\"><a class=\"anchor\" href=\"#86-服务熔断和降级的区别\">#</a> 8.6 服务熔断和降级的区别</h3>\n<ul>\n<li><strong>服务熔断 —&gt; 服务端</strong>：某个服务超时或异常，引起熔断～，类似于保险丝 (自我熔断)</li>\n<li><strong>服务降级 —&gt; 客户端</strong>：从整体网站请求负载考虑，当某个服务熔断或者关闭之后，服务将不再被调用，此时在客户端，我们可以准备一个 FallBackFactory ，返回一个默认的值 (缺省值)。会导致整体的服务下降，但是好歹能用，比直接挂掉强。</li>\n<li>触发原因不太一样，服务熔断一般是某个服务（下游服务）故障引起，而服务降级一般是从整体负荷考虑；管理目标的层次不太一样，熔断其实是一个框架级的处理，每个微服务都需要（无层级之分），而降级一般需要对业务有层级之分（比如降级一般是从最外围服务开始）</li>\n<li>实现方式不太一样，服务降级具有代码侵入性 (由控制器完成 / 或自动降级)，熔断一般称为<strong>自我熔断</strong>。</li>\n</ul>\n<p>限流：限制并发的请求访问量，超过阈值则拒绝；<br />\n降级：服务分优先级，牺牲非核心服务（不可用），保证核心服务稳定；从整体负荷考虑；<br />\n熔断：依赖的下游服务故障触发熔断，避免引发本系统崩溃；系统自动执行和恢复</p>\n<h3 id=\"87-dashboard-流监控\"><a class=\"anchor\" href=\"#87-dashboard-流监控\">#</a> 8.7 Dashboard 流监控</h3>\n<p>新建 springcloud-consumer-hystrix-dashboard 模块</p>\n<p>** 添加依赖 ** 其实就是添加了 <code>spring-cloud-starter-hystrix</code> , <code>spring-cloud-starter-hystrix-dashboard</code>  依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 实体类 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!--hystrix--></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-hystrix<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-hystrix-dashboard<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">&lt;!--Ribbon--></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-ribbon<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.6.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">&lt;!--eureka--></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>主启动类</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableHystrixDashboard</span> <span class=\"token comment\">// 开启监控</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptConsumerDashboard_9001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptConsumerDashboard_9001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>启动应用程序，访问：localhost:9001/hystrix</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132120887.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132120887.png\" class=\"\"></p>\n<p><strong>服务端 8001 是否有监控应用程依赖，没有添加</strong>，这里要开启的服务需要具有熔断服务的提供者，不然监控不到</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--actuator 完善监控信息 --></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>给 springcloud-provider-dept-hystrix-8001 模块下的主启动类添加如下代码，添加监控</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 启动类 @SpringBootApplication@EnableEurekaClient // 在服务启动后自动注册到 Eureka 中 @EnableDiscoveryClient // 服务发现～@EnableCircuitBreaker// 添加对熔断的支持 public class DeptProviderHystrix_8081 &#123;public static void main (String [] args) &#123;        SpringApplication.run (DeptProviderHystrix_8081.class,args);    &#125;    // 增加一个 Servlet    @Bean    public ServletRegistrationBean hystrixMetricsStreamServlet ()&#123;        ServletRegistrationBean registrationBean = new ServletRegistrationBean (new HystrixMetricsStreamServlet ());        // 访问该页面就是监控页面        registrationBean.addUrlMappings (\"/actuator/hystrix.stream\");        return registrationBean;    &#125;&#125;</span></pre></td></tr></table></figure><p><strong>&lt;font color=red&gt; 注意：先访问 localhost:8001/dept/get/1，在访问 localhost:8081/actuator/hystrix.stream，不然会一直 ping，没有数据 &lt;/font&gt;</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132505226.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132505226.png\" class=\"\"></p>\n<p>在 springcloud-consumer-hystrix-dashboard 中的 yml 中添加配置（&lt;font color=red&gt; 刚开始没加，一直报这个错: Unable to connect to Command Metric Stream&lt;/font&gt;）</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">hystrix</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">proxy-stream-allow-list</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span></pre></td></tr></table></figure><p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132545037.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132545037.png\" class=\"\"></p>\n<p>运行结果：（注意心跳和圆的大小变化）</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132643868.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132643868.png\" class=\"\"></p>\n<p><strong>如何看运行结果</strong></p>\n<ul>\n<li>\n<p>七色</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205557442.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205557442.png\" class=\"\"></p>\n<p>绿色：成功数</p>\n<p>蓝色：熔断数</p>\n<p>浅绿色：错误请求数</p>\n<p>黄色：超时数</p>\n<p>紫色：线程池拒绝数</p>\n<p>红色：失败 / 异常数</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132807927.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508132807927.png\" class=\"\"></p>\n<p>Hosts：服务请求频率</p>\n<p>Circuit Closed：断路状态</p>\n</li>\n<li>\n<p>一圈<br />\n实心圆：公有两种含义，他通过颜色的变化代表了实例的健康程度<br />\n它的健康程度从绿色 &lt; 黄色 &lt; 橙色 &lt; 红色  <strong>递减</strong><br />\n该实心圆除了颜色的变化之外，它的大小也会根据实例的请求流量发生变化，流量越大，该实心圆就<br />\n越大，所以通过该实心圆的展示，就可以在大量的实例中快速发现<strong>故障实例和高压力实例</strong>。<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205822580.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205822580.png\" class=\"\"><br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205857949.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002205857949.png\" class=\"\"></p>\n</li>\n<li>\n<p>一线<br />\n曲线：用来记录 2 分钟内流量的相对变化，可以通过它来观察到流量的上升和下降趋势！<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002210211989.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201002210211989.png\" class=\"\"></p>\n</li>\n</ul>\n<h2 id=\"9-zull路由网关\"><a class=\"anchor\" href=\"#9-zull路由网关\">#</a> 9. Zull 路由网关</h2>\n<h3 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h3>\n<p><strong>什么是 zuul?</strong></p>\n<p>Zull 包含了对请求的<strong>路由</strong> (用来跳转的) 和<strong>过滤</strong>两个最主要功能：</p>\n<p>其中<strong>路由功能负责将外部请求转发到具体的微服务实例上，是实现外部访问统一入口的基础</strong>，而过<strong>滤器功能则负责对请求的处理过程进行干预，是实现请求校验，服务聚合等功能的基础</strong>。Zuul 和 Eureka 进行整合，将 Zuul 自身注册为 Eureka 服务治理下的应用，同时从 Eureka 中获得其他服务的消息，也即以后的访问微服务都是通过 Zuul 跳转后获得。</p>\n<p>&lt;font color=red&gt; 注意：Zuul 服务最终还是会注册进 Eureka&lt;/font&gt;</p>\n<p>提供：代理 + 路由 + 过滤 三大功能！</p>\n<p><strong>Zuul 能干嘛？</strong></p>\n<ul>\n<li>路由</li>\n<li>过滤</li>\n</ul>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05ldGZsaXgvenV1bC8=\">https://github.com/Netflix/zuul/</span></p>\n<h3 id=\"入门案例-2\"><a class=\"anchor\" href=\"#入门案例-2\">#</a> 入门案例</h3>\n<p><strong>新建 springcloud-zuul 模块，并导入依赖</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 实体类 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">&lt;!--zuul--></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-zuul --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-zuul<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">&lt;!--hystrix--></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-hystrix<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-hystrix-dashboard<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">&lt;!--eureka--></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-eureka<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.4.7.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mao<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">&lt;!-- 热部署工具 --></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">9527spring</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud-zuuleureka</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span><span class=\"token key atrule\">http://eureka7003.com:7003/eureka/  instance</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">zuul9527.com    prefer-ip-address</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">trueinfo</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">app.name</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud  company.name</span><span class=\"token punctuation\">:</span> blog.lloamstudy.com</pre></td></tr></table></figure><p>启动如下图三个服务（先去 host 文件里面添加 www.lloamstudy.com 的服务）</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160127902.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160127902.png\" class=\"\"></p>\n<p>访问 http://localhost:8001/dept/get/1 和 http://www.lloamstudy.com:9527/springcloud-provider-dept/dept/get/1 都可以获得数据</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160156461.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160156461.png\" class=\"\"></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160229497.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160229497.png\" class=\"\"></p>\n<p>隐藏微服务 springcloud-provider-dept 的名称在地址栏，application.yml 中添加配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">zuul</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">mydept.serviceId</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">mydept.path</span><span class=\"token punctuation\">:</span> /mydept/<span class=\"token important\">**</span></pre></td></tr></table></figure><p>访问这个地址即可 http://www.kuangstudy.com:9527/mydept/dept/get/2</p>\n<p>但是原路径 http://www.kuangstudy.com:9527/springcloud-provider-dept/dept/get2 也能访问</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160406933.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160406933.png\" class=\"\"></p>\n<p>继续配置 application.yml, 原来的 http://www.kuangstudy.com:9527/springcloud-provider-dept/dept/get/1 不能访问了</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">zuul</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">mydept.serviceId</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud-provider-dept    mydept.path</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">/mydept/**  ignored-services</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>  <span class=\"token comment\"># 不能再使用某个 (*：全部) 路径访问了，ignored ： 忽略，隐藏全部的～</span></pre></td></tr></table></figure><p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003105303720.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003105303720.png\" class=\"\"></p>\n<p>继续想 application 添加公共的访问前缀，访问路径变为 http://www.kuangstudy.com:9527/kuang/mydept/dept/get/2</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">zuul</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">mydept.serviceId</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud-provider-dept    mydept.path</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">/mydept/**  ignored-services</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>  <span class=\"token comment\"># 不能再使用某个 (*：全部) 路径访问了，ignored ： 忽略，隐藏全部的～prefix: /mao  # 设置公共的前缀，实现隐藏原有路由</span></pre></td></tr></table></figure><p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160526645.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160526645.png\" class=\"\"></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160545633.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508160545633.png\" class=\"\"></p>\n<h2 id=\"10-spring-cloud-config-分布式配置\"><a class=\"anchor\" href=\"#10-spring-cloud-config-分布式配置\">#</a> 10. Spring Cloud Config 分布式配置</h2>\n<h3 id=\"概述-2\"><a class=\"anchor\" href=\"#概述-2\">#</a> 概述</h3>\n<p><strong>分布式系统面临的–配置文件问题</strong></p>\n<p>微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务，由于每个服务都需要必要的配置信息才能运行，所以一套集中式的，动态的配置管理设施是必不可少的。spring cloud 提供了 configServer 来解决这个问题，我们每一个微服务自己带着一个 application.yml，那上百个的配置文件修改起来，令人头疼！</p>\n<p><strong>什么是 SpringCloud config 分布式配置中心？</strong></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003110343457.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003110343457.png\" class=\"\"></p>\n<p>spring cloud config 为微服务架构中的微服务提供集中化的外部支持，配置服务器为各个不同微服务应用的所有环节提供了一个<strong>中心化的外部配置</strong>。</p>\n<p>spring cloud config 分为<strong>服务端</strong>和<strong>客户端</strong>两部分。</p>\n<p>服务端也称为 <strong>分布式配置中心</strong>，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密，解密信息等访问接口。</p>\n<p>客户端则是<strong>通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息</strong>。配置服务器默认采用 git 来存储配置信息，这样就有助于对环境配置进行版本管理。并且可用通过 git 客户端工具来方便的管理和访问配置内容。</p>\n<p><strong>spring cloud config 分布式配置中心能干嘛？</strong></p>\n<ul>\n<li>集中式管理配置文件</li>\n<li>不同环境，不同配置，动态化的配置更新，分环境部署，比如 /dev/test /prod/beta /release</li>\n<li>运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息</li>\n<li>当配置发生变动时，服务不需要重启，即可感知到配置的变化，并应用新的配置</li>\n<li>将配置信息以 REST 接口的形式暴露</li>\n</ul>\n<p><strong>spring cloud config 分布式配置中心与 Git 整合</strong></p>\n<p>由于 spring cloud config 默认使用 git 来存储配置文件 (也有其他方式，比如自持 SVN 和本地文件)，但是最推荐的还是 git ，而且使用的是 http /https 访问的形式。</p>\n<h3 id=\"入门案例-3\"><a class=\"anchor\" href=\"#入门案例-3\">#</a> 入门案例</h3>\n<h4 id=\"服务端\"><a class=\"anchor\" href=\"#服务端\">#</a> <strong>服务端</strong></h4>\n<p>编写 application.yml 提交到 github 上或者码云上面（&lt;font color=red&gt; 注意：--- 和空格的输入，否则之后访问不到 &lt;/font&gt;）</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>dev</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> test</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>test</pre></td></tr></table></figure><p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508163341999.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508163341999.png\" class=\"\"></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508163404038.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508163404038.png\" class=\"\"></p>\n<p>新建 springcloud-config-server-3344 模块导入 pom.xml 依赖，<mark>这里试了 2.2.2 以上的版本都用不了，不晓得哪里版本不兼容了</mark></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span>        <span class=\"token comment\">&lt;!--config--></span>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-config-server --></span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-config-server<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.1.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>        <span class=\"token comment\">&lt;!--web--></span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>resource 下创建 application.yml 配置文件，Spring Cloud Config 服务器从 git 存储库（必须提供）为远程客户端提供配置：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3344</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\"># 连接远程仓库</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">git</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//gitee.com/lloamhh/springcloud<span class=\"token punctuation\">-</span>config.git <span class=\"token comment\"># https, 不是 git</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\"># 通过 config-server 可以连接到 git；访问其中的资源以及配置</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 不加这个配置会报 Cannot execute request on any known server 这个错：连接 Eureka 服务端地址不对</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 或者直接注释掉 eureka 依赖 这里暂时用不到 eureka</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">fetch-registry</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr></table></figure><p>&lt;font color=red&gt; 注意：default-label 属性，默认是 master 提交，我改成 main 提交之后页面死活出不来 &lt;/font&gt;</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003141429024.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003141429024.png\" class=\"\"></p>\n<p>可以输入 <code>git status</code>  查看自己的分支</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003142733336.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20201003142733336.png\" class=\"\"></p>\n<p>访问：<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDozMzQ0L2FwcGxpY2F0aW9uLWRldi55bWwlRTklQTElQjUlRTklOUQlQTI=\">http://localhost:3344/application-dev.yml 页面</span></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508174120606.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508174120606.png\" class=\"\"></p>\n<p>访问：<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDozMzQ0L2FwcGxpY2F0aW9uLXRlc3QueW1sJUU5JUExJUI1JUU5JTlEJUEy\">http://localhost:3344/application-test.yml 页面</span></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508174144795.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508174144795.png\" class=\"\"></p>\n<p><strong>HTTP 服务具有以下格式的资源：</strong>（默认为 master）</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token punctuation\">&#123;</span>application<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">/</span><span class=\"token punctuation\">&#123;</span>profile<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">[</span><span class=\"token operator\">/</span><span class=\"token punctuation\">&#123;</span>label<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span>   \t\t<span class=\"token comment\">//\thttp://localhost:3344/application/test/master/&#123;application&#125;-&#123;profile&#125;.yml\t\t\t\t//\thttp://localhost:3344/application-test.yml/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.yml\t\t//\thttp://localhost:3344/master/application-test.yml/&#123;application&#125;-&#123;profile&#125;.properties/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.properties</span></pre></td></tr></table></figure><h4 id=\"客户端\"><a class=\"anchor\" href=\"#客户端\">#</a> <strong>客户端</strong></h4>\n<p>将本地 git 仓库 springcloud-config 文件夹下新建的 config-client.yml 提交到 github 或码云仓库：（<mark>千万别加注释，否则路径找不到</mark>）</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">dev---server</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">8201spring</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">dev  application</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud-provider-depteureka</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span><span class=\"token key atrule\">http://eureka7003.com:7003/eureka/ ---server</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">8202spring</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">test  application</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token key atrule\">springcloud-provider-depteureka</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr></table></figure><p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508185345283.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508185345283.png\" class=\"\"></p>\n<p>新建一个 springcloud-config-client-3355 模块，并导入依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-config --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.1.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">&lt;!--actuator 完善监控信息 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">&lt;!--web--></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>resources 下创建 application.yml 和 bootstrap.yml 配置文件</p>\n<ul>\n<li>\n<p>bootstrap.yml 是系统级别的配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 系统级别的配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token comment\"># 这里我们从自己写的 config-server 服务端去获取配置</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">3344</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">-</span>client <span class=\"token comment\"># 需要从 git 上读取的资源名称，不需要后缀</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">profile</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure></li>\n<li>\n<p>application.yml 是用户级别的配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 用户级别的配置 spring:  application:    name: springcloud-config-client-3355</span></pre></td></tr></table></figure></li>\n</ul>\n<p>创建 controller 包下的 ConfigClientController.java 用于测试</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestControllerpublic</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfigClientController</span> <span class=\"token punctuation\">&#123;</span>        <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;spring.application.name&#125;\"</span><span class=\"token punctuation\">)</span>        <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> applicationName<span class=\"token punctuation\">;</span><span class=\"token comment\">// 获取为服务的名称        @Value (\"$&#123;eureka.client.service-url.defaultZone&#125;\")        private String eurekaServer;// 获取 Eureka 服务        @Value (\"$&#123;server.port&#125;\")        private String port;// 获取服务端的端口号        @RequestMapping (\"/config\")        public String getConfig () &#123;            return \"applicationName:\" + applicationName +                    \"eurekaServer:\" + eurekaServer +                    \"port:\" + port;        &#125;&#125;</span></pre></td></tr></table></figure><p>主启动类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplicationpublic</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ConfigClient_3355</span> <span class=\"token punctuation\">&#123;</span>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigClient_3355</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>测试：</p>\n<p>启动服务端 Config_server_3344 再启动客户端 ConfigClient</p>\n<p>访问：<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MjAxL2NvbmZpZyVFRiVCQyU4QyVFOCVCRiU5OSVFOSU4NyU4QyVFNSU5QiVBMCVFNCVCOCVCQSVFNiU4OCU5MSVFNCVCQiVBQyVFNyU5QSU4NCVFOCVCRiU5QyVFNyVBOCU4QiVFNSVCQSU5MyVFNyU5QSU4NGNvbmZpZy1DbGllbnQlRTQlQjglQUQlRTclOUElODREZXYlRTclOEUlQUYlRTUlQTIlODMlRTclOUElODQlRTclQUIlQUYlRTUlOEYlQTMlRTUlOEYlQjclRTYlOTclQjY4MjAxJUVGJUJDJThDJUU4JTgwJThDJUU0JUI4JTk0Ym9vdHN0cmFwLnltbCVFOSU4NSU4RCVFNyVCRCVBRSVFNyU5QSU4NGNvbmZpZyVFNyU5QSU4NCVFNyU4RSVBRiVFNSVBMiU4MyVFNCVCOSU5RiVFNiU5OCVBRmRldiVFRiVCQyU4QyVFNiU4OSU4MCVFNCVCQiVBNSVFNyU5QiVCOCVFNSVCRCU5MyVFNCVCQSU4RSVFNSVBRSVBMiVFNiU4OCVCNyVFNyVBQiVBRiVFNyU5QSU4NCVFNyVBQiVBRiVFNSU4RiVBMyVFNSU4RiVCNyVFNiU5NyVCNjgyMDE=\">http://localhost:8201/config，这里因为我们的远程库的 config-Client 中的 Dev 环境的端口号时 8201，而且 bootstrap.yml 配置的 config 的环境也是 dev，所以相当于客户端的端口号时 8201</span></p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508185556013.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508185556013.png\" class=\"\"></p>\n<h3 id=\"小案例\"><a class=\"anchor\" href=\"#小案例\">#</a> <strong>小案例</strong></h3>\n<p><strong>本地新建 config-dept.yml 和 config-eureka.yml 并提交到码云仓库</strong></p>\n<ul>\n<li>\n<p>config-dept.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8001</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">mybatis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">type-aliases-package</span><span class=\"token punctuation\">:</span> com.mao.springcloud.pojo</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">config-location</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mybatis<span class=\"token punctuation\">-</span>config.xml</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">mapper-locations</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mapper/<span class=\"token important\">*.xml</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>dept</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/db01<span class=\"token punctuation\">?</span>serverTimezone=UTC<span class=\"token important\">&amp;useUnicode=true&amp;characterEncoding=utf-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept<span class=\"token punctuation\">-</span><span class=\"token number\">8001</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">prefer-ip-address</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key atrule\">info</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token key atrule\">app.name</span><span class=\"token punctuation\">:</span> lloam<span class=\"token punctuation\">-</span>springcloud</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token key atrule\">company.name</span><span class=\"token punctuation\">:</span> blog.lloam.com</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8001</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token key atrule\">mybatis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token key atrule\">type-aliases-package</span><span class=\"token punctuation\">:</span> com.mao.springcloud.pojo</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token key atrule\">config-location</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mybatis<span class=\"token punctuation\">-</span>config.xml</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token key atrule\">mapper-locations</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>mybatis/mapper/<span class=\"token important\">*.xml</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> test</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>dept</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mysql<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/db02<span class=\"token punctuation\">?</span>serverTimezone=UTC<span class=\"token important\">&amp;useUnicode=true&amp;characterEncoding=utf-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7001.com<span class=\"token punctuation\">:</span>7001/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token key atrule\">instance-id</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>provider<span class=\"token punctuation\">-</span>dept<span class=\"token punctuation\">-</span><span class=\"token number\">8001</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token key atrule\">prefer-ip-address</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token key atrule\">info</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token key atrule\">app.name</span><span class=\"token punctuation\">:</span> lloam<span class=\"token punctuation\">-</span>springcloud</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token key atrule\">company.name</span><span class=\"token punctuation\">:</span> blog.lloam.com</pre></td></tr></table></figure></li>\n<li>\n<p>config-eureka.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">active</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7001</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>eureka</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> eureka7001.com</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">fetch-registry</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7001</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token key atrule\">profiles</span><span class=\"token punctuation\">:</span> test</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>eureka</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> eureka7001.com</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">register-with-eureka</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">fetch-registry</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//eureka7002.com<span class=\"token punctuation\">:</span>7002/eureka/<span class=\"token punctuation\">,</span>http<span class=\"token punctuation\">:</span>//eureka7003.com<span class=\"token punctuation\">:</span>7003/eureka/</pre></td></tr></table></figure></li>\n<li>\n<p>上传成功<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508204846462.png\" alt=\"\" /> <img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508204846462.png\" class=\"\"></p>\n</li>\n</ul>\n<p><strong>新建 springcloud-config-eureka-7001 模块，并将原来的 springcloud-eureka-7001 模块下的内容拷贝的该模块。</strong></p>\n<ul>\n<li>\n<p>清空该模块的 application.yml 配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> springcloud<span class=\"token punctuation\">-</span>config<span class=\"token punctuation\">-</span>eureka<span class=\"token punctuation\">-</span><span class=\"token number\">7001</span></pre></td></tr></table></figure></li>\n<li>\n<p>并新建 bootstrap.yml 连接远程配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\"># 本地客户端指向 3344 这个服务器，从这个服务器拿到我们的 Eureka 配置文件</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">-</span>eureka</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> master</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">profile</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">3344</span></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>在 pom.xml 中添加 spring cloud config 依赖</strong></p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--config--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.1.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>主启动类</strong>，不需要加 <code>@ConfigServer</code> ，服务端才要</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaServer</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EurekaServer_7001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EurekaServer_7001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>测试</strong></p>\n<ul>\n<li>启动 Config_Server_3344，并访问 http://localhost:3344/master/config-eureka-dev.yml 测试<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205215584.png\" alt=\"\" /> <img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205215584.png\" class=\"\"></li>\n<li>启动 ConfigEurekaServer_7001，访问 <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo3MDAxLw==\">http://localhost:7001/</span> 测试<br />\n<img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205302328.png\" alt=\"\" /> <img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205302328.png\" class=\"\"></li>\n<li>显示上图则成功</li>\n</ul>\n<p>新建 springcloud-config-dept-8001 模块并拷贝 springcloud-provider-dept-8001 的内容</p>\n<p>同理导入 spring cloud config 依赖、清空 application.yml 、新建 bootstrap.yml 连接远程配置文件并配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">-</span>dept</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">profile</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> master</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">3344</span></pre></td></tr></table></figure><p>主启动类</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * Author: Administrator</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Date: 2021/5/5 14:05</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * Description: 主启动类</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token annotation punctuation\">@EnableEurekaClient</span> <span class=\"token comment\">// 在启动之后会自己注册到 Eureka 中</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@EnableDiscoveryClient</span> <span class=\"token comment\">// 开启服务发现</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeptProvider_8001</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DeptProvider_8001</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>启动并访问 http://eureka7001.com:7001/，显示已经将 provider 注册到 Eureka 中</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205501350.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205501350.png\" class=\"\"></p>\n<p>访问 http://localhost:8001/dept/get/1，成功</p>\n<p><img data-src=\"SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205556569.png\" alt=\"\" /><img data-src=\"/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/image-20210508205556569.png\" class=\"\"></p>\n<p>只需更改 git 远程即可实现部署</p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "SpringCloud",
                "SpringCloud"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/ElasticSearch%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/",
            "url": "https://xinyao_idiot.gitee.io/zxy/ElasticSearch%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/",
            "title": "ElasticSearch初步学习",
            "date_published": "2021-06-22T11:10:00.000Z",
            "content_html": "",
            "tags": [
                "计算机学习",
                "后端",
                "ElasticSearch",
                "ElasticSearch"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/",
            "url": "https://xinyao_idiot.gitee.io/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/",
            "title": "springboot笔记心得",
            "date_published": "2021-06-22T11:10:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"springboot笔记心得\"><a class=\"anchor\" href=\"#springboot笔记心得\">#</a> springboot 笔记心得</h2>\n<h3 id=\"一-初始配置\"><a class=\"anchor\" href=\"#一-初始配置\">#</a> 一、初始配置</h3>\n<p>欲要攻其事，必先利其器，学习 Springboot 则需要先配置好相关的配置。</p>\n<ul>\n<li>Java 环境</li>\n<li>IntelliJ IDEA（中高版本即可）</li>\n<li>Maven</li>\n</ul>\n<h4 id=\"11-java环境配置\"><a class=\"anchor\" href=\"#11-java环境配置\">#</a> 1.1、Java 环境配置</h4>\n<ul>\n<li>安装流程\n<ul>\n<li>自行搜索 Java 1.8 安装包进行下载</li>\n<li>Java 整个分为 <code>jdk</code>  和 <code>jre</code>  两个包，请务必把两个包安装在一起！！！</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW1iNDExQjdaZg==\">https://www.bilibili.com/video/BV1mb411B7Zf</span></li>\n</ul>\n</li>\n<li>环境配置\n<ul>\n<li>安装完成后，windows 一般识别不到 Java，需要我们另外在环境变量中进行配置，使 Java 能够正常使用</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9qYXZhL2phdmEtZW52aXJvbm1lbnQtc2V0dXAuaHRtbA==\">https://www.runoob.com/java/java-environment-setup.html</span></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"12-intellij-idea的安装与配置\"><a class=\"anchor\" href=\"#12-intellij-idea的安装与配置\">#</a> 1.2、IntelliJ IDEA 的安装与配置</h4>\n<ol>\n<li>\n<p>安装流程</p>\n<ul>\n<li>\n<p>进入官网（<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9pZGVhLyVFRiVCQyU4OQ==\">https://www.jetbrains.com/idea/）</span></p>\n</li>\n<li>\n<p>先进入 IDEA 的官网，在官网中找到其产品 **&quot;IntelliJ IDEA&quot;<strong>。其中分为两种版本，一个为开发版，一个为社区版。找到</strong> Ultimate**  (开发版) 并且下载即可。</p>\n<ul>\n<li><strong>Ultimate</strong>  (开发版)：收费，免费试用三十天，<strong>一般都使用这个版本（可破解）</strong></li>\n<li><strong>Community</strong>  (社区版)：免费，Bug 很多，有一些功能不给使用，<strong>不推荐下载</strong></li>\n</ul>\n</li>\n<li>\n<p>下载完成后，进行软件安装（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwNTE5NC9hcnRpY2xlL2RldGFpbHMvMTA0NDUyODgwJUVGJUJDJTg5\">https://blog.csdn.net/weixin_44505194/article/details/104452880）</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>破解流程</p>\n<ul>\n<li>因为安装开发版，我们暂时未有账号和激活码，所以我们需要破解。目前能够正常破解的插件的思想就是无限重置三十天免费试用，意义上来说算是可以长时间使用</li>\n<li>无限制插件链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJfdURwbUVDd2FKejRGbDJpWnRqdVE=\">https://pan.baidu.com/s/1r_uDpmECwaJz4Fl2iZtjuQ</span><br />\n 提取码：g8i2</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"13-maven的配置\"><a class=\"anchor\" href=\"#13-maven的配置\">#</a> 1.3、Maven 的配置</h4>\n<p>​\t**[注意！！！]** 在之前的 JavaWeb、Spring、SpringMVC 开发中都是需要配置 Tomcat 和 Maven 两个配置，且其他相关配置也及其复杂和繁琐。但是 Springboot 则是在里面内嵌了 Tomcat，从而只需要我们配置好 Maven 即可使用。</p>\n<ol>\n<li>\n<p>为什么要学 Maven</p>\n<ol>\n<li>在 JavaWeb 开发中，需要使用大量的 jar 包，需要手动去导入</li>\n<li>如何能够让一个东西自动帮我导入和配置这个 jar 包，由此 Maven 诞生了</li>\n</ol>\n</li>\n<li>\n<p>Maven 的核心思想</p>\n<ol>\n<li><strong>约定大于配置</strong></li>\n</ol>\n</li>\n<li>\n<p>下载</p>\n<ul>\n<li>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cDovL21hdmVuLmFwYWNoZS5vcmcvZ3VpZGVzLw==\">http://maven.apache.org/guides/</span></p>\n</li>\n<li>\n<p>选择好需要下载的压缩包</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513121046465.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513121046465.png\" class=\"\"></p>\n</li>\n<li>\n<p>下载好后只需要在预安装的位置上解压就可以了</p>\n</li>\n</ul>\n</li>\n<li>\n<p>环境配置</p>\n<p>需要在系统环境变量中配置这些配置：</p>\n<ul>\n<li>M2_HOME：maven 目录下的 bin 目录</li>\n<li>MAVEN_HOME：maven 的目录</li>\n<li>在系统的 path 中配置 % MAVEN_HOME%\\bin</li>\n</ul>\n<p>配置完成后，需要在 cmd 中测试是否配置成功</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513122501361.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513122501361.png\" class=\"\"></p>\n<p>现在需要将 maven 的镜像源改成阿里的镜像源</p>\n<ul>\n<li>\n<p>打开 maven 的安装目录：maven 目录 /config/settings.xml</p>\n</li>\n<li>\n<p>在 &lt;mirrors&gt; 中加上这个配置</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mirror</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>maven-default-http-blocker<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mirrorOf</span><span class=\"token punctuation\">></span></span>external:http:*<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mirrorOf</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>Pseudo repository to mirror external repositories initially using HTTP.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>http://0.0.0.0/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>blocked</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>blocked</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mirror</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>然后在 maven 目录下建立一个仓库</p>\n</li>\n<li>\n<p>添加一个 &lt;localRepository&gt; 标签设置</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>localRepository</span><span class=\"token punctuation\">></span></span>D:\\apache-maven-3.8.1\\maven-repo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>localRepository</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>设置 idea 使用安装好的 maven 包：<strong>打开 IDEA—&gt;File–&gt;Other Settings–&gt;Default setting…–&gt;Build,Execution,Deployment–&gt;Build Tools–&gt;Maven–&gt;user settings file: 选择自己的 Maven 的路径即可。</strong></p>\n<p>【注意】：在 idea 中创建项目时（尤其是 springboot），经常出现 idea 调用自己默认的包，说明你更改的只是当前项目的配置文件，需要另外去更改新建项目时的配置（<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmluYmluZ2cvcC8xNDAwMTM1NS5odG1sJUVGJUJDJTg5\">https://www.cnblogs.com/binbingg/p/14001355.html）</span></p>\n</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"14-新建springboot项目\"><a class=\"anchor\" href=\"#14-新建springboot项目\">#</a> 1.4、新建 springboot 项目</h4>\n<p>操作流程：File—&gt;New—a&gt;New Project—&gt;Spring Initializr—&gt; 配置好自己的项目文件 —&gt; 选择需要的依赖包 —&gt;Finish</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513152852846.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513152852846.png\" class=\"\"></p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513153030239.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513153030239.png\" class=\"\"></p>\n<p>【注意】：项目中的 <code>.mvn</code> 、 <code>.gitignore</code> 、 <code>HELP.md</code> 、 <code>mvnw</code> 、 <code>mvnw.cmd</code>  文件夹都可以删除</p>\n<h4 id=\"15-intellij-idea快捷键\"><a class=\"anchor\" href=\"#15-intellij-idea快捷键\">#</a> 1.5、IntelliJ IDEA 快捷键</h4>\n<p>自动格式化： <code>Ctrl</code> + <code>Alt</code> + <code>L</code></p>\n<p>快速运行： <code>Shift</code> + <code>F10</code></p>\n<p>快速运行（debug）： <code>Shift</code> + <code>F9</code></p>\n<p>快速热加载（只修改网页没修改其他的时候）： <code>Ctrl</code> + <code>F9</code></p>\n<h4 id=\"16-intellij-idea后缀补全\"><a class=\"anchor\" href=\"#16-intellij-idea后缀补全\">#</a> 1.6、IntelliJ IDEA 后缀补全</h4>\n<h4 id=\"17-intellij-idea插件分享\"><a class=\"anchor\" href=\"#17-intellij-idea插件分享\">#</a> 1.7、IntelliJ IDEA 插件分享</h4>\n<hr />\n<h3 id=\"二-thymeleaf模板及其语法\"><a class=\"anchor\" href=\"#二-thymeleaf模板及其语法\">#</a> 二、Thymeleaf 模板及其语法</h3>\n<h4 id=\"21-使用thymeleaf的操作流程\"><a class=\"anchor\" href=\"#21-使用thymeleaf的操作流程\">#</a> 2.1、使用 Thymeleaf 的操作流程</h4>\n<ol>\n<li>\n<p>导入依赖包</p>\n<ul>\n<li>\n<p>方法一：在创建项目的时候就可以添加 <code>Thymeleaf</code>  依赖包</p>\n</li>\n<li>\n<p>方法二：在创建项目之后在 <code>pom.xml</code>  文件加中添加（shift+tab 可以减少缩进）</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-thymeleaf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>使用方法（<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGh5bWVsZWFmLm9yZy9kb2MvdHV0b3JpYWxzLzMuMC90aHltZWxlYWZzcHJpbmcuaHRtbCVFRiVCQyU4OQ==\">https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html）</span></p>\n<ul>\n<li>\n<p>导入约束：</p>\n<ul>\n<li>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>en</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>http://www.thymeleaf.org</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>语法：</p>\n<ul>\n<li css-module=\".\">使用变量表达式：$</li>\n<li css-module=\".\">选择表达式：*</li>\n<li css-module=\".\">消息表达式：#</li>\n<li css-module=\".\">URL 表达式：@</li>\n<li css-module=\".\">Fragment 表达式：~</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"三-扩展mvc\"><a class=\"anchor\" href=\"#三-扩展mvc\">#</a> 三、扩展 MVC</h3>\n<p>新建一个 <code>config</code>  包，写一个类 <code>MyMvcConfig</code> ，编写一个 @Configuration 注解类，并且类型要为 WebMvcConfigurer，还不能表述 @EnaledWebMvc；</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 应为类型要求为 WebMvcConfigurer，所以我们实现其接口</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 可以使用自定义扩展 Mvc 的功能</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyMvcConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addViewControllers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewControllerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// 浏览器发送 \"/\" 或者 \"/index.html\"，就会跳转到 index 页面</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addViewController</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setViewName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addViewController</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/index.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setViewName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><hr />\n<h3 id=\"四-员工管理系统\"><a class=\"anchor\" href=\"#四-员工管理系统\">#</a> 四、员工管理系统</h3>\n<h5 id=\"41-首页实现\"><a class=\"anchor\" href=\"#41-首页实现\">#</a> 4.1、首页实现</h5>\n<ol>\n<li>\n<p>首先需要创建好 model 层</p>\n<ul>\n<li>\n<p>先创建一个公司表</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>kuangstudy_demo<span class=\"token punctuation\">.</span>model</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AllArgsConstructor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoArgsConstructor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @author zxy</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @description: TODO</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @date 2021/5/12 9:19</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Department</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> departmentName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>再创建一个员工表</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>kuangstudy_demo<span class=\"token punctuation\">.</span>model</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoArgsConstructor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @author zxy</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @description: TODO</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @date 2021/5/12 9:20</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Employee</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> lastName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> gender<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Department</span> department<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> birth<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Employee</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> lastName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> gender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Department</span> department<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastName <span class=\"token operator\">=</span> lastName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> email<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gender <span class=\"token operator\">=</span> gender<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>department <span class=\"token operator\">=</span> department<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// 默认日期</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>birth <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>因为视频这里偏向于入门，所以暂时不调用数据库，自己写一个伪数据</p>\n<ul>\n<li>\n<p>公司表的 Dao</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>kuangstudy_demo<span class=\"token punctuation\">.</span>mapper</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>kuangstudy_demo<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Resource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @author zxy</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @description: TODO</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @date 2021/5/12 9:22</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@Resource</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DemartmentDao</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> departments <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        departments <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 创建一个部门表</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        departments<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"教学部\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        departments<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token number\">102</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"市场部\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        departments<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token number\">103</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"教研部\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        departments<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token number\">104</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"运营部\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        departments<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token number\">105</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Department</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"后勤部\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getDepartments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> departments<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Department</span> <span class=\"token function\">getDepartmentById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">return</span> departments<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>员工表的 Dao</p>\n<pre><code class=\"language-Java\">package com.example.kuangstudy_demo.mapper;\n\nimport com.example.kuangstudy_demo.model.Department;\nimport com.example.kuangstudy_demo.model.Employee;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport javax.annotation.Resource;\nimport java.util.Collection;\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author zxy\n * @version 1.0\n * @description: TODO\n * @date 2021/5/12 9:30\n */\n\n@Resource\npublic class EmployeeDao &#123;\n     private static Map&lt;Integer, Employee&gt; employees = null;\n\n     @Autowired\n     private DepartmentDao departmentDao;\n\n     static &#123;\n         employees = new HashMap&lt;Integer,Employee&gt;();\n\n         employees.put(1001,new Employee(1001,&quot;AA&quot;,&quot;1031574211@qq.com&quot;,0,new Department(101,&quot;后勤部&quot;)));\n         employees.put(1002,new Employee(1002,&quot;BB&quot;,&quot;2031574211@qq.com&quot;,1,new Department(102,&quot;后勤部&quot;)));\n         employees.put(1003,new Employee(1003,&quot;CC&quot;,&quot;3031574211@qq.com&quot;,0,new Department(103,&quot;后勤部&quot;)));\n         employees.put(1004,new Employee(1004,&quot;DD&quot;,&quot;4031574211@qq.com&quot;,1,new Department(104,&quot;后勤部&quot;)));\n         employees.put(1005,new Employee(1005,&quot;EE&quot;,&quot;5031574211@qq.com&quot;,0,new Department(105,&quot;后勤部&quot;)));\n     &#125;\n\n     //主键自增\n     private static  Integer initId = 1006;\n     //增加以一个员工\n     public void save(Employee employee)&#123;\n         if (employee.getId()==null)&#123;\n             employee.setId(initId++);\n         &#125;\n         employee.setDepartment((demartmentDao.getDepartmentById(employee.getDepartment().getId())));\n         employees.put(employee.getId(),employee);\n     &#125;\n\n     //查询全部员工\n     public Collection&lt;Employee&gt; getAll()&#123;\n         return employees.values();\n     &#125;\n\n     //通过id查询员工\n    public Employee getEmployeeById(Integer id)&#123;\n         return employees.get(id);\n    &#125;\n\n    //通过id删除员工\n    public void deleteById(Integer id)&#123;\n         employees.remove(id);\n    &#125;\n&#125;\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>更改静态页面</p>\n<ul>\n<li>\n<p>首先需要把静态资源导入，springboot 项目创建的时候会默认有一个 resources 文件夹，里面包含有两个包 <code>static</code>  和 <code>templates</code></p>\n<ul>\n<li>\n<p><code>static</code>  是放置 js、css、img 这些资源文件</p>\n</li>\n<li>\n<p><code>templates</code>  是放置整个项目的静态网页</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513162633474.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513162633474.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>给静态网页使用 <code>Thymeleaf</code> ，如果更改的话，那么启动项目之后将无法使用样式和数据</p>\n<ul>\n<li>将 <code>src</code>  改为 <code>th:src=&quot;@&#123;...&#125;&quot;</code></li>\n<li>将 <code>text</code>  改为 <code>th:text=&quot;#&#123;...&#125;&quot;</code></li>\n</ul>\n</li>\n<li>\n<p>静态页面的资源：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMUpKcVJXUUEzSmNkems3QmZoWGhUcXclRTYlOEYlOTAlRTUlOEYlOTYlRTclQTAlODElRUYlQkMlOUF2eXN4\">https://pan.baidu.com/s/1JJqRWQA3Jcdzk7BfhXhTqw 提取码：vysx</span></p>\n</li>\n</ul>\n</li>\n</ol>\n<h5 id=\"42-国际化语言切换如中英文切换\"><a class=\"anchor\" href=\"#42-国际化语言切换如中英文切换\">#</a> 4.2、国际化（语言切换，如：中英文切换）</h5>\n<ol>\n<li>\n<p>保证 properties 的格式为 UTF-8</p>\n<ul>\n<li><code>Ctrl+Alt+A</code>  打开 Settings—&gt; 搜索 File Encodings—&gt; 修改为 UTF-8</li>\n</ul>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513164116782.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513164116782.png\" class=\"\"></p>\n</li>\n<li>\n<p>新建一个包 <code>i18n</code> （国际化单词的缩写，首字母为 i，尾字母为 n，中间 18 个字母）</p>\n</li>\n<li>\n<p>在 <code>i18n</code>  包下面新建一个 <code>login.properties</code>  配置文件，再新建两个配置文件 <code>login_zh_CN.properties</code>  和 <code>login_en_US.properties</code></p>\n<ul>\n<li>\n<p>这个时候，idea 会自动帮我们创建一个关于 <code>login</code>  的包</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513164613304.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513164613304.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513165044810.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210513165044810.png\" class=\"\"></p>\n</li>\n<li>\n<p>在 <code>config</code>  包下编写一个自己的类 <code>LocalResolver</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>kuangstudy_demo<span class=\"token punctuation\">.</span>config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocaleResolver</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>thymeleaf<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Locale</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @author zxy</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @description: TODO</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @date 2021/5/12 14:40</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 引入 LocaleResolver</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyLocalResolver</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">LocaleResolver</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Locale</span> <span class=\"token function\">resolveLocale</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">String</span> language <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"l\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Locale</span> locale <span class=\"token operator\">=</span> <span class=\"token class-name\">Locale</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 如果没有就使用默认的</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// 如果请求连接携带了国际化的参数</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>language<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> split <span class=\"token operator\">=</span> language<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 国家，地区</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            locale <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Locale</span><span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> split<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> locale<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setLocale</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Locale</span> locale<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>然后在 @Configuration 的类中将刚刚自己写的 <code>MyLocalResolver</code>  注入到 Bean 中</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyMvcConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addViewControllers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewControllerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addViewController</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setViewName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addViewController</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/index.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setViewName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LocaleResolver</span> <span class=\"token function\">localeResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyLocalResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>然后在更改切换语言的按钮上增加一个请求</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/index.html(l=<span class=\"token punctuation\">'</span>zh_CN<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>中文<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/index.html(l=<span class=\"token punctuation\">'</span>en_US<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>English<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n<h5 id=\"43-登录功能\"><a class=\"anchor\" href=\"#43-登录功能\">#</a> 4.3、登录功能</h5>\n<ol>\n<li>\n<p>将首页的登录菜单的 <code>action</code>  改为 <code>th:action=&quot;@&#123;/user/login&#125;&quot;</code></p>\n</li>\n<li>\n<p>在 <code>Controller</code>  包下新建一个类 <code>LoginController</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                       <span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 具体的业务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span><span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'123456'</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/main.html\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// 告诉用户，你的登录失败了</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"msg\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"用户名或密码错误\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     \t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>需要另外更改一下 <code>index</code>  的代码，使得能够返回数据</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-signin<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/user/login&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mb-4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/img/bootstrap-solid.svg&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>72<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>72<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>h3 mb-3 font-weight-normal<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#&#123;login.tip&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Please sign in<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 如果 msg 不为空则返回该 p 标签 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">color</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;msg&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>if</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;not #Strings.isEmpty(msg)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#&#123;login.username&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autofocus</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#&#123;login.password&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox mb-3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>remember-me<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> [[#&#123;login.remember&#125;]]</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-lg btn-primary btn-block<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>[[#&#123;login.btn&#125;]]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mt-5 mb-3 text-muted<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>© 2017-2018<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/index.html(l=<span class=\"token punctuation\">'</span>zh_CN<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>中文<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/index.html(l=<span class=\"token punctuation\">'</span>en_US<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>English<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>为了在跳转的时候是能够重定向到 main.html，我们还需要去 <code>MyMvcConfig</code>  里面再写一个更改访问路由</p>\n<pre><code class=\"language-Java\">@Configuration\npublic class MyMvcConfig implements WebMvcConfigurer &#123;\n    @Override\n    public void addViewControllers(ViewControllerRegistry registry) &#123;\n        registry.addViewController(&quot;/&quot;).setViewName(&quot;index&quot;);\n        registry.addViewController(&quot;/index.html&quot;).setViewName(&quot;index&quot;);\n        registry.addViewController(&quot;/main.html&quot;).setViewName(&quot;dashboard&quot;)\n    &#125;\n\n    @Bean\n    public LocaleResolver localeResolver()&#123;\n        return new MyLocalResolver();\n    &#125;\n&#125;\n</code></pre>\n<ul>\n<li>这个时候伪登录就做好了，并且登录成功之后路由更改为 http://localhost:8080/main.html，不会再显示 dashboard.html 了</li>\n</ul>\n</li>\n</ol>\n<h5 id=\"44-登录拦截器\"><a class=\"anchor\" href=\"#44-登录拦截器\">#</a> 4.4、登录拦截器</h5>\n<ol>\n<li>\n<p>为了增加拦截器，需要新建一个类继承 <code>HandlerInterceptor</code></p>\n<pre><code class=\"language-Java\">package com.example.kuangstudy_demo.config;\n\nimport org.springframework.web.servlet.HandlerInterceptor;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n\npublic class LoginHandlerInterceptor implements HandlerInterceptor &#123;\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;\n        //登录成功之后，应该有用户的session;\n        Object loginUser = request.getSession().getAttribute(&quot;loginUser&quot;);\n\n        if (loginUser == null)&#123;\n            //没有登陆\n            request.setAttribute(&quot;msg&quot;,&quot;没有权限登陆&quot;);\n            request.getRequestDispatcher(&quot;/index.html&quot;).forward(request,response);\n            return false;\n        &#125;else &#123;\n            return true;\n        &#125;\n    &#125;\n&#125;\n</code></pre>\n</li>\n<li>\n<p>然后需要把拦截器注入到 spring 中去</p>\n<pre><code class=\"language-Java\">@Configuration\npublic class MyMvcConfig implements WebMvcConfigurer &#123;\n    @Override\n    public void addViewControllers(ViewControllerRegistry registry) &#123;\n        registry.addViewController(&quot;/&quot;).setViewName(&quot;index&quot;);\n        registry.addViewController(&quot;/index.html&quot;).setViewName(&quot;index&quot;);\n        registry.addViewController(&quot;/main.html&quot;).setViewName(&quot;dashboard&quot;);\n    &#125;\n\n    //自定义国际化组件就生效了\n    @Bean\n    public LocaleResolver localeResolver()&#123;\n        return new MyLocalResolver();\n    &#125;\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) &#123;\n        registry.addInterceptor(new LoginHandlerInterceptor())\n            .addPathPatterns(&quot;/**&quot;)\n            .excludePathPatterns(&quot;/index.html&quot;,&quot;/&quot;,&quot;/user/login&quot;,&quot;/css/*&quot;,&quot;/js/**&quot;,&quot;/img/**&quot;);\n    &#125;\n&#125;\n</code></pre>\n</li>\n<li>\n<p>同样还需要再 LoginController 中增加 HttpSession</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                        <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        <span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 具体的业务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loginUser\"</span><span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/main.html\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// 告诉用户，你的登录失败了</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"msg\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"用户名或密码错误\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>到这里，拦截器算是做好了，我们再给它加点东西。让他登录之后显示它登录的名字</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nav</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navbar-brand col-sm-3 col-md-2 mr-0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://getbootstrap.com/docs/4.0/examples/dashboard/#<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;session.loginUser&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>效果图如下</p>\n<ul>\n<li>\n<p>密码不为 &quot;123456&quot;</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210515144043406.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210515144043406.png\" class=\"\"></p>\n</li>\n<li>\n<p>由于在 html 那边的 form 表单中填写了用户名不能为空，所以不存在用户名不会空的情况</p>\n</li>\n<li>\n<p>登陆成功</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210515144237196.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210515144237196.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n</ol>\n<h5 id=\"45-展示员工列表\"><a class=\"anchor\" href=\"#45-展示员工列表\">#</a> 4.5、展示员工列表</h5>\n<ol>\n<li>\n<p>先新建一个 Controller 类 <code>EmployeeController</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmployeeController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">EmployeeDao</span> employeeDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/* 查询所有员工 */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emps\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Employee</span><span class=\"token punctuation\">></span></span> employees <span class=\"token operator\">=</span> employeeDao<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"emp\"</span><span class=\"token punctuation\">,</span>employees<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/list\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>提取公共页面</p>\n<ol>\n<li>\n<p>因为 thymeleaf 支持组件化开发，所以我们另外将公共部分直接放置在一个页面中，其他页面可以直接调用即可</p>\n<ol>\n<li>\n<p>在 <code>templates</code>  文件夹下新建一个文件夹 <code>commons</code> ，并且在下面新建一个网页 `commons.html</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nav</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-2 d-none d-md-block bg-light sidebar<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>fragment</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sidebar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 提取公共部分，使用 th:fragment=\"...\"--></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sidebar-sticky<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav flex-column<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-item<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token comment\">&lt;!-- 传递一个参数 active，当具体页面传过来的页面中 active 的变量一致，就会更改高亮 --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;active==<span class=\"token punctuation\">'</span>main.html<span class=\"token punctuation\">'</span>?<span class=\"token punctuation\">'</span>nav-link active<span class=\"token punctuation\">'</span>:<span class=\"token punctuation\">'</span>nav-link<span class=\"token punctuation\">'</span>&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/index.html&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol>\n<li>th:fragment=&quot;...&quot;</li>\n<li>th:replace=&quot;~{commons/commons::topbar}&quot;</li>\n<li>如果要传递参数，可以直接使用 () 传参，接受判断即可</li>\n</ol>\n</li>\n<li>\n<p>由于业务的需要，我们把具体的业务放在一个规范的文件夹。继续在 <code>templates</code>  文件夹下新建一个文件夹 <code>emp</code> ，然后把之前的 <code>list.html</code>  放进去</p>\n</li>\n<li>\n<p>稍加对 <code>dashboard.html</code>  和 <code>list.html</code>  更改一下</p>\n<ul>\n<li><code>list.html</code></li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, shrink-to-fit=no<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Dashboard Template for Bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core CSS --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/bootstrap.min.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Custom styles for this template --></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/dashboard.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">/* Chart.js */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token selector\">.chartjs-render-monitor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">-webkit-animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>insert</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::topbar&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-fluid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>replace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::sidebar(active=<span class=\"token punctuation\">'</span>list.html<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-9 ml-sm-auto col-lg-10 pt-3 px-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Section title<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>table-responsive<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>table table-striped table-sm<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>thead</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>id<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>lastName<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>gender<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>department<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>birth<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>thead</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tbody</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>each</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>emp:$&#123;emps&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                                    <span class=\"token comment\">&lt;!--getId 和 LastName 是 thymeleaf 的两种表示方法 --></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getId()&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>[[$&#123;emp.getLastName()&#125;]]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getEmail()&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getGender()==0?<span class=\"token punctuation\">'</span>女<span class=\"token punctuation\">'</span>:<span class=\"token punctuation\">'</span>男<span class=\"token punctuation\">'</span>&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;#dates.format(emp.getBirth(),<span class=\"token punctuation\">'</span>yyyy-MM-dd HH:mm:ss<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>编辑<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-danger<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>删除<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tbody</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core JavaScript</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>================================================== --></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Placed at the end of the document so the pages load faster --></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/jquery-3.2.1.slim.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/popper.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/bootstrap.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Icons --></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/feather.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            feather<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Graphs --></span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/Chart.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myChart\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>            <span class=\"token keyword\">var</span> myChart <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chart</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                type<span class=\"token operator\">:</span> <span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                data<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                    labels<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Saturday\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                    datasets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                        data<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">15339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18483</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24003</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24092</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12034</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                        lineTension<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                        backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                        borderColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                        borderWidth<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                        pointBackgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                options<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    scales<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                        yAxes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                            ticks<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                                beginAtZero<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                    legend<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                        display<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li><code>dashboard.html</code></li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, shrink-to-fit=no<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Dashboard Template for Bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Bootstrap core CSS --></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/bootstrap.min.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Custom styles for this template --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/dashboard.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token comment\">/* Chart.js */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t<span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t\t<span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t<span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t<span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t\t<span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t<span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t\t<span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token selector\">.chartjs-render-monitor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t<span class=\"token property\">-webkit-animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- 顶部导航栏 --></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>insert</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>commons/commons::topbar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-fluid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t<span class=\"token comment\">&lt;!-- 侧边栏 --></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t<span class=\"token comment\">&lt;!-- 传递参数给组件 --></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>insert</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>commons/commons::sidebar(active=<span class=\"token punctuation\">'</span>main.html<span class=\"token punctuation\">'</span>)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-9 ml-sm-auto col-lg-10 pt-3 px-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>chartjs-size-monitor<span class=\"token punctuation\">\"</span></span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span> <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0px<span class=\"token punctuation\">;</span> <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0px<span class=\"token punctuation\">;</span> <span class=\"token property\">right</span><span class=\"token punctuation\">:</span> 0px<span class=\"token punctuation\">;</span> <span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span> 0px<span class=\"token punctuation\">;</span> <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span> <span class=\"token property\">pointer-events</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span> <span class=\"token property\">visibility</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span> <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> -1<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>chartjs-size-monitor-expand<span class=\"token punctuation\">\"</span></span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">position</span><span class=\"token punctuation\">:</span>absolute<span class=\"token punctuation\">;</span><span class=\"token property\">left</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">top</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">right</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span>hidden<span class=\"token punctuation\">;</span><span class=\"token property\">pointer-events</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span><span class=\"token property\">visibility</span><span class=\"token punctuation\">:</span>hidden<span class=\"token punctuation\">;</span><span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span>-1<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">position</span><span class=\"token punctuation\">:</span>absolute<span class=\"token punctuation\">;</span><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>1000000px<span class=\"token punctuation\">;</span><span class=\"token property\">height</span><span class=\"token punctuation\">:</span>1000000px<span class=\"token punctuation\">;</span><span class=\"token property\">left</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">top</span><span class=\"token punctuation\">:</span>0</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>chartjs-size-monitor-shrink<span class=\"token punctuation\">\"</span></span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">position</span><span class=\"token punctuation\">:</span>absolute<span class=\"token punctuation\">;</span><span class=\"token property\">left</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">top</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">right</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span><span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span>hidden<span class=\"token punctuation\">;</span><span class=\"token property\">pointer-events</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span><span class=\"token property\">visibility</span><span class=\"token punctuation\">:</span>hidden<span class=\"token punctuation\">;</span><span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span>-1<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">position</span><span class=\"token punctuation\">:</span>absolute<span class=\"token punctuation\">;</span><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>200%<span class=\"token punctuation\">;</span><span class=\"token property\">height</span><span class=\"token punctuation\">:</span>200%<span class=\"token punctuation\">;</span><span class=\"token property\">left</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span> <span class=\"token property\">top</span><span class=\"token punctuation\">:</span>0</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>h2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Dashboard<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn-toolbar mb-2 mb-md-0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn-group mr-2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-outline-secondary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Share<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-outline-secondary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Export<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-outline-secondary dropdown-toggle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>24<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>24<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">viewBox</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 24 24<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>none<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>currentColor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-linecap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>round<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stroke-linejoin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>round<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>feather feather-calendar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>rect</span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>18<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>18<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ry</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>rect</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>line</span> <span class=\"token attr-name\">x1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>line</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>line</span> <span class=\"token attr-name\">x1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>line</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>line</span> <span class=\"token attr-name\">x1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y1</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">x2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>21<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>line</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                This week</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>              <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-4 chartjs-render-monitor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>myChart<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1076<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>454<span class=\"token punctuation\">\"</span></span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span> <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 1076px<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 454px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t\t\t\t</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Bootstrap core JavaScript</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    ================================================== --></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Placed at the end of the document so the pages load faster --></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/jquery-3.2.1.slim.min.js&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/popper.min.js&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/bootstrap.min.js&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Icons --></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/feather.min.js&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t\tfeather<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\t<span class=\"token comment\">&lt;!-- Graphs --></span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/Chart.min.js&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myChart\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> myChart <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chart</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>\t\t\t\ttype<span class=\"token operator\">:</span> <span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>\t\t\t\tdata<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>\t\t\t\t\tlabels<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Saturday\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>\t\t\t\t\tdatasets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>\t\t\t\t\t\tdata<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">15339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18483</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24003</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24092</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12034</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>\t\t\t\t\t\tlineTension<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>\t\t\t\t\t\tbackgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>\t\t\t\t\t\tborderColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>\t\t\t\t\t\tborderWidth<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>\t\t\t\t\t\tpointBackgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>\t\t\t\toptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>\t\t\t\t\tscales<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>\t\t\t\t\t\tyAxes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>\t\t\t\t\t\t\tticks<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>\t\t\t\t\t\t\t\tbeginAtZero<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>\t\t\t\t\tlegend<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>\t\t\t\t\t\tdisplay<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>\t\t</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>到此为止，已经做完了前端的查询功能，效果如下</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517093617347.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517093617347.png\" class=\"\"></p>\n</li>\n</ol>\n<h5 id=\"46-增加员工信息\"><a class=\"anchor\" href=\"#46-增加员工信息\">#</a> 4.6、增加员工信息</h5>\n<p>思路：点击添加按钮 —&gt; 跳转页面，添加 Controller—&gt; 在新页面添加新的数据 —&gt; 添加完成后重定向到查询所有员工</p>\n<ol>\n<li>\n<p>更改 <code>list.html</code>  页面，增加一个添加按钮，并且点击添加按钮跳转页面</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-fluid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>replace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::sidebar(active=<span class=\"token punctuation\">'</span>list.html<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-9 ml-sm-auto col-lg-10 pt-3 px-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-success<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/emp&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>添加员工<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>因为上面给了一个路由，所以我们在 <code>EmployeeContorller</code>  中加点东西</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 浏览器查询</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toApppage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 查出所有部门的信息</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> departments <span class=\"token operator\">=</span> demartmentDao<span class=\"token punctuation\">.</span><span class=\"token function\">getDepartments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"departments\"</span><span class=\"token punctuation\">,</span>departments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/add\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>然后我们再来写添加数据的页面 <code>add.html</code> ，放到 <code>emp</code>  文件夹下</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, shrink-to-fit=no<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Dashboard Template for Bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core CSS --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/bootstrap.min.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Custom styles for this template --></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/dashboard.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">/* Chart.js */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token selector\">.chartjs-render-monitor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">-webkit-animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>insert</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::topbar&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-fluid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>replace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::sidebar(active=<span class=\"token punctuation\">'</span>list.html<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-9 ml-sm-auto col-lg-10 pt-3 px-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/emp&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>LastName<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>海绵宝宝<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lastName<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1176244270@qq.com<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Gender<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check form-check-inline<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-input<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>radio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gender<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-label<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>男<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check form-check-inline<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-input<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>radio</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>0</span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>gender</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-label<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>女<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department.id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 因为我们取的是 department 对象的 id 属性，所以要这样取，需要注意一下 --></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>each</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dept:$&#123;departments&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;dept.getDepartmentName()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;dept.getId()&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Birth<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>嘤嘤嘤<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>birth<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>添加<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core JavaScript</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>================================================== --></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Placed at the end of the document so the pages load faster --></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/jquery-3.2.1.slim.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/popper.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/bootstrap.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Icons --></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/feather.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            feather<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Graphs --></span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/Chart.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myChart\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>            <span class=\"token keyword\">var</span> myChart <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chart</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                type<span class=\"token operator\">:</span> <span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                data<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                    labels<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Saturday\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                    datasets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                        data<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">15339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18483</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24003</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24092</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12034</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                        lineTension<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                        backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                        borderColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                        borderWidth<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                        pointBackgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                options<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                    scales<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                        yAxes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                            ticks<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                                beginAtZero<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                    legend<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                        display<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>增加 form 表单提交添加员工的数据（就是在 <code>add.html</code>  页面中添加 action 路由和传值的方式）</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/emp&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>处理 form 表单的方法（restful 风格，虽然路由一致，但请求方式不同，则是不同的方法）</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 添加员工表单</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">addEmp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Employee</span> employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"save\"</span> <span class=\"token operator\">+</span> employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    employeeDao<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 调用底层方法，保存员工信息</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>额外彩蛋</p>\n<ol>\n<li>\n<p>在添加员工的时候，我们使用的是默认的 springboot 处理的 date 方式，所以添加的时候必须是以 <code>/</code>  的方式进行的。但是我们可以在 <code>application.properties</code>  中更改</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517164229647.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517164229647.png\" class=\"\"></p>\n</li>\n<li>\n<p><code>application.properties</code>  中更改默认时间格式</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#时间格式化</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.mvc.format.date</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">yyyy-MM-dd</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ol>\n<h5 id=\"47-修改员工信息\"><a class=\"anchor\" href=\"#47-修改员工信息\">#</a> 4.7、修改员工信息</h5>\n<p>思路：给编辑按钮增加跳转功能 —&gt; 增加一个跳转员工修改页面的方法 —&gt; 增加一个修改页面 <code>update.html</code> —&gt; 更改 <code>update.html</code>  中之前员工的数据信息作为默认值 —&gt; 再给修改的 form 表单做一个 Controller 处理 —&gt; 解决 update 自增 id 的问题</p>\n<ol>\n<li>\n<p>给 <code>list.html</code>  的编辑按钮增加跳转功能</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>|@&#123;/emp/&#125;$&#123;emp.getId()&#125;|<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>编辑<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>增加一个跳转员工修改页面的方法</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 跳转到修改员工的界面</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toUpdateEmp</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 查出原来的数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Employee</span> employee <span class=\"token operator\">=</span> employeeDao<span class=\"token punctuation\">.</span><span class=\"token function\">getEmployeeById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"emp\"</span><span class=\"token punctuation\">,</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 查出所有部门的信息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> departments <span class=\"token operator\">=</span> demartmentDao<span class=\"token punctuation\">.</span><span class=\"token function\">getDepartments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"departments\"</span><span class=\"token punctuation\">,</span>departments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/update\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>增加一个修改页面 <code>update.html</code></p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>这里就不展示了，就是把add.html直接复制一份</pre></td></tr></table></figure></li>\n<li>\n<p>更改 <code>update.html</code>  中之前员工的数据信息作为默认值</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, shrink-to-fit=no<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Dashboard Template for Bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core CSS --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/bootstrap.min.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Custom styles for this template --></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/css/dashboard.css&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">/* Chart.js */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> chartjs-render-animation</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token selector\">from</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.99</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token selector\">to</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token selector\">.chartjs-render-monitor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">-webkit-animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> chartjs-render-animation 0.001s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>insert</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::topbar&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-fluid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>replace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>~&#123;commons/commons::sidebar(active=<span class=\"token punctuation\">'</span>list.html<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>main<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>col-md-9 ml-sm-auto col-lg-10 pt-3 px-4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/emp&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>LastName<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getLastName()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>海绵宝宝<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lastName<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getEmail()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1176244270@qq.com<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Gender<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check form-check-inline<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>checked</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getGender()==1&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-input<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>radio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gender<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-label<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>男<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check form-check-inline<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>checked</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getGender()==0&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-input<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>radio</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>0</span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>gender</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-check-label<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>女<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department.id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token comment\">&lt;!-- 因为我们取的是 department 对象的 id 属性，所以要这样取，需要注意一下 --></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>selected</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;dept.getId()==emp.getDepartment().getId()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>each</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dept:$&#123;departments&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;dept.getDepartmentName()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;dept.getId()&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Birth<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getBirth()&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>嘤嘤嘤<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>birth<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>添加<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Bootstrap core JavaScript</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>================================================== --></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Placed at the end of the document so the pages load faster --></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/jquery-3.2.1.slim.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/popper.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/bootstrap.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Icons --></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/feather.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            feather<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Graphs --></span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/js/Chart.min.js&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token keyword\">var</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myChart\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>            <span class=\"token keyword\">var</span> myChart <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chart</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                type<span class=\"token operator\">:</span> <span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                data<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                    labels<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Saturday\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                    datasets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                        data<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">15339</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18483</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24003</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23489</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24092</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12034</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                        lineTension<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                        backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                        borderColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                        borderWidth<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                        pointBackgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'#007bff'</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                options<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                    scales<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                        yAxes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                            ticks<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                                beginAtZero<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                    legend<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                        display<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>修改一下 form 表单、处理一下日期格式化的问题、做一个提交修改的 Controller 处理</p>\n<ol>\n<li>\n<p>修改的 form 表单</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/updateEmp&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>...</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>|@&#123;/emp/&#125;$&#123;emp.getId()&#125;|<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>编辑<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>处理日期格式化</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Birth<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;#dates.format(emp.getBirth(),<span class=\"token punctuation\">'</span>yyyy-MM-dd HH:mm<span class=\"token punctuation\">'</span>)&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>例如：1999-12-29<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>birth<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>Controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/updateEmp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">updateEmp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Employee</span> employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    employeeDao<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li>\n<p>解决 update 自增 id 的问题</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 增加一个隐藏的 id，不给用户修改，但是可以直接从这边传值去 Dao 的 save 方法 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;emp.getId()&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n<h5 id=\"48-删除及404处理-注销功能\"><a class=\"anchor\" href=\"#48-删除及404处理-注销功能\">#</a> 4.8、删除及 404 处理、注销功能</h5>\n<ul>\n<li>思路\n<ul>\n<li>删除：跟更新一致，点击删除按钮 —&gt; 添加 Controller—&gt; 删除完成后重定向到查询所有员工</li>\n<li>404 处理：在 <code>templates</code>  文件夹下新建一个文件夹 <code>error</code> ，把 400 页面放进去就可以了</li>\n<li>注销：增加注销按钮 —&gt; 写个 Contorller</li>\n</ul>\n</li>\n</ul>\n<ol>\n<li>\n<p>删除</p>\n<ol>\n<li>\n<p>修改删除按钮</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-sm btn-danger<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>|@&#123;/deleteEmp/&#125;$&#123;emp.getId()&#125;|<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>删除<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>添加 Contorller，删除完成之后重定向到查询所有员工</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/deleteEmp/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">deleteEmp</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> employeeDao<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已删除员工============》\"</span><span class=\"token operator\">+</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li>\n<p>404 处理</p>\n<p>在 <code>templates</code>  文件夹下新建一个文件夹 <code>error</code> ，把 400 页面放进去就可以了</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517200849971.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210517200849971.png\" class=\"\"></p>\n</li>\n<li>\n<p>注销</p>\n<ol>\n<li>\n<p>添加注销按钮</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav-link<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/user/logout&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>注销<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>写 Controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/logout\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">userLogout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    session<span class=\"token punctuation\">.</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/index.html\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ol>\n<hr />\n<h3 id=\"五-整合jdbc\"><a class=\"anchor\" href=\"#五-整合jdbc\">#</a> 五、整合 JDBC</h3>\n<ul>\n<li>\n<p>概念</p>\n<ul>\n<li>对于数据库访问层（DAO），对于 SQL 和 NoSQL，springboot 都是采用 SpringData 的方式进行统一处理</li>\n</ul>\n</li>\n<li>\n<p>当导入了 Springboot Data JDBC 且配置好数据库之后可直接注入数据库</p>\n</li>\n<li>\n<p>连接数据库常用配置参数</p>\n<ul>\n<li>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">  datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">    username</span><span class=\"token punctuation\">:</span> <span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">    password</span><span class=\"token punctuation\">:</span> <span class=\"token attr-value\">rootzxy</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">    url</span><span class=\"token punctuation\">:</span> <span class=\"token attr-value\">jdbc:mariadb://localhost:3306/mabatis_plus?useUnicode=true&amp;chatracterEncoding=utf-8</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token attr-name\">    driver-class-name</span><span class=\"token punctuation\">:</span> <span class=\"token attr-value\">org.mariadb.jdbc.Driver</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"六-整合druid数据源\"><a class=\"anchor\" href=\"#六-整合druid数据源\">#</a> 六、整合 Druid 数据源</h3>\n<ul>\n<li>\n<p>概念：</p>\n<ul>\n<li>阿里的，优秀的数据库连接池，跟 <code>hikaridatasource</code>  相庭抗争</li>\n<li>Springboot 在 2.0.4 默认使用 com.zaxxer.hikari.HikariDataSource 数据源\n<ul>\n<li><code>hikaridatasource</code>  相对快， <code>Druid</code>  相对优秀</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>使用</p>\n<ul>\n<li>\n<p>导入依赖</p>\n</li>\n<li>\n<p>更改数据库连接池（因为 Springboot 默认使用 <code>hikaridatasource</code> ，所以需要另外的下面加一个 spring.datasource.type: <code>com.alibaba.druid.pool.DruidDataSource</code> ）</p>\n</li>\n<li>\n<p>在 Druid 中拥有监控功能： <code>stat</code> 、日志记录： <code>log4j</code> 、防御 sql 注入： <code>wall</code></p>\n<ul>\n<li>同样在 application 中配置，spring.datasource.filters : stat,wall,log4j</li>\n<li>在 application 使用这个功能的时候需要先导入相对应的包，不然无法使用这些</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> rootzxy</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mariadb<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/mabatis_plus<span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;chatracterEncoding=utf-</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> org.mariadb.jdbc.Driver</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> com.alibaba.druid.pool.DruidDataSource</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">#SpringBoot 默认是不注入这些的，需要自己绑定</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">#druid 数据源专有配置</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">initialSize</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">minIdle</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">maxActive</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">maxWait</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60000</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">timeBetweenEvictionRunsMillis</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60000</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">minEvictableIdleTimeMillis</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300000</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">validationQuery</span><span class=\"token punctuation\">:</span> SELECT 1 FROM DUAL</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">testWhileIdle</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">testOnBorrow</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">testOnReturn</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">poolPreparedStatements</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">#配置监控统计拦截的 filters，stat：监控统计、log4j：日志记录、wall：防御 sql 注入</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">#如果允许报错，java.lang.ClassNotFoundException: org.apache.Log4j.Properity</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">#则导入 log4j 依赖就行</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#    filters: stat,wall,log4j</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#    maxPoolPreparedStatementPerConnectionSize: 20</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#    useGlobalDataSourceStat: true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></pre></td></tr></table></figure></li>\n<li>\n<p>自定义配置</p>\n<ul>\n<li>导入 application 的配置\n<ul>\n<li>先新建一个 <code>DruidConfig</code>  类</li>\n<li>给这个类打上 <code>@Configuration</code>  注解</li>\n<li>类里面创建个方法 <code>druidDateSource</code> ，返回值为 DataSource，直接 return new DruidDataSource ()；</li>\n<li>给 <code>druidDateSource</code>  方法上打上 <code>@ConfigurationProperties(perfix = &quot;spring.datasource&quot;)</code>  和 <code>@Bean</code></li>\n<li>接下来，其他需要的方法直接在这个类里面写就可以了，记得每个方法需要加上 <code>@Bean</code>  注解，使它们注入到 Spring 中，其实就是 springboot 内嵌了 Servlet 容器</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>例：</p>\n<ul>\n<li>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>durid_demo<span class=\"token punctuation\">.</span>config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DruidDataSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StatViewServlet</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>druid<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebStatFilter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConfigurationProperties</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletRegistrationBean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @author zxy</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @description: TODO</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * @date 2021/5/18 9:53</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DruidConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@ConfigurationProperties</span><span class=\"token punctuation\">(</span>prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"spring.datasource\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DataSource</span> <span class=\"token function\">druidDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DruidDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 后台监控：web.xml,ServletRegistrationBean</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// 因为 Springboot 内置了 servlet 容器，所以没有 web.xml，替代方法：ServletRegistrationBean</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ServletRegistrationBean</span> <span class=\"token class-name\">StatViewServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">ServletRegistrationBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StatViewServlet</span><span class=\"token punctuation\">></span></span> bean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServletRegistrationBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StatViewServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/druid/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 后台需要有人登录，账号密码配置</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> initParameters <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 增加配置</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        initParameters<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loginUsername\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 登录 key 是固定的 loginUsernae loginPassword</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        initParameters<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loginPassword\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// 允许谁可以访问</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        initParameters<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"allow\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 禁止谁能访问 initParameters.put (\"kaungshen\",\"192.168.11.123\");// 用户名 + ip 地址</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        bean<span class=\"token punctuation\">.</span><span class=\"token function\">setInitParameters</span><span class=\"token punctuation\">(</span>initParameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 设置初始化</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">//filter</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FilterRegistrationBean</span> <span class=\"token function\">webStatFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">FilterRegistrationBean</span> bean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        bean<span class=\"token punctuation\">.</span><span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebStatFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token comment\">// 可以过滤那些请求呢？</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> initParameters <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token comment\">// 这些东西不进行统计，排除一下文件</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        initParameters<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"exclusions\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"*.js，*.css,/druid/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        bean<span class=\"token punctuation\">.</span><span class=\"token function\">setInitParameters</span><span class=\"token punctuation\">(</span>initParameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"七-整合mybatis及mybatis-plus\"><a class=\"anchor\" href=\"#七-整合mybatis及mybatis-plus\">#</a> 七、整合 Mybatis 及 Mybatis plus</h3>\n<ul>\n<li>\n<h4 id=\"mybatis\"><a class=\"anchor\" href=\"#mybatis\">#</a> Mybatis</h4>\n<ul>\n<li>\n<p>使用</p>\n<ol>\n<li>\n<p>导入包（保证存在 mybatis 和自己的数据库，这里是 mariadb）</p>\n<pre><code class=\"language-xml\">\n</code></pre>\n</li>\n<li>\n<p>配置文件</p>\n<p>这里需要连接一下自己的数据库</p>\n<pre><code class=\"language-properties\">\n</code></pre>\n</li>\n<li>\n<p>编写 model 层</p>\n<p>由于是重写之前的 kuangshenstudy_demo 项目，所以这边不再重复展示了，详情请看上方 ↑</p>\n</li>\n<li>\n<p>编写 mapper 层</p>\n<ol>\n<li>加上注解</li>\n</ol>\n<ul>\n<li>可以在编写 mapper 接口的时候在接口上打上 <code>@mapper</code>  注解和 <code>@Repository</code>  注解就可以了\n<ul>\n<li>相同的，也可以直接在整个项目的 Application 类的主方法上打上 <code>@MapperScan(&quot;com.example.kuangstudy_demo.mapper&quot;)</code></li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>在 mapper 上增设方法</p>\n<ol>\n<li>\n<p><code>DemartmentMapper</code></p>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<p><code>EmployeeMapper</code></p>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ol>\n</li>\n<li>\n<p>写完 mapper 之后，需要在 <code>resources</code>  包下新建一个 <code>mybatis</code>  文件夹，再 <code>mybatis</code>  下再新建一个 <code>mapper</code>  文件夹，在里面跟你项目的新建的 mapper 与之对应</p>\n</li>\n<li>\n<p>编写项目对应的 <code>*Mapper.xml</code></p>\n<ol>\n<li>\n<p><code>DemartmentMapper.xml</code></p>\n<pre><code class=\"language-xml\">\n</code></pre>\n</li>\n<li>\n<p><code>EmployeeMapper.xml</code></p>\n<pre><code class=\"language-xml\">\n</code></pre>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>mybatis 配置</p>\n<ol>\n<li>\n<p>因为写了 Mapper.xml，需要在 properties 上配置相对应的 mybatis</p>\n<pre><code class=\"language-properties\">\n</code></pre>\n</li>\n</ol>\n</li>\n<li>\n<p>service 层调用 dao 层</p>\n<ol>\n<li>\n<p>创建 serivce 层</p>\n<ul>\n<li>请务必根据方法名进行创建</li>\n</ul>\n</li>\n<li>\n<p>编写方法</p>\n<ul>\n<li>\n<p><code>DepartmentService</code></p>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<p><code>EmployeeService</code></p>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>controller 层调用 serivce 层</p>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<h4 id=\"mybatis-puls\"><a class=\"anchor\" href=\"#mybatis-puls\">#</a> Mybatis-puls</h4>\n<ol>\n<li>\n<p>调整数据库</p>\n<ul>\n<li>\n<p>Department</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Department\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Department</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span>AUTO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> departmentName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>Employee</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@TableName</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"Employee\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Employee</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableId</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">=</span> <span class=\"token class-name\">IdType</span><span class=\"token punctuation\">.</span>AUTO<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> lastName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> gender<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> departmentId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>exist <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Department</span> department<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token annotation punctuation\">@TableField</span><span class=\"token punctuation\">(</span>fill <span class=\"token operator\">=</span> <span class=\"token class-name\">FieldFill</span><span class=\"token punctuation\">.</span>INSERT_UPDATE<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Date</span> birth<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>编写 mapper 层</p>\n<ol>\n<li>\n<p>DepartmentMapper</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Repository</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">DepartmentMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 因为继承了 BaseMapper，所以基本的 CRUD 不用自己写了，只需要写一些自定义的一些 sql 语句</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>EmployeeMapper</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Repository</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">EmployeeMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseMapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Employee</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Employee</span> <span class=\"token function\">findEmpOrDepById</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Employee</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findEmpOrDepAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">insertEmp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Employee</span> employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li>\n<p>编写 mapper.xml</p>\n<ol>\n<li>\n<p>EmployeeMapper.xml</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.example.kuangstudy_demo.dao.EmployeeMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>EmpResulMap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.example.kuangstudy_demo.model.Employee<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>last_name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lastName<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gender<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gender<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>birth<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>birth<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>association</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                     <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.example.kuangstudy_demo.model.Department<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>did<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>department_name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>departmentName<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>association</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>findEmpOrDepAll<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>EmpResulMap<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        select e.id, e.last_name, e.email, e.gender, e.birth, d.id as did, d.department_name</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        from employee e</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        left join department d on e.department_id = d.id</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>findEmpOrDepById<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>EmpResulMap<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        select e.id, e.last_name, e.email, e.gender, e.birth, d.id as did, d.department_name</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        from employee e</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        left join department d on e.department_id = d.id where e.id = #&#123;id&#125;</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>insert</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>insertEmp<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.example.kuangstudy_demo.model.Employee<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        insert into employee(last_name,email,gender,birth,department_id)value(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;birth&#125;,#&#123;department.id&#125;)</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>insert</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li>\n<p>最后就是编写 Controller 层</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmployeeController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//    @Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//    EmployeeDao employeeDao;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//    @Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//    DemartmentDao demartmentDao;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">EmployeeMapper</span> employeeMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">DepartmentMapper</span> departmentMapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/* 查询所有员工 */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emps\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Employee</span><span class=\"token punctuation\">></span></span> employees <span class=\"token operator\">=</span> employeeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">findEmpOrDepAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"emps\"</span><span class=\"token punctuation\">,</span> employees<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">//         Collection&lt;Employee> employees = employeeDao.getAll();</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/list\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 浏览器查询</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toApppage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 查出所有部门的信息</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> departments <span class=\"token operator\">=</span> departmentMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">//         Collection&lt;Department> departments = demartmentDao.getDepartments();</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"departments\"</span><span class=\"token punctuation\">,</span> departments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/add\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// 添加员工表单</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">addEmp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Employee</span> employee<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"save\"</span> <span class=\"token operator\">+</span> employee<span class=\"token punctuation\">.</span><span class=\"token function\">getDepartmentId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        employee<span class=\"token punctuation\">.</span><span class=\"token function\">setDepartment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>departmentMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">.</span><span class=\"token function\">getDepartmentId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        employeeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token comment\">//        employeeMapper.insert(employee);</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">//        employeeDao.save (employee);// 调用底层方法，保存员工信息</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// 跳转到修改员工的界面</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/emp/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toUpdateEmp</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">// 查出原来的数据</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token class-name\">Employee</span> employee <span class=\"token operator\">=</span> employeeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">findEmpOrDepById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">//        Employee employee = employeeDao.getEmployeeById(id);</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"emp\"</span><span class=\"token punctuation\">,</span> employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token comment\">// 查出所有部门的信息</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Department</span><span class=\"token punctuation\">></span></span> departments <span class=\"token operator\">=</span> departmentMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token comment\">//        Collection&lt;Department> departments = demartmentDao.getDepartments();</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"departments\"</span><span class=\"token punctuation\">,</span> departments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"emp/update\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/updateEmp\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">updateEmp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Employee</span> employee<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        employeeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token comment\">//        employeeDao.save(employee);</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/deleteEmp/&#123;id&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">deleteEmp</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Integer</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        employeeMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token comment\">//        employeeDao.deleteById(id);</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已删除员工============》\"</span> <span class=\"token operator\">+</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/emps\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<hr />\n<h3 id=\"八-springsecurity环境搭建\"><a class=\"anchor\" href=\"#八-springsecurity环境搭建\">#</a> 八、SpringSecurity 环境搭建</h3>\n<ul>\n<li>\n<p>概念</p>\n<ul>\n<li>是一个功能强大且高度可定制的身份验证和访问控制框架</li>\n<li>用于<mark>保护基于 Spring 的应用程序的实际标准</mark></li>\n<li>致力于<mark>为 Java 应用程序提供身份验证和授权</mark></li>\n</ul>\n</li>\n<li>\n<p>思路</p>\n<ul>\n<li>\n<p>导入依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-security<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>需要记住的类</p>\n<ul>\n<li>WebSecurityConfigurerAdapter：自定义 Security 策略</li>\n<li>AuthenticationManagerBuilder：自定义认证策略</li>\n<li>@EnableWebSecurity：开启 WebSecurity 模式，  @Enable xxx 开启某个功能</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"九-用户认证和授权\"><a class=\"anchor\" href=\"#九-用户认证和授权\">#</a> 九、用户认证和授权</h3>\n<ul>\n<li>\n<p>步骤</p>\n<ul>\n<li>\n<p>创建一个 <code>config</code>  配置类去继承 <code>WebSecurityConfigurerAdapter</code> ，并且打上 <code>@EnableWebsecurity</code>  让 Spring 去托管这个类</p>\n</li>\n<li>\n<p>然后在刚刚继承了 <code>WebSecurityConfigurerAdapter</code>  的配置类上重写方法 <code>configure(http:HttpSecurity):void</code> ，案例如下：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableWebSecurity</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>现在我们来自己定制一些需求设置：</p>\n<ul>\n<li>\n<p>源码中的默认设置</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Using default configure(HttpSecurity). \"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                      <span class=\"token operator\">+</span> <span class=\"token string\">\"If subclassed this will potentially override subclass configure(HttpSecurity).\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> requests<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">httpBasic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>我们这里设置了首页允许被所有人访问；level1 需要 vip1，level2 需要 vip2，level3 需要 vip3</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 链式编程</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 首页所有人可以访问，功能页只有对应有权限的人才能访问</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 请求授权的规则</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level1/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level2/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip2\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level3/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 没有权限会默认到登录页面，需要开启登录的页面</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 这里的页面是 spring 自己写好的 login 页面</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 路由为:/login;  报错为:/login?error</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>接下来重写一下方法 <code>configure(auth:AuthenticationManagerBuilder):void</code> ，在内存中设置几个账户访问的权限，并且给密码进行加密</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 认证，springboot 2.1.x 可以直接使用</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 密码编码：passwordEncoder</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 在 Spring Security 5.0+ 新增了很多的加密方法～</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 这些数据正常应该从数据库中读取</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    auth<span class=\"token punctuation\">.</span><span class=\"token function\">inMemoryAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"vip3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"vip2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"vip3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"guest\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>如果想在数据库上进行账户的设置就可以根据官网的介绍来</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210608201336355.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210608201336355.png\" class=\"\"></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十-注销及权限控制\"><a class=\"anchor\" href=\"#十-注销及权限控制\">#</a> 十、注销及权限控制</h3>\n<ul>\n<li>\n<p>开启注销功能</p>\n<ul>\n<li>\n<p>只需要在上文编写的配置类中新增一个 <code>http.logout();</code>  即可</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 完成注销后会跳转到 \"/\" 页面</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>将不满足权限的部分不显示给该账户</p>\n<ul>\n<li>\n<p>首先需要导入新的依赖：``thymeleaf-extras-springsecurity`，这个包可以使你在 thymeleaf 中编写一些 springsecurity 的工作</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--security—thymeleaf 整合包 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">&lt;!-- 可以在 thymeleaf 中编写一些 springsecurity 的工作 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.thymeleaf.extras<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>thymeleaf-extras-springsecurity5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>在需要使用 security 的静态页面中引入包（不然没有提示），不添加这个也可以正常运行，只不过没有提示并且会爆红</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>sec</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org/thymeleaf-extras-springsecurity5<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>\n<p>问题解决：</p>\n<ol>\n<li>\n<p>如果引入了上面的 html 包，但是没有提示的话，请将其更改为 <code>http://www.thymeleaf.org/extras/spring-security</code></p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xhtml<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>sec</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org/extras/spring-security<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>这里我们可以添加一个当登陆成功后，显示当前登录账户的用户名和权限</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 登录注销 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>right menu<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 如果未登录 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!isAuthenticated()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/toLogin&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>address card icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span> 登录</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">&lt;!-- 如果已登陆：用户名 + 注销按钮 --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>isAuthenticated()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            用户名：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>principal.username<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            角色：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authentication</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>principal.authorities<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>isAuthenticated()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/logout&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sign-out icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span>注销</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li><mark>思维扩展</mark>：角色这里返回的是一个集合，如果需要更好的效果，需要另外去字符串截取一下；若权限等级是层层包含关系的话，可以尝试集合截取字符串减 1 再截取字符串来获取最高权限</li>\n</ul>\n</li>\n<li>\n<p>csrf</p>\n</li>\n<li>\n<p>将不满足权限的部分不显示给该账户</p>\n<ul>\n<li>在相关权限所展示的部分加上约束</li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>column<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">sec:</span>authorize</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hasRole(<span class=\"token punctuation\">'</span>vip1 <span class=\"token punctuation\">'</span>)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ui raised segment<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ui<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h5</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Level 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h5</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/level1/1&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bullhorn icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span> Level-1-1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/level1/2&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bullhorn icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span> Level-1-2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>@&#123;/level1/3&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bullhorn icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span> Level-1-3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十一-记住我及首页定制\"><a class=\"anchor\" href=\"#十一-记住我及首页定制\">#</a> 十一、记住我及首页定制</h3>\n<ul>\n<li>\n<p>登录 — 记住我功能</p>\n<ul>\n<li>\n<p>也同样是在上方编写的 Config 配置类中增加一条语句开启 <code>记住我</code> 功能即可</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 授权</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 首页所有人可以访问，功能页只有对应有权限的人才能访问</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 请求授权的规则</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level1/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level2/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip2\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/level3/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vip3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 没有权限会默认到登录页面，需要开启登录的页面</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 这里的页面是 spring 自己写好的 login 页面</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 路由为:/login;  报错为:/login?error</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 开启注销功能，跳转到首页</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 防止网站工具  csrf： 网络安全，防止 get 的重复发送请求进行攻击</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutRequestMatcher</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 开启记住我功能</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">rememberMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>添加完成后运行登陆界面，就会发现新增了一个 <code>记住我</code> 的按钮</p>\n<p><img data-src=\"SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210609132259468.png\" alt=\"\" /><img data-src=\"/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/image-20210609132259468.png\" class=\"\"></p>\n</li>\n<li>\n<p>其中 <code>记住我</code> 功能中的 cookie 默认保留 14 天</p>\n</li>\n</ul>\n</li>\n<li>\n<p>定制登录页面</p>\n<ul>\n<li>\n<p>需要将之前设置的 <code>http.formLogin</code>  进行增加</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 定制登录页 LoginPage (\"/toLogin\")</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toLogin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>根据自己定制化的登录页面来，将页面访问的路由更改为自己 <code>Controller</code>  相对应的路由即可</p>\n<ul>\n<li>\n<p>若前端页面访问的路由固定，后端也不想改 <code>Controller</code>  层的路由，那么可以在配置类中增加一下配置，让 springSecurity 默认的 <code>/&quot;login&quot;</code>  路由去做处理</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toLogin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>参考链接：https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>blog<span class=\"token punctuation\">.</span>csdn<span class=\"token punctuation\">.</span>net<span class=\"token operator\">/</span>m0_37609060<span class=\"token operator\">/</span>article<span class=\"token operator\">/</span>details<span class=\"token operator\">/</span><span class=\"token number\">115288956</span></pre></td></tr></table></figure></li>\n<li>\n<p>因为 springSecurity 默认的配置是认定前端返回的参数名是 username 和 password，倘若前端页面不一致的话，需要另外去设置该配置</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/toLogin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pwd\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>设置好定制化登陆页面之后，也可以另外设置定制化的记住我</p>\n<ul>\n<li>\n<p>首先需要确保在页面中存在这个按钮</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>remember<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>记住我</pre></td></tr></table></figure></li>\n<li>\n<p>第二步就是在 Config 配置类中设置自定义</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 开启记住我功能 cookie，默认保存两周，自定义接受前端的参数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">rememberMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rememberMeParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"remember\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十二-oauth2\"><a class=\"anchor\" href=\"#十二-oauth2\">#</a> 十二、Oauth2</h3>\n<ul>\n<li>概念\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTkvMDQvb2F1dGhfZGVzaWduLmh0bWw=\">http://www.ruanyifeng.com/blog/2019/04/oauth_design.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTQvMDUvb2F1dGhfMl8wLmh0bWw=\">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC80ZGFlZjQxZjE0YTU=\">https://www.jianshu.com/p/4daef41f14a5</span></li>\n</ul>\n</li>\n<li>步骤</li>\n</ul>\n<hr />\n<h3 id=\"十三-swagger\"><a class=\"anchor\" href=\"#十三-swagger\">#</a> 十三、Swagger</h3>\n<h4 id=\"131-swagger介绍及集成\"><a class=\"anchor\" href=\"#131-swagger介绍及集成\">#</a> 13.1、Swagger 介绍及集成</h4>\n<h4 id=\"132-配置swagger信息\"><a class=\"anchor\" href=\"#132-配置swagger信息\">#</a> 13.2、配置 Swagger 信息</h4>\n<h4 id=\"133-配置扫描接口及开关\"><a class=\"anchor\" href=\"#133-配置扫描接口及开关\">#</a> 13.3、配置扫描接口及开关</h4>\n<h4 id=\"134-分组和几口注释及小结\"><a class=\"anchor\" href=\"#134-分组和几口注释及小结\">#</a> 13.4、分组和几口注释及小结</h4>\n<hr />\n<h3 id=\"十四-springboot-apispringboot_day系列扩展\"><a class=\"anchor\" href=\"#十四-springboot-apispringboot_day系列扩展\">#</a> 十四、SpringBoot API（springboot_Day 系列扩展）</h3>\n<hr />\n<h3 id=\"十五-异步任务\"><a class=\"anchor\" href=\"#十五-异步任务\">#</a> 十五、异步任务</h3>\n<ul>\n<li>\n<p>思路</p>\n<ul>\n<li>开启异步 —&gt; 创建方法 —&gt; 调用方法</li>\n</ul>\n</li>\n<li>\n<p>操作</p>\n<ul>\n<li>\n<p>在 application.java 中开启异步</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableAsync</span>    <span class=\"token comment\">// 开启异步功能</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">KuangstudyDemoApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KuangstudyDemoApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>编写一个 serivce 层</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AsnycService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Async</span><span class=\"token comment\">// 告诉 Spring 这是一个异步的方法</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"数据正在处理中\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>在 Controller 中引用上面的 servce 层</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AsnycController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">AsnycService</span> asnycService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        asnycService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 停止三秒，转圈圈～</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十六-邮件任务\"><a class=\"anchor\" href=\"#十六-邮件任务\">#</a> 十六、邮件任务</h3>\n<ul>\n<li>\n<p>思路</p>\n<ul>\n<li>导包</li>\n<li>设置配置</li>\n<li>编写 service 层</li>\n<li>Controller 调用</li>\n</ul>\n</li>\n<li>\n<p>操作</p>\n<ul>\n<li>\n<p>导入依赖包</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-mail<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>设置配置</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 需要开启 smtp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.mail.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">smtp.qq.com</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.mail.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">465</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 发件人的邮箱</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">spring.mail.username</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1031574211@qq.com</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># qq 邮箱的第三方授权码 并非个人密码</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token attr-name\">spring.mail.password</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">irpeiiybmunxbbaj</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#开启 ssl 否则 503 错误</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token attr-name\">spring.mail.properties.mail.smtp.ssl.enable</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr></table></figure></li>\n<li>\n<p>编写 service 层</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Resource</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">JavaMailSender</span> javaMailSender<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;spring.mail.username&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> from<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * 发送纯文本邮件.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @param to      目标 email 地址</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @param subject 邮件主题</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     * @param text    纯文本内容</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMail</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">SimpleMailMessage</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleMailMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">setFrom</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1031574211@qq.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 谁发送这个邮件</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">setTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        javaMailSender<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMailPlus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MessagingException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 一个复杂的邮件</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">MimeMessage</span> mimeMessage <span class=\"token operator\">=</span> javaMailSender<span class=\"token punctuation\">.</span><span class=\"token function\">createMimeMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// 组装</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">MimeMessageHelper</span> helper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MimeMessageHelper</span><span class=\"token punctuation\">(</span>mimeMessage<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// 正文</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zxyPlus\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;p style='color:red'>zxyPlus&lt;/p>\"</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 附件</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">addAttachment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.jpg\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"可读取运行该项目的本机的绝对地址\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">addAttachment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.jpg\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"可读取运行该项目的本机的绝对地址\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">setTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2509917825@qq.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 收件人邮箱</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        helper<span class=\"token punctuation\">.</span><span class=\"token function\">setFrom</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1031574211@qq.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 发送者邮箱</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        javaMailSender<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>mimeMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>Controller 调用</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EmailService</span> emailService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 简单读取</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/send\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        emailService<span class=\"token punctuation\">.</span><span class=\"token function\">sendMail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1031574211@qq.com\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试邮件\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试邮件\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 读取文本发送</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/readFile\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">ClassPathResource</span> classPathResource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassPathResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"static/sms_code.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> stream <span class=\"token operator\">=</span> classPathResource<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">String</span> line <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>line <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                emailService<span class=\"token punctuation\">.</span><span class=\"token function\">sendMail</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试邮件\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试邮件\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已发送一条 >>>>> \"</span> <span class=\"token operator\">+</span> line <span class=\"token operator\">+</span> <span class=\"token string\">\"成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"success\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十七-定时执行任务\"><a class=\"anchor\" href=\"#十七-定时执行任务\">#</a> 十七、定时执行任务</h3>\n<ul>\n<li>\n<p>思路</p>\n<ul>\n<li>开启功能 —&gt; 创建方法 —&gt; 调用方法</li>\n</ul>\n</li>\n<li>\n<p>使用</p>\n<ul>\n<li>\n<p>开启服务：在 application.java 中启用定时任务功能</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableAsync</span>    <span class=\"token comment\">// 开启异步功能</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableScheduling</span>   <span class=\"token comment\">// 开启定时功能</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">KuangstudyDemoApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">KuangstudyDemoApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>创建方法：记得要在方法上打上 @Scheduled</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScheduledService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//cron 表达式</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 秒 分 时 日 月 星</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Scheduled</span><span class=\"token punctuation\">(</span>cron <span class=\"token operator\">=</span> <span class=\"token string\">\"* * * * * *\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello,你被执行了\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>调用方法：编写一个 Controller 直接调用就好</p>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"十八-springboot集成redis\"><a class=\"anchor\" href=\"#十八-springboot集成redis\">#</a> 十八、Springboot 集成 Redis</h3>\n<hr />\n<h3 id=\"十九-自定义redis-template\"><a class=\"anchor\" href=\"#十九-自定义redis-template\">#</a> 十九、自定义 Redis Template</h3>\n<hr />\n<h3 id=\"二十-分布式理论\"><a class=\"anchor\" href=\"#二十-分布式理论\">#</a> 二十、分布式理论</h3>\n<hr />\n<h3 id=\"二十一-什么是dubbo及zookeeper安装\"><a class=\"anchor\" href=\"#二十一-什么是dubbo及zookeeper安装\">#</a> 二十一、什么是 Dubbo 及 Zookeeper 安装</h3>\n<hr />\n<h3 id=\"二十二-服务注册发现实战\"><a class=\"anchor\" href=\"#二十二-服务注册发现实战\">#</a> 二十二、服务注册发现实战</h3>\n<hr />\n<h3 id=\"概念原理\"><a class=\"anchor\" href=\"#概念原理\">#</a> 概念原理</h3>\n<h4 id=\"1什么是springboot\"><a class=\"anchor\" href=\"#1什么是springboot\">#</a> 1. 什么是 Springboot</h4>\n<h4 id=\"2什么是微服务架构\"><a class=\"anchor\" href=\"#2什么是微服务架构\">#</a> 2. 什么是微服务架构</h4>\n<h4 id=\"3springboot自动装配原理\"><a class=\"anchor\" href=\"#3springboot自动装配原理\">#</a> 3.springboot 自动装配原理</h4>\n<h4 id=\"4主启动类是怎么运行的\"><a class=\"anchor\" href=\"#4主启动类是怎么运行的\">#</a> 4. 主启动类是怎么运行的</h4>\n<h4 id=\"5mvc原理\"><a class=\"anchor\" href=\"#5mvc原理\">#</a> 5.MVC 原理</h4>\n",
            "tags": [
                "计算机学习",
                "后端",
                "SpringBoot",
                "SpringBoot"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/redis/",
            "url": "https://xinyao_idiot.gitee.io/zxy/redis/",
            "title": "Redis初步学习",
            "date_published": "2021-05-13T08:30:03.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<blockquote>\n<p>Bilibili 搜索关注：狂神说（所有课程免费） 公众号：狂神说（日更文章）</p>\n</blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVM1NHkxUjdTQj9wPTE=\">bilibili 狂神聊 redis</span></p>\n<h1 id=\"狂神聊redis\"><a class=\"anchor\" href=\"#狂神聊redis\">#</a> 狂神聊 Redis</h1>\n<p>学习方式：不是为了面试和工作学习！仅仅是为了兴趣！兴趣才是最好的老师！</p>\n<ul>\n<li>基本的理论先学习，然后将知识融汇贯通！</li>\n</ul>\n<p><strong>狂神的 Redis 课程安排：</strong></p>\n<ul>\n<li>nosql 讲解</li>\n<li>阿里巴巴架构演进</li>\n<li>nosql 数据模型</li>\n<li>Nosql 四大分类</li>\n<li>CAP</li>\n<li>BASE</li>\n<li>Redis 入门</li>\n<li>Redis 安装（Window &amp; Linux 服务器）</li>\n<li>五大基本数据类型\n<ul>\n<li>String</li>\n<li>List</li>\n<li>Set</li>\n<li>Hash</li>\n<li>Zset</li>\n</ul>\n</li>\n<li>三种特殊数据类型\n<ul>\n<li>geo</li>\n<li>hyperloglog</li>\n<li>bitmap</li>\n</ul>\n</li>\n<li>Redis 配置详解</li>\n<li>Redis 持久化\n<ul>\n<li>RDB</li>\n<li>AOF</li>\n</ul>\n</li>\n<li>Redis 事务操作</li>\n<li>Redis 实现订阅发布（消息队列）</li>\n<li>Redis 主从复制</li>\n<li>Redis 哨兵模式（现在公司中所有的集群都用哨兵模式）</li>\n<li>缓存穿透及解决方案</li>\n<li>缓存击穿及解决方案</li>\n<li>缓存雪崩及解决方案</li>\n<li>基础 API 之 Jedis 详解</li>\n<li>SpringBoot 集成 Redis 操作</li>\n<li>Redis 的实践分析</li>\n</ul>\n<h1 id=\"nosql概述\"><a class=\"anchor\" href=\"#nosql概述\">#</a> Nosql 概述</h1>\n<h2 id=\"为什么要用nosql\"><a class=\"anchor\" href=\"#为什么要用nosql\">#</a> 为什么要用 Nosql</h2>\n<blockquote>\n<p>1 、单机 MySQL 的年代！</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515205042567.png\" alt=\"image-20210515205042567\" /></p>\n<p>90 年代，一个基本的网站访问量一般不会太大，单个数据库完全足够！</p>\n<p>那个时候，更多的去使用静态网页 Html ~ 服务器根本没有太大的压力！</p>\n<p>思考一下，这种情况下：整个网站的瓶颈是什么？</p>\n<p>1 、数据量如果太大、一个机器放不下了！</p>\n<p>2 、数据的索引 （B+ Tree），一个机器内存也放不下</p>\n<p>3 、访问量（读写混合），一个服务器承受不了～</p>\n<p>只要你开始出现以上的三种情况之一，那么你就必须要晋级！</p>\n<blockquote>\n<p>2 、Memcached（缓存） + MySQL + 垂直拆分 （读写分离）</p>\n</blockquote>\n<p>网站 80% 的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率！</p>\n<p>发展过程： 优化数据结构和索引 --&gt; 文件缓存（IO）---&gt; Memcached（当时最热门的技术！）</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515210046188.png\" alt=\"image-20210515210046188\" /></p>\n<blockquote>\n<p>3 、分库分表 + 水平拆分 + MySQL 集群</p>\n</blockquote>\n<p>技术和业务在发展的同时，对人的要求也越来越高！</p>\n<p><mark>本质：数据库（读、写）</mark></p>\n<p>早些年 MyISAM：表锁（100 万 张三 -- 密码），十分影响效率！高并发下就会出现严重的锁问题</p>\n<p>转战 Innodb：行锁（每次查询只锁一行）</p>\n<p>慢慢地就开始使用分库分表来解决写的压力！MySQL 在那个年代推出了表分区！这个并没有多少公司使用！</p>\n<p>MySQL 的集群，很好满足那个年代的所有需求！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515210907927.png\" alt=\"image-20210515210907927\" /></p>\n<blockquote>\n<p>4 、如今最近的年代</p>\n</blockquote>\n<p>2010--2020 十年之间，世界已经发生了翻天覆地的变化；（定位，也是一种数据，音乐，热榜！）</p>\n<p>MySQL 等关系型数据库就不够用了！数据量很多，变化很快～！</p>\n<p>MySQL 有的使用它来存储一些比较大的文件，博客，图片！数据库表很大，效率就低了！如果有一种数据库来专门处理这种数据，</p>\n<p>MySQL 压力就变得十分小（研究如何处理这些问题！）大数据的 IO 压力下，表几乎没法更大！</p>\n<blockquote>\n<p>目前一个基本的互联网项目！</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515212827051.png\" alt=\"image-20210515212827051\" /></p>\n<blockquote>\n<p>为什么要用 NoSQL！</p>\n</blockquote>\n<p>用户的个人信息、社交网络、地理位置、用户自己产生的数据、用户日志等等爆发式增长！</p>\n<p>这时候我们就需要使用 NoSQL 数据库的，Nosql 可以很好的处理以上的情况！</p>\n<h2 id=\"什么是nosql\"><a class=\"anchor\" href=\"#什么是nosql\">#</a> 什么是 NoSQL</h2>\n<blockquote>\n<p>NoSQL</p>\n</blockquote>\n<p>NoSQL = Not Only SQL （不仅仅是 SQL）</p>\n<p>关系型数据库：表格 ，行 ，列</p>\n<p>泛指非关系型数据库的，随着 web2.0 互联网的诞生！传统的关系型数据库很难对付 web2.0 时代！尤其是超大规模的高并发的社区！ 暴露出来很多难以克服的问题，NoSQL 在当今大数据环境下发展的十分迅速，Redis 是发展最快的，而且是我们当下必须要掌握的一个技术！</p>\n<p>很多的数据类型用户的个人信息，社交网络，地理位置。这些数据类型的存储不需要一个固定的格式！<br />\n不需要多余的操作就可以横向扩展的 ！ Map&lt;String,Object&gt; 使用键值对来控制！</p>\n<blockquote>\n<p>NoSQL 特点</p>\n</blockquote>\n<p>解耦！</p>\n<p>1 、方便扩展（数据之间没有关系，很好扩展！）</p>\n<p>2 、大数据量高性能（Redis 一秒写 8 万次，读取 11 万，NoSQL 的缓存记录级，是一种细粒度的缓存，性能会比较高！）</p>\n<p>3 、数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据量十分大的表，很多人就无法设计了！）</p>\n<p>4 、传统 RDBMS 和 NoSQL</p>\n<pre><code>传统的RDBMS\n- 结构化组织\n- SQL\n- 数据和关系都存在单独的表中 row col\n- 数据操作，数据定义语言\n- 严格的一致性\n- 基础的事务\n- ......\n</code></pre>\n<pre><code>Nosql\n- 不仅仅是数据\n- 没有固定的查询语言\n- 键值对存储，列存储，文档存储，图形数据库（社交关系）\n- 最终一致性\n- CAP定理 和BASE理论（异地多活）初级架构师！（只要学不死，就往死里学）\n- 高性能，高可用，高可扩展\n- ......\n</code></pre>\n<blockquote>\n<p>了解：3V+3 高</p>\n</blockquote>\n<p>大数据时代的 3V：主要是描述问题的</p>\n<ol>\n<li>海量 Volume</li>\n<li>多样 Variety</li>\n<li>实时 Velocity</li>\n</ol>\n<p>大数据时代的 3 高：主要是对程序的要求</p>\n<ol>\n<li>高并发</li>\n<li>高可扩（随时水平拆分，机器不够了，可以扩展机器来解决）</li>\n<li>高性能（保证用户体验和性能！）</li>\n</ol>\n<p>真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的，阿里巴巴的架构演进！</p>\n<p>技术没有高低之分，就看你如何去使用！（提升内功，思维的提高！）</p>\n<h2 id=\"阿里巴巴演进分析\"><a class=\"anchor\" href=\"#阿里巴巴演进分析\">#</a> 阿里巴巴演进分析</h2>\n<p>思考问题：这么多东西难道都是在一个数据库中的吗？</p>\n<p>技术急不得，越是慢慢学，才能越扎实！</p>\n<p>开源才是技术的王道！</p>\n<p><mark>任何一家互联网的公司，都不可能只是简简单单让用户能用就好了！</mark></p>\n<p>大量公司做的都是相同的业务；（竞品协议）</p>\n<p>随着这样的竞争，业务是越来越完善，然后对于开发者的要求也是越来越高！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515220434523.png\" alt=\"image-20210515220434523\" /></p>\n<p>如果你未来相当一个架构师： 没有什么是加一层解决不了的！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 1、商品的基本信息</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    名称、价格、商家信息：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    关系型数据库就可以解决了！MySQL/Oracle（淘宝早年就去IOE了！-王坚：推荐文章：阿里云的这群分子）</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    淘宝内部的 MySQL 不是大家用的 MySQL</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 2、商品的描述、评论（文字比较多）</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t文档型数据库中，Redis/MongoDB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 3、图片</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t分布式文件系统 FastDFS</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t- 淘宝自己的  TFS</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t- Gooale的   GFS</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t- Hadoop    HDFS</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t- 阿里云的    oss</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 4、商品的关键字（搜索）</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t- 搜索引擎 solr elasticsearch</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t- ISerach：多隆（多去了解一下这些技术大佬）</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t所有牛逼的人都有一段苦逼的岁月！但是你只要想SB一样的去坚持，终将牛逼！</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 5、商品热门的波段信息</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t- 内存数据库</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t- Redis  Tair、Memache<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># 6、商品的交易，外部的支付接口</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t- 三方应用</pre></td></tr></table></figure><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9hcnRpY2xlLzY1MzUxMQ==\">阿里云的这群疯子</span></p>\n<p>要知道，一个简单的网页背后的技术一定不是大家所想的那么简单！</p>\n<p>大型互联网应用问题：</p>\n<ul>\n<li>数据类型太多了！</li>\n<li>数据源繁多。经常重构！</li>\n<li>数据要改造，大面积改造比较麻烦</li>\n<li>解决问题:</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515222041025.png\" alt=\"image-20210515222041025\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515222408406.png\" alt=\"image-20210515222408406\" /></p>\n<p>这里以上都是 NoSQL 入门概述，不仅能够提高大家的知识，还可以帮助大家了解大厂的工作内容！</p>\n<h2 id=\"nosql的四大分类\"><a class=\"anchor\" href=\"#nosql的四大分类\">#</a> NoSQL 的四大分类</h2>\n<blockquote>\n<p><strong>KV 键值对：</strong></p>\n</blockquote>\n<ul>\n<li>\n<p>新浪： Redis</p>\n</li>\n<li>\n<p>美团：Redis + Tair</p>\n</li>\n<li>\n<p>阿里、百度：Redis + memacache</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>文档型数据库（bson 格式 和 json 一样）：</strong></p>\n</blockquote>\n<ul>\n<li>MongoDB （一般必须要掌握）\n<ul>\n<li>MongoDB 是一个基于分布式文件存储的数据库，C++ 编写，主要用来处理大量的文档！</li>\n<li>MongoDB 是一个介于关系型数据库和非关系型数据中中间的产品！MongoDB 是非关系型数据库中功能最丰富，最像关系型数据库的！</li>\n</ul>\n</li>\n<li>ConthDB</li>\n</ul>\n<blockquote>\n<p><strong>列存储数据库</strong></p>\n</blockquote>\n<ul>\n<li>HBase</li>\n<li>分布式文件系统</li>\n</ul>\n<blockquote>\n<p><strong>图关系数据库</strong></p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515223344089.png\" alt=\"image-20210515223344089\" /></p>\n<ul>\n<li>\n<p>他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐！</p>\n</li>\n<li>\n<p>Neo4j ，InfoGrid；</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>四者对比！</strong></p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515223913698.png\" alt=\"image-20210515223913698\" /></p>\n<p>敬畏之心可以使人进步！宇宙！科幻！</p>\n<p>活着的意义？ 追求幸福（帮助他人，感恩之心），探索未知（努力的学习，不要这个社会抛弃）</p>\n<h1 id=\"redis入门\"><a class=\"anchor\" href=\"#redis入门\">#</a> Redis 入门</h1>\n<h2 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h2>\n<blockquote>\n<p>Redis 是什么？</p>\n</blockquote>\n<p>Redis（<mark>Re</mark>mote <mark>Di</mark>ctionary <mark>S</mark>erver )，即远程字典服务！</p>\n<p>是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value 数据库，并提供多种语言的 API。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515225216671.png\" alt=\"image-20210515225216671\" /></p>\n<p>免费和开源！是当下最热门的 NoSQL 技术之一！也被人们称之为结构化数据库！</p>\n<p>redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了<br />\n master-slave (主从) 同步。</p>\n<blockquote>\n<p>Redis 能干嘛？</p>\n</blockquote>\n<p>1 、内存存储、持久化，内存中是断电即失、所以说持久化很重要（rdb、aof）</p>\n<p>2 、效率高，可以用于高速缓存</p>\n<p>3 、发布订阅系统</p>\n<p>4 、地图信息分析</p>\n<p>5 、计时器、计数器（浏览量！）</p>\n<p>6 、........</p>\n<blockquote>\n<p>特性</p>\n</blockquote>\n<p>1 、多样的数据类型</p>\n<p>2 、持久化</p>\n<p>3 、集群</p>\n<p>4 、事务</p>\n<p>......</p>\n<blockquote>\n<p>学习中需要用到的东西</p>\n</blockquote>\n<p>1 、狂神的公众号：狂神说</p>\n<p>2 、官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZWRpcy5pby8=\">https://redis.io/</span></p>\n<p>3 、中文网：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yZWRpcy5jbi8=\">http://www.redis.cn/</span></p>\n<p>4 、下载地址：通过官网下载即可！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515225832019.png\" alt=\"image-20210515225832019\" /></p>\n<p>注意：Wdinow 在 Github 上下载（停更很久了！）</p>\n<p><mark>Redis 推荐都是在 Linux 服务器上搭建的，我们是基于 Linux 学习！</mark></p>\n<h2 id=\"windows安装\"><a class=\"anchor\" href=\"#windows安装\">#</a> Windows 安装</h2>\n<p>1 、下载安装包：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RtYWpraWMvcmVkaXMvcmVsZWFzZXM=\">https://github.com/dmajkic/redis/releases</span></p>\n<p>2 、下载完毕得到压缩包：</p>\n<p>3 、解压到自己电脑上的环境目录下的就可以的！Redis 十分的小，只有 5M</p>\n<p>4 、开启 Redis，双击运行服务即可！</p>\n<p>5 、使用 redis 客户单来来连接 redis</p>\n<p>记住一句话，Window 下使用确实简单，但是 Redis 推荐我们使用 Linux 去开发使用！</p>\n<h2 id=\"linux安装\"><a class=\"anchor\" href=\"#linux安装\">#</a> Linux 安装</h2>\n<p>1 、下载安装包！  <code>redis-5.0.8.tar.gz</code></p>\n<p>2 、解压 Redis 的安装包！ 程序一般放到 /opt 目录下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mv</span> redis-6.2.3.tar.gz /opt</pre></td></tr></table></figure><p>3 、进入解压后的文件，可以看到我们 redis 的配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> -zxvf redis-6.2.3.tar.gz</pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231004876.png\" alt=\"image-20210515231004876\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231111463.png\" alt=\"image-20210515231111463\" /></p>\n<p>4 、基本的环境安装</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> gcc-c++</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231552495.png\" alt=\"image-20210515231552495\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231737409.png\" alt=\"image-20210515231737409\" /></p>\n<p>5 、redis 的默认安装路径 <code> /usr/local/bin</code></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231925392.png\" alt=\"image-20210515231925392\" /></p>\n<p>6 、将 redis 配置文件。复制到我们当前目录下</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232123274.png\" alt=\"image-20210515232123274\" /></p>\n<p>7 、redis 默认不是后台启动的，修改配置文件！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232321291.png\" alt=\"image-20210515232321291\" /></p>\n<p>8 、启动 Redis 服务！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server maoconfig/redis.conf</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232453274.png\" alt=\"image-20210515232453274\" /></p>\n<p>9 、使用 redis-cli 进行连接测试！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232759601.png\" alt=\"image-20210515232759601\" /></p>\n<p>10 、查看 redis 的进程是否开启！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233041587.png\" alt=\"image-20210515233041587\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam /<span class=\"token punctuation\">]</span><span class=\"token comment\"># ps -ef|grep redis</span></pre></td></tr></table></figure><p>11 、如何关闭 Redis 服务呢？ shutdown</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233158652.png\" alt=\"image-20210515233158652\" /></p>\n<p>12 、再次查看进程是否存在</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233211116.png\" alt=\"image-20210515233211116\" /></p>\n<p>13 、后面我们会使用单机多 Redis 启动集群测试！</p>\n<h2 id=\"测试性能\"><a class=\"anchor\" href=\"#测试性能\">#</a> 测试性能</h2>\n<p><strong>redis-benchmark</strong> 是一个压力测试工具！</p>\n<p>官方自带的性能测试工具！</p>\n<p>redis-benchmark 命令参数！</p>\n<p>图片来自菜鸟教程：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233448855.png\" alt=\"image-20210515233448855\" /></p>\n<p>我们来简单测试下：</p>\n<p>如何查看这些分析呢？</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 测试： 100 个并发连接 100000 请求</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>redis-benchmark -h localhost -p <span class=\"token number\">6379</span> -c <span class=\"token number\">100</span> -n <span class=\"token number\">100000</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234105056.png\" alt=\"image-20210515234105056\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234452037.png\" alt=\"image-20210515234452037\" /></p>\n<p>查看这些分析？</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234613748.png\" alt=\"image-20210515234613748\" /></p>\n<h2 id=\"基础的知识\"><a class=\"anchor\" href=\"#基础的知识\">#</a> 基础的知识</h2>\n<p>redis 默认有 16 个数据库</p>\n<p><strong>默认使用的是第 0 个</strong></p>\n<p>可以使用 select 进行切换数据库！</p>\n<p>清除当前数据库 flushdb</p>\n<p>清除全部数据库的内容 FLUSHALL</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">3</span> <span class=\"token comment\"># 切换数据库</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> DBSIZE  <span class=\"token comment\"># 查看 DB 大小！</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516200010388.png\" alt=\"image-20210516200010388\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *  <span class=\"token comment\"># 查看数据库所有的 key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr></table></figure><p>清除当前的数据库 <code>flushdb</code></p>\n<p>清空全部数据库  <code>flushall</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> flushdb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>empty array<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>思考：为什么 redis 是 6379 ！粉丝效应！（了解一下即可！）</p>\n<blockquote>\n<p>Redis 是单线程的！</p>\n</blockquote>\n<p>明白 Redis 是很快的，官方表示，Redis 是基于内存操作，CPU 不是 Redis 性能瓶颈，Redis 的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程来实现，就使用单线程了！所以就使用了单线程了！</p>\n<p>Redis 是 C 语言写的，官方提供的数据为 100000+ 的 QPS，完全不比同样是使用 key-vale 的 Memecache 差！</p>\n<p><strong>Redis 为什么单线程还这么快？</strong></p>\n<p>1 、误区 1 ：高性能的服务器一定是多线程的？</p>\n<p>2 、误区 2 ：多线程（CPU 上下文会切换！）一定比单线程效率高！</p>\n<p>先去 CPU &gt; 内存 &gt; 硬盘的速度要有所了解！</p>\n<p>核心：redis 是将所有的数据全部放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU 上下文会切换：耗时的操作！！！），对于内存系统来说，如果没有上下文切换效率就是最高<br />\n的！多次读写都是在一个 CPU 上的，在内存情况下，这个就是最佳的方案！</p>\n<h1 id=\"五大数据类型\"><a class=\"anchor\" href=\"#五大数据类型\">#</a> 五大数据类型</h1>\n<blockquote>\n<p>官网文档</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516201315950.png\" alt=\"image-20210516201315950\" /></p>\n<p><code>全段翻译：</code></p>\n<p>Redis 是一个开源（BSD 许可）的，内存中的数据结构存储系统，它可以用作<mark>数据库、缓存和消息中间件 MQ</mark>。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合<br />\n（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA 脚本（Lua scripting）， LRU 驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis 哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p>\n<blockquote>\n<p>移动 key</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> move name <span class=\"token number\">1</span> <span class=\"token comment\"># 将 key 为 name 的 key 移动到 1 号数据库</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"age\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr></table></figure><blockquote>\n<p>我们现在讲解的所有命令大家一定要全部记住，后面我们使用 SpringBoot。Jedis，所有的方法就是这些命令！</p>\n<p>单点登录</p>\n</blockquote>\n<h2 id=\"redis-key\"><a class=\"anchor\" href=\"#redis-key\">#</a> Redis-Key</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *  <span class=\"token comment\"># 查看所有的 key</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>empty list or <span class=\"token builtin class-name\">set</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> name kuangshen  <span class=\"token comment\"># set key</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> age <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"age\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> EXISTS name  <span class=\"token comment\"># 判断当前的 key 是否存在</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> EXISTS name</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> move name <span class=\"token number\">1</span> <span class=\"token comment\"># 将 key 为 name 的 key 移动到 1 号数据库</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#################################################</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"age\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token keyword\">select</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> keys *</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> name qinjiang</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"age\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">clear</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"age\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token punctuation\">)</span> <span class=\"token string\">\"name\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token string\">\"qinjiang\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> EXPIRE name <span class=\"token number\">10</span> <span class=\"token comment\"># 设置 key 的过期时间，单位是秒</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name  <span class=\"token comment\"># 查看当前 key 的剩余时间</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl name</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> -</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get name</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">type</span> name  <span class=\"token comment\"># 查看当前 key 的一个类型！</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>string</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">127</span> .0.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">type</span> age</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>string</pre></td></tr></table></figure><p>后面如果遇到不会的命令，可以在官网查看帮助文档！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516202657996.png\" alt=\"image-20210516202657996\" /></p>\n<h2 id=\"string字符串\"><a class=\"anchor\" href=\"#string字符串\">#</a> String（字符串）</h2>\n<p>90% 的 java 程序员使用 redis 只会使用一个 String 类型！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> key1 v1\t\t<span class=\"token comment\"># 设置值</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key1\t\t<span class=\"token comment\"># 获得值</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *\t\t\t<span class=\"token comment\"># 获得所有的 key</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"key1\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> exists key1\t\t<span class=\"token comment\"># 判断某一个 key 是否存在</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> append key1 hello  <span class=\"token comment\"># 追加字符串，如果当前 key 不存在，就相当于 set key</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\"v1hello\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> strlen key1\t\t<span class=\"token comment\"># 获取字符串的长度</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> append key1 mao</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> strlen key1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\"v1hellomao\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># i++</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># 步长 i+=</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> views <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get views</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incr views\t\t<span class=\"token comment\"># 自增 1  浏览量为 1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incr views</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get views</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decr views\t\t<span class=\"token comment\"># 自减 1   浏览量 - 1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decr views</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decr views</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> -1</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get views</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token string\">\"-1\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> incrby views <span class=\"token number\">10</span>\t\t<span class=\"token comment\">#可以设置步长，指定增量</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">9</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> decrby views <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\"># 字符串范围 range</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> key1 hello,mao\t\t<span class=\"token comment\"># 设置 key1 的值</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key1</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token string\">\"hello,mao\"</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getrange key1 <span class=\"token number\">0</span> <span class=\"token number\">3</span>\t\t<span class=\"token comment\"># 截取字符串 [0,3]</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token string\">\"hell\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getrange key1 <span class=\"token number\">0</span> -1\t\t<span class=\"token comment\"># 获取全部的字符串 和 get key 是一样的</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token string\">\"hello,mao\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\"># 替换！</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> key2 abcdefg</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key2</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token string\">\"abcdefg\"</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setrange key2 <span class=\"token number\">1</span> XX\t\t<span class=\"token comment\">#替换指定位置开始的字符串</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key2</pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token string\">\"aXXdefg\"</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token comment\"># setex (set with expire) # 设置过期时间</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\"># setnx (set if not exist) # 不存在再设置 (在分布式锁中常常使用)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setex key3 <span class=\"token number\">30</span> hello\t\t<span class=\"token comment\"># 设置 key3 的值为 hello，30 秒后过期</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl key3</pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">26</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get key3</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setnx mykey redis\t\t<span class=\"token comment\"># 如果 mykey 不存在，创建 mykey</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"key2\"</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mykey\"</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"key1\"</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ttl key3</pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> -2</pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> setnx mykey MongoDB\t\t<span class=\"token comment\"># 如果 mykey 存在，创建失败</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get mykey</pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token string\">\"redis\"</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token comment\"># mset</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token comment\"># mget</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mset k1 v1 k2 v2 k3 v3\t\t<span class=\"token comment\">#同时设置多个值</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> keys *</pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k2\"</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k3\"</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"k1\"</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mget k1 k2 k3\t\t<span class=\"token comment\"># 同时获取多个值</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v3\"</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> msetnx k1 v1 k4 v4\t\t<span class=\"token comment\"># msetnx 是一个原子性的操作，要么一起成功，要么一起失败</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k4</pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token comment\"># 对象</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token builtin class-name\">set</span> user:1<span class=\"token punctuation\">&#123;</span>name:zhangsan,age:3<span class=\"token punctuation\">&#125;</span>  <span class=\"token comment\"># 设置一个 user：1 对象 值为 json 字符来保存一个对象！</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token comment\"># 这里的 key 是一个巧妙地设计：user:&#123;id&#125;:&#123;filed&#125;, 如此设计在 Redis 中是完全 OK 了！</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mset user:1:name zhangsan user:1:age <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> mget user:1:name user:1:age</pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>getset <span class=\"token comment\"># 先 get 然后再 set</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getset db redis\t\t<span class=\"token comment\"># 如果不存在值，则返回 nil</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get db</pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token string\">\"redis\"</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getset db MongoDB\t\t<span class=\"token comment\"># 如果存在值，获取原来的值，并设置新的值</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token string\">\"redis\"</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get db</pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token string\">\"MongoDB\"</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr></table></figure><p>数据结构是相通的！</p>\n<p>String 类似的使用场景：value 除了是我们的字符串还可以是我们的数字！</p>\n<ul>\n<li>计数器</li>\n<li>统计多单位的数量</li>\n<li>粉丝数</li>\n<li>对象缓存存储！</li>\n</ul>\n<h2 id=\"list列表\"><a class=\"anchor\" href=\"#list列表\">#</a> List（列表）</h2>\n<p>基本的数据类型，列表</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516211032480.png\" alt=\"image-20210516211032480\" /></p>\n<p>在 redis 里面，我们可以把 list 玩成 ，栈、队列、阻塞队列！</p>\n<p>所有的 list 命令都是用 l 开头的，Redis 不区分大小命令</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list one\t\t<span class=\"token comment\">#将一个值或多个值插入到列表的头部（左）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list two</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list three</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1\t\t<span class=\"token comment\"># 获取 list 中的值！</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> <span class=\"token number\">1</span>\t\t<span class=\"token comment\"># 通过区间获取具体的值！</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush list right\t\t<span class=\"token comment\">#将一个值或多个插入到列表尾部（右）</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"right\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>lpop</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>rpop</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"right\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpop list \t\t<span class=\"token comment\"># 移除 list 的第一个元素</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpop list\t\t<span class=\"token comment\"># 移除 list 的最后一个元素</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token string\">\"right\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>Lindex</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lindex list <span class=\"token number\">1</span>\t\t<span class=\"token comment\"># 通过下标获得 list 中的某一个值！</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lindex list <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>Llen</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list one</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list two</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list three</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> llen list\t\t<span class=\"token comment\"># 返回列表的长度</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>移除指定的值！</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>lrem</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrem list <span class=\"token number\">1</span> one\t\t<span class=\"token comment\"># 移除 list 集合中指定个数的 value，精确匹配</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrem list <span class=\"token number\">2</span> three</pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> -1\t<span class=\"token comment\"># 移除 list 集合中指定个数的 value，移除 2 个 three</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>trim 修剪：list 截断</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello1</pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello2</pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello3</pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ltrim mylist <span class=\"token number\">1</span> <span class=\"token number\">2</span>\t<span class=\"token comment\"># 通过下标截取指定的长度，这个 list 已经被改变了，截断了只剩下截取的元素！</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange mylist <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello1\"</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello2\"</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>rpoplpush <span class=\"token comment\"># 移除列表的最后一个元素并移动到新的列表当中</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello1</pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello2</pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpoplpush mylist myotherlist\t <span class=\"token comment\"># 移除列表的最后一个元素，并移动到新的列表当中！</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token string\">\"hello2\"</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange mylist <span class=\"token number\">0</span> -1\t<span class=\"token comment\">#查看原来的列表</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello1\"</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange myotherlist <span class=\"token number\">0</span> -1\t<span class=\"token comment\">#查看目标列表中，确实存在该值</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello2\"</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>lset <span class=\"token comment\"># 将列表中指定下标的值替换为另外一个值，更新操作</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> exists list\t\t<span class=\"token comment\"># 判断这个列表是否存在</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset list <span class=\"token number\">0</span> item\t<span class=\"token comment\"># 如果不存在列表我们去更新就会报错</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR no such key</pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lpush list value1</pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"value1\"</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset list <span class=\"token number\">0</span> item\t<span class=\"token comment\"># 如果存在，就更新下标的值</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange list <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"item\"</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lset list <span class=\"token number\">1</span> other\t<span class=\"token comment\"># 如果存在列表，但不存在值也会报错</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR index out of range</pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>linsert\t<span class=\"token comment\"># 将某个具体的 value 插入到列表中某个元素的前面后者后面</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> rpush mylist world</pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> linsert mylist before world other\t<span class=\"token comment\"># 在 world 前面插入 other</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange mylist <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"other\"</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> linsert mylist after world new\t<span class=\"token comment\"># 在 world 后面插入 new</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> lrange mylist <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"other\"</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"new\"</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr></table></figure><blockquote>\n<p>小结</p>\n</blockquote>\n<ul>\n<li>他实际上是一个链表，before Node after ， 它的 left，right 都可以插入值</li>\n<li>如果 key 不存在，创建新的链表</li>\n<li>如果 key 存在，新增内容</li>\n<li>如果移除了所有值，空链表，也代表不存在！</li>\n<li>在两边插入或者改动值效率最高！如果操作中间元素，相对来说效率会低一点</li>\n</ul>\n<p>消息排队！消息队列 （Lpush，Rpop），栈（Lpush，Lpop）</p>\n<h2 id=\"set集合\"><a class=\"anchor\" href=\"#set集合\">#</a> Set（集合）</h2>\n<p>set 中的值是不能重读的！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset hello\t\t<span class=\"token comment\"># set 集合中添加元素</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset mao</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset lovemao</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smembers myset\t\t<span class=\"token comment\"># 查看指定 set 的所有值</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SISMEMBER myset hello\t<span class=\"token comment\">#判断某一个值是不是在 set 集合中！，存在返回 1，不存在返回 0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SISMEMBER myset world</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SCARD myset\t\t<span class=\"token comment\"># 获取 set 集合中的内容元素个数</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset lovemao2</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> scard myset</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>srem</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> srem myset hello\t\t<span class=\"token comment\"># 移除 set 集合中的指定元素</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> scard myset</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token comment\"># 无序不重复集合。抽随机！</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset\t\t<span class=\"token comment\"># 随机抽选出一个元素</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset <span class=\"token number\">2</span>\t\t<span class=\"token comment\">#随机抽选出指定个数的元素</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SRANDMEMBER myset <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>删除指定的key：srem，随机删除key：spop！</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> spop myset\t\t<span class=\"token comment\"># 随机删除一些 set 集合中的元素！</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token string\">\"lovemao\"</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> spop myset</pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lovemao2\"</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token comment\"># 将一个指定的值移动到另外一个 set 集合中</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset hello</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset</pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR wrong number of arguments <span class=\"token keyword\">for</span> <span class=\"token string\">'sadd'</span> <span class=\"token builtin class-name\">command</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset world</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset mao</pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd myset2 set2</pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> smove myset myset2 mao\t<span class=\"token comment\"># 将一个指定的值，移动到另外一个 set 集合中</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SMEMBERS myset2</pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"set2\"</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>微博，B站，共同关注！<span class=\"token punctuation\">(</span>并集<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>数字集合类：</pre></td></tr><tr><td data-num=\"92\"></td><td><pre> - 差集 SDIFF</pre></td></tr><tr><td data-num=\"93\"></td><td><pre> - 交集 SINTER</pre></td></tr><tr><td data-num=\"94\"></td><td><pre> - 并集 SUNION</pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd key1 b</pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd key1 c</pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd key2 c</pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd key2 d</pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> sadd key2 e</pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SDIFF key1 key2\t\t<span class=\"token comment\"># 差集</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SINTER key1 key2\t\t<span class=\"token comment\"># 交集   共同好友就可以这样实现</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SUNION key1 key2\t\t<span class=\"token comment\"># 并集</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"c\"</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"b\"</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"e\"</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"a\"</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"d\"</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr></table></figure><p>微博，A 用户将所有关注的人放在一个 set 集合中！将他的粉丝也放在一个集合中！</p>\n<p>共同关注，共同爱好，二度好友（六度分割理论）</p>\n<h2 id=\"hash哈希\"><a class=\"anchor\" href=\"#hash哈希\">#</a> Hash（哈希）</h2>\n<p>Map 集合，key-map! 时候这个值是一个 map 集合！ 本质和 String 类型没有太大区别，还是一个简单的 key-value！</p>\n<p>set myhash field mao</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hset myhash field1 mao\t<span class=\"token comment\"># set 一个具体的 key-value</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hget myhash field1\t<span class=\"token comment\"># 获取一个字段值</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hmset myhash field1 hello field2 world\t<span class=\"token comment\"># set 多个 key-value</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hmget myhash field1 field2\t<span class=\"token comment\"># 获取多个字段值</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall myhash\t<span class=\"token comment\"># 获取全部的数据</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field1\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field2\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hdel myhash field1\t<span class=\"token comment\"># 删除 hash 指定的 key 字段！对应的 value 值也就消失了！</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall myhash</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field2\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>hlen <span class=\"token comment\"># 获取 hash 表的字段数量！</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hmset myhash field1 hello field2 world</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hgetall myhash</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field2\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field1\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hlen myhash\t<span class=\"token comment\"># 获取 hash 表的字段数量！</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> HEXISTS myhash field1\t<span class=\"token comment\"># 判断 hash 中指定字段是否存在！</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> HEXISTS myhash field3</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 只获得所有 field</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\"># 只获得所有 value</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hkeys myhash\t<span class=\"token comment\"># 只获得所有 field</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field2\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"field1\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hvals myhash\t<span class=\"token comment\"># 只获得所有 value</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"world\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>incr  decr</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hset myhash field3 <span class=\"token number\">5</span>\t<span class=\"token comment\"># 指定增量</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> HINCRBY myhash field3 <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> HINCRBY myhash field3 -1</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hsetnx myhash field4 hello\t<span class=\"token comment\">#如果不存在则可以设置</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> hsetnx myhash field4 hello\t<span class=\"token comment\"># 如果存在则不能设置</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr></table></figure><p>hash 变更的数据 user name age，尤其是用户信息之类的，经常变动的信息！hash 更适合于对象的存储，而 string 更加适合字符串的存储！</p>\n<h2 id=\"zset有序集合\"><a class=\"anchor\" href=\"#zset有序集合\">#</a> Zset（有序集合）</h2>\n<p>在 set 的基础上，增加了一个值，set k1 v1 zset k1 score1 v1</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd myset <span class=\"token number\">1</span> one\t\t<span class=\"token comment\">#添加一个值</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd myset <span class=\"token number\">2</span> two <span class=\"token number\">3</span> three\t<span class=\"token comment\">#添加多个值</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ZRANGE myset <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"one\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"two\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"three\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>排序如何实现</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd salary <span class=\"token number\">2500</span> xiaohong\t<span class=\"token comment\"># 添加三个用户</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd salary <span class=\"token number\">5000</span> zhangsan</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd salary <span class=\"token number\">500</span> mao</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># ZRANGEBYSCORE key min max</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ZRANGEBYSCORE salary -inf +inf\t<span class=\"token comment\">#显示全部的用户 从小到大</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaohong\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ZREVRANGE salary <span class=\"token number\">0</span> -1\t<span class=\"token comment\"># 从大到小进行排序</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ZRANGEBYSCORE salary -inf +inf withscores\t<span class=\"token comment\"># 显示全部的用户并且附带成绩</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"500\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaohong\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2500\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> ZRANGEBYSCORE salary -inf <span class=\"token number\">2500</span> withscores\t<span class=\"token comment\"># 显示工资小于 2500 员工的升序排列</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"500\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaohong\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"2500\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 移除 rem 中的元素</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange salary <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xiaohong\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrem salary xiaohong\t<span class=\"token comment\"># 移除有序集合中的指定的元素</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange salary <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"mao\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"zhangsan\"</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zcard salary\t\t<span class=\"token comment\"># 获取有序集合中的个数</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd myset <span class=\"token number\">1</span> hello</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zadd myset <span class=\"token number\">2</span> world <span class=\"token number\">3</span> mao</pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zcount myset <span class=\"token number\">1</span> <span class=\"token number\">3</span>\t<span class=\"token comment\"># 获取指定区间的成员数量</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zcount myset <span class=\"token number\">1</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr></table></figure><p>其余的一些 API，通过我们的学习，剩下的如果工作中又需要，这个时候可以去查看官方文档！</p>\n<p>案例思路：set 排序  存储班级成绩表  工资表排序！</p>\n<p>普通消息，1，重要消息，2，带权重进行判断！</p>\n<p>排行榜应用实现，取 Top 值</p>\n<h1 id=\"三种特殊数据类型\"><a class=\"anchor\" href=\"#三种特殊数据类型\">#</a> 三种特殊数据类型</h1>\n<h2 id=\"geospatial-地理位置\"><a class=\"anchor\" href=\"#geospatial-地理位置\">#</a> Geospatial 地理位置</h2>\n<p>朋友的定位，附近的人，打车距离计算？</p>\n<p>Redis 的 Geo 在 Redis3.2 版本就推出了！ 这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人！</p>\n<p>可以查询一些测试数据：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qaW5nd2VpZHUuYm1jeC5jb20v\">https://jingweidu.bmcx.com/</span></p>\n<p>只有 六个命令：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210517220126455.png\" alt=\"image-20210517220126455\" /></p>\n<blockquote>\n<p>geoadd</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210517221324145.png\" alt=\"image-20210517221324145\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">##########################################################</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># geoadd 添加地理位置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 规则：两级无法直接添加，我们一般会下载城市数据，直接通过 java 程序一次性导入</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 参数 key 值（经度，维度，名称）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 由 EPSG：900913 / EPSG：3785 / OSGEO：41001 指定的确切限制如下：</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 有效经度为 - 180 至 180 度。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 有效纬度为 - 85.05112878 至 85.05112878 度。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 当用户尝试索引超出指定范围的坐标时，该命令将报告错误。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">34.23</span> <span class=\"token number\">108.93</span> nanchang</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR invalid longitude,latitude pair <span class=\"token number\">34.230000</span>,108.930000</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">116.23</span> <span class=\"token number\">40.22</span> beijing</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">121.48</span> <span class=\"token number\">31.40</span> shanghai</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">106.54</span> <span class=\"token number\">29.40</span> chongqing</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">113.88</span> <span class=\"token number\">22.55</span> shenzhen</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">120.21</span> <span class=\"token number\">30.20</span> hangzhou</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geoadd china:city <span class=\"token number\">108.93</span> <span class=\"token number\">34.23</span> xian</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><blockquote>\n<p>geopos</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEOPOS china:city beijing\t<span class=\"token comment\"># 获取指定的城市的经度和纬度！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"116.23000055551528931\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"40.2200010338739844\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEOPOS china:city chongqing</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.54000014066696167\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.39999880018641676\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEOPOS china:city beijing chongqing</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"116.23000055551528931\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"40.2200010338739844\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.54000014066696167\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.39999880018641676\"</span></pre></td></tr></table></figure><blockquote>\n<p>GEODIST</p>\n</blockquote>\n<p>两人之间的距离</p>\n<p>单位：</p>\n<ul>\n<li><strong>m</strong> 表示单位为米。</li>\n<li><strong>km</strong> 表示单位为千米。</li>\n<li><strong>mi</strong> 表示单位为英里。</li>\n<li><strong>ft</strong> 表示单位为英尺。</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEODIST china:city beijing shanghai km\t<span class=\"token comment\"># 查看上海到北京的直线距离</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\"1088.7854\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEODIST china:city beijing chongqing km\t<span class=\"token comment\"># 查看重庆到北京的直线距离</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"1491.6716\"</span></pre></td></tr></table></figure><blockquote>\n<p>GEORADIUS 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p>\n</blockquote>\n<p>我附近的人？（获得所有附近的人的地址，定位！) 通过半径来查询！</p>\n<p>获得指定数量的人，200</p>\n<p>所有的数据应该录入：china:city，才会让结果更加清晰！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">1000</span> km\t<span class=\"token comment\"># 以 110，30 这个经纬度为中心，寻找方圆 1000km 内的城市</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shenzhen\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">500</span> km</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">500</span> km withdist\t<span class=\"token comment\"># 显示到中心距离的位置</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"340.8679\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"481.1540\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">500</span> km withcoord\t<span class=\"token comment\"># 显示他人的定位信息</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.54000014066696167\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.39999880018641676\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"108.92999857664108276\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"34.23000121926852302\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">500</span> km withdist withcoord count <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"340.8679\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.54000014066696167\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.39999880018641676\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUS china:city <span class=\"token number\">110</span> <span class=\"token number\">30</span> <span class=\"token number\">500</span> km withdist withcoord count <span class=\"token number\">2</span>\t<span class=\"token comment\"># 筛选出指定的结果！</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"340.8679\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"106.54000014066696167\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"29.39999880018641676\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"481.1540\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"108.92999857664108276\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"34.23000121926852302\"</span></pre></td></tr></table></figure><blockquote>\n<p>GEORADIUSBYMEMBER</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 找出位于指定元素周围的其他元素！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUSBYMEMBER china:city beijing <span class=\"token number\">1000</span> km</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> GEORADIUSBYMEMBER china:city shanghai <span class=\"token number\">400</span> km</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shanghai\"</span></pre></td></tr></table></figure><blockquote>\n<p>GEOHASH  返回一个或多个位置元素的 Geohash 表示。</p>\n</blockquote>\n<p>该命令将返回 11 个字符的 Geohash 字符串</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 将二维的经纬度转换为一维的字符串，如果两个字符串越接近，那么则距离越近！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> geohash china:city beijing chongqing</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wx4sucu47r0\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"wm5z22h53v0\"</span></pre></td></tr></table></figure><blockquote>\n<p>GEO 底层的实现原理其实就是 Zset！我们可以使用 Zset 命令来操作 geo！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange china:city <span class=\"token number\">0</span> -1\t<span class=\"token comment\"># 查看地图中全部的元素</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shenzhen\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shanghai\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"beijing\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrem china:city beijing\t\t<span class=\"token comment\"># 移除指定的元素</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> zrange china:city <span class=\"token number\">0</span> -1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"chongqing\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"xian\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shenzhen\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hangzhou\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"shanghai\"</span></pre></td></tr></table></figure><h2 id=\"hyperloglog\"><a class=\"anchor\" href=\"#hyperloglog\">#</a> Hyperloglog</h2>\n<blockquote>\n<p>什么是基数？</p>\n</blockquote>\n<p 1,3,5,7,8,7=\"\">A</p>\n<p 1,3,5,7,8=\"\">B</p>\n<p>基数（不重复的元素） = 5，可以接受误差！</p>\n<blockquote>\n<p>简介</p>\n</blockquote>\n<p>Redis 2.8.9 版本就更新了 Hyperloglog 数据结构！</p>\n<p>Redis Hyperloglog 基数统计的算法！</p>\n<p>找出位于指定元素周围的其他元素！</p>\n<p><strong>优点：占用的内存是固定，2^64 不同的元素的技术，只需要废 12KB 内存！如果要从内存角度来比较的话 Hyperloglog 首选！</strong></p>\n<p><strong>网页的 UV （一个人访问一个网站多次，但是还是算作一个人！）</strong></p>\n<p>传统的方式， set 保存用户的 id，然后就可以统计 set 中的元素数量作为标准判断！</p>\n<p>这个方式如果保存大量的用户 id，就会比较麻烦！我们的目的是为了计数，而不是保存用户 id；</p>\n<p>大概有 0.81% 错误率！ 统计 UV 任务，可以忽略不计的！</p>\n<blockquote>\n<p>测试使用</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> pfadd myset a b c d e f g h i j\t<span class=\"token comment\"># 创建第一组元素</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFCOUNT myset\t<span class=\"token comment\"># 统计 mykey 中元素的基数数量</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> pfadd myset2 i jj z x c <span class=\"token function\">v</span> b n m\t<span class=\"token comment\">#创建第二组元素 mykey2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PFCOUNT myset2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">9</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> pfmerge mykey3 myset myset2\t<span class=\"token comment\"># 合并两组 mykey mykey2 =》mykey3 并集</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> pfcount mykey3\t<span class=\"token comment\"># 查看并集的数量</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">16</span></pre></td></tr></table></figure><p>如果允许容错，那么一定可以使用 Hyperloglog ！</p>\n<p>如果不允许容错，就使用 set 或者自己的数据类型即可！</p>\n<h2 id=\"bitmap\"><a class=\"anchor\" href=\"#bitmap\">#</a> Bitmap</h2>\n<p>为什么其他教程都不喜欢讲这些？这些在生活中或者开发中，都有十分多的应用场景，学习了，就是多一个思路！技多不压身！</p>\n<blockquote>\n<p>位存储</p>\n</blockquote>\n<p>统计用户信息，活跃，不活跃！ 登录 、 未登录！ 打卡， 365 打卡！ 两个状态的，都可以使用 Bitmaps！</p>\n<p>Bitmap 位图，数据结构！ 都是操作二进制位来进行记录，就只有 0 和 1 两个状态！</p>\n<p>365 天 = 365 bit 1 字节 = 8bit 46 个字节左右！</p>\n<blockquote>\n<p>测试</p>\n</blockquote>\n<p>使用 bitmap 来记录 周一到周日的打卡！</p>\n<p>周一打卡：1 周二打卡：1....</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518202441951.png\" alt=\"image-20210518202441951\" /></p>\n<p>查看某一天是否打卡！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getbit sign <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> getbit sign <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><p>统计操作，统计打卡的天数！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> bitcount sign\t<span class=\"token comment\"># 统计这周的打卡天数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">4</span></pre></td></tr></table></figure><h1 id=\"事务\"><a class=\"anchor\" href=\"#事务\">#</a> 事务</h1>\n<p>Redis 事务本质：一组命令的集合！ 一个事务中的所有命令都会被序列化，在事务执行过程的中，会按照顺序执行！</p>\n<p>一次性、顺序性、排他性！执行一些列的命令！</p>\n<p>Redis 事务没有没有隔离级别的概念！</p>\n<p>所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！Exec</p>\n<p><mark>Redis 单条命令是保存原子性的，但是事务不保证原子性！</mark></p>\n<p>redis 的事务：</p>\n<ul>\n<li>开启事务（multi）</li>\n<li>命令入队（......）</li>\n<li>执行事务（exec）</li>\n</ul>\n<blockquote>\n<p>正常执行事务！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi\t\t<span class=\"token comment\"># 开启事务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> get k2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span>\t\t<span class=\"token comment\"># 执行事务</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> OK</pre></td></tr></table></figure><blockquote>\n<p>放弃事务！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi\t\t<span class=\"token comment\"># 开启事务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k4 v4</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> DISCARD\t\t<span class=\"token comment\"># 取消事务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k4\t\t<span class=\"token comment\"># 事务队列中的命令都不会被执行！</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><blockquote>\n<p>编译型异常（代码有问题！命令有错！），事务中所有的命令都不会被执行！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> getset k3\t\t<span class=\"token comment\"># 错误的命令</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR wrong number of arguments <span class=\"token keyword\">for</span> <span class=\"token string\">'getset'</span> <span class=\"token builtin class-name\">command</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k4 v4</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k5 v5</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span>\t\t<span class=\"token comment\"># 执行事务报错！</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> EXECABORT Transaction discarded because of previous errors.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k5\t\t<span class=\"token comment\"># 所有的命令都不会被执行！</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><blockquote>\n<p>运行时异常（1/0）， 如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的，错误命令抛出异常！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 <span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> incr k1\t\t<span class=\"token comment\"># 执行的时候失败</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> k3 v3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> get k3</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span>\t\t<span class=\"token comment\"># 虽然第一天命令报错，但依旧正常执行成功了</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> ERR value is not an integer or out of range</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> OK</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"v3\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k2</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token string\">\"v2\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k3</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\"v3\"</span></pre></td></tr></table></figure><blockquote>\n<p>监控！Watch（面试常问！）</p>\n</blockquote>\n<p><strong>悲观锁：</strong></p>\n<ul>\n<li>很悲观，认为什么时候都会出问题，无论做什么都会加锁！</li>\n</ul>\n<p><strong>乐观锁：</strong></p>\n<ul>\n<li>\n<p>很乐观，认为什么时候都不会出问题，所以不会上锁！ 更新数据的时候去判断一下，在此期间是否有人修改过这个数据，</p>\n</li>\n<li>\n<p>获取 version</p>\n</li>\n<li>\n<p>更新的时候比较 version</p>\n</li>\n</ul>\n<blockquote>\n<p>Redis 测监视测试</p>\n</blockquote>\n<p>正常执行成功！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> money <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> out <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">watch</span> money\t\t<span class=\"token comment\"># 监视 money 对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi\t\t<span class=\"token comment\"># 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> DECRBY money <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> INCRBY out <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">20</span></pre></td></tr></table></figure><p>测试多线程修改值，使用 watch 可以当做 redis 的乐观锁操作！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">watch</span> money\t\t<span class=\"token comment\"># 监视 money</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> multi</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> DECRBY money <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> INCRBY out <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:6379<span class=\"token punctuation\">(</span>TX<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token builtin class-name\">exec</span>\t\t<span class=\"token comment\"># 执行之前另外一个线程修改了这个 money，就会导致事务执行失败！</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span>nil<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><blockquote>\n<p>如果修改失败，获取最新的值就好</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518205812951.png\" alt=\"image-20210518205812951\" /></p>\n<h1 id=\"jedis\"><a class=\"anchor\" href=\"#jedis\">#</a> Jedis</h1>\n<p>我们要使用 Java 来操作 Redis，知其然并知其所以然，授人以渔！ 学习不能急躁，慢慢来会很快！</p>\n<blockquote>\n<p>什么是 Jedis 是 Redis 官方推荐的 java 连接开发工具！ 使用 Java 操作 Redis 中间件！如果你要使用 java 操作 redis，那么一定要对 Jedis 十分的熟悉！</p>\n</blockquote>\n<blockquote>\n<p>测试</p>\n</blockquote>\n<p>1 、导入对应的依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 导入 jedis 的包 --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>redis.clients<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jedis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.6.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">&lt;!--fastjson--></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>fastjson<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.2.60<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2 、编码测试：</p>\n<ul>\n<li>\n<p>连接数据库</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestPing</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 1、new Jedis 对象即可</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Jedis</span> jedis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jedis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">//jedis 所有的命令就是我们之前学习的所有指令</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">ping</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>操作命令</p>\n</li>\n<li>\n<p>断开连接！</p>\n</li>\n<li>\n<p>输出：</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518211611577.png\" alt=\"image-20210518211611577\" /></p>\n<h3 id=\"常用的api\"><a class=\"anchor\" href=\"#常用的api\">#</a> 常用的 API</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vbGxvYW1oaC9yZWRpcy1zdHVkeQ==\">代码</span></p>\n<p>String</p>\n<p>List</p>\n<p>Set</p>\n<p>Hash</p>\n<p>Zset</p>\n<blockquote>\n<p>所有的 api 命令，就是我们对应的上面学习的指令，一个都没有变化！</p>\n</blockquote>\n<h3 id=\"事务-2\"><a class=\"anchor\" href=\"#事务-2\">#</a> 事务</h3>\n<h1 id=\"springboot整合\"><a class=\"anchor\" href=\"#springboot整合\">#</a> SpringBoot 整合</h1>\n<p>SpringBoot 操作数据：spring-data jpa jdbc mongodb redis！</p>\n<p>SpringData 也是和 SpringBoot 齐名的项目！</p>\n<p>说明： 在 SpringBoot2.x 之后，原来使用的 jedis 被替换为了 lettuce?</p>\n<p>jedis : 采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用 jedis pool 连接池！ 更像 BIO 模式</p>\n<p>lettuce : 采用 netty，实例可以再多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据了，更像 NIO 模式</p>\n<p>源码分析：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@ConditionalOnMissingBean</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"redisTemplate\"</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">// 我们可以自己定义一个 redisTemplate 来替换这个默认的！</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@ConditionalOnSingleCandidate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">redisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> redisConnectionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 默认的 RedisTemplate 没有过多的设置，redis 对象都是需要序列化！</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// 两个泛型都是 Object，Object 的类型，我们要使用需要强制转换 &lt;String, Object></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> template <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\ttemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>redisConnectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> template<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token annotation punctuation\">@ConditionalOnMissingBean</span>\t<span class=\"token comment\">// 由于 String 是 redis 中最常用使用的类型，所以说单独提出来了一个 bean！</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token annotation punctuation\">@ConditionalOnSingleCandidate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StringRedisTemplate</span> <span class=\"token function\">stringRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> redisConnectionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token class-name\">StringRedisTemplate</span> template <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\ttemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>redisConnectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> template<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>整合测试一下</p>\n</blockquote>\n<p>1 、导入依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2 、配置连接</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Springboot 所有的配置类，都有一个自动配置类 RedisAutoConfiguration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 自动配置类都会绑定一个 properties 配置文件 RedisProperties</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 配置 redis</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 127.0.0.1</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>3 、测试！</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Redis02SpringbootApplicationTests</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">contextLoads</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token comment\">//redisTemplate 操作不同的数据类型，api 和我们的指令是一样的</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token comment\">//opsForValue 操作字符串 类似 String</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token comment\">//opsForList 操作 List 类型 List</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token comment\">// opsForSet</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token comment\">// opsForHash</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token comment\">// opsForZSet</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token comment\">// opsForGeo</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token comment\">// opsForHyperLogLog</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token comment\">// 除了基本的操作，我们常用的方法都可以直接通过 redisTemplate 操作，比如事务，和基本的 crud</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token comment\">/* 获取 redis 的连接对象</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tRedisConnection connection = redisTemplate.getConnectionFactory ().getConnection ();</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tconnection.flushDb ();</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tconnection.flushAll ();*/</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tredisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mykey\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"关注狂神说公众号\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mykey\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519205527214.png\" alt=\"image-20210519205527214\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519205732105.png\" alt=\"image-20210519205732105\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519210859444.png\" alt=\"image-20210519210859444\" /></p>\n<p>我们来编写一个自己的 RedisTemplate</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//RedisTemplate 序列化配置 -- >  注意要使用 @Qualifier (\"redisTemplate\") 避免歧义（测试类中有使用案例）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">redisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> factory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 我们为了自己开发方便，一般直接使用 &lt;String, Object></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> template <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// Json 序列化配置</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jackson2JsonRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">ObjectMapper</span> om <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">setVisibility</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PropertyAccessor</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> <span class=\"token class-name\">JsonAutoDetect<span class=\"token punctuation\">.</span>Visibility</span><span class=\"token punctuation\">.</span>ANY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">enableDefaultTyping</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper<span class=\"token punctuation\">.</span>DefaultTyping</span><span class=\"token punctuation\">.</span>NON_FINAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        jackson2JsonRedisSerializer<span class=\"token punctuation\">.</span><span class=\"token function\">setObjectMapper</span><span class=\"token punctuation\">(</span>om<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// String 的序列化</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">StringRedisSerializer</span> stringRedisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">//key 采用 String 的序列化方式</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setKeySerializer</span><span class=\"token punctuation\">(</span>stringRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">//hash 的 key 也采用 String 的序列化方式</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setHashKeySerializer</span><span class=\"token punctuation\">(</span>stringRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">//value 序列化方式采用 jackson</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setValueSerializer</span><span class=\"token punctuation\">(</span>jackson2JsonRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">//hash 的 value 序列化方式采用 jackson</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setHashValueSerializer</span><span class=\"token punctuation\">(</span>jackson2JsonRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> template<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>所有的 redis 操作，其实对于 java 开发人员来说，十分的简单，更重要的是要去理解 redis 的思想和每一种数据结构的用处和作用场景！</p>\n<h1 id=\"redisconf详解\"><a class=\"anchor\" href=\"#redisconf详解\">#</a> Redis.conf 详解</h1>\n<p>启动的时候，就通过配置文件来启动！</p>\n<p>工作中，一些小小的配置，可以让你脱颖而出！</p>\n<p><mark>行家有没有，出手就知道</mark></p>\n<blockquote>\n<p>单位</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519214335523.png\" alt=\"image-20210519214335523\" /></p>\n<p>1、配置文件 unit 单位对大小写不敏感！</p>\n<blockquote>\n<p>包含</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519214516731.png\" alt=\"image-20210519214516731\" /></p>\n<p>就是好比我们学习 Spring、Import、include 可以将多个配置文件包含</p>\n<blockquote>\n<p>网络</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">127.0</span>.0.1 -::1 <span class=\"token comment\"># 绑定的 ip</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>\t<span class=\"token comment\"># 保护模式</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">6379</span>\t<span class=\"token comment\"># 端口设置</span></pre></td></tr></table></figure><blockquote>\n<p>通用 GENERAL</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>daemonize <span class=\"token function\">yes</span>\t<span class=\"token comment\"># 以守护进程的方式运行，默认是 no，我们需要自己开启为 yes！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pidfile /var/run/redis_6379.pid\t<span class=\"token comment\"># 如果以后台的方式运行，我们就需要指定一个 pid 文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 日志</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Specify the server verbosity level.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># This can be one of:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># debug (a lot of information, useful for development/testing)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># verbose (many rarely useful info, but not a mess like the debug level)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># notice (moderately verbose, what you want in production probably) 生产环境适用</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># warning (only very important / critical messages are logged)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>logfile <span class=\"token string\">\"\"</span>\t<span class=\"token comment\"># 日志的文件位置名</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>databases <span class=\"token number\">16</span>\t<span class=\"token comment\"># 数据库的数量，默认是 16 个数据库</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>always-show-logo no\t<span class=\"token comment\"># 是否总是显示 logo</span></pre></td></tr></table></figure><blockquote>\n<p>快照 SNAPSHOTTING</p>\n</blockquote>\n<p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 .rdb .aof</p>\n<p>redis 是内存数据库，如果没有持久化，那么数据断电即失</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 如果 3600 秒内，如果至少有一个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>save <span class=\"token number\">3600</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 如果 300 秒内，如果至少有 10 个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>save <span class=\"token number\">300</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 如果 60 秒内，如果至少有 10000 个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>save <span class=\"token number\">60</span> <span class=\"token number\">10000</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 我们之后学习持久化，会自己定义这个设置！</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>stop-writes-on-bgsave-error <span class=\"token function\">yes</span>\t<span class=\"token comment\"># 持久化如果出错，是否还需要继续工作！</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>rdbcompression <span class=\"token function\">yes</span>\t<span class=\"token comment\"># 是否压缩 rdb 文件，需要消耗一些 cpu 资源</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>rdbchecksum <span class=\"token function\">yes</span>\t<span class=\"token comment\"># 保存 rdb 的时候，进行错误的检查校验！</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">dir</span> ./\t<span class=\"token comment\"># rdb 文件保存的目录！</span></pre></td></tr></table></figure><blockquote>\n<p>REPLICATION 主从复制，我们后面讲解主从复制的时候再进行讲解</p>\n</blockquote>\n<blockquote>\n<p>SECURITY 安全</p>\n</blockquote>\n<p>可以在这里设置 redis 的密码，默认是没有密码！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> config get requirepass\t<span class=\"token comment\"># 获取 redis 的密码</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"requirepass\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> config <span class=\"token builtin class-name\">set</span> requirepass <span class=\"token string\">\"lloam\"</span>\t<span class=\"token comment\"># 设置 redis 的密码</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> config get requirepass</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"requirepass\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"lloam\"</span></pre></td></tr></table></figure><blockquote>\n<p>CLIENTS 限制</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>maxclients <span class=\"token number\">10000</span>\t<span class=\"token comment\"># 设置能连接上 redis 的最大客户端的数量！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>maxmemory <span class=\"token operator\">&lt;</span>bytes<span class=\"token operator\">></span>\t<span class=\"token comment\"># redis 配置最大的内存容量</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>maxmemory-policy noeviction\t<span class=\"token comment\"># 内存达到上限之后的处理策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\"># 移除一些过期的 key</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\"># 报错</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\"># ...</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token number\">1</span> 、volatile-lru：只对设置了过期时间的key进行LRU（默认值）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">2</span> 、allkeys-lru ： 删除lru算法的key</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token number\">3</span> 、volatile-random：随机删除即将过期key</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token number\">4</span> 、allkeys-random：随机删除</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token number\">5</span> 、volatile-ttl ： 删除即将过期的</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token number\">6</span> 、noeviction ： 永不过期，返回错误</pre></td></tr></table></figure><blockquote>\n<p>APPEND ONLY MODE 模式 aof 配置</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>appendonly no\t<span class=\"token comment\"># 默认是不开启 aof 模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>appendfilename <span class=\"token string\">\"appendonly.aof\"</span>\t<span class=\"token comment\"># 持久化的文件的名字</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># appendfsync always\t# 每次修改都会同步数据，消耗性能</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>appendfsync everysec\t<span class=\"token comment\"># 每秒执行一次 也就是每秒同步一次 sync，可能会丢失这 1s 的数据！</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># appendfsync no\t# 不执行同步，这个时候操作系统自己同步数据，速度最快！</span></pre></td></tr></table></figure><p>具体的配置，我们在 Redis 持久化中去给大家详细讲解！</p>\n<h1 id=\"redis持久化\"><a class=\"anchor\" href=\"#redis持久化\">#</a> Redis 持久化</h1>\n<p>面试和工作，持久化都是重点！</p>\n<p>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。所以 Redis 提供了持久化功能！</p>\n<h2 id=\"rdbredis-database\"><a class=\"anchor\" href=\"#rdbredis-database\">#</a> RDB（Redis DataBase）</h2>\n<blockquote>\n<p>什么是 RDB</p>\n</blockquote>\n<p>在主从复制中，rdb 就是备用了！从机上面！</p>\n<p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的 Snapshot 快照，它恢复时是将快照文件直接读到内存里。Redis 会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何 IO 操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效。RDB 的缺点是最后一次持久化后的数据可能丢失。我们默认的就是 RDB，一般情况下不需要修改这个配置！</p>\n<p>有时候在生产环境我们会将这个文件进行备份！</p>\n<p><mark>rdb 保存的文件是 dump.rdb</mark></p>\n<p>都是在我们的配置文件中快照中进行配置的！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520195804095.png\" alt=\"image-20210520195804095\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520200107454.png\" alt=\"image-20210520200107454\" /></p>\n<blockquote>\n<p>触发机制</p>\n</blockquote>\n<p>1 、save 的规则满足的情况下，会自动触发 rdb 规则</p>\n<p>2 、执行 flushall 命令，也会触发我们的 rdb 规则！</p>\n<p>3 、退出 redis，也会产生 rdb 文件！</p>\n<p>备份就自动生成一个 dump.rdb</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520200658389.png\" alt=\"image-20210520200658389\" /></p>\n<blockquote>\n<p>如何恢复 rdb 文件！</p>\n</blockquote>\n<p>1 、只需要将 rdb 文件放在我们 redis 启动目录就可以，redis 启动的时候会自动检查 dump.rdb 恢复其中的数据！</p>\n<p>2 、查看需要存在的位置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> config get <span class=\"token function\">dir</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"dir\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"/usr/local/bin\"</span>\t<span class=\"token comment\"># 如果在这个目录下存在 dump.rdb 文件，启动就会自动恢复其中的数据</span></pre></td></tr></table></figure><blockquote>\n<p>几乎就他自己默认的配置就够用了，但是我们还是需要去学习！</p>\n</blockquote>\n<p>优点：</p>\n<p>1 、适合大规模的数据恢复！</p>\n<p>2 、对数据的完整性要不高！</p>\n<p>缺点：</p>\n<p>1 、需要一定的时间间隔进程操作！如果 redis 意外宕机了，这个最后一次修改数据就没有的了！</p>\n<p>2 、fork 进程的时候，会占用一定的内存空间！！</p>\n<h2 id=\"aofappend-only-file\"><a class=\"anchor\" href=\"#aofappend-only-file\">#</a> AOF（Append Only File）</h2>\n<p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件全部在执行一遍！</p>\n<blockquote>\n<p>是什么</p>\n</blockquote>\n<p>以日志的形式来记录每个写操作，将 Redis 执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis 启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>\n<p>Aof 保存的是 appendonly.aof 文件</p>\n<blockquote>\n<p>append</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520201705996.png\" alt=\"image-20210520201705996\" /></p>\n<p>默认是不开启的，我们需要手动进行配置！我们只需要将 appendonly 改为 yes 就开启了 aof！</p>\n<p>重启，redis 就可以生效了！</p>\n<p>如果这个 aof 文件有错误，这时候 redis 是启动不起来的吗，我们需要修复这个 aof 文件</p>\n<p>redis 给我们提供了一个工具 <code> redis-check-aof --fix</code></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520202444654.png\" alt=\"image-20210520202444654\" /></p>\n<p>如果文件正常，重启就可以直接恢复了！</p>\n<blockquote>\n<p>重写规则说明</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520203003627.png\" alt=\"image-20210520203003627\" /></p>\n<p>aof 默认就是文件的无限追加，文件会越来越大！</p>\n<p>如果 aof 文件大于 64m，太大了！ 就会 fork 一个新的进程来将我们的文件进行重写！</p>\n<blockquote>\n<p>优点和缺点！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>appendonly no\t<span class=\"token comment\"># 默认是不开启 aof 模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>appendfilename <span class=\"token string\">\"appendonly.aof\"</span>\t<span class=\"token comment\"># 持久化的文件的名字</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># appendfsync always\t# 每次修改都会同步数据，消耗性能</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>appendfsync everysec\t<span class=\"token comment\"># 每秒执行一次 也就是每秒同步一次 sync，可能会丢失这 1s 的数据！</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># appendfsync no\t# 不执行同步，这个时候操作系统自己同步数据，速度最快！</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># rewrite</span></pre></td></tr></table></figure><p>优点：</p>\n<p>1 、每一次修改都同步，文件的完整会更加好！</p>\n<p>2 、每秒同步一次，可能会丢失一秒的数据</p>\n<p>3 、从不同步，效率最高的！</p>\n<p>缺点：</p>\n<p>1 、相对于数据文件来说，aof 远远大于 rdb，修复的速度也比 rdb 慢！</p>\n<p>2 、Aof 运行效率也要比 rdb 慢，所以我们 redis 默认的配置就是 rdb 持久化！</p>\n<h4 id=\"扩展\"><a class=\"anchor\" href=\"#扩展\">#</a> 扩展：</h4>\n<p>1 、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p>\n<p>2 、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF 命令以 Redis 协议追加保存每次写的操作到文件末尾，Redis 还能对 AOF 文件进行后台重写，使得 AOF 文件的体积不至于过大。</p>\n<p>3 、<mark>只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</mark></p>\n<p>4 、同时开启两种持久化方式</p>\n<ul>\n<li>在这种情况下，当 redis 重启的时候会优先载入 AOF 文件来恢复原始的数据，因为在通常情况下 AOF 文件保存的数据集要比 RDB 文件保存的数据集要完整。</li>\n<li>RDB 的数据不实时，同时使用两者时服务器重启也只会找 AOF 文件，那要不要只使用 AOF 呢？作者建议不要，因为 RDB 更适合用于备份数据库（AOF 在不断变化不好备份），快速重启，而且不会有 AOF 可能潜在的 Bug，留着作为一个万一的手段。</li>\n</ul>\n<p>5 、性能建议</p>\n<ul>\n<li>因为 RDB 文件只用作后备用途，建议只在 Slave 上持久化 RDB 文件，而且只要 15 分钟备份一次就够了，只保留 save 900 1 这条规则。</li>\n<li>如果 Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只 load 自己的 AOF 文件就可以了，代价一是带来了持续的 IO，二是 AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少 AOF rewrite 的频率，AOF 重写的基础大小默认值 64M 太小了，可以设到 5G 以上，默认超过原大小 100% 大小重写可以改到适当的数值。</li>\n<li>如果不 Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔 IO，也减少了 rewrite 时带来的系统波动。代价是如果 Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB 文件，载入较新的那个，微博就是这种架构。</li>\n</ul>\n<h1 id=\"redis发布订阅\"><a class=\"anchor\" href=\"#redis发布订阅\">#</a> Redis 发布订阅</h1>\n<p>Redis 发布订阅 (pub/sub) 是一种<mark>消息通信模式</mark>：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。微信、微博、关注系统！</p>\n<p>Redis 客户端可以订阅任意数量的频道。</p>\n<p>订阅 / 发布消息图：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205008926.png\" alt=\"image-20210520205008926\" /></p>\n<p>第一个：消息发送者， 第二个：频道， 第三个：消息订阅者！</p>\n<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205141004.png\" alt=\"image-20210520205141004\" /></p>\n<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户<br />\n端：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205209640.png\" alt=\"image-20210520205209640\" /></p>\n<blockquote>\n<p>命令</p>\n</blockquote>\n<p>这些命令被广泛用于构建即时通信应用，比如网络聊天室 (chatroom) 和实时广播、实时提醒等。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205303771.png\" alt=\"image-20210520205303771\" /></p>\n<blockquote>\n<p>测试</p>\n</blockquote>\n<p>订阅端：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> SUBSCRIBE kuangshenshuo\t<span class=\"token comment\">#订阅一个频道 kuangshenshuo</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Reading messages<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">(</span>press Ctrl-C to quit<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"subscribe\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"kuangshenshuo\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 等待读取推送的信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"message\"</span>\t\t<span class=\"token comment\">#消息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"kuangshenshuo\"</span>\t\t<span class=\"token comment\">#哪个频道的消息</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello,kuangshen\"</span>\t\t<span class=\"token comment\"># 消息的具体内容</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"message\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"kuangshenshuo\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"hello,redis\"</span></pre></td></tr></table></figure><p>发送端：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PUBLISH kuangshenshuo <span class=\"token string\">\"hello,kuangshen\"</span>\t<span class=\"token comment\"># 发布者发送消息到频道！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> PUBLISH kuangshenshuo <span class=\"token string\">\"hello,redis\"</span>\t<span class=\"token comment\"># 发布者发送消息到频道！</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span>integer<span class=\"token punctuation\">)</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><blockquote>\n<p>原理</p>\n</blockquote>\n<p>Redis 是使用 C 实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，籍此加深对 Redis 的理解。</p>\n<p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p>\n<p>微信：</p>\n<p>通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 频道！而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键，就是将客户端添加到给定 channel 的订阅链表中。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520210737723.png\" alt=\"image-20210520210737723\" /></p>\n<p>通过 PUBLISH 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520210838355.png\" alt=\"image-20210520210838355\" /></p>\n<p>Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在 Redis 中，你可以设定对某一个 key 值进行消息发布及消息订阅，当一个 key 值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>\n<p><strong>使用场景：</strong></p>\n<p>1 、实时消息系统！</p>\n<p>2 、事实聊天！（频道当做聊天室，将信息回显给所有人即可！）</p>\n<p>3 、订阅，关注系统都是可以的！</p>\n<p>稍微复杂的场景我们就会使用 消息中间件 MQ</p>\n<h1 id=\"redis主从复制\"><a class=\"anchor\" href=\"#redis主从复制\">#</a> Redis 主从复制</h1>\n<h3 id=\"概念\"><a class=\"anchor\" href=\"#概念\">#</a> 概念</h3>\n<p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点<br />\n (master/leader)，后者称为从节点 (slave/follower)；== 数据的复制是单向的，只能由主节点到从节点。==Master 以写为主，Slave 以读为主。</p>\n<p><mark>默认情况下，每台 Redis 服务器都是主节点；</mark></p>\n<p>且一个主节点可以有多个从节点 (或没有从节点)，但一个从节点只能有一个主节点。（）</p>\n<p><strong>主从复制的作用主要包括：</strong></p>\n<p>1 、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p>\n<p>2 、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</p>\n<p>3 、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务 ==（即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点）==，分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量。</p>\n<p>4 、高可用（集群）基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础。</p>\n<p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的（会宕机，一般一主二从），原因如下：</p>\n<p>1 、从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p>\n<p>2 、从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为 256G，也不能将所有内存用作 Redis 存储内存，一般来说，<mark>单台 Redis 最大使用内存不应该超过 20G。</mark></p>\n<p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是 &quot;多读少写&quot;。</p>\n<p>对于这种场景，我们可以使如下这种架构：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520211238731.png\" alt=\"image-20210520211238731\" /></p>\n<p>主从复制，读写分离！ 80% 的情况下都是在进行读操作！减缓服务器的压力！架构中经常使用！ 一主二从！</p>\n<p>只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用 Redis！</p>\n<h2 id=\"环境配置\"><a class=\"anchor\" href=\"#环境配置\">#</a> 环境配置</h2>\n<p>只配置从库，不用配置主库！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication\t\t<span class=\"token comment\">#查看当前库的信息</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:master\t\t<span class=\"token comment\"># 角色  master</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>connected_slaves:0\t\t<span class=\"token comment\"># 没有从机</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_replid:30a335d3ec84363d738343b2e57607f0ef6cca90</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_repl_offset:0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>repl_backlog_active:0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>repl_backlog_first_byte_offset:0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>repl_backlog_histlen:0</pre></td></tr></table></figure><p>复制 3 个配置文件，然后修改对应的信息</p>\n<p>1 、端口</p>\n<p>2 、pid 名字</p>\n<p>3 、log 文件名字</p>\n<p>4 、dump.rdb 名字</p>\n<p>修改完毕之后，启动我们的 3 个 redis 服务器，可以通过进程信息查看！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520213559496.png\" alt=\"image-20210520213559496\" /></p>\n<h3 id=\"一主二从\"><a class=\"anchor\" href=\"#一主二从\">#</a> 一主二从</h3>\n<p><mark>默认情况下，每台 Redis 服务器都是主节点；</mark> 我们一般情况下只用配置从机就好了！</p>\n<p>认老大！ 一主 （ 79 ）二从（ 80 ， 81 ）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> SLAVEOF <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span>\t\t<span class=\"token comment\"># SLAVEOF host 6379 找谁当自己的老大！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:638<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span> info replication</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>role:slave\t\t<span class=\"token comment\"># 当前角色是从机</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>master_host:127.0.0.1\t\t<span class=\"token comment\"># 可以看到主机的信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_link_status:up</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_last_io_seconds_ago:6</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>slave_repl_offset:0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>replica_announced:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>master_replid:6c48ecaf27edad5631781b5432548f10acde2cec</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>master_repl_offset:0</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>repl_backlog_histlen:0</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">###############################################################</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># 在主机中查看！</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>role:master</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>connected_slaves:1\t\t<span class=\"token comment\"># 多了从机的配置</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span>.0.1,port<span class=\"token operator\">=</span><span class=\"token number\">6380</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">28</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span>\t\t<span class=\"token comment\"># 多了从机的配置</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>master_replid:6c48ecaf27edad5631781b5432548f10acde2cec</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>master_repl_offset:28</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>repl_backlog_histlen:28</pre></td></tr></table></figure><p>如果两个都配置完了，就是有两个从机的</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214352916.png\" alt=\"image-20210520214352916\" /></p>\n<p>真实的从主配置应该在配置文件中配置，这样的话是永久的，我们这里使用的是命令，暂时的！关闭 redis 服务后再重启就没有了。</p>\n<blockquote>\n<p>细节</p>\n</blockquote>\n<p>== 主机可以写，从机不能写只能读！== 主机中的所有信息和数据，都会自动被从机保存！</p>\n<p>主机写：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214917078.png\" alt=\"image-20210520214917078\" /></p>\n<p>从机只能读取内容！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214957623.png\" alt=\"image-20210520214957623\" /></p>\n<p>测试：主机断开连接，从机依旧连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依旧可以直接获取到主机写的信息！</p>\n<p>如果是使用命令行，来配置的主从，这个时候如果重启了，就会变回主机！只要变为从机，立马就会从主机中获取值！</p>\n<blockquote>\n<p>复制原理</p>\n</blockquote>\n<p>Slave 启动成功连接到 master 后会发送一个 sync 同步命令</p>\n<p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集的命令，在后台进程执行完毕之后，master 将传送整个数据文件到 slave，并完成一次完全同步。</p>\n<p><mark>全量复制</mark>：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p>\n<p><mark>增量复制</mark>：Master 继续将新的所有收集到的修改命令依次传给 slave，完成同步</p>\n<p>但是只要是重新连接 master，一次完全同步（全量复制）将被自动执行！ 我们的数据一定可以在从机中看到！</p>\n<blockquote>\n<p>层层链路</p>\n</blockquote>\n<p><strong>上一个 M 链接下一个 S！</strong></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520220346763.png\" alt=\"image-20210520220346763\" /></p>\n<p>这时候也可以完成我们的主从复制！</p>\n<blockquote>\n<p>如果没有老大了，这个时候能不能选择一个老大出来呢？ 没有哨兵模式情况下需要手动配置！</p>\n</blockquote>\n<p><strong><mark>谋朝篡位</mark></strong></p>\n<p>如果主机断开了连接，我们可以使用  <code>SLAVEOF no one </code> 让自己变成主机！其他的节点就可以手动连接到最新的这个主节点（手动）！如果这个时候老大修复了，那就重新连接！</p>\n<h2 id=\"哨兵模式\"><a class=\"anchor\" href=\"#哨兵模式\">#</a> 哨兵模式</h2>\n<p>（自动选举老大的模式）</p>\n<p>概述</p>\n<p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis 从 2.8 开始正式提供了 Sentinel（哨兵） 架构来解决这个问题。</p>\n<p>谋朝篡位的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</p>\n<p>哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是 <strong>哨兵通过发送命令，等待 Redis 服务器响应，从而监控运行的多个 Redis 实例。</strong></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520221658955.png\" alt=\"image-20210520221658955\" /></p>\n<p>这里的哨兵有两个作用</p>\n<ul>\n<li>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器。</li>\n<li>当哨兵监测到 master 宕机，会自动将 slave 切换成 master，然后通过 发布订阅模式 通知其他的从服务器，修改配置文件，让它们切换主机。</li>\n</ul>\n<p>然而一个哨兵进程对 Redis 服务器进行监控，可能会出现问题（哨兵宕机），为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520221919792.png\" alt=\"image-20210520221919792\" /></p>\n<p>假设主服务器宕机，哨兵 1 先检测到这个结果，系统并不会马上进行 failover 选举过程，仅仅是哨兵 1 主观的认为主服务器不可用，这个现象成为 <strong>主观下线</strong> 。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 failover [故障转移] 操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong> 。</p>\n<blockquote>\n<p>测试！</p>\n</blockquote>\n<p>我们目前的状态是 一主二从！</p>\n<p>1 、配置哨兵配置文件 sentinel.conf</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># sentinel monitor 被监控的名称 host port 1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>sentinel monitor myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><p><mark>后面的这个数字 1 ，表示至少要多少个 sentinel 哨兵一致认为主机挂掉了，那么才会触发 failover【故障转移】操作</mark>，我们这里因为只有一个 sentinel 哨兵，假设有三个哨兵，那么这个数字就可以设置为 2。哨兵投票看让谁接替成为主机，票数最多的，就会成为主机！</p>\n<p>2 、启动哨兵！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-sentinel maoconfig/sentinel.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.879 <span class=\"token comment\"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.879 <span class=\"token comment\"># Redis version=6.2.3, bits=64, commit=00000000, modified=0, pid=19968, just started</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.879 <span class=\"token comment\"># Configuration loaded</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.879 * monotonic clock: POSIX clock_gettime</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                _._                                                  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>           _.-`<span class=\"token variable\"><span class=\"token variable\">`</span>__ <span class=\"token string\">''</span>-._                                             </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      _.-<span class=\"token variable\">`</span></span><span class=\"token variable\"><span class=\"token variable\">`</span>    <span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\"><span class=\"token variable\">`</span>_.  <span class=\"token string\">''</span>-._           Redis <span class=\"token number\">6.2</span>.3 <span class=\"token punctuation\">(</span>00000000/0<span class=\"token punctuation\">)</span> <span class=\"token number\">64</span> bit</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  .-<span class=\"token variable\">`</span></span><span class=\"token variable\"><span class=\"token variable\">`</span> .-<span class=\"token variable\">`</span></span>`<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\">`</span></span>`<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token punctuation\">\\</span>/    _.,_ <span class=\"token string\">''</span>-._                                  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre> <span class=\"token punctuation\">(</span>    '      ,       .-<span class=\"token variable\">`</span></span>  <span class=\"token operator\">|</span> <span class=\"token variable\"><span class=\"token variable\">`</span>,    <span class=\"token punctuation\">)</span>     Running <span class=\"token keyword\">in</span> sentinel mode</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-<span class=\"token punctuation\">..</span>.-<span class=\"token variable\">`</span></span> __<span class=\"token punctuation\">..</span>.-.`<span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token operator\">|</span>'<span class=\"token variable\">`</span></span> _.-<span class=\"token string\">'|     Port: 26379</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> |    <span class=\"token variable\"><span class=\"token variable\">`</span>-._   <span class=\"token variable\">`</span></span>._    /     _.-'</span>    <span class=\"token operator\">|</span>     PID: <span class=\"token number\">19968</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-._  <span class=\"token variable\"><span class=\"token variable\">`</span>-./  _.-<span class=\"token string\">'    _.-'</span>                                   </pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-.__.-<span class=\"token string\">'    _.-'</span>_.-<span class=\"token string\">'|                                  </pre></td></tr><tr><td data-num=\"15\"></td><td><pre> |    <span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token variable\">`</span></span>-._        _.-'</span>_.-<span class=\"token string\">'    |           https://redis.io       </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-.__.-<span class=\"token string\">'_.-'</span>    _.-'                                   </pre></td></tr><tr><td data-num=\"17\"></td><td><pre> <span class=\"token operator\">|</span><span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-.__.-'</span>    _.-<span class=\"token string\">'_.-'</span><span class=\"token operator\">|</span>                                  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre> <span class=\"token operator\">|</span>    <span class=\"token variable\"><span class=\"token variable\">`</span>-._<span class=\"token variable\">`</span></span>-._        _.-<span class=\"token string\">'_.-'</span>    <span class=\"token operator\">|</span>                                  </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token variable\"><span class=\"token variable\">`</span>-._    <span class=\"token variable\">`</span></span>-._<span class=\"token variable\"><span class=\"token variable\">`</span>-.__.-<span class=\"token string\">'_.-'</span>    _.-'                                   </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token variable\">`</span></span>-._    <span class=\"token variable\"><span class=\"token variable\">`</span>-.__.-<span class=\"token string\">'    _.-'</span>                                       </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token variable\">`</span></span>-._        _.-'                                           </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>              `-.__.-'                                               </pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.880 <span class=\"token comment\"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.882 <span class=\"token comment\"># Sentinel ID is 3555ee07f208305027d0e90ca9a47de93b3c99f3</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.882 <span class=\"token comment\"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.883 * +slave slave <span class=\"token number\">127.0</span>.0.1:6380 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6380</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">19968</span>:X <span class=\"token number\">20</span> May <span class=\"token number\">2021</span> <span class=\"token number\">22</span>:35:51.885 * +slave slave <span class=\"token number\">127.0</span>.0.1:6381 <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6381</span> @ myredis <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>如果 Master 节点断开了，这个时候就会从从机中随机选择一个服务器！ （这里面有一个投票算法！）</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520224201764.png\" alt=\"image-20210520224201764\" /></p>\n<blockquote>\n<p>哨兵日志！</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520224334799.png\" alt=\"image-20210520224334799\" /></p>\n<p>如果主机此时回来了，只能归并到新的主机下，当做从机，这就是哨兵模式的规则！</p>\n<blockquote>\n<p>哨兵模式</p>\n</blockquote>\n<p>优点：</p>\n<p>1 、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p>\n<p>2 、 主从可以切换，故障可以转移，系统的可用性就会更好</p>\n<p>3 、哨兵模式就是主从模式的升级，手动到自动，更加健壮！</p>\n<p>缺点：</p>\n<p>1 、Redis 不好在线扩容的，集群容量一旦到达上限，在线扩容就十分麻烦！</p>\n<p>2 、实现哨兵模式的配置其实是很麻烦的，里面有很多选择！</p>\n<blockquote>\n<p>哨兵模式的全部配置！</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Example sentinel.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 实例运行的端口 默认 26379</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>port <span class=\"token number\">26379</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 的工作目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">dir</span> /tmp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 监控的 redis 主节点的 ip port</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># master-name 可以自己命名的主节点名字 只能由字母 A-z、数字 0-9 、这三个字符 \".-_\" 组成。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># quorum 配置多少个 sentinel 哨兵统一认为 master 主节点失联 那么这时客观上认为主节点失联了</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>sentinel monitor mymaster <span class=\"token number\">127</span> .0.0.1 <span class=\"token number\">6379</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 当在 Redis 实例中开启了 requirepass foobared 授权密码 这样所有连接 Redis 实例的客户端都要提供</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>密码</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 设置哨兵 sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># sentinel auth-pass &lt;master-name> &lt;password></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># 指定多少毫秒之后 主节点没有应答哨兵 sentinel 此时 哨兵主观上认为主节点下线 默认 30 秒</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>sentinel down-after-milliseconds mymaster <span class=\"token number\">30000</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># 这个配置项指定了在发生 failover 主备切换时最多可以有多少个 slave 同时对新的 master 进行 同步，</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>这个数字越小，完成failover所需的时间就越长，</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>可以通过将这个值设为 <span class=\"token number\">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># sentinel parallel-syncs &lt;master-name> &lt;numslaves></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sentinel parallel-syncs mymaster <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#1. 同一个 sentinel 对同一个 master 两次 failover 之间的间隔时间。</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#2. 当一个 slave 从一个错误的 master 那里同步数据开始计算时间。直到 slave 被纠正为向正确的 master 那</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>里同步数据时。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#3. 当想要取消一个正在进行的 failover 所需要的时间。</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#4. 当进行 failover 时，配置所有 slaves 指向新的 master 所需的最大时间。不过，即使过了这个超时，</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\"># 默认三分钟</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># sentinel failover-timeout &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>sentinel failover-timeout mymaster <span class=\"token number\">180000</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\"># SCRIPTS EXECUTION</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>相关人员。</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">#对于脚本的运行结果有以下规则：</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 1 ，那么该脚本稍后将会被再次执行，重复次数目前默认为 10</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 2 ，或者比 2 更高的一个返回值，脚本将不会重复执行。</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为 1 时的行为相同。</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">#一个脚本的最大执行时间为 60s，如果超过这个时间，脚本将会被一个 SIGKILL 信号终止，之后重新执行。</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">#通知型脚本：当 sentinel 有任何警告级别的事件发生时（比如说 redis 实例的主观失效和客观失效等等），</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>法正常启动成功。</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">#通知脚本</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\"># shell 编程</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\"># sentinel notification-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>sentinel notification-script mymaster /var/redis/notify.sh</pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\"># 客户端重新配置主节点参数脚本</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token comment\"># 当一个 master 由于 failover 而发生改变时，这个脚本将会被调用，通知相关的客户端关于 master 地址已</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>经发生改变的信息。</pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\"># 以下参数将会在调用脚本时传给脚本:</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token comment\"># &lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\"># 目前 & lt;state > 总是 “failover”,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token comment\"># &lt;role > 是 “leader” 或者 “observer” 中的一个。</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token comment\"># 参数 from-ip, from-port, to-ip, to-port 是用来和旧的 master 和新的 master (即旧的 slave) 通</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>信的</pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token comment\"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\"># sentinel client-reconfig-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh <span class=\"token comment\"># 一般都是由运维来配置！</span></pre></td></tr></table></figure><p><mark>社会目前程序员饱和（初级和中级）、高级程序员重金难求！（提升自己！）</mark></p>\n<h1 id=\"redis缓存穿透和雪崩\"><a class=\"anchor\" href=\"#redis缓存穿透和雪崩\">#</a> Redis 缓存穿透和雪崩</h1>\n<blockquote>\n<p>服务的高可用问题！</p>\n</blockquote>\n<p>在这里我们不会详细的区分析解决方案的底层！</p>\n<p>Redis 缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。</p>\n<p>另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521204551606.png\" alt=\"image-20210521204551606\" /></p>\n<h2 id=\"缓存穿透查不到\"><a class=\"anchor\" href=\"#缓存穿透查不到\">#</a> 缓存穿透（查不到）</h2>\n<blockquote>\n<p>概念</p>\n</blockquote>\n<p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis 内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀！），于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>\n<blockquote>\n<p>解决方案</p>\n</blockquote>\n<h4 id=\"布隆过滤器\"><a class=\"anchor\" href=\"#布隆过滤器\">#</a> 布隆过滤器</h4>\n<p>布隆过滤器是一种数据结构，对所有可能查询的参数以 hash 形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力；</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521205047971.png\" alt=\"image-20210521205047971\" /></p>\n<h4 id=\"缓存空对象\"><a class=\"anchor\" href=\"#缓存空对象\">#</a> 缓存空对象</h4>\n<p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源；</p>\n<p>但是这种方法会存在两个问题：</p>\n<p>1 、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；</p>\n<p>2 、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p>\n<h2 id=\"缓存击穿量太大缓存过期\"><a class=\"anchor\" href=\"#缓存击穿量太大缓存过期\">#</a> 缓存击穿（量太大，缓存过期！）</h2>\n<blockquote>\n<p>概述</p>\n</blockquote>\n<p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个 key 非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个 key 在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p>\n<p>当某个 key 在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>\n<blockquote>\n<p>解决方案</p>\n</blockquote>\n<p><strong>设置热点数据永不过期</strong></p>\n<p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p>\n<p><strong>加互斥锁</strong></p>\n<p>分布式锁：使用分布式锁，保证对于每个 key 同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521210320816.png\" alt=\"image-20210521210320816\" /></p>\n<h2 id=\"缓存雪崩\"><a class=\"anchor\" href=\"#缓存雪崩\">#</a> 缓存雪崩</h2>\n<blockquote>\n<p>概念</p>\n</blockquote>\n<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis 宕机！</p>\n<p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521210743763.png\" alt=\"image-20210521210743763\" /></p>\n<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p>\n<blockquote>\n<p>解决方案</p>\n</blockquote>\n<p><strong>redis 高可用</strong></p>\n<p>这个思想的含义是，既然 redis 有可能挂掉，那我多增设几台 redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群。（异地多活！）</p>\n<p><strong>限流降级（在 SpringCloud 讲解过！）</strong></p>\n<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。</p>\n<p><strong>数据预热</strong></p>\n<p>数据预热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>\n<blockquote>\n<p>小结</p>\n</blockquote>\n<p>关注公众号：狂神说，每日更新动态！</p>\n<p>所有看我视频学习的小伙伴，分享或者写笔记的时候，可以带上我的视频连接，表示尊重！</p>\n<p>后面的课程安排：bilibili 免费直播，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vOTUyNTY0NDk=\">https://space.bilibili.com/95256449</span></p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "Redis",
                "Redis"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/",
            "url": "https://xinyao_idiot.gitee.io/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/",
            "title": "RabbitMQ 高级特性",
            "date_published": "2021-05-10T03:38:04.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"1-rabbitmq高级-过期时间ttl\"><a class=\"anchor\" href=\"#1-rabbitmq高级-过期时间ttl\">#</a> 1. RabbitMQ 高级 - 过期时间 TTL</h1>\n<h2 id=\"11-概述\"><a class=\"anchor\" href=\"#11-概述\">#</a> 1.1 概述</h2>\n<p>过期时间 TTL 表示可以对消息设置预期的时间，在这个时间内都可以被消费者接收获取；过了之后消息将自动被删除。RabbitMQ 可以对<strong>消息和队列</strong>设置 TTL。目前有两种方法可以设置。</p>\n<ul>\n<li>第一种方法是通过队列属性设置，队列中所有消息都有相同的过期时间。</li>\n<li>第二种方法是对消息进行单独设置，每条消息 TTL 可以不同。</li>\n</ul>\n<p><strong>如果上述两种方法同时使用</strong>，<strong>则消息的过期时间以两者之间 TTL 较小的那个数值为准</strong>。消息在队列的生存时间一旦超过设置的 TTL 值，就称为 dead message 被投递到死信队列， 消费者将无法再收到该消息。</p>\n<h2 id=\"12-设置队列ttl\"><a class=\"anchor\" href=\"#12-设置队列ttl\">#</a> 1.2 设置队列 TTL</h2>\n<p>生产者、消费者都进行交换机、队列的配置</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName TTLRabbitMqConfiguration</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description ttl 队列配置</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 16:40</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TTLRabbitMqConfiguration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 声明注册 direct 模式的交换机</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl_direct_exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// 队列的过期时间</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">ttlDirectBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">ttlDirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>参数 x-message-ttl 的值 必须是非负 32 位整数 (0 &lt;= n &lt;= 2^32-1) ，以毫秒为单位表示 TTL 的值。这样，值 6000 表示存在于 队列 中的当前 消息 将最多只存活 6 秒。</p>\n</blockquote>\n<p>生产者 <code>OrderService</code>  下单代码，以及测试。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrderTTL</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 定义交换机</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"ttl_direct_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> orderNumber <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户 \"</span> <span class=\"token operator\">+</span> userId <span class=\"token operator\">+</span> <span class=\"token string\">\",订单编号是：\"</span> <span class=\"token operator\">+</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"ttl\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 发送订单信息给 RabbitMQ fanout</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testTTL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">makeOrderTTL</span><span class=\"token punctuation\">(</span><span class=\"token number\">111L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513165521887.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513165521887.png\" class=\"\"></p>\n<h2 id=\"13-设置消息ttl\"><a class=\"anchor\" href=\"#13-设置消息ttl\">#</a> 1.3 设置消息 TTL</h2>\n<p>消息的过期时间；只需要在发送消息（可以发送到任何队列，不管该队列是否属于某个交换机）的时候设置过期时间即可。在测试类中编写如下方法发送消息并设置过期时间到队列：</p>\n<ul>\n<li>在 <code>TTLRabbitMqConfiguration</code>  配置类中创建一个普通的队列，并绑定到该交换机上。</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlMsgQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.message.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>在生产者 <code>OrderService</code>  中发送消息，并设置过期时间。</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 给消息设置过期时间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrderTTLMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 定义交换机</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"ttl_direct_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">String</span> orderNumber <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户 \"</span> <span class=\"token operator\">+</span> userId <span class=\"token operator\">+</span> <span class=\"token string\">\",订单编号是：\"</span> <span class=\"token operator\">+</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"ttlMsg\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 给消息设置过期时间</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">MessagePostProcessor</span> messagePostProcessor <span class=\"token operator\">=</span> message <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setContentEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> message<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 发送订单信息给 RabbitMQ fanout</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">,</span> messagePostProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testTTLMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">makeOrderTTLMsg</span><span class=\"token punctuation\">(</span><span class=\"token number\">111L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>两种方法有如下区别：</p>\n<p>队列 TTL：过期以后，会写入转移到死信队列中。</p>\n<p>消息 TTL：过期以后，就会被移除，不会被转移到死信队列中。</p>\n</blockquote>\n<h1 id=\"2-rabbitmq高级-死信队列\"><a class=\"anchor\" href=\"#2-rabbitmq高级-死信队列\">#</a> 2. RabbitMQ 高级 - 死信队列</h1>\n<h2 id=\"21-概述\"><a class=\"anchor\" href=\"#21-概述\">#</a> 2.1 概述</h2>\n<p>DLX，全称为 Dead-Letter-Exchange , 可以称之为死信交换机，也有人称之为死信邮箱。当消息在一个队列中变成死信 (dead message) 之后，它能被重新发送到另一个交换机中，这个交换机就是 DLX ，绑定 DLX 的队列就称之为死信队列。<br />\n消息变成死信，可能是由于以下的原因：</p>\n<ul>\n<li>消息被拒绝</li>\n<li>消息过期</li>\n<li>队列达到最大长度</li>\n</ul>\n<p>DLX 也是一个正常的交换机，和一般的交换机没有区别，它能在任何的队列上被指定，实际上就是设置某一个队列的属性。<strong>当这个队列中存在死信时，Rabbitmq 就会自动地将这个消息重新发布到设置的 DLX 上去，进而被路由到另一个队列，即死信队列。</strong><br />\n要想使用死信队列，只需要在定义队列的时候设置队列参数  <code>x-dead-letter-exchange</code>  指定交换机即可。</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/833.png\" alt=\"\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/833.png\" class=\"\"></p>\n<h2 id=\"22-实现\"><a class=\"anchor\" href=\"#22-实现\">#</a> 2.2 实现</h2>\n<p>在 <code>TTLRabbitMqConfiguration</code>  中的队列 <code>ttlQueue</code>  配置死信交换机和死信队列</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 队列的过期时间</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 设置死信交换机和死信队列</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dead_direct_exchange\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dead\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//fanout 模式不需要配置路由 Key</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>然后再运行下之前的测试方法</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">testTTL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">makeOrderTTL</span><span class=\"token punctuation\">(</span><span class=\"token number\">111L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在 rabbitMQ 管理界面中结果</p>\n<ul>\n<li>未过期：</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513173952448.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513173952448.png\" class=\"\"></p>\n<ul>\n<li>过期后：</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513174028982.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513174028982.png\" class=\"\"></p>\n<h2 id=\"23-队列达到最大接收长度\"><a class=\"anchor\" href=\"#23-队列达到最大接收长度\">#</a> 2.3 队列达到最大接收长度</h2>\n<p>在 <code>TTLRabbitMqConfiguration</code>  中的队列 <code>ttlQueue</code>  配置接收消息个数</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">ttlQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 队列的过期时间</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 设置死信交换机和死信队列</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dead_direct_exchange\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dead\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//fanout 模式不需要配置路由 Key</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ttl.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>如果达到最大接收消息个数后，其余的消息会被转移到死信队列中。</p>\n<p>模拟发送 11 次消息到该队列中</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">testForTTL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">11</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">makeOrderTTL</span><span class=\"token punctuation\">(</span><span class=\"token number\">111L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513175005152.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513175005152.png\" class=\"\"></p>\n<p>该队列只能接收 5 个消息，其余的 6 个转移到死信队列中。</p>\n<p>ttl 队列的 5 个消息过期后，也会被转入死信队列中。</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513175130713.png\" alt=\"image-20210513175130713\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210513175130713.png\" class=\"\"></p>\n<h1 id=\"3rabbitmq高级-内存磁盘的监控\"><a class=\"anchor\" href=\"#3rabbitmq高级-内存磁盘的监控\">#</a> 3.RabbitMQ 高级 - 内存磁盘的监控</h1>\n<h2 id=\"31-rabbitmq的内存警告\"><a class=\"anchor\" href=\"#31-rabbitmq的内存警告\">#</a> 3.1 RabbitMQ 的内存警告</h2>\n<p>当内存使用超过配置的阈值或者磁盘空间剩余空间对于配置的阈值时，RabbitMQ 会暂时阻塞客户端的连接，并且停止接收从客户端发来的消息，以此避免服务器的崩溃，客户端与服务端的心态检测机制也会失效。<br />\n如下图：</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/840.png\" alt=\"\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/840.png\" class=\"\"></p>\n<p><strong>当出现 blocking 或 blocked 话说明到达了阈值和以及高负荷运行了。</strong></p>\n<h2 id=\"32-rabbitmq的内存控制\"><a class=\"anchor\" href=\"#32-rabbitmq的内存控制\">#</a> 3.2 RabbitMQ 的内存控制</h2>\n<p>参考帮助文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NvbmZpZ3VyZS5odG1s\">https://www.rabbitmq.com/configure.html</span><br />\n 当出现警告的时候，可以通过配置去修改和调整.</p>\n<h3 id=\"321-命令的方式\"><a class=\"anchor\" href=\"#321-命令的方式\">#</a> 3.2.1 命令的方式：</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl set_vm_memory_high_watermark <span class=\"token number\">0.7</span> <span class=\"token comment\">#设置相对的内存大小，值的范围在 0~1 范围，是磁盘大小的 0~1 倍数，建议取值在 04~0.7 之间，不建议超过 0.7.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitmqctl set_vm_memory_high_watermark absolute 10MB <span class=\"token comment\">#设置绝对的内存大小</span></pre></td></tr></table></figure><p><strong>fraction/value 为内存阈值</strong>。<strong>默认情况是：0.4/2GB</strong>，代表的含义是：当 RabbitMQ 的内存超过 40% 时，就会产生警告并且阻塞所有生产者的连接。通过此命令修改阈值在 Broker 重启以后将会失效，通过修改配置文件方式设置的阈值则不会随着重启而消失，但修改了配置文件一样要重启 broker 才会生效。</p>\n<p>分析：</p>\n<blockquote>\n<p>rabbitmqctl set_vm_memory_high_watermark absolute 50MB</p>\n</blockquote>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/841.png\" alt=\"\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/841.png\" class=\"\"></p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/842.png\" alt=\"\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/842.png\" class=\"\"></p>\n<p>看到 <code>State</code>  为 <code>blocking</code> ，赶紧给 Rabbitmq 加内存。</p>\n<h3 id=\"322-配置文件方式-rabbitmqconf\"><a class=\"anchor\" href=\"#322-配置文件方式-rabbitmqconf\">#</a> 3.2.2 配置文件方式 rabbitmq.conf</h3>\n<blockquote>\n<p>当前配置文件：/etc/rabbitmq/rabbitmq.conf</p>\n</blockquote>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#默认</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#vm_memory_high_watermark.relative = 0.4</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 使用 relative 相对值进行设置 fraction, 建议取值在 04~0.7 之间，不建议超过 0.7.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">vm_memory_high_watermark.relative</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">0.6</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 使用 absolute 的绝对值的方式，但是是 KB,MB,GB 对应的命令如下</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token attr-name\">vm_memory_high_watermark.absolute</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">2GB</span></pre></td></tr></table></figure><h2 id=\"33-rabbitmq的内存换页\"><a class=\"anchor\" href=\"#33-rabbitmq的内存换页\">#</a> 3.3 RabbitMQ 的内存换页</h2>\n<p>在某个 Broker 节点及内存阻塞生产者之前，它会尝试将队列中的消息换页到磁盘以释放内存空间，持久化和非持久化的消息都会写入磁盘中，其中持久化的消息本身就在磁盘中有一个副本，所以在转移的过程中持久化的消息会先从内存中清除掉。</p>\n<blockquote>\n<p><strong>默认情况下，内存到达的阈值是 50% 时就会换页处理。</strong><br />\n也就是说，在默认情况下该内存的阈值是 0.4 的情况下，当内存超过 0.4*0.5=0.2 时，会进行换页动作。</p>\n</blockquote>\n<p>比如有 1000MB 内存，当内存的使用率达到了 400MB, 已经达到了极限，但是因为配置的换页内存 0.5，这个时候会在达到极限 400mb 之前，会把内存中的 200MB 进行转移到磁盘中。从而达到稳健的运行。</p>\n<p>可以通过设置  <code>vm_memory_high_watermark_paging_ratio</code>  来进行调整</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">vm_memory_high_watermark.relative</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">0.4</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">vm_memory_high_watermark_paging_ratio</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">0.7 #建议小于0。7，最好是在0.4或者0.5（设置小于1的值）</span></pre></td></tr></table></figure><p>为什么设置小</p>\n<p>于 1，以为你如果你设置为 1 的阈值。内存都已经达到了极限了。你在去换页意义不是很大了。</p>\n<h2 id=\"34-rabbitmq的磁盘预警\"><a class=\"anchor\" href=\"#34-rabbitmq的磁盘预警\">#</a> 3.4 RabbitMQ 的磁盘预警</h2>\n<p>当磁盘的剩余空间低于确定的阈值时，RabbitMQ 同样会阻塞生产者，这样可以避免因非持久化的消息持续换页而耗尽磁盘空间导致服务器崩溃。</p>\n<blockquote>\n<p>** 默认情况下：磁盘预警为 50MB 的时候会进行预警。** 表示当前磁盘空间第 50MB 的时候会阻塞生产者并且停止内存消息换页到磁盘的过程。<br />\n这个阈值可以减小，但是不能完全的消除因磁盘耗尽而导致崩溃的可能性。比如在两次磁盘空间的检查空隙内，第一次检查是：60MB ，第二检查可能就是 1MB, 就会出现警告。</p>\n</blockquote>\n<h3 id=\"通过命令方式修改如下\"><a class=\"anchor\" href=\"#通过命令方式修改如下\">#</a> 通过命令方式修改如下：</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl set_disk_free_limit  <span class=\"token operator\">&lt;</span>disk_limit<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitmqctl set_disk_free_limit mem_relative  <span class=\"token operator\">&lt;</span>fraction<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>disk_limit：固定单位 KB MB GB</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fraction ：是相对阈值，建议范围在:1.0~2.0之间。（相对于内存）</pre></td></tr></table></figure><h3 id=\"通过配置文件配置如下\"><a class=\"anchor\" href=\"#通过配置文件配置如下\">#</a> 通过配置文件配置如下：</h3>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">disk_free_limit.relative</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">3.0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">disk_free_limit.absolute</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">50mb</span></pre></td></tr></table></figure><h1 id=\"4-rabbitmq-高级-集群\"><a class=\"anchor\" href=\"#4-rabbitmq-高级-集群\">#</a> 4. RabbitMQ - 高级 - 集群</h1>\n<h2 id=\"41-rabbitmq-集群\"><a class=\"anchor\" href=\"#41-rabbitmq-集群\">#</a> 4.1 RabbitMQ 集群</h2>\n<p>RabbitMQ 这款消息队列中间件产品本身是基于 Erlang 编写，Erlang 语言天生具备分布式特性（通过同步 Erlang 集群各节点的 magic cookie 来实现）。因此，RabbitMQ 天然支持 Clustering。这使得 RabbitMQ 本身不需要像 ActiveMQ、Kafka 那样通过 ZooKeeper 分别来实现 HA 方案和保存集群的元数据。集群是保证可靠性的一种方式，同时可以通过水平扩展以达到增加消息吞吐量能力的目的。<br />\n在实际使用过程中多采取多机多实例部署方式，为了便于同学们练习搭建，有时候你不得不在一台机器上去搭建一个 rabbitmq 集群，本章主要针对单机多实例这种方式来进行开展。</p>\n<blockquote>\n<p>主要参考官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NsdXN0ZXJpbmcuaHRtbA==\">https://www.rabbitmq.com/clustering.html</span></p>\n</blockquote>\n<h2 id=\"42-集群搭建\"><a class=\"anchor\" href=\"#42-集群搭建\">#</a> 4.2 集群搭建</h2>\n<p>配置的前提是你的 rabbitmq 可以运行起来，比如”ps aux|grep rabbitmq” 你能看到相关进程，又比如运行 “rabbitmqctl status” 你可以看到类似如下信息，而不报错：</p>\n<p>执行下面命令进行查看：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> aux<span class=\"token operator\">|</span><span class=\"token function\">grep</span> rabbitmq</pre></td></tr></table></figure><p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210518185635235.png\" alt=\"\" /></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/image-20210518185635235.png\" class=\"\"></p>\n<p>或者</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl status rabbitmq-server</pre></td></tr></table></figure><blockquote>\n<p>注意：确保 RabbitMQ 可以运行的，确保完成之后，把单机版的 RabbitMQ 服务停止，后台看不到 RabbitMQ 的进程为止</p>\n</blockquote>\n<h2 id=\"43-单机多实例搭建\"><a class=\"anchor\" href=\"#43-单机多实例搭建\">#</a> 4.3 单机多实例搭建</h2>\n<p>** 场景：** 假设有两个 rabbitmq 节点，分别为 rabbit-1, rabbit-2，rabbit-1 作为主节点，rabbit-2 作为从节点。<br />\n<strong>启动命令</strong>：RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit-1 rabbitmq-server -detached<br />\n<strong> 结束命令</strong>：rabbitmqctl -n rabbit-1 stop</p>\n<h3 id=\"431-第一步启动第一个节点rabbit-1\"><a class=\"anchor\" href=\"#431-第一步启动第一个节点rabbit-1\">#</a> 4.3.1 <strong>第一步</strong>：启动第一个节点 rabbit-1</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> <span class=\"token assign-left variable\">RABBITMQ_NODE_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5672</span> <span class=\"token assign-left variable\">RABBITMQ_NODENAME</span><span class=\"token operator\">=</span>rabbit-1 rabbitmq-server start <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.省略<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">##########  Logs: /var/log/rabbitmq/rabbit-1.log</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">######  ##        /var/log/rabbitmq/rabbit-1-sasl.log</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">##########</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>              Starting broker<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> completed with <span class=\"token number\">7</span> plugins.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1234567</span></pre></td></tr></table></figure><p>至此节点 rabbit-1 启动完成。</p>\n<h3 id=\"432-启动第二个节点rabbit-2\"><a class=\"anchor\" href=\"#432-启动第二个节点rabbit-2\">#</a> 4.3.2 启动第二个节点 rabbit-2</h3>\n<blockquote>\n<p>注意：web 管理插件端口占用，所以还要指定其 web 插件占用的端口号<br />\n RABBITMQ_SERVER_START_ARGS=”-rabbitmq_management listener [{port,15673}]”</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token assign-left variable\">RABBITMQ_NODE_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5673</span> <span class=\"token assign-left variable\">RABBITMQ_SERVER_START_ARGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-rabbitmq_management listener [&#123;port,15673&#125;]\"</span> <span class=\"token assign-left variable\">RABBITMQ_NODENAME</span><span class=\"token operator\">=</span>rabbit-2 rabbitmq-server start <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>省略<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">##########  Logs: /var/log/rabbitmq/rabbit-2.log</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">######  ##        /var/log/rabbitmq/rabbit-2-sasl.log</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">##########</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>              Starting broker<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> completed with <span class=\"token number\">7</span> plugins.</pre></td></tr></table></figure><p>至此节点 rabbit-2 启动完成</p>\n<h3 id=\"433-验证启动-ps-auxgrep-rabbitmq\"><a class=\"anchor\" href=\"#433-验证启动-ps-auxgrep-rabbitmq\">#</a> 4.3.3 验证启动 “ps aux|grep rabbitmq”</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq  <span class=\"token number\">2022</span>  <span class=\"token number\">2.7</span>  <span class=\"token number\">0.4</span> <span class=\"token number\">5349380</span> <span class=\"token number\">77020</span> ?       Sl   <span class=\"token number\">11</span>:03   <span class=\"token number\">0</span>:06 /usr/lib/erlang/erts-9.2/bin/beam.smp -W w -A <span class=\"token number\">128</span> -P <span class=\"token number\">1048576</span> -t <span class=\"token number\">5000000</span> -stbt db -zdbbl <span class=\"token number\">128000</span> -K <span class=\"token boolean\">true</span> -B i -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/ebin -noshell -noinput -s rabbit boot -sname rabbit-1 -boot start_sasl -kernel inet_default_connect_options <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>nodelay,true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span> -rabbit tcp_listeners <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"auto\"</span>,5672<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span> -sasl errlog_type error -sasl sasl_error_logger <span class=\"token boolean\">false</span> -rabbit error_logger <span class=\"token punctuation\">&#123;</span>file,<span class=\"token string\">\"/var/log/rabbitmq/rabbit-1.log\"</span><span class=\"token punctuation\">&#125;</span> -rabbit sasl_error_logger <span class=\"token punctuation\">&#123;</span>file,<span class=\"token string\">\"/var/log/rabbitmq/rabbit-1-sasl.log\"</span><span class=\"token punctuation\">&#125;</span> -rabbit enabled_plugins_file <span class=\"token string\">\"/etc/rabbitmq/enabled_plugins\"</span> -rabbit plugins_dir <span class=\"token string\">\"/usr/lib/rabbitmq/plugins:/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/plugins\"</span> -rabbit plugins_expand_dir <span class=\"token string\">\"/var/lib/rabbitmq/mnesia/rabbit-1-plugins-expand\"</span> -os_mon start_cpu_sup <span class=\"token boolean\">false</span> -os_mon start_disksup <span class=\"token boolean\">false</span> -os_mon start_memsup <span class=\"token boolean\">false</span> -mnesia <span class=\"token function\">dir</span> <span class=\"token string\">\"/var/lib/rabbitmq/mnesia/rabbit-1\"</span> -kernel inet_dist_listen_min <span class=\"token number\">25672</span> -kernel inet_dist_listen_max <span class=\"token number\">25672</span> start</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitmq  <span class=\"token number\">2402</span>  <span class=\"token number\">4.2</span>  <span class=\"token number\">0.4</span> <span class=\"token number\">5352196</span> <span class=\"token number\">77196</span> ?       Sl   <span class=\"token number\">11</span>:05   <span class=\"token number\">0</span>:05 /usr/lib/erlang/erts-9.2/bin/beam.smp -W w -A <span class=\"token number\">128</span> -P <span class=\"token number\">1048576</span> -t <span class=\"token number\">5000000</span> -stbt db -zdbbl <span class=\"token number\">128000</span> -K <span class=\"token boolean\">true</span> -B i -- -root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/ebin -noshell -noinput -s rabbit boot -sname rabbit-2 -boot start_sasl -kernel inet_default_connect_options <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>nodelay,true<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span> -rabbit tcp_listeners <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"auto\"</span>,5673<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span> -sasl errlog_type error -sasl sasl_error_logger <span class=\"token boolean\">false</span> -rabbit error_logger <span class=\"token punctuation\">&#123;</span>file,<span class=\"token string\">\"/var/log/rabbitmq/rabbit-2.log\"</span><span class=\"token punctuation\">&#125;</span> -rabbit sasl_error_logger <span class=\"token punctuation\">&#123;</span>file,<span class=\"token string\">\"/var/log/rabbitmq/rabbit-2-sasl.log\"</span><span class=\"token punctuation\">&#125;</span> -rabbit enabled_plugins_file <span class=\"token string\">\"/etc/rabbitmq/enabled_plugins\"</span> -rabbit plugins_dir <span class=\"token string\">\"/usr/lib/rabbitmq/plugins:/usr/lib/rabbitmq/lib/rabbitmq_server-3.6.15/plugins\"</span> -rabbit plugins_expand_dir <span class=\"token string\">\"/var/lib/rabbitmq/mnesia/rabbit-2-plugins-expand\"</span> -os_mon start_cpu_sup <span class=\"token boolean\">false</span> -os_mon start_disksup <span class=\"token boolean\">false</span> -os_mon start_memsup <span class=\"token boolean\">false</span> -mnesia <span class=\"token function\">dir</span> <span class=\"token string\">\"/var/lib/rabbitmq/mnesia/rabbit-2\"</span> -rabbitmq_management listener <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>port,15673<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span> -kernel inet_dist_listen_min <span class=\"token number\">25673</span> -kernel inet_dist_listen_max <span class=\"token number\">25673</span> start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">12</span></pre></td></tr></table></figure><h3 id=\"434-rabbit-1操作作为主节点\"><a class=\"anchor\" href=\"#434-rabbit-1操作作为主节点\">#</a> 4.3.4 rabbit-1 操作作为主节点</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#停止应用</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-1 stop_app</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#目的是清除节点上的历史数据（如果不清除，无法将节点加入到集群）</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-1 reset</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#启动应用</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-1 start_app</pre></td></tr></table></figure><h3 id=\"435-rabbit2操作为从节点\"><a class=\"anchor\" href=\"#435-rabbit2操作为从节点\">#</a> 4.3.5 rabbit2 操作为从节点</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 停止应用</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-2 stop_app</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 目的是清除节点上的历史数据（如果不清除，无法将节点加入到集群）</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-2 reset</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 将 rabbit2 节点加入到 rabbit1（主节点）集群当中【Server-node 服务器的主机名】</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-2 join_cluster rabbit-1@<span class=\"token string\">'Server-node'</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 启动应用</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl -n rabbit-2 start_app</pre></td></tr></table></figure><h3 id=\"436-验证集群状态\"><a class=\"anchor\" href=\"#436-验证集群状态\">#</a> 4.3.6 验证集群状态</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">sudo</span> rabbitmqctl cluster_status -n rabbit-1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>//集群有两个节点：rabbit-1@Server-node、rabbit-2@Server-node</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>nodes,<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>disc,<span class=\"token punctuation\">[</span><span class=\"token string\">'rabbit-1@Server-node'</span>,<span class=\"token string\">'rabbit-2@Server-node'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token punctuation\">&#123;</span>running_nodes,<span class=\"token punctuation\">[</span><span class=\"token string\">'rabbit-2@Server-node'</span>,<span class=\"token string\">'rabbit-1@Server-node'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token punctuation\">&#123;</span>cluster_name,<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">\"rabbit-1@Server-node.localdomain\"</span><span class=\"token operator\">>></span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token punctuation\">&#123;</span>partitions,<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token punctuation\">&#123;</span>alarms,<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">'rabbit-2@Server-node'</span>,<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span>,<span class=\"token punctuation\">&#123;</span><span class=\"token string\">'rabbit-1@Server-node'</span>,<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"437-web监控\"><a class=\"anchor\" href=\"#437-web监控\">#</a> 4.3.7 Web 监控</h3>\n<blockquote>\n<p>打开 rabbitmq Web 管理界面：rabbitmq-plugins enable rabbitmq_management</p>\n</blockquote>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/851.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/851.png\" class=\"\"></p>\n<p><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/851.png\" class=\"\"></p>\n<blockquote>\n<p>注意在访问的时候：web 结面的管理需要给 15672 node-1 和 15673 的 node-2 设置用户名和密码。如下:</p>\n</blockquote>\n<p>在 <code>rabbit-1</code>  或者 <code>rabbit-2</code>  其中一个节点设置的用户，其他节点都会共享。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl -n rabbit-1 add_user admin admin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rabbitmqctl -n rabbit-1 set_user_tags admin administrator</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rabbitmqctl -n rabbit-1 set_permissions -p / admin <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>rabbitmqctl -n rabbit-2 add_user admin admin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>rabbitmqctl -n rabbit-2 set_user_tags admin administrator</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>rabbitmqctl -n rabbit-2 set_permissions -p / admin <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span></pre></td></tr></table></figure><h3 id=\"438-小结\"><a class=\"anchor\" href=\"#438-小结\">#</a> 4.3.8 小结</h3>\n<blockquote>\n<p><strong>Tips：</strong><br />\n如果采用多机部署方式，需读取其中一个节点的 cookie, 并复制到其他节点（节点之间通过 cookie 确定相互是否可通信）。cookie 存放在 /var/lib/rabbitmq/.erlang.cookie。<br />\n例如：主机名分别为 rabbit-1、rabbit-2<br />\n1、逐个启动各节点<br />\n 2、配置各节点的 hosts 文件 (vim /etc/hosts)<br />\n​ ip1：rabbit-1<br />\n​ ip2：rabbit-2<br />\n 其它步骤雷同单机部署方式</p>\n</blockquote>\n<h1 id=\"5-rabbitmq-高级-分布式事务\"><a class=\"anchor\" href=\"#5-rabbitmq-高级-分布式事务\">#</a> 5. RabbitMQ - 高级 - 分布式事务</h1>\n<h2 id=\"51-简述\"><a class=\"anchor\" href=\"#51-简述\">#</a> 5.1 简述</h2>\n<p>分布式事务指事务的操作位于不同的节点上，需要保证事务的 AICD 特性。<br />\n例如在下单场景下，库存和订单如果不在同一个节点上，就涉及分布式事务。</p>\n<blockquote>\n<p>简单的说，就是在某个业务处理下，所涉及到的多个系统之间各自数据库的数据一致性。</p>\n</blockquote>\n<h2 id=\"52-分布式事务的方式\"><a class=\"anchor\" href=\"#52-分布式事务的方式\">#</a> 5.2 分布式事务的方式</h2>\n<p>在分布式系统中，要实现分布式事务，无外乎那几种解决方案。</p>\n<h4 id=\"一-两阶段提交2pc需要数据库产商的支持java组件有atomikos等\"><a class=\"anchor\" href=\"#一-两阶段提交2pc需要数据库产商的支持java组件有atomikos等\">#</a> 一、两阶段提交（2PC）需要数据库产商的支持，java 组件有 atomikos 等。</h4>\n<p>两阶段提交（Two-phase Commit，2PC），通过引入协调者（Coordinator）来协调参与者的行为，并最终决定这些参与者是否要真正执行事务。</p>\n<h5 id=\"1-准备阶段\"><a class=\"anchor\" href=\"#1-准备阶段\">#</a> 1、准备阶段</h5>\n<p>协调者询问参与者事务是否执行成功，参与者发回事务执行结果。</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/852.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/852.png\" class=\"\"></p>\n<h5 id=\"2-提交阶段\"><a class=\"anchor\" href=\"#2-提交阶段\">#</a> 2、提交阶段</h5>\n<p>如果事务在每个参与者上都执行成功，事务协调者发送通知让参与者提交事务；否则，协调者发送通知让参与者回滚事务。<br />\n需要注意的是，在准备阶段，参与者执行了事务，但是还未提交。只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚。</p>\n<p><img data-src=\"/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/853.png\" alt=\"853\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/853.png\" class=\"\"></p>\n<h5 id=\"存在的问题\"><a class=\"anchor\" href=\"#存在的问题\">#</a> 存在的问题</h5>\n<ul>\n<li>1 同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。</li>\n<li>2 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。</li>\n<li>3 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。</li>\n<li>4 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。</li>\n</ul>\n<h4 id=\"二-补偿事务tcc-严选阿里蚂蚁金服\"><a class=\"anchor\" href=\"#二-补偿事务tcc-严选阿里蚂蚁金服\">#</a> 二、补偿事务（TCC） 严选，阿里，蚂蚁金服。</h4>\n<p>TCC 其实就是采用的补偿机制，其核心思想是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作。它分为三个阶段：</p>\n<ul>\n<li>Try 阶段主要是对业务系统做检测及资源预留</li>\n<li>Confirm 阶段主要是对业务系统做确认提交，Try 阶段执行成功并开始执行 Confirm 阶段时，默认 - - - Confirm 阶段是不会出错的。即：只要 Try 成功，Confirm 一定成功。</li>\n<li>Cancel 阶段主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放。</li>\n</ul>\n<blockquote>\n<p>举个例子，假入 Bob 要向 Smith 转账，思路大概是： 我们有一个本地方法，里面依次调用<br />\n 1：首先在 Try 阶段，要先调用远程接口把 Smith 和 Bob 的钱给冻结起来。<br />\n2：在 Confirm 阶段，执行远程调用的转账的操作，转账成功进行解冻。<br />\n3：如果第 2 步执行成功，那么转账成功，如果第二步执行失败，则调用远程冻结接口对应的解冻方法 (Cancel)。</p>\n</blockquote>\n<p>优点： 跟 2PC 比起来，实现以及流程相对简单了一些，但数据的一致性比 2PC 也要差一些<br />\n缺点： 缺点还是比较明显的，在 2,3 步中都有可能失败。TCC 属于应用层的一种补偿方式，所以需要程序员在实现的时候多写很多补偿的代码，在一些场景中，一些业务流程可能用 TCC 不太好定义及处理。</p>\n<h4 id=\"三-本地消息表异步确保比如支付宝-微信支付主动查询支付状态对账单的形式\"><a class=\"anchor\" href=\"#三-本地消息表异步确保比如支付宝-微信支付主动查询支付状态对账单的形式\">#</a> 三、本地消息表（异步确保）比如：支付宝、微信支付主动查询支付状态，对账单的形式</h4>\n<p>本地消息表与业务数据表处于同一个数据库中，这样就能利用本地事务来保证在对这两个表的操作满足事务特性，并且使用了消息队列来保证最终一致性。</p>\n<ul>\n<li>在分布式事务操作的一方完成写业务数据的操作之后向本地消息表发送一个消息，本地事务能保证这个消息一定会被写入本地消息表中。</li>\n<li>之后将本地消息表中的消息转发到 Kafka 等消息队列中，如果转发成功则将消息从本地消息表中删除，否则继续重新转发。</li>\n<li>在分布式事务操作的另一方从消息队列中读取一个消息，并执行消息中的操作。</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/854.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/854.png\" class=\"\"></p>\n<blockquote>\n<p>优点： 一种非常经典的实现，避免了分布式事务，实现了最终一致性。<br />\n缺点： 消息表会耦合到业务系统中，如果没有封装好的解决方案，会有很多杂活需要处理。</p>\n</blockquote>\n<h3 id=\"四-mq-事务消息-异步场景通用性较强拓展性较高\"><a class=\"anchor\" href=\"#四-mq-事务消息-异步场景通用性较强拓展性较高\">#</a> 四、MQ 事务消息 异步场景，通用性较强，拓展性较高。</h3>\n<p>有一些第三方的 MQ 是支持事务消息的，比如 RocketMQ，他们支持事务消息的方式也是类似于采用的二阶段提交，但是市面上一些主流的 MQ 都是不支持事务消息的，比如 Kafka 不支持。<br />\n以阿里的 RabbitMQ 中间件为例，其思路大致为：</p>\n<ul>\n<li>第一阶段 Prepared 消息，会拿到消息的地址。 第二阶段执行本地事务，第三阶段通过第一阶段拿到的地址去访问消息，并修改状态。</li>\n<li>也就是说在业务方法内要想消息队列提交两次请求，一次发送消息和一次确认消息。如果确认消息发送失败了 RabbitMQ 会定期扫描消息集群中的事务消息，这时候发现了 Prepared 消息，它会向消息发送者确认，所以生产方需要实现一个 check 接口，RabbitMQ 会根据发送端设置的策略来决定是回滚还是继续发送确认消息。这样就保证了消息发送与本地事务同时成功或同时失败。</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/855.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/855.png\" class=\"\"></p>\n<blockquote>\n<p>优点： 实现了最终一致性，不需要依赖本地数据库事务。<br />\n缺点： 实现难度大，主流 MQ 不支持，RocketMQ 事务消息部分代码也未开源。</p>\n</blockquote>\n<h3 id=\"五-总结\"><a class=\"anchor\" href=\"#五-总结\">#</a> 五、总结</h3>\n<p>通过本文我们总结并对比了几种分布式分解方案的优缺点，分布式事务本身是一个技术难题，是没有一种完美的方案应对所有场景的，具体还是要根据业务场景去抉择吧。阿里 RocketMQ 去实现的分布式事务，现在也有除了很多分布式事务的协调器，比如 LCN 等，大家可以多去尝试。</p>\n<h2 id=\"53-具体实现\"><a class=\"anchor\" href=\"#53-具体实现\">#</a> 5.3 具体实现</h2>\n<p>分布式事务的完整架构图：</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/856.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/856.png\" class=\"\"></p>\n<p>美团外卖架构：</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/857.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/857.png\" class=\"\"></p>\n<h3 id=\"531-系统与系统之间的分布式事务问题\"><a class=\"anchor\" href=\"#531-系统与系统之间的分布式事务问题\">#</a> 5.3.1 系统与系统之间的分布式事务问题</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/858.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/858.png\" class=\"\"></p>\n<h3 id=\"532-系统间调用过程中事务回滚问题\"><a class=\"anchor\" href=\"#532-系统间调用过程中事务回滚问题\">#</a> 5.3.2 系统间调用过程中事务回滚问题</h3>\n<p>创建两个项目 <code>mt_order</code>  和 <code>mt_dispatch</code></p>\n<ul>\n<li>mt_order</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8089</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mariadb<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/demo</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> org.mariadb.jdbc.Driver</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">jpa</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">show-sql</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">open-in-view</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">ddl-auto</span><span class=\"token punctuation\">:</span> update</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> 10.1.53.166<span class=\"token punctuation\">:</span><span class=\"token number\">5672</span><span class=\"token punctuation\">,</span>10.1.53.166<span class=\"token punctuation\">:</span><span class=\"token number\">5673</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\"># 开启手动 ACK，让程序去控制 MQ 消息的重发、移除和转移</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">publisher-confirm-type</span><span class=\"token punctuation\">:</span> correlated</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">publisher-returns</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> manual</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\">#开启重启</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token key atrule\">max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span> <span class=\"token comment\">#最大重试次数</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token key atrule\">initial-interval</span><span class=\"token punctuation\">:</span> 2000ms <span class=\"token comment\">#重试间隔时间</span></pre></td></tr></table></figure><figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>runtime<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optional</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optional</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optional</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optional</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-rabbit-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-jpa<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mariadb.jdbc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mariadb-java-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>runtime<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Entity</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"`order`\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> orderContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">OrderRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderRepository</span> orderRepository<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>rollbackFor <span class=\"token operator\">=</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 1. 订单信息 ---- 插入订单数据库，订单数据库事务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2. 通过 http 接口发送订单消息到运单系统</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token function\">dispatchHttpApi</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单创建失败，原因是运单接口调用失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * 将订单信息发送到运单系统</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @param orderId 订单 ID</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">dispatchHttpApi</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> orderId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">SimpleClientHttpRequestFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleClientHttpRequestFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 连接超时 > 3 秒</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 处理超时 > 2 秒</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        factory<span class=\"token punctuation\">.</span><span class=\"token function\">setReadTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 发送 http 请求</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost:9000/dispatch/order?orderId=\"</span> <span class=\"token operator\">+</span> orderId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token class-name\">RestTemplate</span> restTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplate</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForObject</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>mt_dispatch</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-devtools<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>runtime<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optional</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optional</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.projectlombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>lombok<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>optional</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>optional</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-rabbit-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-jpa<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mariadb.jdbc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mariadb-java-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>runtime<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9000</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>mariadb<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>3306/demo</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> org.mariadb.jdbc.Driver</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">jpa</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">show-sql</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">open-in-view</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">ddl-auto</span><span class=\"token punctuation\">:</span> update</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> 10.1.53.166<span class=\"token punctuation\">:</span><span class=\"token number\">5672</span><span class=\"token punctuation\">,</span>10.1.53.166<span class=\"token punctuation\">:</span><span class=\"token number\">5673</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\"># 开启手动 ACK，让程序去控制 MQ 消息的重发、移除和转移</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> manual</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\">#开启重启</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span> <span class=\"token comment\">#最大重试次数</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">initial-interval</span><span class=\"token punctuation\">:</span> 2000ms <span class=\"token comment\">#重试间隔时间</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Entity</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Dispatcher</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> orderId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> status<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> orderContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">DispatchRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dispatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DispatchService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DispatchRepository</span> dispatchRepository<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> orderId<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">Dispatcher</span> dispatcher <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dispatcher</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> orderId<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"买了一栋别墅\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">666</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Dispatcher</span> result <span class=\"token operator\">=</span> dispatchRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>dispatcher<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"运单创建失败！原因【操作数据库失败】\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在 <code>mt_order</code>  中添加单元测试，模拟创建订单， <code>mt_dispatch</code>  开启 <code>debug</code>  模式，并打断点在 <code>DispatchService</code>  中的 <code>dispatch</code>  方法。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">orderCreated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    order<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    order<span class=\"token punctuation\">.</span><span class=\"token function\">setOrderContent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"买了一栋别墅\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    order<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span><span class=\"token number\">666</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    order<span class=\"token punctuation\">.</span><span class=\"token function\">setCreateTime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单创建成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>【测试结果】订单系统因为设置了处理超时时间 <code>2s</code> ，超过了之后数据会进行回滚，而运单系统则继续将数据插入到数据库中。订单系统出现异常，会进行回滚，而运单系统不会。</p>\n<p>【结论】订单系统的 Transactional 只能控制自己服务的事务，不能控制其他服务的事务，从而引起分布式事务问题。</p>\n<h3 id=\"533-基于mq的分布式事务整体设计思路\"><a class=\"anchor\" href=\"#533-基于mq的分布式事务整体设计思路\">#</a> 5.3.3 基于 MQ 的分布式事务整体设计思路</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/859.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/859.png\" class=\"\"></p>\n<h3 id=\"534-基于mq的分布式事务消息的可靠生产问题\"><a class=\"anchor\" href=\"#534-基于mq的分布式事务消息的可靠生产问题\">#</a> 5.3.4 基于 MQ 的分布式事务消息的可靠生产问题</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/860.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/860.png\" class=\"\"></p>\n<p>如果这个时候 MQ 服务器出现了异常和故障，那么消息是无法获取到回执信息。怎么解决呢？</p>\n<h3 id=\"535-基于mq的分布式事务消息的可靠生产问题-定时重发\"><a class=\"anchor\" href=\"#535-基于mq的分布式事务消息的可靠生产问题-定时重发\">#</a> 5.3.5 基于 MQ 的分布式事务消息的可靠生产问题 - 定时重发</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/861.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/861.png\" class=\"\"></p>\n<p>生产者 <code>mt_order</code> yml 配置开启发送确定机制</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\"># 开启手动 ACK，让程序去控制 MQ 消息的重发、移除和转移</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">publisher-confirm-type</span><span class=\"token punctuation\">:</span> correlated <span class=\"token comment\">#消息发送确认机制</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">publisher-returns</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\">#开启消息回执</span></pre></td></tr></table></figure><p>创建一个订单消息冗余表，来保证消息的可靠性。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Entity</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@AllArgsConstructor</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@NoArgsConstructor</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderMessage</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> userId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> orderContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> status<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 消息发送成功状态，是否已被 rabbitmq 接收。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>创建 repository，根据 <code>订单id</code>  修改订单消息冗余表的状态</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">OrderMessageRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderMessage</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Transactional</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Modifying</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"update order_message set status = ?1 where id = ?2\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Integer</span> <span class=\"token function\">updateStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> status<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>创建 service</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderMessageService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderMessageRepository</span> orderMessageRepository<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 将订单数据保存到订单消息冗余表中。消息状态默认为 0，未消费</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveLocalMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">OrderMessage</span> orderMessage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderMessage</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getOrderContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getCreateTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        orderMessageRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>orderMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>创建 MQ 发送消息以及发送成功后的确认回调处理。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderMQService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderMessageRepository</span> orderMessageRepository<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * 发布者确认的回调。</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * @PostConstruct 该注解用来修饰一个非静态的 void () 方法，被该注解修饰的方法会在服务器加载 Servlet 的时候运行，并且只会被运行一次。</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @param correlationData 回调的相关数据。</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     * @param ack             ack 为真，nack 为假</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     * @param cause           一个可选的原因，用于 nack，如果可用，否则为空。</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostConstruct</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">regCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 消息发送成功以后，给生产者的消息回执，来确保生产者的可靠性</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>correlationData<span class=\"token punctuation\">,</span> ack<span class=\"token punctuation\">,</span> cause<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cause: \"</span> <span class=\"token operator\">+</span> cause<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 如果 ack 为 true 代表消息已经收到</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>ack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MQ队列应答失败，orderId是：\"</span> <span class=\"token operator\">+</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token class-name\">Integer</span> count <span class=\"token operator\">=</span> orderMessageRepository<span class=\"token punctuation\">.</span><span class=\"token function\">updateStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"本地消息状态修改成功，消息成功投递到消息队列中...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"本地消息状态修改失败，出现异常：\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order_fanout_exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">objectToJson</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderMessage</span> orderMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order_fanout_exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">objectToJson</span><span class=\"token punctuation\">(</span>orderMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>orderMessage<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>JSON 序列化工具类，这里使用的是 <code>jackson</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 当前类用于将某个特定的对象转换为 JSON 对象，或者将 JSON 对象转换为某个特定的对象</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JsonUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ObjectMapper</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper</span> mapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span>mapper <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">String</span> <span class=\"token function\">objectToJson</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">jsonToObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span>  <span class=\"token class-name\">TypeReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> tr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">T</span> o <span class=\"token operator\">=</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> tr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">return</span> o<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>创建一个定时任务，每隔一段时间，检查有没有发送失败的消息，然后重新将消息发送到 MQ 中</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Slf4j</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@EnableScheduling</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderMessageService</span> orderMessageService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderMQService</span> orderMQService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Scheduled</span><span class=\"token punctuation\">(</span>cron <span class=\"token operator\">=</span> <span class=\"token string\">\"0 */1 * * * ?\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 把消息为 0 的状态消息查询出来，重新投递到 MQ 中。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderMessage</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> orderMessageService<span class=\"token punctuation\">.</span><span class=\"token function\">findByStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"检查未发送的消息，进行重新发送，需要重发的数量 = \"</span> <span class=\"token operator\">+</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 3. 通过 http 接口发送订单消息到运单系统</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>order <span class=\"token operator\">-></span> orderMQService<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>创建控制器，以便开启 debug 模式测试</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MQOrderService</span> mqOrderService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/test\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        order<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        order<span class=\"token punctuation\">.</span><span class=\"token function\">setOrderContent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"买了一栋别墅\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        order<span class=\"token punctuation\">.</span><span class=\"token function\">setUserId</span><span class=\"token punctuation\">(</span><span class=\"token number\">666</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        order<span class=\"token punctuation\">.</span><span class=\"token function\">setCreateTime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        mqOrderService<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单创建成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在 rabbitmq Web 控制界面创建 <code>fanout模式</code> 交换机 <code>order_fanout_exchange</code>  以及绑定消息队列 <code>order.queue</code> 。</p>\n<p>【测试】开启 debug 模式，浏览器访问 <code>http://ip:8089/test</code></p>\n<h3 id=\"536-基于mq的分布式事务消息的可靠消费\"><a class=\"anchor\" href=\"#536-基于mq的分布式事务消息的可靠消费\">#</a> 5.3.6 基于 MQ 的分布式事务消息的可靠消费</h3>\n<p><strong>在消息过程中，出现了故障，默认会进行重发，触发 rabbitmq 的重试机制，而重试机制会引发死循环。</strong></p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/862.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/862.png\" class=\"\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName OrderMQConsumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 订单 MQ 消息 消费</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/24 9:59</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderMQConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DispatchService</span> dispatchService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// 解决消息重试的集中方案：</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">//1. 控制重发的次数</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">//2.try + catch + 手动 ack</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//3.try + catch + 手动 ack + 死信队列 + 人工干预</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"order.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">messageConsumer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> orderMsg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Channel</span> channel<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CorrelationData</span> correlationData<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Header</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AmqpHeaders</span><span class=\"token punctuation\">.</span>DELIVERY_TAG<span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> tag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// 1. 获取消息队列的消息</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到MQ的消息是：\"</span> <span class=\"token operator\">+</span> orderMsg <span class=\"token operator\">+</span> <span class=\"token string\">\"，count = \"</span> <span class=\"token operator\">+</span> count<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// 2. 获取订单服务的消息</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">jsonToObject</span><span class=\"token punctuation\">(</span>orderMsg<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单ID = \"</span> <span class=\"token operator\">+</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 3. 派单处理</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        dispatchService<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>控制消息重发的次数</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\"># 开启手动 ACK，让程序去控制 MQ 消息的重发、移除和转移</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">acknowledge-mode</span><span class=\"token punctuation\">:</span> manual <span class=\"token comment\"># 默认为 none，自动进行 ack，会把消息进行移除或转移到死信队列；manual 表示进行手动确认</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">retry</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\">#开启重启</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> <span class=\"token comment\">#最大重试次数</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>          <span class=\"token key atrule\">initial-interval</span><span class=\"token punctuation\">:</span> 2000ms <span class=\"token comment\">#重试间隔时间</span></pre></td></tr></table></figure><h3 id=\"537-基于mq的分布式事务消息的消息重发\"><a class=\"anchor\" href=\"#537-基于mq的分布式事务消息的消息重发\">#</a> 5.3.7 基于 MQ 的分布式事务消息的消息重发</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/863.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/863.png\" class=\"\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderMQConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DispatchService</span> dispatchService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 解决消息重试的集中方案：</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">//1. 控制重发的次数</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">//2.try + catch + 手动 ack</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">//3.try + catch + 手动 ack + 死信队列 + 人工干预</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"order.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">messageConsumer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> orderMsg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Channel</span> channel<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CorrelationData</span> correlationData<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Header</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AmqpHeaders</span><span class=\"token punctuation\">.</span>DELIVERY_TAG<span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> tag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 1. 获取消息队列的消息</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到MQ的消息是：\"</span> <span class=\"token operator\">+</span> orderMsg <span class=\"token operator\">+</span> <span class=\"token string\">\"，count = \"</span> <span class=\"token operator\">+</span> count<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 2. 获取订单服务的消息</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">jsonToObject</span><span class=\"token punctuation\">(</span>orderMsg<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3. 获取订单 id</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单ID = \"</span> <span class=\"token operator\">+</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//        int a =1/0;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 4. 派单处理</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            dispatchService<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 5. 手动 ack 告诉 MQ 消息已经正常消费</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// 如果出现异常的情况下，根据实际的情况去进行重发</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// 重发一次后，丢失，还是记录，存库根据自己的业务场景去决定</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// 参数 1：消息的 tag   参数 2：false 是否多条处理</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// 参数 3： requeue 是否重发，false 不会重发，会把消息转移到死信队列中；true 的话会进行死循环的重发，建议如果使用 true 的话，不要加 try/catch 否则就会造成死循环。</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicNack</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>如果使用的是 try + catch + 手动 ack，之前的控制重试次数机制就会失效</p>\n</blockquote>\n<h3 id=\"538-基于mq的分布式事务消息的死信队列消息转移-人工处理\"><a class=\"anchor\" href=\"#538-基于mq的分布式事务消息的死信队列消息转移-人工处理\">#</a> 5.3.8 基于 MQ 的分布式事务消息的死信队列消息转移 + 人工处理</h3>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/864.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/864.png\" class=\"\"></p>\n<p><strong>如果死信队列报错就进行人工处理</strong></p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/865.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/865.png\" class=\"\"></p>\n<p>新建 rabbitmq 配置类 <code>RabbitMQConfiguration</code> ，定义订单交换机、队列，以及死信交换机和队列，并完成队列和死信队列的绑定。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfiguration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * 声明注册 fanout 模式的交换机，作为死信交换机</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * @return FanoutExchange</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FanoutExchange</span> <span class=\"token function\">deadExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dead_order_fanout_exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 声明死信队列</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">deadOrderQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dead.order.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 完成绑定关系（队列和交换机）</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">bindingDeadOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">deadOrderQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">deadExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FanoutExchange</span> <span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order_fanout_exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">orderQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dead_order_fanout_exchange\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">bindingOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">orderQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者根据订单消费类，复制出来一个死信队列消费处理，失败后的处理根据业务场景决定。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeadMQConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DispatchService</span> dispatchService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 解决消息重试的集中方案：</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">//1. 控制重发的次数</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">//2.try + catch + 手动 ack</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">//3.try + catch + 手动 ack + 死信队列 + 人工干预</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"dead.order.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">messageConsumer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> orderMsg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Channel</span> channel<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CorrelationData</span> correlationData<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Header</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AmqpHeaders</span><span class=\"token punctuation\">.</span>DELIVERY_TAG<span class=\"token punctuation\">)</span> <span class=\"token keyword\">long</span> tag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 1. 获取消息队列的消息</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"死信队列收到MQ的消息是：\"</span> <span class=\"token operator\">+</span> orderMsg <span class=\"token operator\">+</span> <span class=\"token string\">\"，count = \"</span> <span class=\"token operator\">+</span> count<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 2. 获取订单服务的消息</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">JsonUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">jsonToObject</span><span class=\"token punctuation\">(</span>orderMsg<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 3. 获取订单 id</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">String</span> orderId <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"订单ID = \"</span> <span class=\"token operator\">+</span> orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4. 派单处理</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            dispatchService<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>orderId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5. 手动 ack 告诉 MQ 消息已经正常消费</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"人工干预\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送短信预警\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"把消息转移到别的存储DB\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicNack</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>由于  <code>订单队列</code> 和 <code>死信队列</code>  都对 运单数据进行插入，所以要考虑到数据幂等性（数据的一致性），可以将运单表的订单 ID <code>orderId</code>  设置唯一约束，这个方法会损耗数据库的一些资源；另一种办法就是使用分布式锁。</p>\n</blockquote>\n<p>整个流程：生产者推送一条消息过来，为了保证可靠生产，使用消息冗余的机制，来保证消息投递的可靠性；</p>\n<p>消费者监听 <code>order.queue</code>  队列，接收消费过程中出现异常故障，将消息转移到死信队列中。</p>\n<p>消费者监听死信队列 <code>dead.order.queue</code> ，接收到以后，消费后正常处理，如果消费过程中，出现异常故障，则进行 <code>人工干预</code> 、 <code>发送短信预警</code> 或者 <code>把消息转移到别的存储DB</code> ，最后把消息进行移除。</p>\n<h2 id=\"6-其他信息\"><a class=\"anchor\" href=\"#6-其他信息\">#</a> 6、其他信息</h2>\n<p>SpringBoot RabbitMq 详细配置信息</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> 127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">6605</span><span class=\"token punctuation\">,</span>127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">6606</span><span class=\"token punctuation\">,</span>127.0.0.1<span class=\"token punctuation\">:</span><span class=\"token number\">6705</span> <span class=\"token comment\">#指定 client 连接到的 server 的地址，多个以逗号分隔 (优先取 addresses，然后再取 host)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#    port:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">## 集群配置 addresses 之间用逗号隔开</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># addresses: ip:port,ip:port</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> / <span class=\"token comment\"># 连接到 rabbitMQ 的 vhost</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">requested-heartbeat</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#指定心跳超时，单位秒，0 为不指定；默认 60s</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">publisher-confirms</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#是否启用 发布确认</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">publisher-reurns</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 是否启用发布返回</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">connection-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#连接超时，单位毫秒，0 表示无穷大，不超时</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">channel.size</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 缓存中保持的 channel 数量</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">channel.checkout-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 当缓存数量被设置时，从缓存中获取一个 channel 的超时时间，单位毫秒；如果为 0，则总是创建一个新 channel</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">connection.size</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 缓存的连接数，只有是 CONNECTION 模式时生效</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">connection.mode</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 连接工厂缓存模式：CHANNEL 和 CONNECTION</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">listener</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">simple.auto-startup</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 是否启动时自动启动容器</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">simple.acknowledge-mode</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 表示消息确认方式，其有三种配置方式，分别是 none、manual 和 auto；默认 auto</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token key atrule\">simple.concurrency</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 最小的消费者数量</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">simple.max-concurrency</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 最大的消费者数量</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token key atrule\">simple.prefetch</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 指定一个请求能处理多少个消息，如果有事务的话，必须大于等于 transaction 数量.</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token key atrule\">simple.transaction-size</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 指定一个事务处理的消息数量，最好是小于等于 prefetch 的数量.</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token key atrule\">simple.default-requeue-rejected</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 决定被拒绝的消息是否重新入队；默认是 true（与参数 acknowledge-mode 有关系）</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token key atrule\">simple.idle-event-interval</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 多少长时间发布空闲容器时间，单位毫秒</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.enabled</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 监听重试是否可用</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 最大重试次数</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.initial-interval</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 第一次和第二次尝试发布或传递消息之间的间隔</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.multiplier</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 应用于上一重试间隔的乘数</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.max-interval</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 最大重试时间间隔</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">simple.retry.stateless</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 重试是有状态 or 无状态</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">mandatory</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 启用强制信息；默认 false</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token key atrule\">receive-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># receive () 操作的超时时间</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token key atrule\">reply-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># sendAndReceive () 操作的超时时间</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token key atrule\">retry.enabled</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 发送重试是否可用</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">retry.max-attempts</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 最大重试次数</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token key atrule\">retry.initial-interval</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 第一次和第二次尝试发布或传递消息之间的间隔</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token key atrule\">retry.multiplier</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 应用于上一重试间隔的乘数</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token key atrule\">retry.max-interval</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#最大重试时间间隔</span></pre></td></tr></table></figure><blockquote>\n<p>注：相关配置很多，大家只需要关注一些常用的配置即可</p>\n</blockquote>\n<ul>\n<li>对于发送方而言，需要做以下配置：<br />\n1 配置 CachingConnectionFactory<br />\n2 配置 Exchange/Queue/Binding<br />\n3 配置 RabbitAdmin 创建上一步的 Exchange/Queue/Binding<br />\n4 配置 RabbitTemplate 用于发送消息，RabbitTemplate 通过 CachingConnectionFactory 获取到 Connection，然后想指定 Exchange 发送</li>\n<li>对于消费方而言，需要做以下配置：<br />\n1 配置 CachingConnectionFactory<br />\n2 配置 Exchange/Queue/Binding<br />\n3 配置 RabbitAdmin 创建上一步的 Exchange/Queue/Binding<br />\n4 配置 RabbitListenerContainerFactory<br />\n5 配置<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JhYmJpdExpc3RlbmVy\"> @RabbitListener</span>/<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JhYmJpdEhhbmRsZXI=\">@RabbitHandler</span> 用于接收消息<br />\n在默认情况下主要的配置如下：</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/866.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/866.png\" class=\"\"></p>\n<p>Spring AMQP 的主要对象:</p>\n<p><img data-src=\"RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/867.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/867.png\" class=\"\"></p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "Rabbitmq",
                "RabbitMQ"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://xinyao_idiot.gitee.io/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "RabbitMQ 入门及使用",
            "date_published": "2021-05-10T00:39:18.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"1-rabbitmq入门及安装\"><a class=\"anchor\" href=\"#1-rabbitmq入门及安装\">#</a> 1. RabbitMQ 入门及安装</h1>\n<h2 id=\"11-概述\"><a class=\"anchor\" href=\"#11-概述\">#</a> 1.1 概述</h2>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tLw==\">https://www.rabbitmq.com/</span><br />\n 什么是 RabbitMQ, 官方给出来这样的解释：</p>\n<blockquote>\n<p>RabbitMQ is the most widely deployed open source message broker.<br />\nWith tens of thousands of users, RabbitMQ is one of the most popular open source message brokers. From T-Mobile to Runtastic, RabbitMQ is used worldwide at small startups and large enterprises.<br />\nRabbitMQ is lightweight and easy to deploy on premises and in the cloud. It supports multiple messaging protocols. RabbitMQ can be deployed in distributed and federated configurations to meet high-scale, high-availability requirements.<br />\nRabbitMQ runs on many operating systems and cloud environments, and provides a wide range of developer tools for most popular languages.<br />\n<strong> 翻译以后：</strong><br />\nRabbitMQ 是部署最广泛的开源消息代理。<br />\nRabbitMQ 拥有成千上万的用户，是最受欢迎的开源消息代理之一。从 T-Mobile 到 Runtastic，RabbitMQ 在全球范围内的小型初创企业和大型企业中都得到使用。<br />\nRabbitMQ 轻巧，易于在内部和云中部署。它支持多种消息传递协议。RabbitMQ 可以部署在分布式和联合配置中，以满足大规模，高可用性的要求。<br />\nRabbitMQ 可在许多操作系统和云环境上运行，并为大多数流行语言提供了广泛的开发人员工具。</p>\n</blockquote>\n<p>简单概述：<br />\n<strong>RabbitMQ 是一个开源的遵循 AMQP 协议实现的基于 Erlang 语言编写，支持多种客户端（语言）。用于在分布式系统中存储消息，转发消息，具有高可用，高可扩性，易用性等特征。</strong></p>\n<h2 id=\"12-安装rabbitmq\"><a class=\"anchor\" href=\"#12-安装rabbitmq\">#</a> 1.2 安装 RabbitMQ</h2>\n<p>1：下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2Rvd25sb2FkLmh0bWw=\">https://www.rabbitmq.com/download.html</span><br />\n2：环境准备：CentOS7.x+ / Erlang<br />\nRabbitMQ 是采用 Erlang 语言开发的，所以系统环境必须提供 Erlang 环境，<strong>第一步就是安装 Erlang。</strong></p>\n<blockquote>\n<p>erlang 和 RabbitMQ 版本的按照比较: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL3doaWNoLWVybGFuZy5odG1s\">https://www.rabbitmq.com/which-erlang.html</span></p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/810.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/810.png\" class=\"\"></p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> -y erlang <span class=\"token comment\">#安装 erlang</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum <span class=\"token function\">install</span> -y socat <span class=\"token comment\">#安装 socat</span></pre></td></tr></table></figure><p>3. 安装 rabbitmq</p>\n<p>下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2Rvd25sb2FkLmh0bWw=\">https://www.rabbitmq.com/download.html</span></p>\n<p>yum 下载</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> rabbitmq-server -y</pre></td></tr></table></figure><p>启动 rabbitmq 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl start rabbitmq-server <span class=\"token comment\"># 启动服务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl status rabbitmq-server <span class=\"token comment\"># 查看服务状态</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl stop rabbitmq-server <span class=\"token comment\"># 停止服务</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> rabbitmq-server <span class=\"token comment\"># 开机启动服务</span></pre></td></tr></table></figure><p>4.RabbitMQ 的配置</p>\n<p>RabbitMQ 默认情况下有一个配置文件，定义了 RabbitMQ 的相关配置信息，默认情况下能够满足日常的开发需求。如果需要修改需要，需要自己创建一个配置文件进行覆盖。</p>\n<blockquote>\n<p>参考官网：<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2RvY3VtZW50YXRpb24uaHRtbA==\">https://www.rabbitmq.com/documentation.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NvbmZpZ3VyZS5odG1s\">https://www.rabbitmq.com/configure.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2NvbmZpZ3VyZS5odG1sI2NvbmZpZy1pdGVtcw==\">https://www.rabbitmq.com/configure.html#config-items</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JhYmJpdG1xL3JhYmJpdG1xLXNlcnZlci9ibG9iL2FkZC1kZWJ1Zy1tZXNzYWdlcy10by1xdW9ydW1fcXVldWVfU1VJVEUvZG9jcy9yYWJiaXRtcS5jb25mLmV4YW1wbGU=\">https://github.com/rabbitmq/rabbitmq-server/blob/add-debug-messages-to-quorum_queue_SUITE/docs/rabbitmq.conf.example</span></p>\n</blockquote>\n<p>5. 相关端口</p>\n<p><strong>5672</strong>: RabbitMQ 的通讯端口<br />\n<strong> 25672</strong>: RabbitMQ 的节点间的 CLI 通讯端口是<br />\n<strong> 15672</strong>: RabbitMQ HTTP_API 的端口，管理员用户才能访问，用于管理 RabbitMQ, 需要启动 Management 插件。<br />\n<strong>1883，8883</strong>：MQTT 插件启动时的端口。<br />\n<strong>61613、61614</strong>：STOMP 客户端插件启用的时候的端口。<br />\n<strong>15674、15675</strong>：基于 webscoket 的 STOMP 端口和 MOTT 端口</p>\n<h2 id=\"13-开启rabbitmq的web管理界面\"><a class=\"anchor\" href=\"#13-开启rabbitmq的web管理界面\">#</a> 1.3 开启 RabbitMQ 的 WEB 管理界面</h2>\n<p>默认情况下，rabbitmq 是没有安装 web 端的客户端插件，需要安装才可以生效。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmq-plugins <span class=\"token builtin class-name\">enable</span> rabbitmq_management</pre></td></tr></table></figure><p>安装完毕以后，重启服务即可。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl restart rabbitmq-server</pre></td></tr></table></figure><blockquote>\n<p>一定要记住，防火墙要开放 <code>15672</code>  端口，如果服务器是 (阿里云，腾讯云等)，则在安全组中开放 <code>15672</code>  的端口。</p>\n<p>Centos7 防火墙相关命令：</p>\n<p>firewall-cmd --permanent --zone=public --list-ports #查询当前有哪些端口开放</p>\n<p>firewall-cmd --permanent --add-port=15672/tcp #开放端口 这里是 15672 端口</p>\n<p>firewall-cmd --reload #重新加载防火墙配置</p>\n</blockquote>\n<h2 id=\"14-新增远程用户和授权\"><a class=\"anchor\" href=\"#14-新增远程用户和授权\">#</a> 1.4 新增远程用户和授权</h2>\n<p>rabbitmq 有一个默认账号和密码是： <code>guest</code>  默认情况只能在 localhost 本机下访问，所以需要添加一个远程登录的用户。</p>\n<p>1、新增用户</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl add_user admin admin</pre></td></tr></table></figure><p>2、设置用户分配操作权限</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl set_user_tags admin administrator</pre></td></tr></table></figure><blockquote>\n<p>用户级别说明：</p>\n<p>1、administrator 可以登录控制台、查看所有信息、可以对 rabbitmq 进行管理</p>\n<p>2、monitoring 监控者 登录控制台，查看所有信息</p>\n<p>3、policymaker 策略制定者 登录控制台，指定策略</p>\n<p>4、managment 普通管理员 登录控制台</p>\n</blockquote>\n<p>3、为用户添加资源权限</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rabbitmqctl.bat set_permissions -p / admin <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span> <span class=\"token string\">\".*\"</span></pre></td></tr></table></figure><p>4、访问 rabbitmq web 管理界面</p>\n<p>设置成功后在浏览器中访问 <span class=\"exturl\" data-url=\"aHR0cDovL2lwOjE1NjcyLw==\">http://ip:15672/</span> ，用户名密码都是 <code>admin</code></p>\n<h1 id=\"2-rabbitmq之docker安装\"><a class=\"anchor\" href=\"#2-rabbitmq之docker安装\">#</a> 2. RabbitMQ 之 Docker 安装</h1>\n<h2 id=\"21安装docker\"><a class=\"anchor\" href=\"#21安装docker\">#</a> 2.1 安装 Docker</h2>\n<p>1、yum 包更新到最新</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum update</pre></td></tr></table></figure><p>2、安装需要的软件包：yum-util 提供 yum-config-manager 功能，另外两个是 devicemapper 驱动依赖的</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> -y yum-utils device-mapper-persistent-data lvm2</pre></td></tr></table></figure><p>3、设置 yum 源为阿里云</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</pre></td></tr></table></figure><p>4、安装 docker</p>\n<pre><code>yum install docker-ce -y\n</code></pre>\n<p>5、安装后查看 docker 版本</p>\n<pre><code>docker -v\n</code></pre>\n<p>6、安装加速镜像</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /etc/docker</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/docker/daemon.json <span class=\"token operator\">&lt;&lt;-</span><span class=\"token string\">'EOF'</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\"registry-mirrors\": [\"https://0wrdwnn6.mirror.aliyuncs.com\"]</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>EOF</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">sudo</span> systemctl daemon-reload</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">sudo</span> systemctl restart docker</pre></td></tr></table></figure><h2 id=\"22-docker的相关命令\"><a class=\"anchor\" href=\"#22-docker的相关命令\">#</a> 2.2 Docker 的相关命令</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 启动 docker：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl start docker</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 停止 docker：</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl stop docker</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 重启 docker：</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>systemctl restart docker</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 查看 docker 状态：</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>systemctl status docker</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 开机启动：</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> dockersystemctl unenable docker</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 查看 docker 概要信息</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>docker info</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 查看 docker 帮助文档</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>docker --help</pre></td></tr></table></figure><h2 id=\"23-安装rabbitmq\"><a class=\"anchor\" href=\"#23-安装rabbitmq\">#</a> 2.3 安装 RabbitMQ</h2>\n<ul>\n<li>获取 rabbitmq 镜像</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker pull rabbitmq:management</pre></td></tr></table></figure><ul>\n<li>创建并运行容器</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -di --name<span class=\"token operator\">=</span>myrabbit -p <span class=\"token number\">15672</span>:15672 rabbitmq:management</pre></td></tr></table></figure><p>—hostname：指定容器主机名称<br />\n —name: 指定容器名称<br />\n - p: 将 mq 端口号映射到本地<br />\n或者运行时设置用户和密码</p>\n<p><strong>运行时设置用户名和密码，并开启 web 管理界面。【推荐使用这个命令运行容器】</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker run -id --name myrabbit -e <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_USER</span><span class=\"token operator\">=</span>admin -e <span class=\"token assign-left variable\">RABBITMQ_DEFAULT_PASS</span><span class=\"token operator\">=</span>admin -p <span class=\"token number\">15672</span>:15672 -p <span class=\"token number\">5672</span>:5672 -p <span class=\"token number\">25672</span>:25672 -p <span class=\"token number\">1883</span>:1883 rabbitmq:management</pre></td></tr></table></figure><ul>\n<li>查看日志</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker logs -f myrabbit</pre></td></tr></table></figure><ul>\n<li>容器运行正常</li>\n</ul>\n<p>使用  <code>http://你的IP地址:15672</code>  访问 rabbit 控制台</p>\n<ul>\n<li>额外 Linux 相关排查命令</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">more</span> xxx.log <span class=\"token comment\">#查看日志信息</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">netstat</span> -naop <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">5672</span> <span class=\"token comment\">#查看端口是否被占用</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ps</span> -ef <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">5672</span> <span class=\"token comment\">#查看进程信息</span></pre></td></tr></table></figure><h1 id=\"3-rabbitmq的角色分类\"><a class=\"anchor\" href=\"#3-rabbitmq的角色分类\">#</a> 3. RabbitMQ 的角色分类</h1>\n<h2 id=\"1none\"><a class=\"anchor\" href=\"#1none\">#</a> 1：none：</h2>\n<ul>\n<li>不能访问 management plugin</li>\n</ul>\n<h2 id=\"2management查看自己相关节点信息\"><a class=\"anchor\" href=\"#2management查看自己相关节点信息\">#</a> 2：management：查看自己相关节点信息</h2>\n<ul>\n<li>列出自己可以通过 AMQP 登入的虚拟机</li>\n<li>查看自己的虚拟机节点 virtual hosts 的 queues,exchanges 和 bindings 信息</li>\n<li>查看和关闭自己的 channels 和 connections</li>\n<li>查看有关自己的虚拟机节点 virtual hosts 的统计信息。包括其他用户在这个节点 virtual hosts 中的活动信息。</li>\n</ul>\n<h2 id=\"3policymaker\"><a class=\"anchor\" href=\"#3policymaker\">#</a> 3：Policymaker</h2>\n<ul>\n<li>包含 management 所有权限</li>\n<li>查看和创建和删除自己的 virtual hosts 所属的 policies 和 parameters 信息。</li>\n</ul>\n<h2 id=\"4monitoring\"><a class=\"anchor\" href=\"#4monitoring\">#</a> 4：Monitoring</h2>\n<ul>\n<li>包含 management 所有权限</li>\n<li>罗列出所有的 virtual hosts，包括不能登录的 virtual hosts。</li>\n<li>查看其他用户的 connections 和 channels 信息</li>\n<li>查看节点级别的数据如 clustering 和 memory 使用情况</li>\n<li>查看所有的 virtual hosts 的全局统计信息。</li>\n</ul>\n<h2 id=\"5administrator\"><a class=\"anchor\" href=\"#5administrator\">#</a> 5：Administrator</h2>\n<ul>\n<li>最高权限</li>\n<li>可以创建和删除 virtual hosts</li>\n<li>可以查看，创建和删除 users</li>\n<li>查看创建 permisssions</li>\n<li>关闭所有用户的 connections</li>\n</ul>\n<h1 id=\"4-rabbitmq入门案例-simple-简单模式\"><a class=\"anchor\" href=\"#4-rabbitmq入门案例-simple-简单模式\">#</a> 4. RabbitMQ 入门案例 - Simple 简单模式</h1>\n<h2 id=\"41-实现步骤\"><a class=\"anchor\" href=\"#41-实现步骤\">#</a> 4.1 实现步骤</h2>\n<ol>\n<li>jdk1.8。</li>\n<li>构建一个 maven 工程。</li>\n<li>导入 rabbitmq 的 maven 依赖。</li>\n<li>启动 rabbitmq-server 服务。</li>\n<li>定义生产者。</li>\n<li>定义消费者。</li>\n<li>观察消息的在 rabbitmq-server 服务中的过程。</li>\n</ol>\n<h2 id=\"42-构建一个maven工程\"><a class=\"anchor\" href=\"#42-构建一个maven工程\">#</a> 4.2 构建一个 maven 工程</h2>\n<p>项目名称任意</p>\n<p>导入以下依赖</p>\n<ul>\n<li>Java 原生依赖</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.rabbitmq<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>amqp-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>5.10.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>Spring 依赖</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-rabbit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2.5.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>SpringBoot 依赖</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>上面根据自己的项目环境进行选择即可。这里选择 Java 原生进行演示。</p>\n<blockquote>\n<p>番外：rabbitmq 和 spring 同属一个公司开放的产品，所以他们的支持也是非常完善，这也是为什么推荐使用 rabbitmq 的一个原因。</p>\n</blockquote>\n<h2 id=\"43-启动rabbitmq-server服务\"><a class=\"anchor\" href=\"#43-启动rabbitmq-server服务\">#</a> 4.3 启动 rabbitmq-server 服务</h2>\n<p><code>systemctl start rabbitmq-server</code>  或者 <code>docker start myrabbit</code></p>\n<h2 id=\"44-定义生产者\"><a class=\"anchor\" href=\"#44-定义生产者\">#</a> 4.4 定义生产者</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 简单队列生产者</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/11 15:20</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">// 6： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello_有毒\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token comment\">// 7: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> queueName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>  <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// 8: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"关闭失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"45-定义消费者\"><a class=\"anchor\" href=\"#45-定义消费者\">#</a> 4.5 定义消费者</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 消费者 简单模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/11 15:33</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// 5: 消费的队列名称</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// 6: 监听消息中间件指定的队列</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeliverCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> consumerTag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Delivery</span> message<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到的消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancelCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> consumerTag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收失败了！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"关闭失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>执行发送，这个时候可以在 web 控制台查看到这个队列 queue 的信息</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/811.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/811.png\" class=\"\"></p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/812.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/812.png\" class=\"\"></p>\n<p>我们可以进行对队列的消息进行预览和测试如下：</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/813.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/813.png\" class=\"\"></p>\n<p>进行预览和获取消息进行测试</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/814.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/814.png\" class=\"\"></p>\n<h1 id=\"5什么是amqp\"><a class=\"anchor\" href=\"#5什么是amqp\">#</a> 5. 什么是 AMQP</h1>\n<p>AMQP 全称：Advanced Message Queuing Protocol (高级消息队列协议)。是应用层协议的一个开发标准，为面向消息的中间件设计。</p>\n<h2 id=\"51-amqp生产者流转过程\"><a class=\"anchor\" href=\"#51-amqp生产者流转过程\">#</a> 5.1 AMQP 生产者流转过程</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/815.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/815.png\" class=\"\"></p>\n<h2 id=\"52-amqp消费者流转过程\"><a class=\"anchor\" href=\"#52-amqp消费者流转过程\">#</a> 5.2 AMQP 消费者流转过程</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/816.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/816.png\" class=\"\"></p>\n<h1 id=\"6-rabbitmq的核心组成部分\"><a class=\"anchor\" href=\"#6-rabbitmq的核心组成部分\">#</a> 6. RabbitMQ 的核心组成部分</h1>\n<h2 id=\"61-rabbitmq的核心组成部分\"><a class=\"anchor\" href=\"#61-rabbitmq的核心组成部分\">#</a> 6.1 RabbitMQ 的核心组成部分</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/817.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/817.png\" class=\"\"></p>\n<p><strong>核心概念：</strong><br />\n<strong>Server</strong>：又称 Broker , 接受客户端的连接，实现 AMQP 实体服务。 安装 rabbitmq-server<br />\n<strong>Connection</strong>：连接，应用程序与 Broker 的网络连接 TCP/IP/ 三次握手和四次挥手<br />\n<strong> Channel</strong>：网络信道，几乎所有的操作都在 Channel 中进行，Channel 是进行消息读写的通道，客户端可以建立对各 Channel，每个 Channel 代表一个会话任务。<br />\n<strong>Message</strong> : 消息：服务与应用程序之间传送的数据，由 Properties 和 body 组成，Properties 可是对消息进行修饰，比如消息的优先级，延迟等高级特性，Body 则就是消息体的内容。<br />\n<strong>Virtual Host</strong> 虚拟地址，用于进行逻辑隔离，最上层的消息路由，一个虚拟主机理由可以有若干个 Exhange 和 Queueu，同一个虚拟主机里面不能有相同名字的 Exchange<br />\n<strong>Exchange</strong>：交换机，接受消息，根据路由键发送消息到绑定的队列。(不具备消息存储的能力)<br />\n<strong>Bindings</strong>：Exchange 和 Queue 之间的虚拟连接，binding 中可以保护多个 routing key.<br />\n<strong>Routing key</strong>：是一个路由规则，虚拟机可以用它来确定如何路由一个特定消息。<br />\n<strong>Queue</strong>：队列：也成为 Message Queue, 消息队列，保存消息并将它们转发给消费者。</p>\n<h2 id=\"62-rabbitmq整体架构是什么样子的\"><a class=\"anchor\" href=\"#62-rabbitmq整体架构是什么样子的\">#</a> 6.2 RabbitMQ 整体架构是什么样子的？</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/818.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/818.png\" class=\"\"></p>\n<h2 id=\"63-rabbitmq的运行流程\"><a class=\"anchor\" href=\"#63-rabbitmq的运行流程\">#</a> 6.3 RabbitMQ 的运行流程</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/819.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/819.png\" class=\"\"></p>\n<h2 id=\"64-rabbitmq支持消息的模式\"><a class=\"anchor\" href=\"#64-rabbitmq支持消息的模式\">#</a> 6.4 RabbitMQ 支持消息的模式</h2>\n<h3 id=\"1-简单模式-simple\"><a class=\"anchor\" href=\"#1-简单模式-simple\">#</a> 1、简单模式 Simple</h3>\n<ul>\n<li>参考第 12 章节</li>\n</ul>\n<h3 id=\"2-工作模式-work\"><a class=\"anchor\" href=\"#2-工作模式-work\">#</a> 2、工作模式 Work</h3>\n<ul>\n<li>web 操作查看视频</li>\n<li>类型：无</li>\n<li>特点：分发机制</li>\n</ul>\n<h3 id=\"3-发布订阅模式\"><a class=\"anchor\" href=\"#3-发布订阅模式\">#</a> 3、发布订阅模式</h3>\n<ul>\n<li>web 操作查看视频</li>\n<li>类型：fanout</li>\n<li>特点：Fanout— 发布与订阅模式，是一种广播机制，它是没有路由 key 的模式。</li>\n</ul>\n<h3 id=\"4-路由模式\"><a class=\"anchor\" href=\"#4-路由模式\">#</a> 4、路由模式</h3>\n<ul>\n<li>web 操作查看视频</li>\n<li>类型：direct</li>\n<li>特点：有 routing-key 的匹配模式</li>\n</ul>\n<h3 id=\"5-主题topic模式\"><a class=\"anchor\" href=\"#5-主题topic模式\">#</a> 5、主题 Topic 模式</h3>\n<ul>\n<li>web 操作查看视频</li>\n<li>类型：topic</li>\n<li>特点：模糊的 routing-key 的匹配模式</li>\n</ul>\n<h3 id=\"6-参数模式\"><a class=\"anchor\" href=\"#6-参数模式\">#</a> 6、参数模式</h3>\n<ul>\n<li>web 操作查看视频</li>\n<li>类型：headers</li>\n<li>特点：参数匹配模式</li>\n</ul>\n<h2 id=\"65-小结\"><a class=\"anchor\" href=\"#65-小结\">#</a> 6.5 小结</h2>\n<ul>\n<li>rabbitmq 发送消息一定有一个交换机</li>\n<li>如果队列没有指定交换机会默认绑定一个交换机</li>\n<li><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/820.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/820.png\" class=\"\"></li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/821.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/821.png\" class=\"\"></p>\n<h1 id=\"7-rabbitmq入门案例-fanout模式\"><a class=\"anchor\" href=\"#7-rabbitmq入门案例-fanout模式\">#</a> 7. RabbitMQ 入门案例 - fanout 模式</h1>\n<p>RabbitMQ 支持消息的模式 参考官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2dldHN0YXJ0ZWQuaHRtbA==\">https://www.rabbitmq.com/getstarted.html</span></p>\n<p>RabbitMQ 的 fanout 广播模式是一种发布订阅模式</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/822.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/822.png\" class=\"\"></p>\n<p>发布订阅模式具体实现</p>\n<ul>\n<li>类型：fanout</li>\n<li>特点：Fanout— 发布与订阅模式，是一种广播机制，<strong>它是没有路由 key 的模式</strong>。</li>\n</ul>\n<p>生产者代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Fanout— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:27</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"你好，极客！！！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span>  exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"fanout-exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// 6: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者，为了模拟多个消费者，使用线程的方式。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Fanout— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:28</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 获取队列的名称</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    s <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token comment\">// 启动三个线程去执行</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"8-rabbitmq入门案例-direct模式\"><a class=\"anchor\" href=\"#8-rabbitmq入门案例-direct模式\">#</a> 8. RabbitMQ 入门案例 - Direct 模式</h1>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/823.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/823.png\" class=\"\"></p>\n<ul>\n<li>类型：direct</li>\n<li>特点：<strong>Direct 模式是 fanout 模式上的一种叠加，增加了路由 RoutingKey 的模式。</strong></li>\n</ul>\n<p>发布订阅之 Direct 模式具体实现</p>\n<p>生产者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Direct— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:27</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 6： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"你好，direct-exchange！！！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span>  exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"direct-exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"email\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// 7: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Direct— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:28</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 获取队列的名称</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    s <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token comment\">// 启动三个线程去执行</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"9-rabbitmq入门案例-topic模式\"><a class=\"anchor\" href=\"#9-rabbitmq入门案例-topic模式\">#</a> 9. RabbitMQ 入门案例 - Topic 模式</h1>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/824.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/824.png\" class=\"\"></p>\n<ul>\n<li>类型：topic</li>\n<li>特点：<strong>Topic 模式是 direct 模式上的一种叠加，增加了模糊路由 RoutingKey 的模式。</strong></li>\n</ul>\n<p>发布订阅之<strong> Topic 模式</strong>具体实现：</p>\n<p>生产者代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Topic— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:27</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"你好，topic-exchange！！！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span>  exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"topic-exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"com.order.user\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// 6: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description Topic— 发布与订阅模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 10:28</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 获取队列的名称</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    s <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token comment\">// 启动三个线程去执行</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"10-完整的声明创建方式\"><a class=\"anchor\" href=\"#10-完整的声明创建方式\">#</a> 10. 完整的声明创建方式</h1>\n<ul>\n<li>声明交换机，所谓的持久化就是指，交换机 会不会随着服务器重启造成丢失， 如果是 true 代表不丢失，false 代表重启后丢失</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">exchangeDeclare</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> exchangeType<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>声明队列</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue5\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>绑定队列</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueBind</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue5\"</span><span class=\"token punctuation\">,</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>生产者</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Data 2021/5/12 10:27</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 6： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"你好，学相伴！！！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"direct_message_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">String</span> exchangeType <span class=\"token operator\">=</span> <span class=\"token string\">\"direct\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// 声明交换机，所谓的持久化就是指，交换机 会不会随着服务器重启造成丢失， 如果是 true 代表不丢失，false 代表重启后丢失</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">exchangeDeclare</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> exchangeType<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// 声明队列</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue5\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue6\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue7\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 绑定队列</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueBind</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue5\"</span><span class=\"token punctuation\">,</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueBind</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue6\"</span><span class=\"token punctuation\">,</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">queueBind</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue7\"</span><span class=\"token punctuation\">,</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token comment\">// 7: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Data 2021/5/12 10:28</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 获取队列的名称</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> queueName <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    s <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>queueName <span class=\"token operator\">+</span> <span class=\"token string\">\"：开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token comment\">// 启动三个线程去执行</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue6\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue7\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"11-rabbitmq入门案例-work模式\"><a class=\"anchor\" href=\"#11-rabbitmq入门案例-work模式\">#</a> 11. RabbitMQ 入门案例 - Work 模式</h1>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/825.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/825.png\" class=\"\"></p>\n<p>当有多个消费者时，我们的消息会被哪个消费者消费呢，我们又该如何均衡消费者消费信息的多少呢？<br />\n 主要有<strong>两种模式</strong>：<br />\n1、轮询分发：一个消费者一条，<strong>按均分配</strong>；<br />\n2、公平分发：根据消费者的消费能力进行公平分发，处理快的处理的多，处理慢的处理的少；<strong>按劳分配</strong>；</p>\n<h2 id=\"11-1-work模式-轮询模式round-robin\"><a class=\"anchor\" href=\"#11-1-work模式-轮询模式round-robin\">#</a> 11. 1 Work 模式 - 轮询模式（Round-Robin）</h2>\n<ul>\n<li>类型：无</li>\n<li>特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，直至消息消费完成；</li>\n</ul>\n<p>生产者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 工作模式之 轮询</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 15:19</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 6： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">//===============================end topic 模式 ==================================</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token comment\">// 消息的内容</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"极客:\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// 7: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Consumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 工作模式之 轮询</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 15:20</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Work1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者-Work1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//            channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 同一时刻，服务器只会推送一条消息给消费者</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token class-name\">Channel</span> finalChannel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">//            finalChannel.basicQos(1);</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeliverCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work1-收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                        ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancelCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work1-开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Work2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 工作模式之 轮询</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 15:21</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Work2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者-Work2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, true, false, null);</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 同一时刻，服务器只会推送一条消息给消费者</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">//channel.basicQos(1);</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token class-name\">Channel</span> finalChannel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">//            finalChannel.basicQos(1);</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeliverCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work2-收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancelCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work2-开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>得出结论： <code>work1</code>  和 <code>work2</code>  的消息处理能力不同，但是最后处理的消息条数相同，是 “<strong>按均分配</strong>”。</p>\n<h2 id=\"11-2-work模式-公平分发fair-dispatch\"><a class=\"anchor\" href=\"#11-2-work模式-公平分发fair-dispatch\">#</a> 11. 2 Work 模式 - 公平分发（Fair Dispatch）</h2>\n<ul>\n<li>类型：无</li>\n<li>特点：由于消息接收者处理消息的能力不同，存在处理快慢的问题，我们就需要能者多劳，处理快的多处理，处理慢的少处理；</li>\n</ul>\n<p>生产者代码：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Producer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 工作模式 之 公平分发</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 15:38</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"生产者\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 6： 准备发送消息的内容</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">//===============================end topic 模式 ==================================</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token comment\">// 消息的内容</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token class-name\">String</span> msg <span class=\"token operator\">=</span> <span class=\"token string\">\"极客:\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// 7: 发送消息给中间件 rabbitmq-server</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token comment\">// @params1: 交换机 exchange</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// @params2: 队列名称 /routingkey</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token comment\">// @params3: 属性配置</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token comment\">// @params4: 发送消息的内容</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息发送成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者代码：</p>\n<p>1、需要将 ** 自动应答 ** 改为 <strong>手动应答</strong></p>\n<p>2、设置 Qos（每次从队列中获取几条），Qos 设置多大，要根据服务器的内存状况和磁盘空间。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName Work1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 工作模式 之 公平分发</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/12 15:38</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Work1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者-Work1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//            channel.queueDeclare(\"queue1\", false, false, false, null);</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 同一时刻，服务器只会推送一条消息给消费者</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token class-name\">Channel</span> finalChannel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicQos</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeliverCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work1-收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//                        Thread.sleep(2000);</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                        finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getEnvelope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancelCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work1-开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token operator\">*</span> <span class=\"token annotation punctuation\">@ClassName</span> <span class=\"token class-name\">Work2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token operator\">*</span> <span class=\"token annotation punctuation\">@Description</span> 工作模式 之 公平分发</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token operator\">*</span> <span class=\"token annotation punctuation\">@Author</span> zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token operator\">*</span> <span class=\"token annotation punctuation\">@Data</span> <span class=\"token number\">2021</span><span class=\"token operator\">/</span><span class=\"token number\">5</span><span class=\"token operator\">/</span><span class=\"token number\">12</span> <span class=\"token number\">15</span><span class=\"token operator\">:</span><span class=\"token number\">38</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token operator\">*</span> <span class=\"token annotation punctuation\">@Version</span> <span class=\"token number\">1.0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token operator\">*</span><span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Work2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 1: 创建连接工厂</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ConnectionFactory</span> connectionFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 2: 设置连接属性</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10.1.53.166\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">5672</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setVirtualHost</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 3: 从连接工厂中获取连接</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            connection <span class=\"token operator\">=</span> connectionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消费者-Work2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\">// 4: 从连接中获取通道 channel</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            channel <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">createChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token comment\">// 5: 申明队列 queue 存储消息</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>             *  如果队列不存在，则会创建</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>             *  Rabbitmq 不允许创建两个相同的队列名称，否则会报错。</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>             *</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>             *  @params1： queue 队列的名称</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>             *  @params2： durable 队列是否持久化</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             *  @params3： exclusive 是否排他，即是否私有的，如果为 true, 会对当前队列加锁，其他的通道不能访问，并且连接自动关闭</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             *  @params4： autoDelete 是否自动删除，当最后一个消费者断开连接之后是否自动删除消息。</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>             *  @params5： arguments 可以设置队列附加参数，设置队列的有效期，消息的最大长度，队列的消息生命周期等等。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             * */</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// 这里如果 queue 已经被创建过一次了，可以不需要定义</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">//channel.queueDeclare(\"queue1\", false, true, false, null);</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 同一时刻，服务器只会推送一条消息给消费者</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token comment\">//channel.basicQos(1);</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// 6： 定义接受消息的回调</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token class-name\">Channel</span> finalChannel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicQos</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicConsume</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue1\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DeliverCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Delivery</span> delivery<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work2-收到消息是：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">//                        Thread.sleep(200);</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                        finalChannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>delivery<span class=\"token punctuation\">.</span><span class=\"token function\">getEnvelope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                        ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancelCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Work2-开始接受消息\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送消息出现异常...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token comment\">// 7: 释放连接关闭通道</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>channel <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                    ex<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"113-小结\"><a class=\"anchor\" href=\"#113-小结\">#</a> 11.3 小结</h2>\n<p>从结果可以看到，消费者 1 在相同时间内，处理了更多的消息；以上代码我们实现了公平分发模式；</p>\n<ul>\n<li>消费者一次接收一条消息，代码 channel.BasicQos (0, 1, false);</li>\n<li>公平分发需要消费者开启手动应答，关闭自动应答</li>\n<li>关闭自动应答代码 channel.BasicConsume (“queue_test”, false, consumer);</li>\n<li>消费者开启手动应答代码：channel.BasicAck (ea.DeliveryTag, false);</li>\n</ul>\n<h2 id=\"114-总结\"><a class=\"anchor\" href=\"#114-总结\">#</a> 11.4 总结</h2>\n<p>（1）当队列里消息较多时，我们通常会开启多个消费者处理消息；公平分发和轮询分发都是我们经常使用的模式。<br />\n（2）<strong>轮询分发</strong>的主要思想是 “<strong>按均分配</strong>”，不考虑消费者的处理能力，所有消费者均分；这种情况下，处理能力弱的服务器，一直都在处理消息，而处理能力强的服务器，在处理完消息后，处于空闲状态；<br />\n（3） <strong>公平分发</strong>的主要思想是 **” 能者多劳，按需分配”**，能力强的干的多。</p>\n<h1 id=\"12-rabbitmq使用场景\"><a class=\"anchor\" href=\"#12-rabbitmq使用场景\">#</a> 12. RabbitMQ 使用场景</h1>\n<blockquote>\n<p>为什么使用 RabbitMQ？</p>\n<p>其实呢，我是 2016 年 xx 时候加入 xx 公司的，刚开始进入公司的时候呢，我们公司的架构还是比较单一，采用的是单体结构，而单体结构呢是把所有的业务堆积在一个项目里面。但是，随着我们公司业务的不断发展，不断推进，我们公司在第二年的时候，公司的项目负责人接下来把我们的项目开始进行一些分裂，就是变成了一个分布式架构，对系统进行了拆分，在拆分的过程中，我们接下来就要考虑到一个问题，比如我们在拆分的过程中，我们做了 xxx 系统的某一个模块和另一个模块进行互相沟通和协同，那么这个时候呢，我们公司采用了消息队列的方式，在选择消息队列的时候呢，就在思考用什么消息队列，后面我们决定用了 RabbitMQ，自己使用 RabbitMQ 的感受最重要的一个点就是异步，因为它是一个多线程，分发的机制，可以让我们的系统的性能得以提升，因为异步，可以让我们处理数据的能力变得高效、稳健。</p>\n</blockquote>\n<h2 id=\"121-解耦-削峰-异步\"><a class=\"anchor\" href=\"#121-解耦-削峰-异步\">#</a> 12.1 解耦、削峰、异步</h2>\n<ul>\n<li>同步异步的问题（串行）</li>\n</ul>\n<p>串行方式：将订单信息写入数据库成功后，发送注册邮件，再发送注册短信。以上三个任务全部完成后，返回给客户端</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/826.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/826.png\" class=\"\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 1 : 保存订单 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">saveOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 2： 发送短信服务</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    messageService<span class=\"token punctuation\">.</span><span class=\"token function\">sendSMS</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//1-2 s</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 3： 发送 email 服务</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    emailService<span class=\"token punctuation\">.</span><span class=\"token function\">sendEmail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//1-2 s</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 4： 发送 APP 服务</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    appService<span class=\"token punctuation\">.</span><span class=\"token function\">sendApp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>并行方式 异步线程池</li>\n</ul>\n<p>并行方式：将订单信息写入数据库成功后，发送注册邮件的同时，发送注册短信。以上三个任务完成后，返回给客户端。与串行的差别是，并行的方式可以提高处理的时间。</p>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/827.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/827.png\" class=\"\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 1 : 保存订单 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">saveOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// 相关发送</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token function\">relationMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">relationMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 异步</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     theadpool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>             <span class=\"token comment\">// 2： 发送短信服务  </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>             messageService<span class=\"token punctuation\">.</span><span class=\"token function\">sendSMS</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 异步</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     theadpool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>              <span class=\"token comment\">// 3： 发送 email 服务</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            emailService<span class=\"token punctuation\">.</span><span class=\"token function\">sendEmail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token comment\">// 异步</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     theadpool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>             <span class=\"token comment\">// 4： 发送短信服务</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>             appService<span class=\"token punctuation\">.</span><span class=\"token function\">sendApp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token comment\">// 异步</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         theadpool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>         <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>             <span class=\"token comment\">// 4： 发送短信服务</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>             appService<span class=\"token punctuation\">.</span><span class=\"token function\">sendApp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>存在问题：</strong><br />\n<strong>1：耦合度高</strong><br />\n<strong> 2：需要自己写线程池自己维护成本太高</strong><br />\n<strong> 3：出现了消息可能会丢失，需要你自己做消息补偿</strong><br />\n<strong> 4：如何保证消息的可靠性你自己写</strong><br />\n<strong> 5：如果服务器承载不了，你需要自己去写高可用</strong></p>\n<ul>\n<li>异步消息队列的方式</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/828.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/828.png\" class=\"\"></p>\n<p><strong>好处</strong><br />\n 1：完全解耦，用 MQ 建立桥接<br />\n 2：有独立的线程池和运行模型<br />\n 3：出现了消息可能会丢失，MQ 有持久化功能<br />\n 4：如何保证消息的可靠性，死信队列和消息转移的等<br />\n 5：如果服务器承载不了，你需要自己去写高可用，HA 镜像模型高可用。<br />\n按照以上约定，用户的响应时间相当于是订单信息写入数据库的时间，也就是 50 毫秒。注册邮件，发送短信写入消息队列后，直接返回，因此写入消息队列的速度很快，基本可以忽略，因此用户的响应时间可能是 50 毫秒。因此架构改变后，系统的吞吐量提高到每秒 20 QPS。比串行提高了 3 倍，比并行提高了两倍</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 1 : 保存订单 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    orderService<span class=\"token punctuation\">.</span><span class=\"token function\">saveOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertSend</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ex\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"消息内容\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"122-高内聚低耦合\"><a class=\"anchor\" href=\"#122-高内聚低耦合\">#</a> 12.2 高内聚，低耦合</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/829.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/829.png\" class=\"\"></p>\n<h2 id=\"123-流量的削峰\"><a class=\"anchor\" href=\"#123-流量的削峰\">#</a> 12.3 流量的削峰</h2>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/830.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/830.png\" class=\"\"></p>\n<p>还有如下应用场景：</p>\n<p>4、分布式事务的可靠消费和可靠生产<br />\n 5、索引、缓存、静态化处理的数据同步<br />\n 6、流量监控<br />\n 7、日志监控（ELK）<br />\n8、下单、订单分发、抢票</p>\n<h1 id=\"13-springboot案例-fanout模式\"><a class=\"anchor\" href=\"#13-springboot案例-fanout模式\">#</a> 13. SpringBoot 案例 -fanout 模式</h1>\n<ul>\n<li>整体核心</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/831.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/831.png\" class=\"\"></p>\n<ul>\n<li>案例：使用 SpringBoot 完成 RabbitMQ 的消费模式 - Fanout</li>\n</ul>\n<p><img data-src=\"RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/832.png\" alt=\"\" /><img data-src=\"/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/832.png\" class=\"\"></p>\n<ul>\n<li>实现步骤：</li>\n</ul>\n<p>1：创建生产者工程：springboot-rabbitmq-fanout-producer</p>\n<p>application.yml 配置文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 服务端口</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 配置 rabbitmq 服务</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 10.1.53.166</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span></pre></td></tr></table></figure><p>2：创建消费者工程： <code>springboot-rabbitmq-fanout-consumer</code></p>\n<p>application.yml 配置文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 服务端口</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8081</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 配置 rabbitmq 服务</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">rabbitmq</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> admin</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">virtual-host</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 10.1.53.166</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5672</span></pre></td></tr></table></figure><p>3：在 pom.xml 中引入 spring-boot-rabbitmq 的依赖</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>4：进行消息的分发和测试<br />\n 5：查看和观察 web 控制台的状况</p>\n<ul>\n<li>生产者代码</li>\n</ul>\n<p>创建交换机，队列，并进行绑定。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName RabbitMQConfiguration</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description rabbitmq 配置</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:17</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfiguration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * 声明注册 fanout 模式的交换机</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @return FanoutExchange</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FanoutExchange</span> <span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fanout_order_exchange\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 声明三个队列</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">smsQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sms.fanout.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">emailQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email.fanout.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">wxQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wx.fanout.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// 完成绑定关系（队列和交换机）</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">smsBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">smsQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">emailBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">emailQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">wxBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">wxQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>发送消息到交换机 <code>fanout_order_exchange</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName OrderService</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description 订单业务</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:12</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 定义交换机</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"fanout_order_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 定义 路由 Key</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> routeKey <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 1： 模拟用户下单</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> orderNumber <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// 2: 根据商品 id productId 去查询商品的库存</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// int numstore = productSerivce.getProductNum(productId);</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 3: 判断库存是否充足</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">//if (num>  numstore )&#123; return  \"商品库存不足...\"; &#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 4: 下单逻辑</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// orderService.saveOrder(order);</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// 5: 下单成功要扣减库存</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// 6: 下单完成以后</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户 \"</span> <span class=\"token operator\">+</span> userId <span class=\"token operator\">+</span> <span class=\"token string\">\",订单编号是：\"</span> <span class=\"token operator\">+</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// 发送订单信息给 RabbitMQ fanout</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routeKey<span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>消费者：</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName FanoutSmsConsumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description rabbitmq 消费者 连接 指定队列，进行消费处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:22</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"sms.fanout.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FanoutEmailConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始邮箱发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName FanoutSmsConsumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description rabbitmq 消费者 连接 指定队列，进行消费处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:22</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"sms.fanout.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FanoutSmsConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始短信发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName FanoutSmsConsumer</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description rabbitmq 消费者 连接 指定队列，进行消费处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:22</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"sms.fanout.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FanoutWxConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始微信推送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>生产者写测试方法调用下单接口</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootTest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProducerApplicationTests</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">contextLoads</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">makeOrder</span><span class=\"token punctuation\">(</span><span class=\"token number\">111L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">222L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"14-springboot案例-direct模式\"><a class=\"anchor\" href=\"#14-springboot案例-direct模式\">#</a> 14. SpringBoot 案例 -Direct 模式</h1>\n<p>生产者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * @ClassName RabbitMQDirectConfiguration</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @Description rabbitmq 配置</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author zzm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Data 2021/5/13 10:17</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQDirectConfiguration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     * 声明注册 direct 模式的交换机</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * @return FanoutExchange</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DirectExchange</span> <span class=\"token function\">directExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"direct_order_exchange\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 声明三个队列</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">smsQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sms.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">emailQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">wxQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wx.direct.queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">// 完成绑定关系（队列和交换机）, 使用 with 指定该队列的路由 Key</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">smsBindingDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">smsQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">directExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sms\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">emailBindingDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">emailQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">directExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">wxBindingDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">BindingBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token function\">wxQueueDirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">(</span><span class=\"token function\">directExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>OrderService</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrderDirect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">// 定义交换机</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"direct_order_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 1： 模拟用户下单</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> orderNumber <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// 2: 根据商品 id productId 去查询商品的库存</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// int numstore = productSerivce.getProductNum(productId);</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 3: 判断库存是否充足</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">//if (num>  numstore )&#123; return  \"商品库存不足...\"; &#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 4: 下单逻辑</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// orderService.saveOrder(order);</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 5: 下单成功要扣减库存</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 6: 下单完成以后</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户 \"</span> <span class=\"token operator\">+</span> userId <span class=\"token operator\">+</span> <span class=\"token string\">\",订单编号是：\"</span> <span class=\"token operator\">+</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 发送订单信息给 RabbitMQ fanout</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sms\"</span><span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"wx\"</span><span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>消费者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"email.direct.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DirectEmailConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Direct模式 开始邮箱发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"sms.direct.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DirectSmsConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Direct模式 开始短信发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"wx.direct.queue\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DirectWxConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Direct模式 开始微信推送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"15-springboot案例-topic模式\"><a class=\"anchor\" href=\"#15-springboot案例-topic模式\">#</a> 15. SpringBoot 案例 -Topic 模式</h1>\n<p>使用注解的模式来配置交换机和队列，以及绑定。 <code>@RabbitListener(bindings = @QueueBinding(value = @Queue(), exchange = @Exchange(), key = &quot;&quot;))</code></p>\n<p>消费者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"email.topic.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> autoDelete <span class=\"token operator\">=</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"topic_order_exchange\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span>TOPIC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        key <span class=\"token operator\">=</span> <span class=\"token string\">\"*.email.#\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TopicEmailConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"topic模式，开始邮箱发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"sms.topic.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> autoDelete <span class=\"token operator\">=</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"topic_order_exchange\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span>TOPIC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        key <span class=\"token operator\">=</span> <span class=\"token string\">\"#.sms.#\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TopicSmsConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"topic模式，开始短信发送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@QueueBinding</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        value <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Queue</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"wx.topic.queue\"</span><span class=\"token punctuation\">,</span> durable <span class=\"token operator\">=</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> autoDelete <span class=\"token operator\">=</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        exchange <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Exchange</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"topic_order_exchange\"</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token class-name\">ExchangeTypes</span><span class=\"token punctuation\">.</span>TOPIC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        key <span class=\"token operator\">=</span> <span class=\"token string\">\"com.#\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TopicWxConsumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@RabbitHandler</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"topic模式，开始微信推送服务：\"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>生产者：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeOrderTopic</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">// 定义交换机</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">String</span> exchangeName <span class=\"token operator\">=</span> <span class=\"token string\">\"topic_order_exchange\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 1： 模拟用户下单</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> orderNumber <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// 2: 根据商品 id productId 去查询商品的库存</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// int numstore = productSerivce.getProductNum(productId);</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 3: 判断库存是否充足</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">//if (num>  numstore )&#123; return  \"商品库存不足...\"; &#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// 4: 下单逻辑</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// orderService.saveOrder(order);</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 5: 下单成功要扣减库存</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 6: 下单完成以后</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户 \"</span> <span class=\"token operator\">+</span> userId <span class=\"token operator\">+</span> <span class=\"token string\">\",订单编号是：\"</span> <span class=\"token operator\">+</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> routingKey <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 发送订单信息给 RabbitMQ fanout</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> orderNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaG9rYS5sb3N0eXUubWUvY29tcHV0ZXItc2NpZW5jZS9ub3RlL3RoZW1lLXNob2thLWRvYy9zcGVjaWFsLyNjb2xsYXBzZS0lRTYlOEElOTglRTUlOEYlQTAlRTUlOUQlOTc=\">https://shoka.lostyu.me/computer-science/note/theme-shoka-doc/special/#collapse - 折叠块</span></p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "Rabbitmq",
                "RabbitMQ"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/nginx/",
            "url": "https://xinyao_idiot.gitee.io/zxy/nginx/",
            "title": "Nginx初步学习",
            "date_published": "2021-04-02T08:30:03.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"nginx\"><a class=\"anchor\" href=\"#nginx\">#</a> nginx</h1>\n<p>推荐视频：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMXpKNDExdzdTVj9wPTE=\">尚硅谷 Nginx</span></p>\n<h1 id=\"内容概览\"><a class=\"anchor\" href=\"#内容概览\">#</a> 内容概览</h1>\n<h2 id=\"1-nginx-简介\"><a class=\"anchor\" href=\"#1-nginx-简介\">#</a> 1、nginx 简介</h2>\n<p>（1）介绍 nginx 的应用场景和具体可以做什么事情</p>\n<p>（2）介绍什么是反向代理</p>\n<p>（3）介绍什么是负载均衡</p>\n<p>（4）介绍什么是动静分离</p>\n<h2 id=\"2-nginx-安装\"><a class=\"anchor\" href=\"#2-nginx-安装\">#</a> 2、nginx 安装</h2>\n<p>（1）介绍 nginx 在 linux 系统中如何进行安装</p>\n<h2 id=\"3-nginx-常用的命令和配置文件\"><a class=\"anchor\" href=\"#3-nginx-常用的命令和配置文件\">#</a> 3、nginx 常用的命令和配置文件</h2>\n<p>（1）介绍 nginx 启动、关闭、重新加载命令</p>\n<p>（2）介绍 nginx 的配置文件</p>\n<h2 id=\"4-nginx-配置实例-反向代理\"><a class=\"anchor\" href=\"#4-nginx-配置实例-反向代理\">#</a> 4、nginx 配置实例 - 反向代理</h2>\n<h2 id=\"5-nginx-配置实例-负载均衡\"><a class=\"anchor\" href=\"#5-nginx-配置实例-负载均衡\">#</a> 5、nginx 配置实例 - 负载均衡</h2>\n<h2 id=\"6-nginx-配置实例-动静分离\"><a class=\"anchor\" href=\"#6-nginx-配置实例-动静分离\">#</a> 6、nginx 配置实例 - 动静分离</h2>\n<h2 id=\"7-nginx-原理与优化参数配置\"><a class=\"anchor\" href=\"#7-nginx-原理与优化参数配置\">#</a> 7、nginx 原理与优化参数配置</h2>\n<h2 id=\"8-搭建-nginx-高可用集群\"><a class=\"anchor\" href=\"#8-搭建-nginx-高可用集群\">#</a> 8、搭建 nginx 高可用集群</h2>\n<p>（1）搭建 nginx 高可用集群（主从模式）</p>\n<p>（2）搭建 nginx 高可用集群（双主模式）</p>\n<hr />\n<h1 id=\"nginx简介\"><a class=\"anchor\" href=\"#nginx简介\">#</a> nginx 简介</h1>\n<h2 id=\"1-什么是nginx\"><a class=\"anchor\" href=\"#1-什么是nginx\">#</a> 1、什么是 nginx</h2>\n<p>Nginx (&quot;engine x&quot;) 是一个高性能的 HTTP 和反向代理服务器，特点是占有内存少，并发能力强，事实上 nginx 的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用 nginx 网站用户有：百度、京东、新浪、网易、腾讯、淘宝等</p>\n<h2 id=\"2-反向代理\"><a class=\"anchor\" href=\"#2-反向代理\">#</a> 2、反向代理</h2>\n<h3 id=\"21-正向代理\"><a class=\"anchor\" href=\"#21-正向代理\">#</a> 2.1、正向代理</h3>\n<p>需要在客户端配置代理服务器进行指定网站访问</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527212532451.png\" alt=\"image-20210527212532451\" /></p>\n<h3 id=\"22-反向代理\"><a class=\"anchor\" href=\"#22-反向代理\">#</a> 2.2、反向代理</h3>\n<p>暴露的是代理服务器地址，隐藏了真实服务器 IP 地址，不需要在客户端配置代理服务器，就相当于客户端只是单纯的认为我们的反向代理服务器才是真正的服务器。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527212846955.png\" alt=\"image-20210527212846955\" /></p>\n<h2 id=\"3-负载均衡\"><a class=\"anchor\" href=\"#3-负载均衡\">#</a> 3、负载均衡</h2>\n<p>单个服务器解决不了，增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527213914267.png\" alt=\"image-20210527213914267\" /></p>\n<h2 id=\"4-动静分离\"><a class=\"anchor\" href=\"#4-动静分离\">#</a> 4、动静分离</h2>\n<p>为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度。降低原来单个服务器的压力。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527215607579.png\" alt=\"image-20210527215607579\" /></p>\n<hr />\n<h1 id=\"nginx的安装\"><a class=\"anchor\" href=\"#nginx的安装\">#</a> nginx 的安装</h1>\n<h2 id=\"1-这里我没有用服务器学习直接xshell远程连接虚拟机\"><a class=\"anchor\" href=\"#1-这里我没有用服务器学习直接xshell远程连接虚拟机\">#</a> 1、这里我没有用服务器学习，直接 xshell 远程连接虚拟机</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527220757094.png\" alt=\"image-20210527220757094\" /></p>\n<h2 id=\"2-进行nginx安装\"><a class=\"anchor\" href=\"#2-进行nginx安装\">#</a> 2、进行 nginx 安装</h2>\n<h3 id=\"第一步安装pcre\"><a class=\"anchor\" href=\"#第一步安装pcre\">#</a> 第一步，安装 pcre</h3>\n<ul>\n<li>直接 pcre 官网下载相应的 tar 包</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527222031652.png\" alt=\"image-20210527222031652\" /></p>\n<ul>\n<li>\n<p>解压之后进行 pcre-8.44 文件夹，执行 <code>./configure</code>  命令</p>\n</li>\n<li>\n<p>== 这里需要注意的是 linux 系统要安装 gcc 和 gcc-c++ 库</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> gcc</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum <span class=\"token function\">install</span> -y gcc-c++</pre></td></tr></table></figure><p>安装完之后在 pcre-8.44 文件夹下执行 <code>./configure</code></p>\n</li>\n<li>\n<p>继续执行 <code>make &amp;&amp; make install</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><p>至此 prce 安装完成，查看版本 <code>pcre-config --version</code></p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527222734029.png\" alt=\"image-20210527222734029\" /></p>\n<h3 id=\"第二步安装-openssl\"><a class=\"anchor\" href=\"#第二步安装-openssl\">#</a> 第二步，安装 openssl</h3>\n<h3 id=\"第三步安装zlib\"><a class=\"anchor\" href=\"#第三步安装zlib\">#</a> 第三步，安装 zlib</h3>\n<p>直接通过 yum 命令安装以上两个</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum -y <span class=\"token function\">install</span> <span class=\"token function\">make</span> zlib zlib-devel gcc-c++ libtool openssl openssl-devel</pre></td></tr></table></figure><h3 id=\"最后安装nginx\"><a class=\"anchor\" href=\"#最后安装nginx\">#</a> 最后安装 nginx</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 使用命令解压</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">tar</span> -xvf nginx-1.21.0.tar.gz</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 进入 nginx 文件夹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>./configure</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><h2 id=\"3-启动服务\"><a class=\"anchor\" href=\"#3-启动服务\">#</a> 3、启动服务</h2>\n<p><mark>进入目录 /usr/local/nginx/sbin/nginx 启动服务</mark></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./nginx</pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527223628933.png\" alt=\"image-20210527223628933\" /></p>\n<p><mark>进入 nginx 配置文件，发现默认端口是 80</mark></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527223908493.png\" alt=\"image-20210527223908493\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527223817099.png\" alt=\"image-20210527223817099\" /></p>\n<p><mark>在 centOS 中访问到了 nginx 页面</mark></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527224249185.png\" alt=\"image-20210527224249185\" /></p>\n<h2 id=\"4-在windows-系统中访问\"><a class=\"anchor\" href=\"#4-在windows-系统中访问\">#</a> 4、在 windows 系统中访问</h2>\n<p>在 windows 系统中访问 linux 中 nginx，默认不能访问的，因为防火墙问题</p>\n<ol>\n<li>关闭防火墙</li>\n<li>开放访问的端口号，80 端口</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看开放的端口号</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>firewall-cmd --list-all</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 设置开放的端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>firewall-cmd --add-port<span class=\"token operator\">=</span><span class=\"token number\">80</span>/tcp --permanent</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 重启防火墙</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>firewall-cmd --reload</pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527224723786.png\" alt=\"image-20210527224723786\" /></p>\n<p>在 windows 系统中也访问到了 nginx 页面</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210527224751817.png\" alt=\"image-20210527224751817\" /></p>\n<h1 id=\"nginx操作的常用命令\"><a class=\"anchor\" href=\"#nginx操作的常用命令\">#</a> nginx 操作的常用命令</h1>\n<blockquote>\n<p>使用 nginx 操作命令前提条件：必须进入 nginx 的目录</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /usr/local/nginx/sbin</pre></td></tr></table></figure><blockquote>\n<p>2、查看 nginx 的版本号</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 sbin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ./nginx -v</span></pre></td></tr></table></figure><blockquote>\n<p>3、启动 nginx</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 sbin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ./nginx</span></pre></td></tr></table></figure><blockquote>\n<p>4、关闭 nginx</p>\n</blockquote>\n<pre><code class=\"language-bashj\">[root@CentOS-7 sbin]# ./nginx -s stop\n</code></pre>\n<blockquote>\n<p>5、重新加载 nginx</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 sbin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ./nginx -s reload</span></pre></td></tr></table></figure><h1 id=\"nginx配置文件\"><a class=\"anchor\" href=\"#nginx配置文件\">#</a> nginx 配置文件</h1>\n<h2 id=\"1-nginx配置文件位置\"><a class=\"anchor\" href=\"#1-nginx配置文件位置\">#</a> 1、nginx 配置文件位置</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528202619737.png\" alt=\"image-20210528202619737\" /></p>\n<h2 id=\"2-nginx配置文件组成\"><a class=\"anchor\" href=\"#2-nginx配置文件组成\">#</a> 2、nginx 配置文件组成</h2>\n<p>（1）nginx 配置文件有三部分组成</p>\n<ul>\n<li>第一部分 全局块\n<ul>\n<li>从配置文件开始到 <code>events块</code> 之间的内容，主要会设置一些影响 nginx 服务器整体运行的配置指令</li>\n<li>比如 worker_processes 1；worker_processes 值越大，可以支持的并发处理量也越多</li>\n</ul>\n</li>\n<li>第二部分 events 块\n<ul>\n<li>events 块涉及的指令主要影响 nginx 服务器与用户的网络连接</li>\n<li>比如 worker_connections   1024; 支持的最大连接数为 1024</li>\n</ul>\n</li>\n<li>第三部分 http 块\n<ul>\n<li>nginx 服务器配置中最频繁的部分</li>\n<li>http 块也可以包括 http 全局块、server 块</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"nginx-配置实例反向代理\"><a class=\"anchor\" href=\"#nginx-配置实例反向代理\">#</a> nginx 配置实例 =&gt; 反向代理</h1>\n<h2 id=\"1-实现效果\"><a class=\"anchor\" href=\"#1-实现效果\">#</a> 1、实现效果</h2>\n<p>（1）打开浏览器，在浏览器地址栏输入地址 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy4xMjMuY29t\">www.123.com</span>，跳转到 liunx 系统 tomcat 主页面中</p>\n<h2 id=\"2-准备工作\"><a class=\"anchor\" href=\"#2-准备工作\">#</a> 2、准备工作</h2>\n<p>（1）在 liunx 系统安装 tomcat，使用默认端口 8080</p>\n<p>tomcat 安装文件放到 liunx 系统中，解压</p>\n<p>进入 tomcat 的 bin 目录中， <code>./startup.sh</code>  启动 tomcat 服务器</p>\n<p>（2）对外开放访问的端口</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>firewall-cmd --add-port<span class=\"token operator\">=</span><span class=\"token number\">8080</span>/tcp --permanent</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>firewall-cmd --reload</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看已经开放的端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>firewall-cmd --list-all</pre></td></tr></table></figure><p>（3）在 windows 系统中通过浏览器访问 tomcat 服务器</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528210132297.png\" alt=\"image-20210528210132297\" /></p>\n<h2 id=\"3-访问过程的分析\"><a class=\"anchor\" href=\"#3-访问过程的分析\">#</a> 3、访问过程的分析</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528210228570.png\" alt=\"image-20210528210228570\" /></p>\n<h2 id=\"4-具体配置\"><a class=\"anchor\" href=\"#4-具体配置\">#</a> 4、具体配置</h2>\n<blockquote>\n<p>第一步 在 windows 系统的 host 文件进行域名和 ip 对应关系的配置</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528210439297.png\" alt=\"image-20210528210439297\" /></p>\n<p>继续访问 tomcat</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528210724394.png\" alt=\"image-20210528210724394\" /></p>\n<blockquote>\n<p>第二步 在 nginx 进行请求转发的配置（反向代理配置）</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528211211559.png\" alt=\"image-20210528211211559\" /></p>\n<h2 id=\"5-最终测试\"><a class=\"anchor\" href=\"#5-最终测试\">#</a> 5、最终测试</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528211428444.png\" alt=\"image-20210528211428444\" /></p>\n<h1 id=\"nginx反向代理实例2\"><a class=\"anchor\" href=\"#nginx反向代理实例2\">#</a> nginx 反向代理实例 2</h1>\n<h2 id=\"1-实现效果-2\"><a class=\"anchor\" href=\"#1-实现效果-2\">#</a> 1、实现效果</h2>\n<p>使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中</p>\n<p>nginx 监听端口为 9001</p>\n<p><mark>访问 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNDIvOjkwMDEvZWR1Lw==\">http://10.102.126.42/:9001/edu/</span> 直接跳转到 127.0.0.1:8080</mark></p>\n<p><mark>访问 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNDIvOjkwMDEvdm9kLw==\">http://10.102.126.42/:9001/vod/</span> 直接跳转到 127.0.0.1:8081</mark></p>\n<h2 id=\"2-准备工作-2\"><a class=\"anchor\" href=\"#2-准备工作-2\">#</a> 2、准备工作</h2>\n<p>（1）准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口</p>\n<p>（2）创建文件夹和测试页面</p>\n<h2 id=\"3-具体配置\"><a class=\"anchor\" href=\"#3-具体配置\">#</a> 3、具体配置</h2>\n<p>（1）找到 nginx 配置文件，进行反向代理配置</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528214716255.png\" alt=\"image-20210528214716255\" /></p>\n<p>（2）开放对外访问的端口号：9001，8080，8081</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 conf<span class=\"token punctuation\">]</span><span class=\"token comment\"># firewall-cmd --add-port=9001/tcp --permanent</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>success</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 conf<span class=\"token punctuation\">]</span><span class=\"token comment\"># firewall-cmd --reload</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>success</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@CentOS-7 conf<span class=\"token punctuation\">]</span><span class=\"token comment\"># firewall-cmd --list-all</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>public <span class=\"token punctuation\">(</span>active<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  target: default</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  icmp-block-inversion: no</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  interfaces: ens32</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  sources: </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  services: dhcpv6-client <span class=\"token function\">ssh</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  ports: <span class=\"token number\">80</span>/tcp <span class=\"token number\">8080</span>/tcp <span class=\"token number\">8081</span>/tcp <span class=\"token number\">9001</span>/tcp</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  protocols: </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  masquerade: no</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  forward-ports: </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  source-ports: </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  icmp-blocks: </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  rich rules:</pre></td></tr></table></figure><h2 id=\"4-最终测试\"><a class=\"anchor\" href=\"#4-最终测试\">#</a> 4、最终测试</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528215314155.png\" alt=\"image-20210528215314155\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528215339564.png\" alt=\"image-20210528215339564\" /></p>\n<h1 id=\"location指令说明\"><a class=\"anchor\" href=\"#location指令说明\">#</a> location 指令说明</h1>\n<p>该指令用于匹配 URL</p>\n<p>语法如下：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528215626081.png\" alt=\"image-20210528215626081\" /></p>\n<p>1、 <code>= </code> ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。</p>\n<p>2、 <code>~</code> ：用于表示 uri 包含正则表达式，并且区分大小写。</p>\n<p>3、 <code>~*</code> ：用于表示 uri 包含正则表达式，并且不区分大小写。</p>\n<p>4、 <code>^~</code> ：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配。</p>\n<p><mark>注意：如果 uri 包含正则表达式，则必须要有～或者～* 标识。</mark></p>\n<h1 id=\"nginx配置实例-负载均衡\"><a class=\"anchor\" href=\"#nginx配置实例-负载均衡\">#</a> nginx 配置实例 - 负载均衡</h1>\n<h2 id=\"1-实现效果-3\"><a class=\"anchor\" href=\"#1-实现效果-3\">#</a> 1、实现效果</h2>\n<p>（1）浏览器地址栏输入地址 http://192.168.17.129/edu/a.html，负载均衡效果，平均 8080 和 8081 端口中</p>\n<h2 id=\"2-准备工作-3\"><a class=\"anchor\" href=\"#2-准备工作-3\">#</a> 2、准备工作</h2>\n<p>（1）准备两台 tomcat 服务器，一台 8080，一台 8081</p>\n<p>（2）在两台 tomcat 里面 webapps 目录中，创建名称是 edu 文件夹，在 edu 文件夹中创建页面 a.html，用于测试</p>\n<h2 id=\"3-在nginx-的配置文件中进行负载均衡的配置\"><a class=\"anchor\" href=\"#3-在nginx-的配置文件中进行负载均衡的配置\">#</a> 3、在 nginx 的配置文件中进行负载均衡的配置</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528221342515.png\" alt=\"image-20210528221342515\" /></p>\n<h2 id=\"4-配置成功\"><a class=\"anchor\" href=\"#4-配置成功\">#</a> 4、配置成功</h2>\n<p>测试，请求同一个路径，轮流地访问 8080，8081 两个服务器，即实现了负载均衡的效果</p>\n<h2 id=\"5-nginx负载均衡的策略\"><a class=\"anchor\" href=\"#5-nginx负载均衡的策略\">#</a> 5、nginx 负载均衡的策略</h2>\n<h3 id=\"1-轮询默认\"><a class=\"anchor\" href=\"#1-轮询默认\">#</a> 1、轮询（默认）</h3>\n<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除</p>\n<h3 id=\"2-weight\"><a class=\"anchor\" href=\"#2-weight\">#</a> 2、weight</h3>\n<p>weight 代表权重，默认为 1，权重越高，被分配的客户端越多</p>\n<p>指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>upstream server_pool<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.21 <span class=\"token assign-left variable\">weight</span><span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.22 <span class=\"token assign-left variable\">weight</span><span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"3-ip_hash\"><a class=\"anchor\" href=\"#3-ip_hash\">#</a> 3、ip_hash</h3>\n<p>每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>upstream server_pool<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ip_hash<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.21:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.22:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"4-fair第三方\"><a class=\"anchor\" href=\"#4-fair第三方\">#</a> 4、fair（第三方）</h3>\n<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>upstream server_pool<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.21:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server <span class=\"token number\">192.168</span>.5.22:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fair<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"nginx配置实例-动静分离\"><a class=\"anchor\" href=\"#nginx配置实例-动静分离\">#</a> nginx 配置实例 - 动静分离</h1>\n<h2 id=\"1-什么是动静分离\"><a class=\"anchor\" href=\"#1-什么是动静分离\">#</a> 1、什么是动静分离</h2>\n<p>Nginx 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用 Nginx 处理静态页面，Tomcat 处理动态页面。动静分离从目前实现角度来讲大致分为两种：</p>\n<ul>\n<li>\n<p>一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案；</p>\n</li>\n<li>\n<p>另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528223635697.png\" alt=\"image-20210528223635697\" /></p>\n<p>通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以设置浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，不建议使用 Expires 来缓存），我这里设置 3d，表示在这 3 天之内访问这个 URL，发送一个请求，比对服务器该文件最后更新时间，没有变化，则不会从服务器抓取，返回状态码 304，如果有修改，则直接从服务器重新下载，返回状态码 200。</p>\n<h2 id=\"2-准备工作-4\"><a class=\"anchor\" href=\"#2-准备工作-4\">#</a> 2、准备工作</h2>\n<p>（1）在 linux 系统中准备静态资源，用于进行访问</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528225532427.png\" alt=\"image-20210528225532427\" /></p>\n<h2 id=\"3-具体配置-2\"><a class=\"anchor\" href=\"#3-具体配置-2\">#</a> 3、具体配置</h2>\n<p>（1）在 nginx 配置文件中进行配置</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528225736743.png\" alt=\"image-20210528225736743\" /></p>\n<h2 id=\"4-最终测试-2\"><a class=\"anchor\" href=\"#4-最终测试-2\">#</a> 4、最终测试</h2>\n<p>（1）浏览器输入地址：<span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNDIvaW1hZ2UvMS5wbmc=\">http://10.102.126.42/image/1.png</span></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528225829853.png\" alt=\"image-20210528225829853\" /></p>\n<p>直接输入地址 http://10.102.126.42/image/，可以将静态资源全部加载出来，== 注意最后一个 <code>/</code> ，就是 image 后面的 <code>/</code>  不能少，不然会出现 404</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529170620289.png\" alt=\"image-20210529170620289\" /></p>\n<p>（2）浏览器输入：<span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNDIvd3d3L2EuaHRtbA==\">http://10.102.126.42/www/a.html</span></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210528230839058.png\" alt=\"image-20210528230839058\" /></p>\n<h1 id=\"nginx配置高可用集群\"><a class=\"anchor\" href=\"#nginx配置高可用集群\">#</a> nginx 配置高可用集群</h1>\n<h2 id=\"1-什么是nginx高可用\"><a class=\"anchor\" href=\"#1-什么是nginx高可用\">#</a> 1、什么是 nginx 高可用</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529195702822.png\" alt=\"image-20210529195702822\" /></p>\n<p>（1）需要两台 nginx 服务器</p>\n<p>（2）需要 keepalived</p>\n<p>（3）需要虚拟 ip 地址</p>\n<h2 id=\"2-配置高可用的准备工作\"><a class=\"anchor\" href=\"#2-配置高可用的准备工作\">#</a> 2、配置高可用的准备工作</h2>\n<p>（1）需要配置两台服务器 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNDIv\">http://10.102.126.42/</span> 和 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi42OC43Ni8=\">http://10.102.68.76/</span></p>\n<p>（2）在两台服务器安装 nginx</p>\n<p>（3）在两台服务器安装 keepalived</p>\n<h2 id=\"3-在两台服务器安装keepalived\"><a class=\"anchor\" href=\"#3-在两台服务器安装keepalived\">#</a> 3、在两台服务器安装 keepalived</h2>\n<p>（1）使用 yum 命令进行安装</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> keepalived -y</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">rpm</span> -q -a keepalived\t<span class=\"token comment\"># 查看 keepalived 是否安装</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529203452428.png\" alt=\"image-20210529203452428\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529203544568.png\" alt=\"image-20210529203544568\" /></p>\n<p><mark>在这步操作中可能会出现一下问题</mark></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Error downloading packages:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  keepalived-1.3.5-19.el7.x86_64: <span class=\"token punctuation\">[</span>Errno <span class=\"token number\">256</span><span class=\"token punctuation\">]</span> No <span class=\"token function\">more</span> mirrors to try.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token number\">1</span>:net-snmp-libs-5.7.2-49.el7_9.1.x86_64: <span class=\"token punctuation\">[</span>Errno <span class=\"token number\">256</span><span class=\"token punctuation\">]</span> No <span class=\"token function\">more</span> mirrors to try.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">1</span>:net-snmp-agent-libs-5.7.2-49.el7_9.1.x86_64: <span class=\"token punctuation\">[</span>Errno <span class=\"token number\">256</span><span class=\"token punctuation\">]</span> No <span class=\"token function\">more</span> mirrors to try.</pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529203728931.png\" alt=\"image-20210529203728931\" /></p>\n<p>出现这种情况百度的话是这种办法</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529204055515.png\" alt=\"image-20210529204055515\" /></p>\n<p><mark>但我觉得首先应该检查自己的虚拟机是否是联网状态，即 ping 百度看能不能 ping 通，如果虚拟机没有联网是没办法通过 yum 命令安装的</mark></p>\n<p>我就是通过虚拟机联网解决了</p>\n<p>（2）安装之后，在 etc 里面生成目录 keepalived，有文件  <code>keepalived.conf</code></p>\n<h2 id=\"4-完成高可用配置主从配置\"><a class=\"anchor\" href=\"#4-完成高可用配置主从配置\">#</a> 4、完成高可用配置（主从配置）</h2>\n<p>（1）修改 <code>/etc/keepalived/keepalived.conf</code>  配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>global_defs <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tnotification_email <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tacassen@firewall.loc</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tfailover@firewall.loc</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tsysadmin@firewall.loc</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tnotification_email_from Alexandre.Cassen@firewall.loc</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tsmtp_server <span class=\"token number\">10.102</span>.126.42</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tsmtp_connect_timeout <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\trouter_id LVS_DEVEL <span class=\"token comment\"># 访问到主机，这是主机的名字，和 localhost 差不多的意思</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>vrrp_script chk_http_port <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tscript <span class=\"token string\">\"/usr/local/src/nginx_check.sh\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinterval <span class=\"token number\">2</span> <span class=\"token comment\">#（检测脚本执行的间隔）</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tweight <span class=\"token number\">2</span> <span class=\"token comment\"># 权重</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>vrrp_instance VI_1 <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tstate BACKUP <span class=\"token comment\"># 备份服务器上将 MASTER 改为 BACKUP</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tinterface ens32 //网卡</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tvirtual_router_id <span class=\"token number\">51</span> <span class=\"token comment\"># 主、备机的 virtual_router_id 必须相同</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tpriority <span class=\"token number\">90</span> <span class=\"token comment\"># 主、备机取不同的优先级，主机值较大，备份机值较小</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tadvert_int <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tauthentication <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tauth_type PASS</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\tauth_pass <span class=\"token number\">1111</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tvirtual_ipaddress <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token number\">10.102</span>.126.50 <span class=\"token comment\"># VRRP H 虚拟地址</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>（2）在 <code>/usr/local/src</code>  添加检测脚本</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">A</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ps</span> -C nginx –-no-header <span class=\"token operator\">|</span><span class=\"token function\">wc</span> -l<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$A</span> -eq <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t/usr/local/nginx/sbin/nginx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">sleep</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ps</span> -C nginx --no-header <span class=\"token operator\">|</span><span class=\"token function\">wc</span> -l<span class=\"token variable\">`</span></span> -eq <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token function\">killall</span> keepalived</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr></table></figure><p><mark>注意这里两台服务器都要配置</mark></p>\n<p>（3）把两台服务器上 nginx 和 keepalived 启动</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 启动 nginx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./nginx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 启动 keepalived</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl start keepalived.service</pre></td></tr></table></figure><h2 id=\"5-最终测试-2\"><a class=\"anchor\" href=\"#5-最终测试-2\">#</a> 5、最终测试</h2>\n<p>（1）在浏览器地址栏输入 虚拟 ip 地址 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNTAv\">http://10.102.126.50/</span></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529220108249.png\" alt=\"image-20210529220108249\" /></p>\n<p>可以看到服务器已经绑定了虚拟 ip</p>\n<p>（2）把主服务器（10.102.126.50）nginx 和 keepalived 停止，再输入 <span class=\"exturl\" data-url=\"aHR0cDovLzEwLjEwMi4xMjYuNTAv\">http://10.102.126.50/</span></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529223105940.png\" alt=\"image-20210529223105940\" /></p>\n<p><mark>依旧能进行访问</mark>，说明此时集群搭建成功</p>\n<p>可以看到备份服务器也绑定了虚拟 ip</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529223435351.png\" alt=\"image-20210529223435351\" /></p>\n<h1 id=\"nginx的原理\"><a class=\"anchor\" href=\"#nginx的原理\">#</a> nginx 的原理</h1>\n<h2 id=\"1-master-和-worker\"><a class=\"anchor\" href=\"#1-master-和-worker\">#</a> 1、master 和 worker</h2>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529225621258.png\" alt=\"image-20210529225621258\" /></p>\n<h2 id=\"2-worker-如何进行工作的\"><a class=\"anchor\" href=\"#2-worker-如何进行工作的\">#</a> 2、worker 如何进行工作的</h2>\n<p>每一个 worker 都会争抢请求，争抢到请求则执行。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/nginx/image-20210529225650761.png\" alt=\"image-20210529225650761\" /></p>\n<h2 id=\"3-一个master和多个worker有什么好处\"><a class=\"anchor\" href=\"#3-一个master和多个worker有什么好处\">#</a> 3、一个 master 和多个 worker 有什么好处</h2>\n<p>（1）可以使用 nginx –s reload 热部署，利用 nginx 进行热部署操作</p>\n<p>例如，当其中一个 worker 在执行请求的时候，其他的三个 worker 进行更新，然后可以继续争抢请求，此时还有一个 worker 没有更新热部署，当执行完任务就会进行热部署更新。</p>\n<p>（2）每个 woker 是独立的进程，如果有其中的一个 woker 出现问题，其他 woker 独立的，继续进行争抢，实现请求过程，不会造成服务中断</p>\n<h2 id=\"4-设置多少个worker合适\"><a class=\"anchor\" href=\"#4-设置多少个worker合适\">#</a> 4、设置多少个 worker 合适</h2>\n<p>worker 数和服务器的 cpu 数相等是最为适宜的</p>\n<h2 id=\"5-连接数-worker_connection\"><a class=\"anchor\" href=\"#5-连接数-worker_connection\">#</a> 5、连接数 worker_connection</h2>\n<p><mark>第一个：发送请求，占用了 worker 的几个连接数？</mark></p>\n<p>答案：2 个或者是 4 个，因为当客户端通过 nginx 请求静态资源的时候，此时 nginx 连接请求，并返回数据，此时连接数为 2 个。当客户端通过 nginx 请求后端，例如访问数据库的时候就需要连接 tomcat，此时还要返回数据，就有 4 个连接数。</p>\n<p><mark>第二个：nginx 有一个 master，有四个 worker，每个 worker 支持最大的连接数 1024. 那么支持的最大并发数是多少？</mark></p>\n<p><code>普通的静态访问最大并发数是：worker_connections \\* worker_processes /2</code></p>\n<p><code>而如果是 HTTP 作 为反向代理来说，最大并发数量应该是 worker_connections \\* worker_processes/4。</code></p>\n",
            "tags": [
                "计算机学习",
                "运维",
                "Nginx",
                "Nginx"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Linux/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Linux/",
            "title": "Linux初步学习",
            "date_published": "2021-04-01T08:30:03.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h1 id=\"linux学习日志\"><a class=\"anchor\" href=\"#linux学习日志\">#</a> Linux 学习日志</h1>\n<h2 id=\"学习相关资料和技术文档\"><a class=\"anchor\" href=\"#学习相关资料和技术文档\">#</a> 学习相关资料和技术文档</h2>\n<p>csdn 博主笔记：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mi9hcnRpY2xlL2xpc3QvMQ==\">https://blog.csdn.net/su2231595742/article/list/1</span></p>\n<p>linux 狂神说学习笔记：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mi9hcnRpY2xlL2RldGFpbHMvMTEyNDcyNzk2\">https://blog.csdn.net/su2231595742/article/details/112472796</span></p>\n<p>linux 安装在 VMwear 教程：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhYnl4dWUvYXJ0aWNsZS9kZXRhaWxzLzgwOTcwNTI2\">https://blog.csdn.net/babyxue/article/details/80970526</span></p>\n<h2 id=\"1入门概述\"><a class=\"anchor\" href=\"#1入门概述\">#</a> 1. 入门概述</h2>\n<h3 id=\"11-我们为什么要学习linux\"><a class=\"anchor\" href=\"#11-我们为什么要学习linux\">#</a> 1.1、我们为什么要学习 Linux</h3>\n<p>linux 诞生了这么多年，以前还喊着如何能取代 windows 系统，现在这个口号已经小多了，任何事物发展都有其局限性都有其天花板。就如同在国内再搞一个社交软件取代腾讯一样，想想而已基本不可能，因为用户已经习惯于使用微信交流，不是说技术上实现不了解而是老百姓已经习惯了，想让他们不用，即使他们自己不用亲戚朋友还是要用，没有办法的事情。</p>\n<p>用习惯了 windows 操作系统，再让大家切换到别的操作系统基本上是不可能的事情，改变一个人已经养成的习惯太难。没有办法深入到普通老百姓的生活中，并不意味着 linux 就没有用武之地了。在服务器端，在开发领域 linux 倒是越来越受欢迎，很多程序员都觉得不懂点 linux 都觉得不好意思，linux 在开源社区的地位依然岿然不动。</p>\n<p>尤其是作为一个后端程序员，是必须要掌握 Linux 的，因为这都成为了你找工作的基础门槛了，所以不得不学习！</p>\n<h3 id=\"12-linux-简介\"><a class=\"anchor\" href=\"#12-linux-简介\">#</a> 1.2、Linux 简介</h3>\n<p>Linux 内核最初只是由芬兰人林纳斯・托瓦兹（Linus Torvalds）在赫尔辛基大学上学时出于个人爱好而编写的。</p>\n<p>Linux 是一套免费使用和自由传播的类 Unix 操作系统，是一个基于 POSIX（可移植操作系统接口） 和 UNIX 的多用户、多任务、支持多线程和多 CPU 的操作系统。</p>\n<p>Linux 能运行主要的 UNIX 工具软件、应用程序和网络协议。它支持 32 位和 64 位硬件。Linux 继承了 Unix 以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。</p>\n<h3 id=\"13-linux-发行版\"><a class=\"anchor\" href=\"#13-linux-发行版\">#</a> 1.3、Linux 发行版</h3>\n<p>Linux 的发行版说简单点就是将 Linux 内核与应用软件做一个打包。</p>\n<p>Kali linux：安全渗透测试使用！（有兴趣做安全的同学可以了解一下！）</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/2020122020104278-1620716275522-1620716316198.png\" alt=\"linux图片\" /></p>\n<p>目前市面上较知名的发行版有：Ubuntu、RedHat、CentOS、Debian、Fedora、SuSE、OpenSUSE、Arch Linux、SolusOS 等。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20201220201119647.png\" alt=\"linux图片\" /></p>\n<h3 id=\"14-linux-应用领域\"><a class=\"anchor\" href=\"#14-linux-应用领域\">#</a> 1.4、Linux 应用领域</h3>\n<p>今天各种场合都有使用各种 Linux 发行版，从嵌入式设备到超级计算机，并且在服务器领域确定了地位，通常服务器使用 LAMP（Linux + Apache + MySQL + PHP）或 LNMP（Linux + Nginx+ MySQL +PHP）组合。</p>\n<p>目前 Linux 不仅在家庭与企业中使用，并且在政府中也很受欢迎。</p>\n<ul>\n<li>巴西联邦政府由于支持 Linux 而世界闻名。</li>\n<li>有新闻报道俄罗斯军队自己制造的 Linux 发布版的，做为 G.H.ost 项目已经取得成果。</li>\n<li>印度的 Kerala 联邦计划在向全联邦的高中推广使用 Linux。</li>\n<li>中华人民共和国为取得技术独立，在龙芯处理器中排他性地使用 Linux。</li>\n<li>在西班牙的一些地区开发了自己的 Linux 发布版，并且在政府与教育领域广泛使用，如 Extremadura 地区的 gnuLinEx 和 Andalusia 地区的 Guadalinex。</li>\n<li>葡萄牙同样使用自己的 Linux 发布版 Caixa Mágica，用于 Magalh?es 笔记本电脑和 e-escola 政府软件。</li>\n<li>法国和德国同样开始逐步采用 Linux。</li>\n</ul>\n<p>只要学不死，就往死里学</p>\n<h3 id=\"15-linux-vs-windows\"><a class=\"anchor\" href=\"#15-linux-vs-windows\">#</a> 1.5、Linux vs Windows</h3>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20201220202154232.png\" alt=\"linux图片\" /></p>\n<h2 id=\"2-环境搭建\"><a class=\"anchor\" href=\"#2-环境搭建\">#</a> 2、环境搭建</h2>\n<p>Linux 的安装，安装步骤比较繁琐（操作系统本身也是一个软件），现在其实云服务器挺普遍的，价格也便宜，如果直接不想搭建，也可以直接买一台学习用用！</p>\n<h3 id=\"21-安装centos-在本地安装这个不太建议如果没有经济来源的话可以考虑在本地搭建\"><a class=\"anchor\" href=\"#21-安装centos-在本地安装这个不太建议如果没有经济来源的话可以考虑在本地搭建\">#</a> 2.1、安装 CentOS （在本地安装，这个不太建议，如果没有经济来源的话，可以考虑在本地搭建）</h3>\n<p>Linux 是一个操作系统，你也可以把自己电脑安装成双系统！</p>\n<p>虚拟机（VMware 下载（收费的，注册码！）</p>\n<p>下载链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudm13YXJlLmNvbS9jbi9wcm9kdWN0cy93b3Jrc3RhdGlvbi1wcm8vd29ya3N0YXRpb24tcHJvLWV2YWx1YXRpb24uaHRtbA==\">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</span></p>\n<p>官网下载：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20201222145631600.png\" alt=\"linux图片\" /></p>\n<p>安装完成后打开软件有如下界面：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511152938944.png\" alt=\"image-20210511152938944\" /></p>\n<p>在虚拟机上安装 CentOS7</p>\n<p>1、可以通过镜像进行安装！ 下载地址：<span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS9jZW50b3MvNy9pc29zL3g4Nl82NC8lRUYlQkMlOEMlRTQlQjglOEIlRTglQkQlQkQlRTUlQUUlOEMlRTYlODglOTAlRTUlOTAlOEUlRTUlQUUlODklRTglQTMlODUlRTUlOEQlQjMlRTUlOEYlQUYlRUYlQkMlODElRTUlQUUlODklRTglQTMlODUlRTYlOTMlOEQlRTQlQkQlOUMlRTclQjMlQkIlRTclQkIlOUYlRTUlOTIlOEMlRTUlQUUlODklRTglQTMlODUlRTglQkQlQUYlRTQlQkIlQjYlRTYlOTglQUYlRTQlQjglODAlRTYlQTAlQjclRTclOUElODQlRUYlQkMlOEMlRTYlQjMlQTglRTYlODQlOEYlRUYlQkMlOUFMaW51eCVFNyVBMyU4MSVFNyU5QiU5OCVFNSU4OCU4NiVFNSU4QyVCQSVFNyU5QSU4NCVFNiU5NyVCNiVFNSU4MCU5OSVFOSU5QyU4MCVFOCVBNiU4MSVFNiVCMyVBOCVFNiU4NCU4RiVFNSU4OCU4NiVFNSU4QyVCQSVFNSU5MCU4RCVFNSU4RCVCMyVFNSU4RiVBRiVFRiVCQyU4MS9ib290\">http://mirrors.aliyun.com/centos/7/isos/x86_64/，下载完成后安装即可！安装操作系统和安装软件是一样的，注意：Linux 磁盘分区的时候需要注意分区名即可！/boot</span> /home!</p>\n<p>2、下载 CentOS 镜像</p>\n<p>CentOS 镜像：<span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS9jZW50b3MvNy9pc29zL3g4Nl82NC8=\">http://mirrors.aliyun.com/centos/7/isos/x86_64/</span></p>\n<p>安装教程：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NzE0NjAzL2FydGljbGUvZGV0YWlscy84ODgyOTQyMw==\">https://blog.csdn.net/qq_44714603/article/details/88829423</span></p>\n<p>3、安装 VMware 虚拟机软件，然后打开我们的镜像即可使用！</p>\n<p>打开后的样子：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511165844058.png\" alt=\"image-20210511165844058\" /></p>\n<p>VMware 的使用方式：</p>\n<p>点击屏幕进入虚拟机、Ctrl + Alt 将聚焦退出虚拟机！</p>\n<p>开机后的页面：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511165753148.png\" alt=\"image-20210511165753148\" /></p>\n<p>大家下载完毕后，可以安装系统，然后根据我们的账号密码，来自己测试登录！</p>\n<p>那我们的本地 Linux 环境就准备好了！</p>\n<h3 id=\"22-购买云服务器有经济来源的话可以购买阿里云服务器因为这才是最近接公司中原生环境的\"><a class=\"anchor\" href=\"#22-购买云服务器有经济来源的话可以购买阿里云服务器因为这才是最近接公司中原生环境的\">#</a> 2.2、购买云服务器（有经济来源的话，可以购买阿里云服务器，因为这才是最近接公司中原生环境的！）</h3>\n<p>云服务器就是一个远程电脑，服务器一般不会关机！</p>\n<p>虚拟机安装后占用空间，也会有些卡顿，我们作为程序员其实可以选择购买一台自己的服务器，这样的话更加接近真实线上工作；</p>\n<p>1、阿里云购买服务器：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9hcnRpY2xlLzc1MjI0Mz9zcG09YTJjNmguMTM4MTMwMTcuMC5kQXJ0aWNsZTczODYzOC41YWI0MWQzY0JybGFGeg==\">https://developer.aliyun.com/article/752243?spm=a2c6h.13813017.0.dArticle738638.5ab41d3cBrlaFz</span><br />\n2、购买完毕后，获取服务器的 ip 地址，重置服务器密码，就可以远程登录了</p>\n<p>获取公网 IP 地址！<br />\n修改自己的登录密码</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511172159160.png\" alt=\"image-20210511172159160\" /></p>\n<p>3、下载 xShell 远程连接工具 22，进行远程连接使用！建议使用 360 一键下载！还需要下载一个 xFtp 文件上传 21！</p>\n<p>下载完毕后，直接打开即可！<br />\n4、使用 Xshell 连接远程服务器！~</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511172321130.png\" alt=\"image-20210511172321130\" /></p>\n<p>登录用户名和密码之后，登录成功就是如下界面：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511172336530.png\" alt=\"image-20210511172336530\" /></p>\n<p>这里就是我们的 Linux 操作系统了！以后的操作都在这里操作，项目也在这里进行发布！</p>\n<p>Ctrl + 鼠标滚轮，放大和缩小字体！<br />\n上传文件使用 xftp 即可！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511172401519.png\" alt=\"image-20210511172401519\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511172544737.png\" alt=\"image-20210511172544737\" /></p>\n<p>Tomcat 需要 Java 环境！我们后会按照 JDK，到时候再测试吧，先学基本的 Linux 命令为主！<br />\n远程环境安装！</p>\n<p>注意事项：</p>\n<p>如果要打开端口，需要在阿里云的安全组面板中开启对应的出入规则，不然的话会被阿里拦截！</p>\n<p>如果前期不好操作，可以推荐安装宝塔面板，傻瓜式管理服务器</p>\n<p>安装教程：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnQuY24vYmJzL3RocmVhZC0xOTM3Ni0xLTEuaHRtbA==\">https://www.bt.cn/bbs/thread-19376-1-1.html</span></p>\n<p>1、开启对应的端口<br />\n 2、一键安装<br />\n 3、安装完毕后会得到远程面板的地址，账号，密码，就可以登录了<br />\n 4、登录之后就可以可视化的安装环境和部署网站！</p>\n<p><strong>关于域名</strong></p>\n<p>如果自己的网站想要上线，就一定要购买一个域名然后进行备案；</p>\n<p>备案的话需要一些认证和时间，备完完毕后，就可以解析到自己的网站了，这个时候就可以使用域名来进行服务器的访问</p>\n<h2 id=\"3-走近linux系统\"><a class=\"anchor\" href=\"#3-走近linux系统\">#</a> 3、走近 Linux 系统</h2>\n<h3 id=\"31-开机登录\"><a class=\"anchor\" href=\"#31-开机登录\">#</a> 3.1、开机登录</h3>\n<p>开机会启动许多程序。它们在 Windows 叫做 &quot;服务&quot;（service），在 Linux 就叫做 &quot;守护进程&quot;（daemon）。</p>\n<p>开机成功后，它会显示一个文本登录界面，这个界面就是我们经常看到的登录界面，在这个登录界面中会提示用户输入用户名，而用户输入的用户将作为参数传给 login 程序来验证用户的身份，密码是不显示的，输完回车即可！</p>\n<p>一般来说，用户的登录方式有三种：</p>\n<p>命令行登录<br />\n ssh 登录<br />\n图形界面登录<br />\n最高权限账户为 root，可以操作一切！</p>\n<h3 id=\"32-关机\"><a class=\"anchor\" href=\"#32-关机\">#</a> 3.2、关机</h3>\n<p>在 linux 领域内大多用在服务器上，很少遇到关机的操作。毕竟服务器上跑一个服务是永无止境的，除非特殊情况下，不得已才会关机。</p>\n<p>关机指令为：shutdown ；</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/2021011521440482.png\" alt=\"linux图片\" /></p>\n<pre><code>sync # 将数据由内存同步到硬盘中。\nshutdown # 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：\nshutdown –h 10 # 这个命令告诉大家，计算机将在10分钟后关机\nshutdown –h now # 立马关机\nshutdown –h 20:25 # 系统会在今天20:25关机\nshutdown –h +10 # 十分钟后关机\nshutdown –r now # 系统立马重启\nshutdown –r +10 # 系统十分钟后重启\nreboot # 就是重启，等同于 shutdown –r now\nhalt # 关闭系统，等同于shutdown –h now 和 poweroff\n</code></pre>\n<p>最后总结一下，不管是重启系统还是关闭系统，首先要运行 sync 命令，把内存中的数据写到磁盘中。</p>\n<h3 id=\"33-系统目录结构\"><a class=\"anchor\" href=\"#33-系统目录结构\">#</a> 3.3、系统目录结构</h3>\n<p>1、一切皆文件<br />\n 2、根目录 / ，所有的文件都挂载在这个节点下</p>\n<p>登录系统后，在当前命令窗口下输入命令：</p>\n<pre><code>ls /\n</code></pre>\n<p>你会看到如下图所示：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511182042029.png\" alt=\"image-20210511182042029\" /></p>\n<p>树状目录结构：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20210115214450337.png\" alt=\"linux图片\" /></p>\n<p>以下是对这些目录的解释：</p>\n<ul>\n<li><strong>/bin：</strong> bin 是 Binary 的缩写，这个目录存 放着最经常使用的命令。</li>\n<li><strong>/boot：</strong> 这里存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。（不要动）</li>\n<li><strong>/dev ：</strong> dev 是 Device (设备) 的缩写，存放的是 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。</li>\n<li><mark><strong>/etc：</strong> 这个目录用来存放所有的系统管理所需要的配置文件和子目录。</mark></li>\n<li><mark>**/home：** 用户的主目录，在 Linux 中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</mark></li>\n<li><strong>/lib：</strong> 这个目录里存放着系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。（不要动）</li>\n<li><strong>/lost+found：</strong> 这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。（存放突然关机的一些文件）</li>\n<li>**/media：**linux 系统会自动识别一些设备，例如 U 盘、光驱等等，当识别后，linux 会把识别的设备挂载到这个目录下。</li>\n<li>**/mnt：** 系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 /mnt/ 上，然后进入该目录就可以查看光驱里的内容了。（我们后面会把一些本地文件挂载在这个目录下）</li>\n<li><mark>**/opt：** 这是给主机额外安装软件所摆放的目录。比如你安装一个 ORACLE 数据库则就可以放到这个目录下。默认是空的。</mark></li>\n<li><strong>/proc：</strong> 这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。（不用管）</li>\n<li><mark>**/root：** 该目录为系统管理员，也称作超级权限者的用户主目录。</mark></li>\n<li>**/sbin：**s 就是 Super User 的意思，这里存放的是系统管理员使用的系统管理程序。</li>\n<li>/srv：该目录存放一些服务启动之后需要提取的数据。/sys：这是 linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。</li>\n<li><mark>**/tmp：** 这个目录是用来存放一些临时文件的。用完即丢的文件，可以放在这个目录下，安装包！</mark></li>\n<li><mark>**/usr：<strong>这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。</strong></mark></li>\n<li><strong>/usr/bin：</strong> 系统用户使用的应用程序。</li>\n<li><strong>/usr/sbin：</strong> 超级用户使用的比较高级的管理程序和系统守护程序。Super</li>\n<li><strong>/usr/src：</strong> 内核源代码默认的放置目录。</li>\n<li><mark>**/var：** 这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</mark></li>\n<li>**/run：** 是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。</li>\n<li><mark>**/www：** 存放服务器网站相关的资源，环境，网站的项目</mark></li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20210115214514601.png\" alt=\"linux图片\" /></p>\n<h2 id=\"4-常用基本命令\"><a class=\"anchor\" href=\"#4-常用基本命令\">#</a> 4、常用基本命令</h2>\n<h3 id=\"41-目录管理\"><a class=\"anchor\" href=\"#41-目录管理\">#</a> 4.1、目录管理</h3>\n<h4 id=\"411-绝对路径-相对路径\"><a class=\"anchor\" href=\"#411-绝对路径-相对路径\">#</a> 4.1.1、绝对路径、相对路径</h4>\n<p>绝对路径路径的全称：C:\\ProgramData\\360safe\\xxx.xx</p>\n<p>比如说 360safe 目录下，那这个 xxx.xx 文件，对应我们的相对配置就 /xxx.xx</p>\n<p>cd ： 切换目录命令！<br />\n./ ： 当前目录<br />\n cd .. ： 返回上一级目录（cd 英文句号打两个）</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511183802095.png\" alt=\"image-20210511183802095\" /></p>\n<h4 id=\"412-ls-列出目录\"><a class=\"anchor\" href=\"#412-ls-列出目录\">#</a> 4.1.2、ls （列出目录！）</h4>\n<p>在 Linux 中 ls 可能是最常常被使用的！</p>\n<p>-a 参数：all ，查看全部的文件，包括隐藏文件<br />\n - l 参数 列出所有的文件，包含文件的属性和权限，没有隐藏文件<br />\n所有 Linux 可以组合使用！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511204512682.png\" alt=\"image-20210511204512682\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511204524263.png\" alt=\"image-20210511204524263\" /></p>\n<h4 id=\"413-cd-命令-切换目录\"><a class=\"anchor\" href=\"#413-cd-命令-切换目录\">#</a> 4.1.3、cd 命令 切换目录</h4>\n<p>cd 目录名（绝对路径都是以 / 开头，相对路径，对于当前目录该如何寻找 …/…/）</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511205045064.png\" alt=\"image-20210511205045064\" /></p>\n<p>大家只要多尝试使用，就会了！</p>\n<blockquote>\n<p>pwd 显示当前用户所在的目录</p>\n</blockquote>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511205352362.png\" alt=\"image-20210511205352362\" /></p>\n<h4 id=\"414-mkdir-创建目录\"><a class=\"anchor\" href=\"#414-mkdir-创建目录\">#</a> 4.1.4、mkdir 创建目录</h4>\n<p>mkdir xxx ： 创建目录<br />\n mkdir -p test2/test3/test4： 创建多级目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir test1 # 创建目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>admin  lloam  lloamstudy  test1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd test1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ test1<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd ..</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir test2/test3/test4 #创建多级目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mkdir: cannot create directory ‘test2/test3/test4’: No such <span class=\"token function\">file</span> or directory</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p test2/test3/test4</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>admin  lloam  lloamstudy  test1  test2</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd test2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ test2<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>test3</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ test2<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd test3</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ test3<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>test4</pre></td></tr></table></figure><h4 id=\"415-rmdir-删除目录\"><a class=\"anchor\" href=\"#415-rmdir-删除目录\">#</a> 4.1.5、rmdir 删除目录</h4>\n<p>rmdir xxx ： 删除不为空的目录<br />\n rmdir -p test2/test3/test4 ：强制删除目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ test3<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /home</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>admin  lloam  lloamstudy  test1  test2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># rmdir test1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>admin  lloam  lloamstudy  test2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># rmdir test2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>rmdir: failed to remove ‘test2’: Directory not empty</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># rmdir -p test2/test3/test4</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>admin  lloam  lloamstudy</pre></td></tr></table></figure><p>rmdir 仅能删除空的目录，如果下面存在文件，需要先删除文件，递归删除多个目录 -p 参数即可</p>\n<h4 id=\"416-cp-复制文件目录\"><a class=\"anchor\" href=\"#416-cp-复制文件目录\">#</a> 4.1.6、cp 复制文件目录</h4>\n<p>cp 原来的地方 新的地方<br />\n如果文件重复，就选择覆盖（y）或者 放弃（n）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin  lloam  lloamstudy  PAD.png</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># clear</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>admin  lloam  lloamstudy  PAD.png</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp PAD.png lloamstudy # 拷贝文件至目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>admin  lloam  lloamstudy  PAD.png</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd lloamstudy</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>PAD.png</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd ..</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp PAD.png lloamstudy # 如果文件重复，就选择覆盖（y）或者放弃（n）</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>cp: overwrite ‘lloamstudy/PAD.png’? y</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><h4 id=\"417-rm-移除文件目录\"><a class=\"anchor\" href=\"#417-rm-移除文件目录\">#</a> 4.1.7、rm 移除文件目录</h4>\n<p>-f 忽略不存在的文件，不会出现警告，强制删除！<br />\n-r 递归删除目录！<br />\n-i 互动，删除询问是否删除</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> -rf / <span class=\"token comment\"># 系统中所有的文件就被删除了，删库跑路就是这么操作的！</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PAD.png</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># rm -rf PAD.png </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr></table></figure><h4 id=\"418-mv-移动文件或者目录\"><a class=\"anchor\" href=\"#418-mv-移动文件或者目录\">#</a> 4.1.8、mv 移动文件或者目录</h4>\n<p>还可以重命名文件夹</p>\n<p>-f 强制<br />\n - u 只替换已经更新过的文件<br />\n mv <span class=\"exturl\" data-url=\"aHR0cDovL2luc3RhbGwuc2g=\">install.sh</span> kuangstudy    移动文件<br />\n mv kuangstudy kuangstudy2   重命名文件夹</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin  lloam  lloamstudy  PAD.png</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv PAD.png lloamstudy # 移动文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>admin  lloam  lloamstudy</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd lloamstudy</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>PAD.png</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ lloamstudy<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd ..</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>admin  lloam  lloamstudy</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv lloamstudy lloamstudy2 # 重命名文件夹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>admin  lloam  lloamstudy2</pre></td></tr></table></figure><h3 id=\"42-基本属性\"><a class=\"anchor\" href=\"#42-基本属性\">#</a> 4.2、基本属性</h3>\n<p>十个字母 ；1 类型</p>\n<h4 id=\"421-看懂文件属性\"><a class=\"anchor\" href=\"#421-看懂文件属性\">#</a> 4.2.1、看懂文件属性</h4>\n<p>Linux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。</p>\n<p>在 Linux 中我们可以使用  <code>ll </code> 或者 <code>ls –l</code>  命令来显示一个文件的属性以及文件所属的用户和组，如：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511211750553.png\" alt=\"image-20210511211750553\" /></p>\n<p>实例中，root 文件的第一个属性用 &quot;d&quot; 表示。&quot;d&quot; 在 Linux 中代表该文件是一个目录文件。</p>\n<p>在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等：</p>\n<ul>\n<li>\n<p><mark>当为 [d] 则是目录</mark></p>\n</li>\n<li>\n<p><mark>当为 [-] 则是文件；</mark></p>\n</li>\n<li>\n<p><mark>若是 [l] 则表示为链接文档 ( link file )；</mark></p>\n</li>\n<li>\n<p>若是 [b] 则表示为装置文件里面的可供储存的接口设备 ( 可随机存取装置 )；</p>\n</li>\n<li>\n<p>若是 [c] 则表示为装置文件里面的串行端口设备，例如键盘、鼠标 ( 一次性读取装置 )。</p>\n<p>接下来的字符中，以三个为一组，且均为『rwx』 的三个参数的组合。</p>\n</li>\n</ul>\n<p>其中，[r] 代表可读 (read)、[ w ] 代表可写 (write)、[ x ] 代表可执行 (execute)。</p>\n<p>要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 [-] 而已。</p>\n<p>每个文件的属性由左边第一部分的 10 个字符来确定（如下图）：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20210115223324226.png\" alt=\"linux图片\" /></p>\n<p>从左至右用 0-9 这些数字来表示。</p>\n<p>第 0 位确定文件类型，第 1-3 位确定属主（该文件的所有者）拥有该文件的权限。第 4-6 位确定属组（所有者的同组用户）拥有该文件的权限，第 7-9 位确定其他用户拥有该文件的权限。</p>\n<p>其中：</p>\n<p>第 1、4、7 位表示读权限，如果用 &quot;r&quot; 字符表示，则有读权限，如果用 &quot;-&quot; 字符表示，则没有读权限；<br />\n第 2、5、8 位表示写权限，如果用 &quot;w&quot; 字符表示，则有写权限，如果用 &quot;-&quot; 字符表示没有写权限；<br />\n第 3、6、9 位表示可执行权限，如果用 &quot;x&quot; 字符表示，则有执行权限，如果用 &quot;-&quot; 字符表示，则没有执行权<br />\n限。<br />\n对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。</p>\n<p>同时，在 Linux 系统中，用户是按组分类的，一个用户属于一个或多个组。</p>\n<p>文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。</p>\n<p>因此，Linux 系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。</p>\n<p>在以上实例中，test 文件是一个目录文件，属主和属组都为 root。</p>\n<h4 id=\"422-修改文件属性\"><a class=\"anchor\" href=\"#422-修改文件属性\">#</a> 4.2.2、修改文件属性</h4>\n<p><strong>1、chgrp：更改文件属组</strong></p>\n<pre><code>chgrp [-R] 属组名 文件名\n</code></pre>\n<p>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上 - R 的参数，那么该目录下的所有文件的属组都会更改。</p>\n<p>2、chown：更改文件属主，也可以同时更改文件属组</p>\n<pre><code>chown [–R] 属主名 文件名\nchown [-R] 属主名：属组名 文件名\n</code></pre>\n<p>3、chmod：更改文件 9 个属性（必须要掌握）</p>\n<p>你没有权限操作此文件！</p>\n<pre><code>chmod [-R] xyz 文件或目录\n</code></pre>\n<p>Linux 文件属性有两种设置方法，一种是数字（常用的是数字），一种是符号。</p>\n<p>Linux 文件的基本权限就有九个，分别是 owner/group/others 三种身份各有自己的 read/write/execute 权限。</p>\n<p>先复习一下刚刚上面提到的数据：文件的权限字符为：『-rwxrwxrwx』， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p>\n<pre><code>r:4    w:2    x:1\n\n可读可写不可执行 rw-   6\n可读可写不课执行 rwx   7\n\nchomd  777  文件赋予所有用户可读可写可执行！\n</code></pre>\n<p>每种身份 (owner/group/others) 各自的三个权限 (r/w/x) 分数是需要累加的，例如当权限为：[-rwxrwx—] 分数则是：</p>\n<p>owner = rwx = 4+2+1 = 7<br />\ngroup = rwx = 4+2+1 = 7<br />\nothers= — = 0+0+0 = 0</p>\n<pre><code>chmod 770 filename\n</code></pre>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511213406298.png\" alt=\"image-20210511213406298\" /></p>\n<h4 id=\"423-文件内容查看\"><a class=\"anchor\" href=\"#423-文件内容查看\">#</a> 4.2.3、文件内容查看</h4>\n<p>我们会经常使用到文件查看！</p>\n<p>Linux 系统中使用以下命令来查看文件的内容：</p>\n<ul>\n<li>\n<p>cat 由第一行开始显示文件内容，用来读文章，或者读取配置文件啊，都使用 cat 命令</p>\n</li>\n<li>\n<p>tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511214200930.png\" alt=\"image-20210511214200930\" /></p>\n<ul>\n<li>nl 显示的时候，顺道输出行号！ 看代码的时候，希望显示行号！ 常用</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511214354825.png\" alt=\"image-20210511214354825\" /></p>\n<ul>\n<li>\n<p>more 一页一页的显示文件内容，带余下内容的（空格代表翻页，enter 代表向下看一行， :f 行号）</p>\n</li>\n<li>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511214600741.png\" alt=\"image-20210511214600741\" /></p>\n</li>\n<li>\n<p>less 与 more 类似，但是比 more 更好的是，他可以往前翻页！ （空格下翻页，pageDown，pageUp 键代表翻动页面！退出 q 命令，查找字符串 ：/ 要查询的字符向下查询，向上查询使用：？要查询的字符串，nN 继续搜寻下一个，n 向上寻找！）</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511215159933.png\" alt=\"image-20210511215159933\" /></p>\n<ul>\n<li>head 只看头几行 通过 -n 参数来控制显示几行！</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511214941992.png\" alt=\"image-20210511214941992\" /></p>\n<ul>\n<li>tail 只看尾巴几行 -n 参数 要查看几行！</li>\n</ul>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511215023267.png\" alt=\"image-20210511215023267\" /></p>\n<p>你可以使用 man [命令] 来查看各个命令的使用文档，如 ：man cp。</p>\n<p>网络配置目录：cd /etc/sysconfig/network-scripts</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511213842724.png\" alt=\"image-20210511213842724\" /></p>\n<p>ifconfig 命令查看网络配置！</p>\n<h4 id=\"424-linux-链接\"><a class=\"anchor\" href=\"#424-linux-链接\">#</a> 4.2.4、Linux 链接</h4>\n<p><strong>拓展：Linux 链接的概念（了解即可！）</strong></p>\n<p>Linux 的链接分为两种：硬链接、软链接！</p>\n<p>** 硬链接：**A—B，假设 B 是 A 的硬链接，那么他们两个指向了同一个文件！允许一个文件拥有多个路径，用户可以通过这种机制建立硬链接到一些重要文件上，防止误删！</p>\n<p><strong>软链接</strong>： 类似 Window 下的快捷方式，删除的源文件，快捷方式也访问不了！</p>\n<p><code>创建连接 ln 命令！</code></p>\n<p><code>touch</code>  命令创建文件！</p>\n<p><code>echo</code>  输入字符串，也可以输入到文件中！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch f1 # 创建一个 f1 文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>admin  f1  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln f1 f2 # 创建一个硬链接 f2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>admin  f1  f2  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln -s f1 f3 # 创建一个软连接 f3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>admin  f1  f2  f3  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>total <span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>drwx------ <span class=\"token number\">3</span> admin admin <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">16</span>:06 admin</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>-rw-r--r-- <span class=\"token number\">2</span> root  root     <span class=\"token number\">0</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:01 f1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-rw-r--r-- <span class=\"token number\">2</span> root  root     <span class=\"token number\">0</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:01 f2</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>lrwxrwxrwx <span class=\"token number\">1</span> root  root     <span class=\"token number\">2</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:02 f3 -<span class=\"token operator\">></span> f1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root  root  <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">18</span>:26 lloam</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root  root  <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">21</span>:11 lloamstudy2</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"i lova mao\" >>f1 #给 f1 文件中写入一些字符串</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>admin  f1  f2  f3  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># clear</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>total <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>drwx------ <span class=\"token number\">3</span> admin admin <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">16</span>:06 admin</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>-rw-r--r-- <span class=\"token number\">2</span> root  root    <span class=\"token number\">11</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:03 f1</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>-rw-r--r-- <span class=\"token number\">2</span> root  root    <span class=\"token number\">11</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:03 f2</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>lrwxrwxrwx <span class=\"token number\">1</span> root  root     <span class=\"token number\">2</span> May <span class=\"token number\">11</span> <span class=\"token number\">22</span>:02 f3 -<span class=\"token operator\">></span> f1</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root  root  <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">18</span>:26 lloam</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root  root  <span class=\"token number\">4096</span> May <span class=\"token number\">11</span> <span class=\"token number\">21</span>:11 lloamstudy2</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat f1 # 查看 f1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>i lova mao</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat f2 # 查看 f2</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>i lova mao</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat f3 # 查看 f3</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>i lova mao</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>删除 f1 之后，查看 f2 和 f3 的区别</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># rm -rf f1 # 删除 f1 文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>admin  f2  f3  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat f2 # f2 硬链接还在</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>i lova mao</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat f3 # f3 （软链接、符号链接）快捷方式</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cat: f3: No such <span class=\"token function\">file</span> or directory</pre></td></tr></table></figure><h3 id=\"43-vim-编辑器\"><a class=\"anchor\" href=\"#43-vim-编辑器\">#</a> 4.3、Vim 编辑器</h3>\n<h4 id=\"431-什么是vim编辑器\"><a class=\"anchor\" href=\"#431-什么是vim编辑器\">#</a> 4.3.1、什么是 Vim 编辑器</h4>\n<p>vim 通过一些插件可以实现和 IDE 一样的功能！</p>\n<p>Vim 是从 vi 发展出来的一个文本编辑器。代码补完、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。尤其是 Linux 中，必须要会使用 Vim（查看内容，编辑内容，保存内容！）</p>\n<p>简单的来说， vi 是老式的字处理器，不过功能已经很齐全了，但是还是有可以进步的地方。</p>\n<p>vim 则可以说是程序开发者的一项很好用的工具。</p>\n<p>所有的 Unix Like 系统都会内建 vi 文书编辑器，其他的文书编辑器则不一定会存在。</p>\n<p>连 vim 的官方网站 (<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy52aW0ub3Jn\">http://www.vim.org</span>) 自己也说 vim 是一个程序开发工具而不是文字处理软件。</p>\n<p>vim 键盘图：</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20210116092222874.png\" alt=\"linux图片\" /></p>\n<h4 id=\"432-三种使用模式\"><a class=\"anchor\" href=\"#432-三种使用模式\">#</a> 4.3.2、三种使用模式</h4>\n<p>基本上 vi/vim 共分为三种模式，分别是命令模式（Command mode），输入模式（Insert mode）和底线命令模式（Last line mode）。这三种模式的作用分别是：</p>\n<p><strong>命令模式：</strong></p>\n<p>用户刚刚启动 vi/vim，便进入了命令模式。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511222634174.png\" alt=\"image-20210511222634174\" /></p>\n<p>此状态下敲击键盘动作会被 Vim 识别为命令，而非输入字符。比如我们此时按下 i，并不会输入一个字符，i 被当作了一个命令。</p>\n<p>以下是常用的几个命令：</p>\n<ul>\n<li>i 切换到输入模式，以输入字符。</li>\n<li>x 删除当前光标所在处的字符。</li>\n<li>: 切换到底线命令模式，以在最底一行输入命令。 如果是编辑模式，需要先退出编辑模式！ESC<br />\n 若想要编辑文本：启动 Vim，进入了命令模式，按下 i，切换到输入模式。</li>\n</ul>\n<p>命令模式只有一些最基本的命令，因此仍要依靠底线命令模式输入更多命令。</p>\n<p>** 输入模式：** 在命令模式下按下 i 就进入了输入模式。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511221521627.png\" alt=\"image-20210511221521627\" /></p>\n<p>在输入模式中，可以使用以下按键：</p>\n<p>字符按键以及 Shift 组合，输入字符<br />\n ENTER，回车键，换行<br />\n BACK SPACE，退格键，删除光标前一个字符<br />\n DEL，删除键，删除光标后一个字符<br />\n方向键，在文本中移动光标<br />\n HOME/END，移动光标到行首 / 行尾<br />\n Page Up/Page Down，上 / 下翻页<br />\n Insert，切换光标为输入 / 替换模式，光标将变成竖线 / 下划线<br />\n ESC，退出输入模式，切换到命令模式<br />\n底线命令模式：在命令模式下按下:（英文冒号）就进入了底线命令模式。光标就移动到了最底下，就可以在这里输入一<br />\n些底线命令了！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20210116092848193.png\" alt=\"linux图片\" /></p>\n<p>底线命令模式可以输入单个或多个字符的命令，可用的命令非常多。</p>\n<p>在底线命令模式中，基本的命令有（已经省略了冒号）：wq</p>\n<p>q 退出程序<br />\n w 保存文件</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/20210116092910342.png\" alt=\"linux图片\" /></p>\n<p>按 ESC 键可随时退出底线命令模式。</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/image-20210511222258700.png\" alt=\"image-20210511222258700\" /></p>\n<p>简单的说，我们可以将这三个模式想成底下的图标来表示：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/linux/919f634aa944b04c0f7929b2ce475715.png\" alt=\"img\" /></p>\n<h4 id=\"433-完整的演示说明\"><a class=\"anchor\" href=\"#433-完整的演示说明\">#</a> 4.3.3、完整的演示说明</h4>\n<p>新建或者编辑文件，按  <code>i </code> 进入编辑模式，编写内容，编写完成后退出编辑模式， <code>esc</code> ，退出之后进入底线命令模式  <code>：</code>   <code>wq </code> 保存退出！</p>\n<h4 id=\"434-vim-按键说明\"><a class=\"anchor\" href=\"#434-vim-按键说明\">#</a> 4.3.4、Vim 按键说明</h4>\n<p>除了上面简易范例的 i, Esc, :wq 之外，其实 vim 还有非常多的按键可以使用。</p>\n<p><strong>第一部分：一般模式可用的光标移动、复制粘贴、搜索替换等</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">按键</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">h 或向左方向键 (←)</td>\n<td style=\"text-align:center\">游标向左移动一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">j 或向下方向键 (↓)</td>\n<td style=\"text-align:center\">游标向下移动一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">k 或向上方向键 (↑)</td>\n<td style=\"text-align:center\">游标向上移动一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">l 或向右方向键 (→)</td>\n<td style=\"text-align:center\">游标向右移动一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>[ctrl]+[f]</mark></td>\n<td style=\"text-align:center\">屏幕向下移动一页，相当于 [Page Down]<strong>（常用）</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>[ctrl]+[b]</mark></td>\n<td style=\"text-align:center\">屏幕向上移动一页，相当于 [Page Up]<strong>（常用）</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">[ctrl]+[d]</td>\n<td style=\"text-align:center\">屏幕向下移动半页</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">[ctrl]+[u]</td>\n<td style=\"text-align:center\">屏幕向上移动半页</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数字 +[Space]</td>\n<td style=\"text-align:center\">n 表示数字，按下数字后再按空格键，游标会向右移动到这一行的第 n 个字元。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能键 [Home] 或 0</td>\n<td style=\"text-align:center\">游标移动到这一行的第一个字元处</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>功能键 [End] 或 $</mark></td>\n<td style=\"text-align:center\">游标移动到这一行的最后一个字元处 <strong>（常用）</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">H</td>\n<td style=\"text-align:center\">游标移动到这个屏幕最上方那一行的第一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">M</td>\n<td style=\"text-align:center\">游标移动到这个屏幕中央那一行的第一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">L</td>\n<td style=\"text-align:center\">游标移动到这个屏幕最下方那一行的第一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>G</mark></td>\n<td style=\"text-align:center\">游标移动到这个档案的最后一行 <strong>（常用）</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nG</td>\n<td style=\"text-align:center\">n 为数字。游标移动到这个档案的第 n 行</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>gg</mark></td>\n<td style=\"text-align:center\">游标移动到这个档案的第一行 <strong>（常用）</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>数字 +[Enter]</mark></td>\n<td style=\"text-align:center\">n 为数字。游标向下移动 n 行 <strong>（常用）</strong></td>\n</tr>\n</tbody>\n</table>\n<p><code>替换搜索\t</code></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">替换搜索</th>\n<th style=\"text-align:center\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">/word</td>\n<td style=\"text-align:center\">向光标之下寻找一个名称为 word 的字符串。例如要在档案内搜寻 vbird 这个字符串，就输入 /vbird 即可！(常用)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">?word</td>\n<td style=\"text-align:center\">向光标之上寻找一个字符串名称为 word 的字符串。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">n</td>\n<td style=\"text-align:center\">这个 n 是英文按键。代表重复前一个搜寻的动作。举例来说， 如果刚刚我们执行 /vbird 去向下搜寻 vbird 这个字符串，则按下 n 后，会向下继续搜寻下一个名称为 vbird 的字符串。如果是执行？vbird 的话，那么按下 n 则会向上继续搜寻名称为 vbird 的字符串！</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">N</td>\n<td style=\"text-align:center\">这个 N 是英文按键。与 n 刚好相反，为『反向』进行前一个搜寻动作。例如 /vbird 后，按下 N 则表示『向上』搜寻 vbird 。</td>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td style=\"text-align:center\">按键</td>\n<td style=\"text-align:center\">说明</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">:------------:</td>\n<td style=\"text-align:center\">:----------------------------------------------------------:</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>[Del] 或 x</mark></td>\n<td style=\"text-align:center\">向后删除一个字元 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>X</mark></td>\n<td style=\"text-align:center\">向前删除一个字元 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nx</td>\n<td style=\"text-align:center\">n 为数字，连续向后删除 n 个字符。举例来说，我要连续删除 10 个字符， 『10x』。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>dd</mark></td>\n<td style=\"text-align:center\">删除游标所在的那一行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>ndd</mark></td>\n<td style=\"text-align:center\">n 为数字，删除游标所在的那一行往下数 的 n 个行，例如 20dd 则是删除 20 行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">d1G</td>\n<td style=\"text-align:center\">删除游标所在的那行到第一行的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">dG</td>\n<td style=\"text-align:center\">删除游标所在的那行到最后一行的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">d$</td>\n<td style=\"text-align:center\">删除游标所在处到该行的最后一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">d0</td>\n<td style=\"text-align:center\">是数字 0，删除游标所在处到该行的第一个字元</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>yy</mark></td>\n<td style=\"text-align:center\">复制游标所在的那一行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>nyy</mark></td>\n<td style=\"text-align:center\">n 为数字， 复制游标所在的那一行往下数 n 行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">y1G</td>\n<td style=\"text-align:center\">复制游标所在行到第一行的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">yG</td>\n<td style=\"text-align:center\">复制游标所在行到最后一行的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">y0</td>\n<td style=\"text-align:center\">复制游标所在的字元到该行行首的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">y$</td>\n<td style=\"text-align:center\">复制游标所在的字元到该行行尾的所有数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>p</mark></td>\n<td style=\"text-align:center\">将已复制的数据粘贴在游标所在的那一行的下一行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>P</mark></td>\n<td style=\"text-align:center\">将已复制的数据粘贴在游标所在的那一行的上一行，原来游标所在的那一行会被推后一行 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">J</td>\n<td style=\"text-align:center\">将游标所在的行与下一行的数据合并为一行</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>u</mark></td>\n<td style=\"text-align:center\">复原前一个动作 **（常用）**</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>[ctrl]+r</mark></td>\n<td style=\"text-align:center\">重做上一个被撤销的操作 （常用）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><mark>.</mark></td>\n<td style=\"text-align:center\">这是小数点，表示重复前一个操作 （常用）</td>\n</tr>\n</tbody>\n</table>\n<p><strong>第二部分：一般模式切换到编辑模式的可用的按钮说明</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">进入输入或取代的编辑模式</th>\n<th style=\"text-align:center\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">i, I</td>\n<td style=\"text-align:center\">进入输入模式 (Insert mode)：i 为『从目前光标所在处输入』， I 为『在目前所在行的第一个非空格符处开始输入』。(常用)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">a, A</td>\n<td style=\"text-align:center\">进入输入模式 (Insert mode)：a 为『从目前光标所在的下一个字符处开始输入』，A 为『从光标所在行的最后一个字符处开始输入』。(常用)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">o, O</td>\n<td style=\"text-align:center\">进入输入模式 (Insert mode)：这是英文字母 o 的大小写。o 为『在目前光标所在的下一行处输入新的一行』；O 为在目前光标所在处的上一行输入新的一行！(常用)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">r, R</td>\n<td style=\"text-align:center\">进入取代模式 (Replace mode)：r 只会取代光标所在的那一个字符一次；R 会一直取代光标所在的文字，直到按下 ESC 为止；(常用)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">[Esc]</td>\n<td style=\"text-align:center\">退出编辑模式，回到一般模式中 **(常用)**</td>\n</tr>\n</tbody>\n</table>\n<p><strong>第三部分：一般模式切换到指令行模式的可用的按钮说明</strong></p>\n<table>\n<thead>\n<tr>\n<th>按键</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><mark>:w</mark></td>\n<td>将编辑的文件写入硬盘 （常用）</td>\n</tr>\n<tr>\n<td>:w!</td>\n<td>若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入， 还是跟你对该档案的档案权限有关啊！</td>\n</tr>\n<tr>\n<td><mark>:q</mark></td>\n<td>离开 vi （常用）</td>\n</tr>\n<tr>\n<td>:q!</td>\n<td>若曾修改过档案，又不想储存，使用！为强制离开不储存档案。注意一下，那个惊叹号 (!) 在 vi 当中，常常具有『强制』的意思</td>\n</tr>\n<tr>\n<td><mark>:wq</mark></td>\n<td>文件写入硬盘后（即保存）离开 vi （常用）</td>\n</tr>\n<tr>\n<td>:wq!</td>\n<td>文件强制写入硬盘后（即保存）离开 vi</td>\n</tr>\n<tr>\n<td>ZZ</td>\n<td>大写字母 Z，如果文件没有修改，则直接离开；如果文件被修改，则保存后离开</td>\n</tr>\n<tr>\n<td>:w [filename]</td>\n<td>将当前文件另存为另一个文件，这个新文件的保存路径为当前路径</td>\n</tr>\n<tr>\n<td>:r [filename]</td>\n<td>在当前文件中读入另一个文件的数据，插入到当前游标所在列的后面</td>\n</tr>\n<tr>\n<td>:n1,n2 w [filename]</td>\n<td>将第 n1 行到第 n2 行的数据储存为新的文件</td>\n</tr>\n<tr>\n<td>:! command</td>\n<td>暂时离开 vi 到指令列模式下执行 command 的显示结果。例如『:! ls /home』即可在 vi 当中看 /home 底下以 ls 输出的档案信息！</td>\n</tr>\n<tr>\n<td><mark>:set nu</mark></td>\n<td>设置行号，代码中经常会使用！\t显示行号，设定之后，会在每一行的前缀显示该行的行号 &lt;br/&gt;:set nonu\t与 set nu 相反，为取消行号！</td>\n</tr>\n</tbody>\n</table>\n<p>以上标注的掌握熟练即可，其与的了解或者自己测一测即可，我们平时使用 VIM 最多的就是修改下文件内容而已！</p>\n<h3 id=\"44-账号管理\"><a class=\"anchor\" href=\"#44-账号管理\">#</a> 4.4、账号管理</h3>\n<p>你一般在公司中，用的应该都不是 root 账户！</p>\n<h4 id=\"441-简介\"><a class=\"anchor\" href=\"#441-简介\">#</a> 4.4.1、简介</h4>\n<p>Linux 系统是一个多用户多任务的分时操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。</p>\n<p>用户的账号一方面可以帮助系统管理员对使用系统的用户进行跟踪，并控制他们对系统资源的访问；另一方面也可以帮助用户组织文件，并为用户提供安全性保护。</p>\n<p>每个用户账号都拥有一个唯一的用户名和各自的口令。</p>\n<p>用户在登录时键入正确的用户名和口令后，就能够进入系统和自己的主目录。</p>\n<p>实现用户账号的管理，要完成的工作主要有如下几个方面：</p>\n<ul>\n<li>用户账号的添加、删除与修改。</li>\n<li>用户口令的管理。</li>\n<li>用户组的管理。</li>\n</ul>\n<h4 id=\"442-用户账号的管理\"><a class=\"anchor\" href=\"#442-用户账号的管理\">#</a> 4.4.2、用户账号的管理</h4>\n<p>用户账号的管理工作主要涉及到用户账号的添加、修改和删除。</p>\n<p>添加用户账号就是在系统中创建一个新账号，然后为新账号分配用户号、用户组、主目录和登录 Shell 等资源。</p>\n<p>属主，属组</p>\n<h4 id=\"443-添加用户useradd\"><a class=\"anchor\" href=\"#443-添加用户useradd\">#</a> 4.4.3、添加用户 useradd</h4>\n<p>useradd - 选项 用户名</p>\n<p>-m： 自动创建这个用户的主目录 /home/qinjiang</p>\n<p>-G : 给用户分配组！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>admin  lloam  lloamstudy2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -m mao # 创建一个用户！</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>admin  lloam  lloamstudy2  mao</pre></td></tr></table></figure><p>理解一下本质：Linux 中一切皆文件，这里的添加用户说白了就是往某一个文件中写入用户的信息了！</p>\n<p>/etc/passwd</p>\n<h4 id=\"444-删除用户-userdel\"><a class=\"anchor\" href=\"#444-删除用户-userdel\">#</a> 4.4.4、删除用户 userdel</h4>\n<p>userdel -r qinjiang 删除用户的时候将他的目录页一并删掉！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ /<span class=\"token punctuation\">]</span><span class=\"token comment\"># userdel -r mao # 删除用户</span></pre></td></tr></table></figure><h4 id=\"445-修改用户-usermod\"><a class=\"anchor\" href=\"#445-修改用户-usermod\">#</a> 4.4.5、修改用户 usermod</h4>\n<p>修改用户 usermod 对应修改的内容 修改那个用户</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@iZ2ze2gq6oy52j4ctfd39hZ home<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -d /home/233 mao</span></pre></td></tr></table></figure><p>修改完毕之后查看配置文件即可！</p>\n<h4 id=\"446-切换用户\"><a class=\"anchor\" href=\"#446-切换用户\">#</a> 4.4.6、切换用户</h4>\n<p>root 用户</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512202914464.png\" alt=\"image-20210512202914464\" /></p>\n<p>1. 切换用户的命令为：su username 【username 是你的用户名】</p>\n<p>2. 从普通用户切换到 root 用户，还可以使用命令：sudo su</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512203429156.png\" alt=\"image-20210512203429156\" /></p>\n<p>3. 在终端输入 exit 或 logout 或使用快捷方式 ctrl+d，可以退回到原来用户，其实 ctrl+d 也是执行的 exit 命令</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512203524441.png\" alt=\"image-20210512203524441\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam home<span class=\"token punctuation\">]</span><span class=\"token comment\"># su mao</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>mao@lloam home<span class=\"token punctuation\">]</span>$ <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@lloam home<span class=\"token punctuation\">]</span><span class=\"token comment\">#</span></pre></td></tr></table></figure><p>4. 在切换用户时，如果想在切换用户之后使用新用户的工作环境，可以在 su 和 username 之间加 - ，例如：【su - root】</p>\n<p>$ 表示普通用户<br />\n #表示超级用户，也就是 root 用户<br />\n有的小伙伴在阿里云买完服务器后，主机名是一个随机字符串！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512204127550.png\" alt=\"image-20210512204127550\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">hostname</span> mao <span class=\"token comment\"># 修改主机名</span></pre></td></tr></table></figure><h4 id=\"447-用户的密码设置\"><a class=\"anchor\" href=\"#447-用户的密码设置\">#</a> 4.4.7、用户的密码设置</h4>\n<p>我们一般通过 root 创建用户的时候！要配置密码！</p>\n<p>Linux 上输入密码是不会显示的，你正常输入就可以了，并不是系统的问题！</p>\n<p>在公司中，你们一般拿不到公司服务器的 root 权限，都是一些分配的账号！</p>\n<p>如果是超级用户的话：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">passwd</span> username：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>new password：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>re password：</pre></td></tr></table></figure><p>如果是普通用户：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span> UNIX password:   <span class=\"token comment\"># 输当前用用户密码</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>new password： <span class=\"token comment\"># 密码不能太过于简单！</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>re password：</pre></td></tr></table></figure><h4 id=\"448-锁定账户\"><a class=\"anchor\" href=\"#448-锁定账户\">#</a> 4.4.8、锁定账户</h4>\n<p>root，比如张三辞职了！冻结这个账号，一旦冻结，这个人就登录不上系统了！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">passwd</span> -l mao <span class=\"token comment\"># 锁定之后这个用户就不能登录了！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">passwd</span> -d mao <span class=\"token comment\"># 没有密码也不能登录！</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">passwd</span> -u mao <span class=\"token comment\"># 解锁用户</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512205338774.png\" alt=\"image-20210512205338774\" /></p>\n<p>在公司中，你一般触及不到 root 用户！作为一个开发一般你拿不到！</p>\n<p>这以上的基本命令，大家必须要掌握！但是自己玩的时候可以使用来学习！Linux 是一个多用户的系统！</p>\n<h3 id=\"45-用户组管理\"><a class=\"anchor\" href=\"#45-用户组管理\">#</a> 4.5、用户组管理</h3>\n<p>属主、属组</p>\n<p>每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理（开发、测试、运维、root）。不同 Linux 系统对用户组的规定有所不同，如 Linux 下的用户属于与它同名的用户组，这个用户组在创建用户时同时创建。</p>\n<p>用户组的管理涉及用户组的添加、删除和修改。<mark><strong>组的增加、删除和修改实际上就是对 /etc/group 文件的更新。</strong></mark></p>\n<h4 id=\"451-创建一个用户组\"><a class=\"anchor\" href=\"#451-创建一个用户组\">#</a> 4.5.1、创建一个用户组</h4>\n<p><strong>groupadd</strong></p>\n<p>创建完用户组后可以得到一个组的 id，这个 id 是可以指定的！ -g 520， 如果不指定就是自增 1</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512205957120.png\" alt=\"image-20210512205957120\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512210110724.png\" alt=\"image-20210512210110724\" /></p>\n<h4 id=\"452-删除用户组\"><a class=\"anchor\" href=\"#452-删除用户组\">#</a> 4.5.2、删除用户组</h4>\n<p><strong>groupdel</strong></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512210139750.png\" alt=\"image-20210512210139750\" /></p>\n<h4 id=\"453-修改用户组\"><a class=\"anchor\" href=\"#453-修改用户组\">#</a> 4.5.3、修改用户组</h4>\n<p><strong>修改用户组的权限信息和名字 groupmod -g -n</strong></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512210418618.png\" alt=\"image-20210512210418618\" /></p>\n<h4 id=\"454-切换用户组\"><a class=\"anchor\" href=\"#454-切换用户组\">#</a> 4.5.4、切换用户组</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 登录当前用户 qinjiang</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ newgrp root</pre></td></tr></table></figure><h3 id=\"455-文件的查看了解即可\"><a class=\"anchor\" href=\"#455-文件的查看了解即可\">#</a> 4.5.5、文件的查看 (了解即可)</h3>\n<blockquote>\n<p>/etc/passwd</p>\n</blockquote>\n<pre><code>用户名:口令(登录密码，我们不可见):用户标识号:组标识号:注释性描述:主目录:登录Shell\n这个文件中的每一行都代表这一个用户，我们可以从这里看出这个用户的主目录在哪里，可以看到属于哪一个组！\n</code></pre>\n<p>登录口令：把真正的加密后的用户口令字存放到 **/etc/shadow** 文件中，保证我们密码的安全性！</p>\n<p>用户组的所有信息都存放在 **/etc/group** 文件中。</p>\n<h3 id=\"46-磁盘管理\"><a class=\"anchor\" href=\"#46-磁盘管理\">#</a> 4.6、磁盘管理</h3>\n<h4 id=\"461-磁盘空间使用量\"><a class=\"anchor\" href=\"#461-磁盘空间使用量\">#</a> 4.6.1、磁盘空间使用量</h4>\n<p>df （列出文件系统整体的磁盘使用量） du（检查磁盘空间使用量！）</p>\n<p>df<br />\ndf -h</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512211651914.png\" alt=\"image-20210512211651914\" /></p>\n<p>du<br />\ndu -a 查看隐藏文件</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512211901487.png\" alt=\"image-20210512211901487\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512212043117.png\" alt=\"image-20210512212043117\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512212222431.png\" alt=\"image-20210512212222431\" /></p>\n<h4 id=\"462-挂载磁盘或文件\"><a class=\"anchor\" href=\"#462-挂载磁盘或文件\">#</a> 4.6.2、挂载磁盘或文件</h4>\n<p>Mac 或者想使用 Linux 挂载我们的一些本地磁盘或者文件！</p>\n<p>挂载：mount</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512212628693.png\" alt=\"image-20210512212628693\" /></p>\n<p>卸载：umount -f [挂载位置] 强制卸载</p>\n<p>除了这个之外，以后我们安装了 JDK ，其实可以使用 java 中的一些命令来查看信息！</p>\n<h3 id=\"47-进程管理\"><a class=\"anchor\" href=\"#47-进程管理\">#</a> 4.7、进程管理</h3>\n<p>Linux 中一切皆文件</p>\n<p>（文件：读写执行（查看，创建，删除，移动，复制，编辑），权限（用户、用户组）。系统：（磁盘，进程））</p>\n<p>对于我们开发人员来说，其实 Linux 更多偏向于使用即可！</p>\n<h4 id=\"471-基本概念\"><a class=\"anchor\" href=\"#471-基本概念\">#</a> 4.7.1、基本概念</h4>\n<p>1、在 Linux 中，每一个程序都是有自己的一个进程，每一个进程都有一个 id 号！<br />\n2、每一个进程呢，都会有一个父进程！<br />\n3、进程可以有两种存在方式：前台！后台运行！<br />\n4、一般的话服务都是后台运行的，基本的程序都是前台运行的！</p>\n<h4 id=\"472-命令\"><a class=\"anchor\" href=\"#472-命令\">#</a> 4.7.2、命令</h4>\n<p><strong>ps</strong> 查看当前系统中正在执行的各种进程的信息！</p>\n<p>ps -xx ：</p>\n<ul>\n<li>-a 显示当前终端运行的所有的进程信息（当前的进程一个）</li>\n<li>-u 以用户的信息显示进程</li>\n<li>-x 显示后台运行进程的参数！</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> -aux <span class=\"token comment\"># 查看所有的进程</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ps</span> -aux<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mysql</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># | 在 Linux 这个叫做管道符 A|B</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">grep</span> <span class=\"token comment\"># 查找文件中符合条件的字符串！</span></pre></td></tr></table></figure><p>对于我们来说，这里目前只需要记住一个命令即可 ps -xx|grep 进程名字！ 过滤进程信息！</p>\n<p>ps -ef：可以查看到父进程的信息</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> mysql <span class=\"token comment\"># 看父进程我们一般可以通过目录树结构来查看！</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 进程树！</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pstree -pu</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-p <span class=\"token comment\">#　显示父 id</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-u <span class=\"token comment\"># 显示用户组</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/20210116144718583.png\" alt=\"linux图片\" /></p>\n<p>结束进程：杀掉进程，等价于 window 结束任务！</p>\n<p>kill -9 进程的 id</p>\n<p>但是啊，我们平时写的一个 Java 代码死循环了，可以选择结束进程！杀进程</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">kill</span> -9 <span class=\"token comment\"># 进程的 id</span></pre></td></tr></table></figure><p>表示强制结束该进程！</p>\n<p>将 Java 程序打包发布的时候讲解！  <code>nohup</code>  ，代表后台执行程序</p>\n<h2 id=\"5-环境安装\"><a class=\"anchor\" href=\"#5-环境安装\">#</a> 5、环境安装</h2>\n<p>安装软件一般有三种方式：</p>\n<ul>\n<li>rpm（Jdk：在线发布一个 SringBoot 项目！）\\</li>\n<li>解压缩（tomcat，启动并通过外网访问，发布网站）</li>\n<li>yum 在线安装（docker：直接安装运行跑起来 docker 就可以！）！</li>\n</ul>\n<h3 id=\"51-jdk安装\"><a class=\"anchor\" href=\"#51-jdk安装\">#</a> 5.1、JDK 安装</h3>\n<p>我们开发 java 程序必须要的环境！<br />\n1、下载 JDK rpm。去 oralce 官网下载即可！<br />\n2、安装 java 环境</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 检测当前系统是否存在 java 环境！ java -version</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 如果有的话就需要卸载</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># rpm -qa|grep jdk # 检测 JDK 版本信息</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># rpm -e --nodeps jdk_</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 卸载完毕后即可安装 jdk</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># rpm -ivh rpm 包  安装 jdk</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 配置环境变量！</span></pre></td></tr></table></figure><p>如果存在可以提前卸载：<br />\n<img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512221347331.png\" alt=\"image-20210512221347331\" /></p>\n<p>安装：</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210512221048774.png\" alt=\"\" /></p>\n<p>配置环境变量： <code> /etc/profile</code>  在文件的最后面增加 java 的配置和 window 安装环境变量一样！</p>\n<p><mark><strong>使用 rpm 安装的 jdk 使不需要配置环境变量的，自动就帮我们配置好了</strong></mark></p>\n<pre><code>JAVA_HOME=/usr/java/jdk1.8.0_221-amd64\nCLASSPATH=%JAVA_HOME%/lib;%JAVA_HOME%/jre/lib\nPATH=$JAVA_HOME/bin;$JAVA_HOME/jre/bin\nexport PATH CLASSPATH JAVA_HOME\n</code></pre>\n<p>让这个配置文件生效！ source /etc/profile 我们来发布一个项目试试！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 开启防火墙端口</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>firewall-cmd --zone<span class=\"token operator\">=</span>public --add-port<span class=\"token operator\">=</span><span class=\"token number\">9000</span>/tcp --permanent</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 重启防火墙</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>systemctl restart firewalld.service</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 查看所有开启的端口，如果是阿里云，需要配置安全组规则！</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>firewall-cmd --list-ports</pre></td></tr></table></figure><h3 id=\"52-tomcat-安装\"><a class=\"anchor\" href=\"#52-tomcat-安装\">#</a> 5.2、Tomcat 安装</h3>\n<p>ssm war 就需要放到 tomcat 中运行！</p>\n<p>1、下载 tomcat。官网下载即可  <code>apache-tomcat-9.0.45.tar.gz </code></p>\n<p>2、解压这个文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> -zxvf apache-tomcat-9.0.22.tar.gz</pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513203918974.png\" alt=\"image-20210513203918974\" /></p>\n<p>3、启动 tomcat 测试！ ./xxx.sh 脚本即可运行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 执行 ./startup.sh</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 停止 ./shotdown.sh</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513204217333.png\" alt=\"image-20210513204217333\" /></p>\n<p><mark>如果防火墙 8080 端口开了并且阿里云安全组也开放了这个时候就可以直接访问远程了！</mark></p>\n<p>我买的是轻量级服务器，只需要开启防火墙 8080 端口就可以访问了</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513205513219.png\" alt=\"image-20210513205513219\" /></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看 firewall 服务状态</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl status firewalld</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 开启、重启、关闭、firewalld.service 服务</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 开启</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">service</span> firewalld start</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 重启</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">service</span> firewalld restart</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 关闭</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">service</span> firewalld stop</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 查看防火墙规则</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>firewall-cmd --list-all <span class=\"token comment\"># 查看全部信息</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>firewall-cmd --list-ports <span class=\"token comment\"># 只看端口信息</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># 开启端口</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>开端口命令：firewall-cmd --zone<span class=\"token operator\">=</span>public --add-port<span class=\"token operator\">=</span><span class=\"token number\">8080</span>/tcp --permanent</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>重启防火墙：systemctl restart firewalld.service</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>命令含义：</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>--zone <span class=\"token comment\">#作用域</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>--add-port<span class=\"token operator\">=</span><span class=\"token number\">80</span>/tcp <span class=\"token comment\">#添加端口，格式为：端口 / 通讯协议</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>--permanent <span class=\"token comment\">#永久生效，没有此参数重启后失效</span></pre></td></tr></table></figure><p>上传完毕的项目直接购买自己的域名，备案解析过去即可！1 年级都会做！</p>\n<p>域名解析后，如果端口是 80 - http 或者 443-https 可以直接访问，如果是 9000 8080，就需要通过 Apcahe 或者 Nginx 做一下反向代理即可，配置文件即可，十分之简单，大家如果想要上线自己的网站，到目前为止，那么你可以如愿以偿了！</p>\n<h3 id=\"53-dockeryum安装\"><a class=\"anchor\" href=\"#53-dockeryum安装\">#</a> 5.3、Docker（yum 安装）</h3>\n<p>联网的情况下 yum install -y yum 源</p>\n<p>官网安装参考手册：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvY2VudG9zLw==\">https://docs.docker.com/install/linux/docker-ce/centos/</span></p>\n<p>我们现在是在 Linux 下执行，一定要联网 ，yum 在线安装！</p>\n<p>将心比心！为什么要做这些事情的一个思想！</p>\n<blockquote>\n<p>安装</p>\n</blockquote>\n<p>1、检测 CentOS 7</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@mao bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/redhat-release</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CentOS Linux release <span class=\"token number\">7.6</span>.1810 <span class=\"token punctuation\">(</span>Core<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>2、安装我们的准备环境</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum -y <span class=\"token function\">install</span> 包名 <span class=\"token comment\"># yum install 安装命令 -y 所有的提示都为 y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum -y <span class=\"token function\">install</span> gcc</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>yum -y <span class=\"token function\">install</span> gcc-c++</pre></td></tr></table></figure><p>3、清楚以前的版本！后面根据官网安装即可，我就不在这里写了！</p>\n<h3 id=\"54-宝塔面板懒人式安装\"><a class=\"anchor\" href=\"#54-宝塔面板懒人式安装\">#</a> 5.4、宝塔面板（懒人式安装）</h3>\n<p>具体的教程 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMTc3NDExSzdiSA==\">https://www.bilibili.com/video/BV177411K7bH</span></p>\n<h2 id=\"6-扩展vmware使用\"><a class=\"anchor\" href=\"#6-扩展vmware使用\">#</a> 6、扩展：Vmware 使用</h2>\n<p>很多小伙伴，比较吝啬，买不起 70 一年的服务器 ！ Vmware 本地安装包！</p>\n<h3 id=\"61-快照\"><a class=\"anchor\" href=\"#61-快照\">#</a> 6.1、快照</h3>\n<p>保留当前系统信息为快照，随时可以恢复，以防未来系统被你玩坏，就好比游戏中的归档！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513213152600.png\" alt=\"image-20210513213152600\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/20210116174016866.png\" alt=\"linux图片\" /></p>\n<p>平时的话，我们每配置一个东西就可以拍摄一个快照，保留信息！</p>\n<h3 id=\"62-本地网络配置\"><a class=\"anchor\" href=\"#62-本地网络配置\">#</a> 6.2、本地网络配置</h3>\n<p>大一学的计算机网络原理中有！</p>\n<p>需要保证 Linux 虚拟机和本机处在同一个网段！</p>\n<p>windows</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513213510841.png\" alt=\"image-20210513213510841\" /></p>\n<p>Linux 也必须要配置到 对应的网段 10.102.0.110</p>\n<p>/etc/sysconfig/network-scripts/</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513214004656.png\" alt=\"image-20210513214004656\" /></p>\n<p>桥接模式 : 192.168.0.110 192.168.0. 160</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/image-20210513214149021.png\" alt=\"image-20210513214149021\" /></p>\n<p>一定要桥接到正确的网卡即可！<br />\n静态的话就需要配置 IP 地址，IPADDR=192.168.0.110，以下是静态的网络配置，这两种方式，都可以让虚拟机连接外网从而实现网络开发！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/20210116174200326.png\" alt=\"linux图片\" /></p>\n<p>傻瓜式配置，只能在图形界面下有效！</p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/20210116174215692.png\" alt=\"linux图片\" /></p>\n<p><img data-src=\"https://gitee.com/lloamhh/spring-img/raw/master/img/mybatis/20210116174222994.png\" alt=\"linux图片\" /></p>\n<p>配置完毕即可上网！</p>\n<h2 id=\"操作图文教程\"><a class=\"anchor\" href=\"#操作图文教程\">#</a> 操作图文教程</h2>\n<p>Ubuntu 系统提示用户不在 sudoers 文件中，此事将被报告。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGludXhydW1lbi5jb20vcm14eC8xODIyLmh0bWw=\">https://www.linuxrumen.com/rmxx/1822.html</span></p>\n<p>linux vim 如何保存退出</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aGlkYW8uYmFpZHUuY29tL3F1ZXN0aW9uLzU4NDMxNjUzNi5odG1s\">https://zhidao.baidu.com/question/584316536.html</span></p>\n<p>管理员和普通用户</p>\n<p>管理员#</p>\n<p>普通用户 $</p>\n<p>命令：su  然后输入密码</p>\n",
            "tags": [
                "计算机学习",
                "运维",
                "linux",
                "linux"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/",
            "title": "Git协同与提交规范",
            "date_published": "2021-04-01T00:40:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"1前言\"><a class=\"anchor\" href=\"#1前言\">#</a> 1. 前言</h2>\n<p>在现代化的软件开发中，尤其是在企业中的团队协同开发流程与代码管理方面，git 都充当着不可或缺的角色。本章中将会讲述如何使用 git 来进行一些基本的版本控制操作与团队协同中的 git 使用流程管理与提交规范。</p>\n<p>在 Git 快速上手章节中你将会了解 git 的基本概念与一些常用命令，能让你快速上手或复习 git 的基本操作。</p>\n<p>在 Git 多人合作基本模型中，你将会了解到 git 的团队基本工作模型。</p>\n<p>Git 工作流与分支管理规范是对于在企业级中 git 的团队协同流程的介绍与规范的讲解，你会学到团队开发中 git 在软件开发生命周期中的角色。</p>\n<p>Git 提交规范总结了在 git 使用过程中对于代码记录的提交信息的规范要求。</p>\n<h2 id=\"2-git-快速上手\"><a class=\"anchor\" href=\"#2-git-快速上手\">#</a> 2. Git 快速上手</h2>\n<h3 id=\"21-git-的简单介绍\"><a class=\"anchor\" href=\"#21-git-的简单介绍\">#</a> 2.1 Git 的简单介绍</h3>\n<p>Git 是一个用于控制管理代码历史版本的工具，区别于集中式的 SVN，Git 使用了分布式的管理方式。</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/845.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/845.png\" class=\"\"></p>\n<p>团队每人都拥有一个自己的本地仓库，不仅可以自己本地进行版本管理，也可以将代码版本在各个成员间共享.</p>\n<h3 id=\"22-初始化一个本地仓库\"><a class=\"anchor\" href=\"#22-初始化一个本地仓库\">#</a> 2.2 初始化一个本地仓库</h3>\n<p>在开始操作之前，确保你的系统环境已经安装了 Git， <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXQtc2NtLmNvbQ==\">https://git-scm.com</span> 上提供了各个系统环境的 Git 下载。</p>\n<p>在使用 git 命令进行操作之前，你需要一个 git 仓库，你可以移动到你的工作目录，命令行中执行:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> init</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Initialized empty Git repository <span class=\"token keyword\">in</span> /path/to/work/directory/.git/</pre></td></tr></table></figure><p>这样你就可以得到一个本地仓库了，你会看到工作目录下已经新增了一个 <em>.git</em> 目录。</p>\n<p><em>注：某些系统中可能预设隐藏以。开头的文件夹，可能需要开启相关设置才能看到</em></p>\n<h3 id=\"23-克隆远程仓库\"><a class=\"anchor\" href=\"#23-克隆远程仓库\">#</a> 2.3 克隆远程仓库</h3>\n<p>当然如果你已经有了一个远程仓库，你就不需要初始化一个本地仓库了，你可以使用：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clone <span class=\"token operator\">&lt;</span>remote address<span class=\"token operator\">></span></pre></td></tr></table></figure><p>上面的命令会将链接指向的远程仓库克隆到本地，这样你也得到了一个 <em>git</em> 仓库，并且这个仓库是与远程仓库关联的，如果你有远程仓库的权限，你就可以对这个仓库推送你的提交。</p>\n<h3 id=\"24-查看仓库状态\"><a class=\"anchor\" href=\"#24-查看仓库状态\">#</a> 2.4 查看仓库状态</h3>\n<p>上面我们已经初始化了一个空仓库，我们可以通过指令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> status</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>On branch master</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>No commits yet</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>nothing to commit <span class=\"token punctuation\">(</span>create/copy files and use <span class=\"token string\">\"git add\"</span> to track<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>通过 <em>git status</em> 查看当前的仓库 (或代码分支) 的状态。</p>\n<h3 id=\"25-追踪文件修改\"><a class=\"anchor\" href=\"#25-追踪文件修改\">#</a> 2.5 追踪文件修改</h3>\n<p>接下来我们可以为这个仓库添加一些文件，在工作目录下执行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">touch</span> index.js</pre></td></tr></table></figure><p>上面的指令为我们在工作目录下创建一个名为 index.js 的文件，使用 git status 可以查看到已经添加了一个 index.js 文件，下面我们在这个文件中写入一些内容：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"console.log('learning git!');\"</span> <span class=\"token operator\">></span> index.js</pre></td></tr></table></figure><p>上面这条指令为我们将 <em>&quot;console.log('learning git!')&quot;</em> 这个内容写入了 <em>index.js</em> 文件中。此时查看仓库状态如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> status</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>On branch master</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>No commits yet</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Untracked files:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">(</span>use <span class=\"token string\">\"git add &lt;file>...\"</span> to include <span class=\"token keyword\">in</span> what will be commited<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        index.js</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>nothing added to commit but untracked files present<span class=\"token punctuation\">(</span>use <span class=\"token string\">\"git add\"</span> to track<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>可以看到信息反馈说到 index.js 这个文件是未追踪的 (<em>Untracked files</em>), 而在 git 中，如果一个文件需要 git 进行版本控制与内容修改追踪，那么就需要先将它加入到 git 仓库的暂存区 (<em>stage</em>) 中。将文件加入到暂存区只需要执行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">add</span> index.js</pre></td></tr></table></figure><p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/846.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/846.png\" class=\"\"></p>\n<p>相信很多人在使用 git 添加修改或者新增文件的时候，会习惯直接使用</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>直接将当前目录下的修改的全部文件添加到暂存区 (<em>stage</em>), 一般情况下，这样的方式既方便又快捷，但是我仍然推荐在执行 <em>git add</em> 先使用 <em>git status</em> 命令来查看一下仓库有哪些文件被修改了，这样是因为如果你的仓库中使用了 git 的子模块功能，直接 <em>git add .</em> 会将子模块的 commit ID 也一并添加到暂存区，万一这个 commit ID 的提交并不是你的本意，那么提交到远程可能会导致子模块错乱的问题。</p>\n<p>为了养成良好习惯，最好在 <em>git add</em> 前使用 <em>git status</em> 查看一下仓库状态。</p>\n<h3 id=\"26-提交文件修改的历史信息\"><a class=\"anchor\" href=\"#26-提交文件修改的历史信息\">#</a> 2.6 提交文件修改的历史信息</h3>\n<p>通过 git add 我们已经将对文件的操作 (新增或修改，删除等) 添加到了暂存区 (<em>stage</em>) 中，但是这样是不够的，我们还需要对这个操作记录成一个历史记录：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> commit -m <span class=\"token string\">\"Add a file named index.js\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>master <span class=\"token punctuation\">(</span>root-commit<span class=\"token punctuation\">)</span> 910f65f<span class=\"token punctuation\">]</span> Add a <span class=\"token function\">file</span> named index.js</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token function\">file</span> changed, <span class=\"token number\">1</span> insertion<span class=\"token punctuation\">(</span>+<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>create mode <span class=\"token number\">100644</span> index.js</pre></td></tr></table></figure><p>这样我们对文件的操作生成一条历史记录，历史记录可以通过 <em>git log</em> 进行查看。不加 -m 参数直接 commit 的提交信息会默认使用 vim 编辑器进行编辑 (对于 vim 编辑器的操作介绍请看后面章节)。对于 commit 记录，原则上我们应该每个 commit 所记录的修改保持纯洁与单一，不允许比如对两个 bug 的修复都提交到一个 commit 中的情况，这样一旦 bug A 的修复会导致另一个问题，但是 bug B 的修复是没有问题的，此时如果回退该 commit，虽然回退了 bug A 的提交，但是也丢失 bug B 的修复工作了。</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/847.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/847.png\" class=\"\"></p>\n<p><em>注：笔者不推荐 commit -m 的操作，因为这不符合提交规范，这里是为了简短说明 commit 的使用，详情请看后面章节</em></p>\n<h4 id=\"261-vim-编辑器的简单介绍\"><a class=\"anchor\" href=\"#261-vim-编辑器的简单介绍\">#</a> 2.6.1 Vim 编辑器的简单介绍</h4>\n<p>使用 git commit 命令会默认使用 vim 编辑器进行提交信息的编写，同时笔者不推荐使用 git commit -m 的方式来提交信息，因为这样编写出来的提交信息不符合规范，只能说明一些简短信息或者甚至直接为空，尤其是空信息是不被允许的。所以这里会简单介绍 vim 的基本用法，有兴趣的读者可以搜索相关 vim 的学习资料进行深入学习。</p>\n<p>当你使用 add 命令将对于文件的修改添加到缓存区后，你可以使用输入 git commit 然后直接回车，然后你会进入到 vim 编辑器的界面，你会在界面上看到类似下面的信息：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Please enter the commit message for your changes. Lines starting</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># with '#' will be ignored, and an empty message aborts the commit.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Committer: shawn &lt;zhangxiang@zhangxiangdeMacBook-Pro.local></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># On branch master</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># Changes to be committed:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#       modified:   index.js</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>~</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>~</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\"~/path/to/working/directory/git-learning/.git/COMMIT_EDITMSG\"</span> 10L, 274C</pre></td></tr></table></figure><p>以 <em>#</em> 开头的信息是注释，不用担心他们会添加到你的提交信息中，而且如果你没有填写信息就直接退出则该 commit 会被中断。</p>\n<h5 id=\"插入模式\"><a class=\"anchor\" href=\"#插入模式\">#</a> 插入模式</h5>\n<p>接下来，当你需要填写数据的时候，你需要按下 &quot;i&quot; 键进入插入模式，进入插入模式之后才能进行文本的插入与编写，然后就可以类似在一般的编辑器下编写你想填写的信息。</p>\n<p>而当你编写完信息后，你需要先退出插入模式而回到原来的普通模式，退出插入模式你只需要按下 &quot;esc&quot; 键。</p>\n<h5 id=\"命令模式\"><a class=\"anchor\" href=\"#命令模式\">#</a> 命令模式</h5>\n<p>当你想退出 vim 编辑器的时候，我们需要进入命令模式，在普通模式下输入 <strong>:</strong> ， 进入命令模式，输入 <em>wq</em> 回车，就可以保存并退出编辑了，下面提供一些常用的命令供大家参考：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>:q   退出</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>:q<span class=\"token operator\">!</span>  强制退出，不进行保存</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>:wq  保存并退出</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>:wq<span class=\"token operator\">!</span> 强制保存并退出</pre></td></tr></table></figure><h3 id=\"27-使用分支\"><a class=\"anchor\" href=\"#27-使用分支\">#</a> 2.7 使用分支</h3>\n<p>分支功能是 git 最为强大的功能之一，它能够让你并发地在多个场景下进行开发。并且可以让你同时开发不同功能而不冲突，用于区分功能或版本。</p>\n<p>在企业里面，有规模的开发团队在开发功能的时候是不可能大家都在一个分支上开发的，因为这可能需要不断地解决冲突，此外功能与功能间通常相互独立，在同一个分支上开发本就不合理。</p>\n<p>你可以执行下面这个命令来创建一个分支：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> branch <span class=\"token operator\">&lt;</span>branch-name<span class=\"token operator\">></span></pre></td></tr></table></figure><p>例如你执行 <em>git branch test</em> 这条命令创建了一条分支，实际上你是创建了一个指向该 commit 节点的名为 test 的指针：</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/848.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/848.png\" class=\"\"></p>\n<h3 id=\"28-在不同场景间切换\"><a class=\"anchor\" href=\"#28-在不同场景间切换\">#</a> 2.8 在不同场景间切换</h3>\n<p>在日常开发的时候，我们可能经常会需要切换到不同的开发场景，比如你正在一个功能分支上开发，但是产品经理或者测试忽然需要你在线上环境看一个问题，所以你需要将你目前的代码切换到线上环境的代码，当你需要切换分支的时候，可以：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> checkout <span class=\"token operator\">&lt;</span>branch-name<span class=\"token operator\">>|</span><span class=\"token operator\">&lt;</span>tag<span class=\"token operator\">>|</span><span class=\"token operator\">&lt;</span>commit <span class=\"token builtin class-name\">hash</span> id<span class=\"token operator\">></span></pre></td></tr></table></figure><p>上面只是 git checkout 的使用场景之一，checkout 不仅可以切换分支，还可以切换 tag，或者 commit hash id 等环境的代码。比如你需要切换到上面创建的 test 分支，那么你需要执行 <em>git checkout test</em> 这条指令，在 git 中是使用 Head 指针来指向当前提交记录的，而 checkout 命令实际上是将 git 的 head 指针指向了 test 这一指针：</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/849.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/849.png\" class=\"\"></p>\n<p>那么现在的当前工作分支就是 test 分支了。这里就会明白，实际上 checkout 命令的本质就是移动 git 的 Head 指针。</p>\n<p>当然，直接 checkout 可能会不能顺利切换过去，因为你的工作区内对于某些文件的修改没有提交，会 git 阻止你进行分支切换，提醒你先对文件的修改进行 commit 提交，相关的 commit 提交操作像上面的章节一样操作就可以，但是如果你因为一些其他原因不希望进行 commit 比如这部分的修改不满足一个 commit 或者这些是实验性的代码，所以你可以将当前的工作区修改进行 &quot;储藏&quot;：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> stash</pre></td></tr></table></figure><p>git stash 命令可以为你保存起目前的代码，并将这些修改压入到一个栈中，换言之你可以多次进行 stash。</p>\n<p>然后当你解决了问题，想回到原来的工作代码环境，你只需要切换到原来的分支上，进行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> stash pop</pre></td></tr></table></figure><p>这里会默认拿栈顶的代码 (也就是最近一次 stash 的代码) 修改记录并将其反映到你的工作区中。</p>\n<h2 id=\"3-git-多人合作基本模型\"><a class=\"anchor\" href=\"#3-git-多人合作基本模型\">#</a> 3. Git 多人合作基本模型</h2>\n<p>在实际的软件研发过程中，团队作战的场景远远多于单兵作战，所以仅仅是掌握上面章节对于自己本地仓库进行操作的 git 指令是不够的，我们会需要一个远程的集中式仓库。所谓集中式仓库就是团队中所有人的代码都上传到这个地方进行存储，有了集中式的仓库，可以方便地进行成果共享与协作。</p>\n<h3 id=\"31-添加远程仓库地址\"><a class=\"anchor\" href=\"#31-添加远程仓库地址\">#</a> 3.1 添加远程仓库地址</h3>\n<p>如果你已经使用 <em>git init</em> 初始化了一个 git 仓库，并且你想要将你的工作成果放到一个远程仓库上，为可能的多人协作做准备的话，你需要为你的本地仓库添加远程连接，也即是说将你本地仓库的历史库放到一个远程服务器的仓库中保存里面：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> remote <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>name<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>remote address<span class=\"token operator\">></span></pre></td></tr></table></figure><p>使用 <em>git remote add</em> 命令为本地仓库添加一个远程仓库的地址，地址可以是 <em>http/https</em> 格式的也可以是 <em>ssh</em> 格式的。而 name 是指这个远程仓库链接名称，比如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin https://github.com/username/example</pre></td></tr></table></figure><p>当然，如果你的仓库是通过 <em>git clone</em> 克隆下来的，你可以不需要添加一个远程仓库链接。</p>\n<h3 id=\"32-将本地修改推送到远程仓库\"><a class=\"anchor\" href=\"#32-将本地修改推送到远程仓库\">#</a> 3.2 将本地修改推送到远程仓库</h3>\n<p>当你有若干个 <em>commit</em> 提交记录需要更新到远程仓库，在执行了 <em>commit</em> 命令后，使用：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> push origin master</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Counting objects: <span class=\"token number\">3</span>, done.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Writing objects: <span class=\"token number\">100</span>% <span class=\"token punctuation\">(</span><span class=\"token number\">3</span>/3<span class=\"token punctuation\">)</span>, <span class=\"token number\">274</span> bytes <span class=\"token operator\">|</span> <span class=\"token number\">274.00</span> KiB/s, done.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Total <span class=\"token number\">3</span> <span class=\"token punctuation\">(</span>delta <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>, reused <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span>delta <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>To https://github.com/username/example.git</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * <span class=\"token punctuation\">[</span>new branch<span class=\"token punctuation\">]</span>      master -<span class=\"token operator\">></span> master</pre></td></tr></table></figure><p>这样就可以将你本地的 <em>commit</em> 提交传送到远程仓库中进行共享。注意第一个推送修改的时候需要指定远程连接的名称 (这里是 origin, 即上一步添加远程仓库地址的名称), 并指定推送的分支名 (这里是 master 分支)。</p>\n<h3 id=\"33-拉取并合并他人修改\"><a class=\"anchor\" href=\"#33-拉取并合并他人修改\">#</a> 3.3 拉取并合并他人修改</h3>\n<p>当团队其他成员对该分支上的代码进行了修改并且已经 <em>push</em> 到远程仓库后，你可以将他的提交拉取到本地并且将他的提交进行合并自己本地仓库上，通过：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>There is no tracking information <span class=\"token keyword\">for</span> the current branch.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Please specify <span class=\"token function\">which</span> branch you want to merge with.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>See git-pull<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> details.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">git</span> pull <span class=\"token operator\">&lt;</span>remote<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>branch<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>If you wish to <span class=\"token builtin class-name\">set</span> tracking information <span class=\"token keyword\">for</span> this branch you can <span class=\"token keyword\">do</span> so with:</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token function\">git</span> branch --set-upstream-to<span class=\"token operator\">=</span>origin/<span class=\"token operator\">&lt;</span>branch<span class=\"token operator\">></span> master</pre></td></tr></table></figure><p>第一次拉取远程仓库的修改的时候，会出现像上面 <em>&quot;There is no tracking information for the current branch&quot;</em> 的错误，这是因为本地分支与远程分支没有建立起关联关系，所以我们需要通过以下两种方式来达到目的:</p>\n<p>1. 通过执行 <em>pull</em> 命令的时候指定分支</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> pull origin master</pre></td></tr></table></figure><p>2. 通过执行 <em>branch</em> 命令建立本地分支与远程分支的关联关系后再次执行 <em>pull</em> 命令</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">git</span> branch --set-upstream-to<span class=\"token operator\">=</span>origin/master</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Branch <span class=\"token string\">'master'</span> <span class=\"token builtin class-name\">set</span> up to track remote branch <span class=\"token string\">'master'</span> from <span class=\"token string\">'origin'</span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>$ <span class=\"token function\">git</span> pull</pre></td></tr></table></figure><p>这样，你本地仓库就会出现其他人提交的代码修改了。</p>\n<h3 id=\"34-协作基本模型\"><a class=\"anchor\" href=\"#34-协作基本模型\">#</a> 3.4 协作基本模型</h3>\n<p>使用 git 的 push 命令与 pull 命令其实已经可以实现多人代码共享的情景，你对本地代码进行了很多修改，同时创建了很多 commit 记录，然后你可以通过 push 推送到远程仓库，团队其他人通过 pull 命令拉取你的提交，同时他们也有可能将他们的 commit 记录提交远程仓库，你可以使用 pull 命令拉取他们的提交。</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/850.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/850.png\" class=\"\"></p>\n<p>但是大家并行开发同时进行提交，大概率会出现 push 的时候被 git 阻止的情况，原因是两个并行的提交，远程仓库需要对两者的提交顺序进行编排，所以会要求你先进行 pull 命令执行，将远程的提交拉取下来并合并到本地分支，在本地编排好你的本地提交记录与其他人的提交记录之后，才允许你进行 push 命令的执行。</p>\n<h2 id=\"4-git-工作流与分支管理规范\"><a class=\"anchor\" href=\"#4-git-工作流与分支管理规范\">#</a> 4. Git 工作流与分支管理规范</h2>\n<p>对于一些规模比较大的团队，一般会使用 git 分支来管理与规范不同环境的代码。</p>\n<h3 id=\"41-分支管理的必要性\"><a class=\"anchor\" href=\"#41-分支管理的必要性\">#</a> 4.1 分支管理的必要性</h3>\n<p>也许你会有疑问为什么我们会需要分支管理，并且需要分如此多的分支？因为在软件开发中，我们通常会有几个阶段，比如开发阶段，冒烟阶段，提测阶段，预发布阶段与上线阶段，而这些阶段都会对应有不同的部署环境，如果我们没有分支管理与将这些环境分别用不同的分支进行区分，代码版本管理将会无从谈起。所以我们会给分出很多分支，并且赋予这些分支不同的角色对应不同的环境与阶段。</p>\n<p><em>注：1. 冒烟这一术语原来自硬件行业，在软件工程中指由开发人员自身对新的程序代码进行测试，确保新的代码不出故障</em></p>\n<h3 id=\"42-使用-gitflow-工作流\"><a class=\"anchor\" href=\"#42-使用-gitflow-工作流\">#</a> 4.2 使用 gitflow 工作流</h3>\n<p>对于分支的管理，推荐使用 gitflow 工作流的模式，流程大概如下图：</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/843.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/843.png\" class=\"\"></p>\n<p>对上面的分支说明如下：</p>\n<ul>\n<li>feature branches。功能分支，一般是从 develop 开发分支上检出 (checkout)</li>\n<li>develop。公共的开发主线分支，feature 功能分支的代码开发完成后，经过 code review 后会合并到此分支</li>\n<li>release branches。测试、发布主线，此分支是从 develop 分支上检出 (checkout), 一般是提测阶段会使用该分支的代码</li>\n<li>bugfix。修复 release 分支问题，</li>\n<li>hotfix。紧急修复，一般是用于修复上线后的生产环境的问题。</li>\n<li>master。可发布的稳定版分支</li>\n</ul>\n<blockquote>\n<p><em>注：gitflow 分支管理图来自网络</em></p>\n</blockquote>\n<h4 id=\"421-功能开发流程\"><a class=\"anchor\" href=\"#421-功能开发流程\">#</a> 4.2.1 功能开发流程</h4>\n<p>团队在使用 <em>gitflow</em> 分支管理规范下，当我们需要有新的功能进行开发的时候，我们需要从最新的 <em>develop</em> 分支上检出 (<em>checkout</em>) 一个功能分支分支，命名形式如 <em>feature-xxx-version</em>，然后就可以在该功能分支上进行开发，当你开发完成后，可以将分支 <em>push</em> 到远程仓库中，并在对应的远程仓库管理软件 (<em>gitlab</em> 等) 中提交 <em>merge request</em>，经过相关人员的代码审查后，会将功能分支合并到 <em>develop</em> 分支上并删除这个功能分支。</p>\n<h4 id=\"422-提测流程\"><a class=\"anchor\" href=\"#422-提测流程\">#</a> 4.2.2 提测流程</h4>\n<p>当开发人员完成了该版本的所有功能后，会向测试人员发起测试功能的请求，此时会将最新的 <em>develop</em> 分支 (此时的 <em>develop</em> 分支已有所有该版本的新功能的代码) 检出 <em>release</em> 分支，命名格式如 <em>release-version</em>，测试人员 QA 会基于 <em>release-version</em> 为主线对代码进行测试与测试环境部署。</p>\n<p>当测试人员在 <em>release</em> 分支上发布代码 <em>bug</em> 的时候，开发人员需要从 <em>release-version</em> 分支上检出 <em>bugfix</em> 分支，命名格式如 <em>bugfix-xxx</em> ，然后类似功能开发流程，将 <em>bugfix-xxx</em> 分支合并到 <em>release-version</em> 分支上。</p>\n<h4 id=\"423-部署发布流程\"><a class=\"anchor\" href=\"#423-部署发布流程\">#</a> 4.2.3 部署发布流程</h4>\n<p>当测试人员测试通过后，会将 <em>release-version</em> 分支合并到 <em>master</em> 分支，并将 <em>release-version</em> 分支合并到 <em>develop</em> 分支，将 <em>master</em> 分支的代码进行部署，并测试线上，测试通过后对 <em>master</em> 分支打上 <em>tag</em>，并将 <em>master</em> 分支合并会 <em>develop</em> 分支。这里解释一下打 tag 的作用，tag 相当于是一个当前 commit 的一个快照，作用与 commit-sha1 类似，但是 tag 更具有可读性，可以供快速回退到想要的版本记录。</p>\n<h4 id=\"424线上问题紧急修复流程\"><a class=\"anchor\" href=\"#424线上问题紧急修复流程\">#</a> 4.2.4 线上问题紧急修复流程</h4>\n<p>当线上即生产环境发现 <em>bug</em> 的时候，需要在 master 分支上检出 (<em>checkout</em>) 一个 <em>hotfix-x.x.x</em> (x.x.x 是指语义化版本号) 分支，然后相关的开发人员的修</p>\n<h3 id=\"43-便于-code-review-的合作流程\"><a class=\"anchor\" href=\"#43-便于-code-review-的合作流程\">#</a> 4.3 便于 code review 的合作流程</h3>\n<p>在编写代码的时候，为了代码的高质量与开发人员的知识共享，通常会加上代码审查也就是 code review 环节。这个环节是借助 merge request 或者 pull request 来做到的，所以我们提交的 commit 记录应该尽量保持为<strong>一个</strong>，这样的好处有很多：</p>\n<ol>\n<li>方便代码审核者进行 code review，只需要看这一个 commit 记录的逻辑即可</li>\n<li>万一该 commit 的代码导致出现问题，我们可以只针对这个 commit 进行快速回退。</li>\n<li>一个功能保持一个 commit 记录如果遇到需要对这个功能提前提交到某些环境比如生产环境上，我们可以快速用过 cherry-pick 命令，在对应的分支上 &quot;重现&quot; 该提交记录，达到提前提交的目的。</li>\n</ol>\n<p>也许你会有疑问，单个功能保持一个 commit 记录与 commit 提交记录尽量保持较细的粒度这一原则是否相悖，笔者觉得并没有冲突，因为这两个 git 协作要求是基于不同的角度来看待问题的，对于自己开发的分支上，我们需要保持每个提交的粒度在一个 commit 做一个修改，这样有利于我们记录工作内容与方便自己在本分支上做回滚，但是对于一个软件开发的主分支来说，它上面的提交应该是以功能为单位的，而无需关心这个功能内开发人员开发这个功能做了多少次修改。</p>\n<p>面对这种情况，我们会使用 rebase 命令，也就是衍合 (变基) 操作。所谓衍合就是将你此分支上的 commit 提交，按顺序重新在某个分支上的某个基础点重新 &quot;演绎&quot; 一次，而这个重新 &quot;演绎&quot; 重新提交的 commit 记录与原来的 commit 提交会有些许不同，不同点在于 commit 的 HashId 会不同，但是提交内容是一样的。</p>\n<p>rebase 命令提供了交互式的界面，并且提供多种的命令让你能够将多个 commit 记录合并为一个，从而达到我们单一功能保持一个 commit 记录的目的，保持提交历史的清爽。</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/844.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/844.png\" class=\"\"></p>\n<p>*<em> 注：企业中一般会使用需求管理系统来管理需要开发的需求等</em></p>\n<h2 id=\"5-git-提交规范\"><a class=\"anchor\" href=\"#5-git-提交规范\">#</a> 5. Git 提交规范</h2>\n<p>制定一个 <em>git commit</em> 信息的提交规范是开发团队工作流必不可少的环节。试想一下，如果查看主分支上的历史库也就是你查看 <em>git log</em> 的时候，打印出来的信息杂乱无章的话，如果代码遇到问题，可能需要很大的精力与成本来查找到导致问题的代码提交，所以团队需要制定规范来引导成员编写规范的 <em>commit</em> 信息。</p>\n<p>接下来的 <em>commit</em> 信息规范参考了 <em>angularjs</em> 团队的开发者指引与笔者的工作团队进行总结，读者如有需要可以以此为基础增加或修改成为自己团队的 <em>commit</em> 规范的一部分。</p>\n<h3 id=\"51-提交信息基本模板\"><a class=\"anchor\" href=\"#51-提交信息基本模板\">#</a> 5.1 提交信息基本模板</h3>\n<p>如果 commit 信息都按照一定的模式进行提交，那么我们就会很容易找到自己想要的信息，模板参考如下：</p>\n<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt; [&lt;ISSUE_ID&gt;]\n\n&lt;body&gt;\n\n&lt;footer&gt;\n</code></pre>\n<p>commit 信息包括三个字段: type (必需)， scope (可选) 和 subject (必需)。</p>\n<ol>\n<li>type。type 是用于说明该 commit 的类型的，一般我们会规定 type 的类型如下：</li>\n</ol>\n<ul>\n<li>\n<ul>\n<li>feat: 新功能 (feature)</li>\n<li>fix: 修复 bug</li>\n<li>docs: 文档 (documents)</li>\n<li>style: 代码格式 (不影响代码运行的格式变动，注意不是指 CSS 的修改)</li>\n<li>refactor: 重构 (既不是新增功能，也不是修改 bug 的代码变动)</li>\n<li>test: 提交测试代码 (单元测试，集成测试等)</li>\n<li>chore: 构建或辅助工具的变动</li>\n<li>misc: 一些未归类或不知道将它归类到什么方面的提交</li>\n</ul>\n</li>\n</ul>\n<ol>\n<li>scope。scope 说明 commit 影响的范围，比如数据层，控制层，视图层等等，这个需要视具体场景与项目的不同而灵活变动</li>\n<li>subject。subject 是对于该 commit 目的的简短描述</li>\n</ol>\n<ul>\n<li>\n<ul>\n<li>使用第一人称现在时的动词开头，比如 modify 而不是 modified 或 modifies</li>\n<li>首字母小写，并且结尾不加句号</li>\n</ul>\n</li>\n</ul>\n<ol>\n<li>ISSUEE_ID。这个与公司的需求管理与项目管理有关，假设你的项目放在 <em>github</em> 上，你的需求或者 <em>bug</em> 修复可能会有对应的 <em>issues</em> 记录，你可以加到你的 <em>commit</em> 信息中如 <em>issue-37938634</em>。</li>\n</ol>\n<p>body 其实就是 subject 的详细说明，而 footer 中你可以填写相关的需求管理 issues id。</p>\n<p>在企业中一般会对团队中要做的事情与需求开发使用一个软件进行管理，好处是可以让代码与对应的用户故事 (story) 或者需求，bug 进行关联，便于管理，类似的方案有 github，gitlab，tracker，JIRA 等等，比如在网易某些团队中就会使用 JIRA 加上 gitlab 来进行团队管理。</p>\n<p>commit message 的规范性是很重要的，对于自己养成良好的编程习惯很有帮助，但是没有必要强制完全遵循开源团队的规范，毕竟每个团队与个人的情况不同，博采众长即可，当然你也可以使用像 <em>commitlint</em> 这样的校验工具从工具层面上来强制执行某些规范，这里就不展开讲了，有兴趣的读者可以查阅相关资料并使用到自己团队的实践中。</p>\n<h2 id=\"6-ideaad-集成提交规范插件\"><a class=\"anchor\" href=\"#6-ideaad-集成提交规范插件\">#</a> 6. IDEA/AD 集成提交规范插件</h2>\n<p>打开 <code>File/Settings</code> ，选择 <code>Plugins</code> ，搜索 <code>Git Commit Template</code>  插件并下载。</p>\n<p>commit 提交的时候，点击下图中的图标。</p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/851.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/851.png\" class=\"\"></p>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/852.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/852.png\" class=\"\"></p>\n<h3 id=\"61-header\"><a class=\"anchor\" href=\"#61-header\">#</a> 6.1 Header</h3>\n<p>Header 的部分只有一行，包括三个字段: <strong>type (必需), scope (可选), subject (必需)</strong></p>\n<p>对应到 idea 插件上图的配置分别为 Header 部分的:</p>\n<table>\n<thead>\n<tr>\n<th>type (必需)</th>\n<th>Type of change</th>\n<th>commit 类别</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>scope (可选)</td>\n<td>Scope of this change</td>\n<td>影响的范围， 一般为自己代码的模块名。</td>\n</tr>\n<tr>\n<td><strong>subject (必需)</strong></td>\n<td><strong>Short description</strong></td>\n<td><strong>简短的描述</strong>，建议符合 50/72 格式。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1-type用于说明-commit-的类别只允许使用下面7个标识\"><a class=\"anchor\" href=\"#1-type用于说明-commit-的类别只允许使用下面7个标识\">#</a> (1) type 用于说明 commit 的类别，只允许使用下面 7 个标识</h4>\n<p><code>type</code>  用于说明 commit 的类别：</p>\n<ol>\n<li><strong>feat：新功能（feature）；</strong></li>\n<li><strong>fix：修补 bug；</strong></li>\n<li><strong>docs：文档（documentation）；</strong></li>\n<li><strong>style： 格式（不影响代码运行的变动，空格，格式化，等等）；</strong></li>\n<li>refactor：重构（即不是新增功能，也不是修改 bug 的代码变动）；</li>\n<li>perf: 性能 (提高代码性能的改变)；</li>\n<li><strong>test：增加测试或者修改测试；</strong></li>\n<li>build: 影响构建系统或外部依赖项的更改 (maven,gradle,npm 等等)；</li>\n<li>ci: 对 CI 配置文件和脚本的更改；</li>\n<li><strong>chore：其他修改， 比如构建流程， 依赖管理。</strong></li>\n<li><strong>revert: Revert a commi，用于撤销以前的 commit</strong></li>\n</ol>\n<h4 id=\"2-scope\"><a class=\"anchor\" href=\"#2-scope\">#</a> (2) scope</h4>\n<p><code>scope</code>  用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p>\n<h4 id=\"3-subject\"><a class=\"anchor\" href=\"#3-subject\">#</a> (3) subject</h4>\n<p><code>subject</code>  是 commit 目的的简短描述，不超过 50 个字符。</p>\n<blockquote>\n<p>以动词开头，使用第一人称现在时，比如 change，而不是 changed 或 changes<br />\n 第一个字母小写<br />\n结尾不加句号（.）</p>\n</blockquote>\n<h3 id=\"62-body\"><a class=\"anchor\" href=\"#62-body\">#</a> 6.2 Body</h3>\n<p>Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。</p>\n<pre><code>More detailed explanatory text, if necessary.  Wrap it to \nabout 72 characters or so. \n\nFurther paragraphs come after blank lines.\n\n- Bullet points are okay, too\n- Use a hanging indent\n</code></pre>\n<p>有两个注意点。</p>\n<p>（1）使用第一人称现在时，比如使用 change 而不是 changed 或 changes。</p>\n<p>（2）应该说明代码变动的动机，以及与以前行为的对比。</p>\n<h3 id=\"63-footer\"><a class=\"anchor\" href=\"#63-footer\">#</a> 6.3 Footer</h3>\n<p>Footer 部分只用于两种情况。</p>\n<h4 id=\"631-不兼容变动\"><a class=\"anchor\" href=\"#631-不兼容变动\">#</a> 6.3.1 不兼容变动</h4>\n<p>如果当前代码与上一个版本不兼容，则 Footer 部分以 <code>BREAKING CHANGE</code>  开头，后面是对变动的描述、以及变动理由和迁移方法。</p>\n<pre><code>BREAKING CHANGE: isolate scope bindings definition has changed.\n\n To migrate the code follow the example below:\n\n Before:\n\n scope: &#123;\n   myAttr: 'attribute',\n &#125;\n\n After:\n\n scope: &#123;\n   myAttr: '@',\n &#125;\n\n The removed `inject` wasn't generaly useful for directives so there should be no code using it.\n</code></pre>\n<h4 id=\"632-关闭-issue\"><a class=\"anchor\" href=\"#632-关闭-issue\">#</a> 6.3.2 关闭 Issue</h4>\n<p>如果当前 commit 针对某个 issue，那么可以在 Footer 部分关闭这个 issue 。</p>\n<pre><code>Closes #234\n</code></pre>\n<p>也可以一次关闭多个 issue 。</p>\n<pre><code>Closes #123, #245, #992\n</code></pre>\n<blockquote>\n<p>特殊情况【回滚，Revert】：如果当前 commit 用于撤销以前的 commit，<br />\n必须以 revert: 开头，后面跟着被撤销 Commit 的 Header。<br />\nBody 部分的格式是固定的，必须写成 This reverts commit &lt;hash&gt;.，其中的 hash 是被撤销 commit 的 SHA 标识符。<br />\n如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。<br />\n如果两者在不同的发布，那么当前 commit，会出现在 Change log 的 Reverts 小标题下面。</p>\n</blockquote>\n<p><img data-src=\"Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/853.png\" alt=\"\" /><img data-src=\"/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/853.png\" class=\"\"></p>\n<h3 id=\"64-5072格式化\"><a class=\"anchor\" href=\"#64-5072格式化\">#</a> 6.4. 50/72 格式化</h3>\n<p>git commit 格式基本规约：50/72 格式化</p>\n<ul>\n<li>第一行不超过 50 个字符</li>\n<li>然后是空白行</li>\n<li>其余文字应以 72 个字符换行</li>\n</ul>\n<p>原因：</p>\n<ul>\n<li>一些工具将第一行作为主题行，将第二段作为正文 (类似于电子邮件)。若工具流行，那么该格式将流行。</li>\n<li><code>git log</code>  不处理换行，因此如果行太长则很难阅读。</li>\n<li><code>git format-patch --stdout</code>  可以将提交转换为电子邮件。</li>\n</ul>\n<h2 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h2>\n<p>本章节介绍了 <em>git</em> 的一些常用命令的操作与基本概念，与基于此的 <em>git</em> 合作流程与 <em>commit</em> 规范。对于 <em>git</em> 的使用，笔者建议多加练习，不能只 &quot;纸上谈兵&quot;, 实际操作才能加深对于 <em>git</em> 的理解，而 <em>git</em> 合作流程与 <em>commit</em> 规范提供了参考。</p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "Git",
                "Git"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/",
            "title": "Hexo安装过程",
            "date_published": "2021-03-01T00:40:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"搭建hexo\"><a class=\"anchor\" href=\"#搭建hexo\">#</a> 搭建 Hexo</h2>\n<h3 id=\"前提提要\"><a class=\"anchor\" href=\"#前提提要\">#</a> 前提提要</h3>\n<p>首先需要一下软件</p>\n<ul>\n<li>Nodejs</li>\n<li>hexo 插件</li>\n<li>Git</li>\n</ul>\n<hr />\n<h3 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h3>\n<h4 id=\"1-安装nodejs\"><a class=\"anchor\" href=\"#1-安装nodejs\">#</a> 1. 安装 nodejs</h4>\n<p>官网链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2VuLw==\">https://nodejs.org/en/</span></p>\n<p><img data-src=\"Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/image-20210620190409458.png\" alt=\"\" /><img data-src=\"/zxy/Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/image-20210620190409458.png\" class=\"\"></p>\n<p>注意：左侧是稳定版、右边是测试版。一般都选稳定版</p>\n<h5 id=\"12-测试\"><a class=\"anchor\" href=\"#12-测试\">#</a> 1.2 测试</h5>\n<pre><code>按 [win] + r 输入cmd \n输入node -v 查看node的版本\n输入npm -v  查看npm的版本\n</code></pre>\n<h4 id=\"13-更改为淘宝镜像源\"><a class=\"anchor\" href=\"#13-更改为淘宝镜像源\">#</a> 1.3 更改为淘宝镜像源</h4>\n<pre><code>npm install -g cnpm --registry=https://registry.npm.taobao.org\n</code></pre>\n<h4 id=\"2-安装hexo\"><a class=\"anchor\" href=\"#2-安装hexo\">#</a> 2. 安装 hexo</h4>\n<pre><code>cnpm install -g hexo-cli\n</code></pre>\n<h5 id=\"21-测验\"><a class=\"anchor\" href=\"#21-测验\">#</a> 2.1 测验</h5>\n<pre><code>输入hexo -v 查看heox 版本\n</code></pre>\n<h4 id=\"3-安装git\"><a class=\"anchor\" href=\"#3-安装git\">#</a> 3 安装 Git</h4>\n<pre><code>下载链接：https://gitee.com/all-about-git\n一路无脑安装即可\n</code></pre>\n<h5 id=\"31-测试\"><a class=\"anchor\" href=\"#31-测试\">#</a> 3.1 测试</h5>\n<pre><code>右键打开 Git Bash Here\n能够成功打开即可说明安装成功\n</code></pre>\n<hr />\n<h3 id=\"创建\"><a class=\"anchor\" href=\"#创建\">#</a> 创建</h3>\n<h4 id=\"1-创建文件夹\"><a class=\"anchor\" href=\"#1-创建文件夹\">#</a> 1. 创建文件夹</h4>\n<pre><code>直接在你想要创建博客的地方新建一个文件夹 [blog]\n</code></pre>\n<h4 id=\"2-进入文件夹初始化hexo\"><a class=\"anchor\" href=\"#2-进入文件夹初始化hexo\">#</a> 2. 进入文件夹，初始化 hexo</h4>\n<pre><code>在该文件夹中打开cmd\n输入hexo init进行初始化（可能会有点卡，懂？）\n</code></pre>\n<h4 id=\"3-本地启动hexo博客\"><a class=\"anchor\" href=\"#3-本地启动hexo博客\">#</a> 3. 本地启动 hexo 博客</h4>\n<pre><code>一般在发布到服务器之前，会先在本地进行测试，测试成功后再发布到服务器上\n在文件夹中打开cmd\n输入hexo s / hexo server（二选一即可，只不过是一个缩写，一个全写）\n\n启动完成后，请不要关闭cmd窗口，否则浏览器会访问不到\n然后打开浏览器，输入localhost:4000\n</code></pre>\n<h4 id=\"4-新建文章\"><a class=\"anchor\" href=\"#4-新建文章\">#</a> 4. 新建文章</h4>\n<pre><code>可以直接在cmd中输入hexo n &quot;创建的文章名称&quot;\n</code></pre>\n<p>注意：也可以直接在 blog 文件夹下打开 <code>\\source\\_posts</code>  下新建一个 markdown 文件即可<br />\n若需要访问图片，需要另外在 typroa 中进行偏好设置</p>\n<p><img data-src=\"Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/image-20210620193421520.png\" alt=\"\" /><img data-src=\"/zxy/Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/image-20210620193421520.png\" class=\"\"></p>\n<hr />\n<h3 id=\"推送到远端服务器\"><a class=\"anchor\" href=\"#推送到远端服务器\">#</a> 推送到远端服务器</h3>\n<h4 id=\"1-修改配置文件\"><a class=\"anchor\" href=\"#1-修改配置文件\">#</a> 1. 修改配置文件</h4>\n<p>在 blog 文件夹下打开 <code>_config.yml</code> ，直接拉到最下面编辑一下内容</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Deployment</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">## Docs: https://hexo.io/docs/one-command-deployment</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> git</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">repo</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>Git分支链接<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>分支名<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h4 id=\"2-安装插件\"><a class=\"anchor\" href=\"#2-安装插件\">#</a> 2. 安装插件</h4>\n<pre><code>在blog文件夹下打开cmd\nnpm install --save hexo-deployer-git\n</code></pre>\n<h4 id=\"3-推送到远端\"><a class=\"anchor\" href=\"#3-推送到远端\">#</a> 3. 推送到远端</h4>\n<pre><code>在blog文件夹下打开cmd\nhexo clean 清除缓存\nhexo g\t   生成文件\nhexo d\t   推送到远端\n</code></pre>\n<h4 id=\"4-设置远端使用网页服务\"><a class=\"anchor\" href=\"#4-设置远端使用网页服务\">#</a> 4. 设置远端使用网页服务</h4>\n<p>Gitee：[Setting]——&gt;[Gitee Page]——&gt; 开启</p>\n<h3 id=\"更换主题\"><a class=\"anchor\" href=\"#更换主题\">#</a> 更换主题</h3>\n<p>在 blog 文件夹下打开 <code>_config.yml</code></p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Extensions</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">## Plugins: https://hexo.io/plugins/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">## Themes: https://hexo.io/themes/</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>更换的模板<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"详细教程\"><a class=\"anchor\" href=\"#详细教程\">#</a> 详细教程</h3>\n<p>教程链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaG9rYS5sb3N0eXUubWUvY29tcHV0ZXItc2NpZW5jZS9ub3RlL3RoZW1lLXNob2thLWRvYy8=\">https://shoka.lostyu.me/computer-science/note/theme-shoka-doc/</span></p>\n",
            "tags": [
                "安装教程",
                "Hexo"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Java%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Java%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/",
            "title": "Java安装过程",
            "date_published": "2021-03-01T00:40:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"java安装过程\"><a class=\"anchor\" href=\"#java安装过程\">#</a> Java 安装过程</h2>\n<p><strong>前提</strong>：jdk 的安装包</p>\n<h3 id=\"操作流程\"><a class=\"anchor\" href=\"#操作流程\">#</a> 操作流程：</h3>\n<h4 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> <strong>安装：</strong></h4>\n<p><strong>无脑下一步（因为会安装 jdk 和 jre，所以建议安装的时候新建一个 JAVA 文件夹先）</strong></p>\n<h4 id=\"设置环境变量\"><a class=\"anchor\" href=\"#设置环境变量\">#</a> 设置环境变量：</h4>\n<p>按 [win]——&gt; 输入 [环境变量]——&gt; 进行编辑 ——&gt; 在全局变量中新建一个 <code>JAVA_HOME</code>  并设置变量 ——&gt; 编辑全局变量中的 <code>Path</code>  并新增一下变量</p>\n<ul>\n<li>JAVA_HOME：java 安装的目录</li>\n<li>PATH ：\n<ul>\n<li>%JAVA_HOME%\\bin</li>\n<li>%JAVA_HOME%\\jre\\bin</li>\n</ul>\n</li>\n</ul>\n<p>完成后请务必按 <strong>[确认]</strong> 进行退出，否则不会保存</p>\n<h4 id=\"测试\"><a class=\"anchor\" href=\"#测试\">#</a> 测试</h4>\n<p>按 <strong>[win]</strong> +  <code>r</code>  输入 <code>cmd</code>  ——&gt; 输入 <code>java</code> 、 <code>javac</code> 、 <code>java -version</code>  进行判断是否设置变量成功（失败请确认变量是否编辑成功）</p>\n",
            "tags": [
                "安装教程",
                "Java"
            ]
        },
        {
            "id": "https://xinyao_idiot.gitee.io/zxy/Springboot%E7%BB%83%E4%B9%A0/",
            "url": "https://xinyao_idiot.gitee.io/zxy/Springboot%E7%BB%83%E4%B9%A0/",
            "title": "Springboot 后端练习任务",
            "date_published": "2021-03-01T00:40:00.000Z",
            "content_html": "<p><span id=\"more\"></span></p>\n<h2 id=\"后端练习任务\"><a class=\"anchor\" href=\"#后端练习任务\">#</a> 后端练习任务</h2>\n<h3 id=\"day01\"><a class=\"anchor\" href=\"#day01\">#</a> day01：</h3>\n<h4 id=\"1创建springboot工程熟悉每个目录结构的作用\"><a class=\"anchor\" href=\"#1创建springboot工程熟悉每个目录结构的作用\">#</a> 1. 创建 Springboot 工程，熟悉每个目录结构的作用</h4>\n<h4 id=\"2熟悉配置文件能自定义属性并在代码中使用的地方绑定到指定的属性上\"><a class=\"anchor\" href=\"#2熟悉配置文件能自定义属性并在代码中使用的地方绑定到指定的属性上\">#</a> 2. 熟悉配置文件，能自定义属性，并在代码中使用的地方，绑定到指定的属性上</h4>\n<h4 id=\"3创建restful-api\"><a class=\"anchor\" href=\"#3创建restful-api\">#</a> 3. 创建 Restful API</h4>\n<h4 id=\"4使用jpa访问mariadb实现增删查改并进行单元测试\"><a class=\"anchor\" href=\"#4使用jpa访问mariadb实现增删查改并进行单元测试\">#</a> 4. 使用 JPA 访问 Mariadb，实现增删查改，并进行单元测试</h4>\n<h4 id=\"5熟悉git命令\"><a class=\"anchor\" href=\"#5熟悉git命令\">#</a> 5. 熟悉 Git 命令</h4>\n<hr />\n<h3 id=\"day02\"><a class=\"anchor\" href=\"#day02\">#</a> day02：</h3>\n<h4 id=\"1读取applicationproperties中的自定义属性\"><a class=\"anchor\" href=\"#1读取applicationproperties中的自定义属性\">#</a> 1. 读取 application.properties 中的自定义属性。</h4>\n<p>在 <code>application.properties</code>  定义两个属性 <code>wx.appid=123456</code>  和 <code>wx.secret=9999</code> ，</p>\n<p>新建 WxController 控制器，在控制器中读取上面定义的两个自定义属性。</p>\n<h4 id=\"2自定义配置文件读取自定义配置文件中的属性\"><a class=\"anchor\" href=\"#2自定义配置文件读取自定义配置文件中的属性\">#</a> 2. 自定义配置文件，读取自定义配置文件中的属性。</h4>\n<p>新建 <code>datasource.properties</code>  文件，在该配置文件中定义以下几个属性，在 WxController 控制器中读取该配置文件中的属性.</p>\n<blockquote>\n<p>note: 该方式不止一种，选择最优雅的一种。</p>\n</blockquote>\n<pre><code>geek.datasource.url=jdbc:mysql://localhost:3306/geek\ngeek.datasource.username=geek\ngeek.datasource.password=123456\n</code></pre>\n<h4 id=\"3jpa基于方法名称命名规则查询\"><a class=\"anchor\" href=\"#3jpa基于方法名称命名规则查询\">#</a> 3.JPA 基于方法名称命名规则查询</h4>\n<p>新建 <code>Student</code>  实体。实体属性根据需求自己定义。</p>\n<p>1. 根据学生的 <code>年龄</code> 查询</p>\n<p>2. 根据学生的 <code>名称``模糊</code> 查询</p>\n<p>3. 查询 <code>所有</code> 学生，按照 <code>年龄</code> 降序</p>\n<p>4. 统计 <code>所有</code> 学生的人数</p>\n<h4 id=\"4jpa自定义sql查询使用query注解\"><a class=\"anchor\" href=\"#4jpa自定义sql查询使用query注解\">#</a> 4.JPA 自定义 SQL 查询，使用 @Query 注解。</h4>\n<p>1. 根据学生的 <code>班级</code> 查询，并按照年龄降序</p>\n<p>2. 根据学生的 <code>年龄</code> 进行 <code>范围</code> 查询</p>\n<h4 id=\"5jpa分页查询\"><a class=\"anchor\" href=\"#5jpa分页查询\">#</a> 5.JPA 分页查询</h4>\n<p>1. 根据学生的 <code>年龄</code> 进行查询，并进行分页。</p>\n<h4 id=\"6复杂查询\"><a class=\"anchor\" href=\"#6复杂查询\">#</a> 6. 复杂查询</h4>\n<p>1. 根据学生 <code>年龄</code> 比较查询和 <code>名称</code> 、 <code>班级</code> 的模糊查询，并进行分页。</p>\n<p><strong>【注意】年龄为一个变量，名称和班级为一个变量，总共两个变量</strong></p>\n<h4 id=\"7跟app组对接\"><a class=\"anchor\" href=\"#7跟app组对接\">#</a> 7. 跟 app 组对接</h4>\n<p>&lt;div style=&quot;color:red&quot;&gt; 每个后端成员找一个 APP 成员，组成搭档后，进行需求的分析，为下一次作业做准备。&lt;/div&gt;</p>\n<p>项目背景：小说 APP</p>\n<hr />\n<h3 id=\"day03\"><a class=\"anchor\" href=\"#day03\">#</a> day03：</h3>\n<h4 id=\"1小说列表首页\"><a class=\"anchor\" href=\"#1小说列表首页\">#</a> 1. 小说列表首页</h4>\n<h5 id=\"11-新建个springboot项目项目名称名字_book\"><a class=\"anchor\" href=\"#11-新建个springboot项目项目名称名字_book\">#</a> 1.1 新建个 SpringBoot 项目，** 项目名称：** 名字_book</h5>\n<h5 id=\"12-找上周选择的app搭档根据他的首页页面进行需求分析设计实体和restful-api\"><a class=\"anchor\" href=\"#12-找上周选择的app搭档根据他的首页页面进行需求分析设计实体和restful-api\">#</a> 1.2 找上周选择的 App 搭档，根据他的首页页面进行需求分析，设计实体和 Restful Api.</h5>\n<p>实体一般包括<strong>书籍</strong> <code>Book</code>  和<strong>分类</strong> <code>Category</code> ，具体实体设计需要根据页面分析。【<strong>note: 分类实体能写出无限级的加分</strong>】</p>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cDovL1JFQURNRS5tZA==\">README.md</span></strong> 需要贴 APP 组员首页截图和 Postman 请求首页 API 结果的截图。</p>\n<blockquote>\n<p><strong>注意：需写增删查改方法，数据通过 postman 模拟添加。</strong></p>\n</blockquote>\n<h4 id=\"2thymeleaf使用\"><a class=\"anchor\" href=\"#2thymeleaf使用\">#</a> 2.Thymeleaf 使用</h4>\n<h5 id=\"21-新建springboot项目项目名称-名字_day03\"><a class=\"anchor\" href=\"#21-新建springboot项目项目名称-名字_day03\">#</a> 2.1 新建 SpringBoot 项目，项目名称： 名字_day03</h5>\n<h5 id=\"22-阅读thymeleaf教程把练习代码提交到day03项目中\"><a class=\"anchor\" href=\"#22-阅读thymeleaf教程把练习代码提交到day03项目中\">#</a> 2.2 阅读 Thymeleaf 教程，把练习代码提交到 day03 项目中</h5>\n<p>Thymeleaf 教程链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMDMwODk0Nzc=\">https://zhuanlan.zhihu.com/p/103089477</span></p>\n<h5 id=\"23-thymeleaf实战\"><a class=\"anchor\" href=\"#23-thymeleaf实战\">#</a> 2.3 Thymeleaf 实战</h5>\n<p>在小说项目 <code>名字_book</code>  编写后台 HTML 页面，使用 Thymeleaf 模板引擎，对接小说项目中的<strong>书籍</strong> <code>Book</code>  和<strong>分类</strong> <code>Category</code>  的<strong>增删查改 Restful API</strong></p>\n<blockquote>\n<p>增删查改 Restful API 有如下几个功能：</p>\n<p>书籍：</p>\n<p>1. 查询书籍，<strong>要求分页</strong></p>\n<p>2. 添加书籍</p>\n<p>3. 修改书籍</p>\n<p>4. 删除书籍</p>\n<p>分类：</p>\n<p>1. 查询分类</p>\n<p>2. 添加分类</p>\n<p>3. 修改分类</p>\n<p>4. 删除分类</p>\n</blockquote>\n<p><strong>代码提交到小说项目 <code>名字_book</code> </strong></p>\n<p><strong>【note】1. 可以使用 Bootstrap4 进行页面布局 <code>https://getbootstrap.net/</code> ；2. 也可以使用后台模板，只要能做出效果；3. 但也可以你纯用 HTML+CSS 手撸一个后台页面；【推荐】第一和第二种结合起来用</strong></p>\n<hr />\n<h3 id=\"day04\"><a class=\"anchor\" href=\"#day04\">#</a> day04：</h3>\n<h4 id=\"1对接小说app首页\"><a class=\"anchor\" href=\"#1对接小说app首页\">#</a> 1. 对接小说 APP 首页</h4>\n<p>跟自己 APP 组员对接小说 APP 首页，数据对接成功，提供截图到 README.md 文件中</p>\n<h4 id=\"2参数-表单检验\"><a class=\"anchor\" href=\"#2参数-表单检验\">#</a> 2. 参数、表单检验</h4>\n<p>对书籍实体和分类实体数据进行检验</p>\n<p>1. 所有属性不能为空</p>\n<p>2.<strong> 书名</strong>长度在 1~20 个字符</p>\n<h4 id=\"3自定义异常全局异常捕获\"><a class=\"anchor\" href=\"#3自定义异常全局异常捕获\">#</a> 3. 自定义异常，全局异常捕获</h4>\n<p>自定义一个异常 <code>ServiceException</code> ，全局异常捕获这个<strong>自定义异常</strong>和<strong>表单检验异常</strong>。</p>\n<p>教程：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAyMDY0MjEwMD91dG1fc291cmNlPXRhZy1uZXdlc3Q=\">https://segmentfault.com/a/1190000020642100?utm_source=tag-newest</span></p>\n<hr />\n<h3 id=\"day05\"><a class=\"anchor\" href=\"#day05\">#</a> day05：</h3>\n<h4 id=\"1新建用户实体\"><a class=\"anchor\" href=\"#1新建用户实体\">#</a> 1. 新建用户实体</h4>\n<p>实体自己设计</p>\n<h4 id=\"2注册用户\"><a class=\"anchor\" href=\"#2注册用户\">#</a> 2. 注册用户</h4>\n<p>必须包含：用户名 + 密码 + 确认密码</p>\n<p>其他可以根据自己加.</p>\n<p><strong>注意：密码需要使用 Bcrypt 加密.</strong></p>\n<h4 id=\"3邮箱注册\"><a class=\"anchor\" href=\"#3邮箱注册\">#</a> 3. 邮箱注册</h4>\n<p>邮箱注册需要发一封邮件到该用户的邮箱中，只有该用户点击该邮件进行验证，该用户才可以验证成功。</p>\n<p><img data-src=\"Springboot%E7%BB%83%E4%B9%A0/image-20200928094416423.png\" alt=\"\" /><img data-src=\"/zxy/Springboot%E7%BB%83%E4%B9%A0/image-20200928094416423.png\" class=\"\"></p>\n<h4 id=\"4手机号注册\"><a class=\"anchor\" href=\"#4手机号注册\">#</a> 4. 手机号注册</h4>\n<p>用户填写完手机号，发送验证码，<strong>验证码需要有个 15 分钟有效期。</strong></p>\n<hr />\n<h3 id=\"day06\"><a class=\"anchor\" href=\"#day06\">#</a> day06：</h3>\n<h4 id=\"1批量导入书籍\"><a class=\"anchor\" href=\"#1批量导入书籍\">#</a> 1. 批量导入书籍</h4>\n<p>复制出来之前的小说项目，更名为：姓名_day06</p>\n<p>在页面上，加一个批量导入按钮，点击可以上传 excel 表格，进行批量导入。</p>\n<p>note：封面图片 url 可以默认在 excel 中写死</p>\n<p>导入格式：书籍名称、介绍、作者、分类名称</p>\n<h4 id=\"2批量导出所有书籍\"><a class=\"anchor\" href=\"#2批量导出所有书籍\">#</a> 2. 批量导出所有书籍</h4>\n<p>导出 excel 名称格式为： <strong>当前日期_书籍信息.xlsx</strong>     2020-10-09_书籍信息.xlsx</p>\n<p>列名需包括：书籍名称、介绍、作者、分类名称、创建时间</p>\n<hr />\n<h3 id=\"day07\"><a class=\"anchor\" href=\"#day07\">#</a> day07：</h3>\n<h4 id=\"目标学会使用swagger2生成文档\"><a class=\"anchor\" href=\"#目标学会使用swagger2生成文档\">#</a> 目标：学会使用 swagger2 生成文档</h4>\n<p>介绍</p>\n<blockquote>\n<p>在日常的工作中，我们往往需要给前端（WEB 端、IOS、Android）或者第三方提供接口，这个时候我们就需要给他们提供一份详细的 API 说明文档。但维护一份详细的文档可不是一件简单的事情。首先，编写一份详细的文档本身就是一件很费时费力的事情，另一方面，由于代码和文档是分离的，所以很容易导致文档和代码的不一致。这篇文章我们就来分享一种 API 文档维护的方式，即通过 Swagger 来自动生成 Restuful API 文档。</p>\n<p>那什么是 Swagger？我们可以直接看下官方的描述：</p>\n<pre><code>THE WORLD'S MOST POPULAR API TOOLING``Swagger is the world’s largest framework of API developer tools ``for` `the OpenAPI Specification(OAS),``enabling development across the entire API lifecycle, from design and documentation, to test and deployment.\n</code></pre>\n<p>这段话首先告诉大家 Swagger 是世界上最流行的 API 工具，并且 Swagger 的目的是支撑整个 API 生命周期的开发，包括设计、文档以及测试和部署。这篇文章中我们会用到 Swagger 的文档管理和测试功能。</p>\n</blockquote>\n<p>任务：给各个接口生成文档，包含接口说明、方法说明、参数说明、例子</p>\n<p>使用<strong> Swagger2</strong> 对书籍进行<strong>增删改查</strong>测试，贴测试结果的截图到 readme.md 文档中</p>\n<blockquote>\n<p>可以使用 <code>swagger-bootstrap-ui</code>  对文档进行换肤</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueGlhb21pbmZvLmNvbS8yMDE4LzA4LzI5L3N3YWdnZXItYm9vdHN0cmFwLXVpLWRlc2NyaXB0aW9uLw==\">https://www.xiaominfo.com/2018/08/29/swagger-bootstrap-ui-description/</span></p>\n</blockquote>\n<hr />\n<h3 id=\"day08\"><a class=\"anchor\" href=\"#day08\">#</a> day08：</h3>\n<h4 id=\"1spring-aop使用\"><a class=\"anchor\" href=\"#1spring-aop使用\">#</a> 1.Spring AOP 使用</h4>\n<p>了解以下注解的使用：</p>\n<blockquote>\n<ul>\n<li><strong>@Aspect</strong>：声明该类为一个注解类；</li>\n<li><strong>@Pointcut</strong>：定义一个切点，后面跟随一个表达式，表达式可以定义为切某个注解，也可以切某个 package 下的方法；</li>\n</ul>\n<p>切点定义好后，就是围绕这个切点做文章了；</p>\n<ul>\n<li><strong>@Before</strong>: 在切点之前，织入相关代码；</li>\n<li><strong>@After</strong>: 在切点之后，织入相关代码；</li>\n<li><strong>@AfterReturning</strong>: 在切点返回内容后，织入相关代码，一般用于对返回值做些加工处理的场景；</li>\n<li><strong>@AfterThrowing</strong>: 用来处理当织入的代码抛出异常后的逻辑处理；</li>\n<li><strong>@Around</strong>: 环绕，可以在切入点前后织入代码，并且可以自由的控制何时执行切点；</li>\n<li><img data-src=\"Springboot%E7%BB%83%E4%B9%A0%5Cimage-20210426152243000.png\" alt=\"\" /><img data-src=\"/zxy/Springboot%E7%BB%83%E4%B9%A0/image-20210426152243000.png\" class=\"\"></li>\n</ul>\n</blockquote>\n<p><strong>练习任务：使用 Spring AOP 计算所有 Service 业务类的程序执行时间。【注意：使用 log 日志形式打印到控制台】</strong></p>\n<p><strong>程序控制头打印如下，需截图到 README.md 中。</strong></p>\n<blockquote>\n<p><strong>INFO  ServiceLogAspect:43 - ====== 开始执行 class com.geek.service.impl.CategoryServiceImpl.xxxx======</strong></p>\n<p>INFO  ServiceLogAspect:62 - ====== 执行结束，耗时：248 毫秒 ======</p>\n</blockquote>\n<hr />\n<h3 id=\"day09\"><a class=\"anchor\" href=\"#day09\">#</a> day09：</h3>\n<h4 id=\"1springboot-自定义注解\"><a class=\"anchor\" href=\"#1springboot-自定义注解\">#</a> 1.SpringBoot 自定义注解</h4>\n<h5 id=\"11-了解如下几个java元注解把每个元注解的意思写道readmemd笔记中\"><a class=\"anchor\" href=\"#11-了解如下几个java元注解把每个元注解的意思写道readmemd笔记中\">#</a> <strong>1.1 了解如下几个 Java 元注解</strong>，把每个元注解的意思写道 README.md 笔记中。</h5>\n<ul>\n<li>\n<p><strong>@Retention</strong></p>\n<p>Retention (保留) 注解说明，这种类型的注解会被保留到那个阶段。有三个值:<br />\n1.RetentionPolicy.SOURCE —— 这种类型的 Annotations 只在源代码级别保留，编译时就会被忽略<br />\n 2.RetentionPolicy.CLASS —— 这种类型的 Annotations 编译时被保留，在 class 文件中存在，但 JVM 将会忽略<br />\n 3.RetentionPolicy.RUNTIME —— 这种类型的 Annotations 将被 JVM 保留，所以他们能在运行时被 JVM 或其他使用反射机制的代码所读取和使用.</p>\n</li>\n<li>\n<p><strong>@Target</strong></p>\n</li>\n<li>\n<p><strong>@Document</strong></p>\n<p>Documented 注解表明这个注解应该被 javadoc 工具记录。默认情况下，javadoc 是不包括注解的。但如果声明注解时指定了 @Documented, 则它会被 javadoc 之类的工具处理，所以注解类型信息也会被包括在生成的文档中。示例 6 进一步演示了使用</p>\n</li>\n<li>\n<p><strong>@Inherited</strong></p>\n</li>\n</ul>\n<h5 id=\"12-自定义检验注解\"><a class=\"anchor\" href=\"#12-自定义检验注解\">#</a> 1.2 自定义检验注解</h5>\n<p>复制上次的注册项目，更名为：名字_day09</p>\n<p>在使用<strong>密码 + 确认密码</strong>注册的时候，我们需要检验密码和确认密码是否一致，这里我们需要自己定义<strong>确认密码</strong>检验注解，来进行检验。</p>\n<p><strong>【注意】确认密码注解名称统一定义叫：ConfirmPassword 注解类</strong></p>\n<p><strong>【注意】可以参考官方检验注解源码，结构一样，主要逻辑不一样而已。</strong></p>\n<p><strong>最后使用 PostMan 测试检验的结果，把成功和失败的请求截图到 README.md 笔记中</strong></p>\n<hr />\n<h3 id=\"day10\"><a class=\"anchor\" href=\"#day10\">#</a> day10：</h3>\n<p>阅读如下这篇文章，把文章案例里的代码都要敲一遍，最后一起提交到仓库。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAyMDE5Mjg3OA==\">https://segmentfault.com/a/1190000020192878</span></p>\n<p>任务：使用定时任务完成：<strong>定时数据库备份</strong>，备份每个月的 1 号凌晨 00: 00 点的数据库，要求兼容<strong> Window 和 Linux</strong> 双系统，把结果截图到 README.md 文件中。</p>\n<p>自己搭建 Linux 环境，镜像使用 Centos7，详细安装见下面这篇博客</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pvdWh1dS9hcnRpY2xlL2RldGFpbHMvODY1MzA3ODc=\">https://blog.csdn.net/zouhuu/article/details/86530787</span></p>\n<hr />\n<h3 id=\"day11\"><a class=\"anchor\" href=\"#day11\">#</a> day11：</h3>\n<h4 id=\"rabbitmq使用\"><a class=\"anchor\" href=\"#rabbitmq使用\">#</a> RabbitMq 使用</h4>\n<p>阅读博客文章：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAxOS8xMS8yOC9SYWJiaXRNcSVFNiU4QyU4NyVFNSU4RCU5Ny8=\">http://zzm.yunep.com/2019/11/28/RabbitMq 指南 /</span></p>\n<p><strong>要求：把博客里的练习代码都要敲一遍，并要求做学习笔记，后面提交到 git 仓库。</strong></p>\n<h4 id=\"rabbitmq发送短信验证码\"><a class=\"anchor\" href=\"#rabbitmq发送短信验证码\">#</a> RabbitMQ 发送短信验证码</h4>\n<p>将之前的短信服务抽离为一个独立工程，工程名称：<strong>姓名_day11_sms</strong></p>\n<p>将<strong> Day05 代码</strong>复制出来，更名为：<strong>姓名_day11_producer</strong></p>\n<p>当手机号注册，发送验证码的时候，需要向 Rabbitmq 发送消息，短信服务接收到消息，进行消费。</p>\n<p>发送短信服务工程为消费者，<strong>姓名_day11_producer</strong> 为生产者</p>\n<p><strong>将测试的结果截图到 README.md 中。</strong></p>\n<hr />\n<h3 id=\"day12\"><a class=\"anchor\" href=\"#day12\">#</a> day12：</h3>\n<h4 id=\"此次学习目标springbootrabbitmq-做智能家居\"><a class=\"anchor\" href=\"#此次学习目标springbootrabbitmq-做智能家居\">#</a> 此次学习目标：SpringBoot+RabbitMQ 做智能家居</h4>\n<p>阅读博客文章：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAyMC8xMC8xNC9TcHJpbmdCb290LVJhYmJpdE1RLSVFNSU4MSU5QSVFNiU5OSVCQSVFOCU4MyVCRCVFNSVBRSVCNiVFNSVCMSU4NS8=\">http://zzm.yunep.com/2020/10/14/SpringBoot-RabbitMQ - 做智能家居 /</span></p>\n<p>创建 SpringBoot 项目：工程名称：名字_day12</p>\n<p><strong>要求：实现文章里的案例功能，并要求写 README.md 学习笔记。</strong></p>\n<hr />\n<h3 id=\"day13\"><a class=\"anchor\" href=\"#day13\">#</a> day13：</h3>\n<p><strong>学习目标：Redis 使用</strong></p>\n<h4 id=\"1安装redis并了解redis命令\"><a class=\"anchor\" href=\"#1安装redis并了解redis命令\">#</a> 1. 安装 Redis 并了解 Redis 命令</h4>\n<h4 id=\"2了解redis的五种数据类型需要做笔记\"><a class=\"anchor\" href=\"#2了解redis的五种数据类型需要做笔记\">#</a> 2. 了解 Redis 的五种数据类型，需要做笔记！</h4>\n<ul>\n<li>\n<p><strong>String</strong></p>\n</li>\n<li>\n<p><strong>Hash</strong></p>\n</li>\n<li>\n<p><strong>list</strong></p>\n</li>\n<li>\n<p><strong>set</strong></p>\n</li>\n<li>\n<p><strong>zset</strong></p>\n</li>\n</ul>\n<h4 id=\"3springboot整合redis并实现手机验证码注册和验证码过期\"><a class=\"anchor\" href=\"#3springboot整合redis并实现手机验证码注册和验证码过期\">#</a> 3.springboot 整合 redis，并实现手机验证码注册和验证码过期</h4>\n<p>博客文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC85NzM5NDkzMg==\">https://zhuanlan.zhihu.com/p/97394932</span></p>\n<p>在短信服务工程中引入 redis，发送短信时：键：手机号码 +&quot;_register&quot; 值：短信验证码</p>\n<p>采用 redis 方式将短信验证码放入 redis 缓存中，如果<strong>验证码 60 秒内未过期</strong> 且 <strong>验证码匹配通过</strong>，则执行注册逻辑，完成注册。</p>\n<hr />\n<h3 id=\"day14\"><a class=\"anchor\" href=\"#day14\">#</a> day14：</h3>\n<p>简单使用 SpringSecurity【老懒狗可忽略】</p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDc2NjIxNC9hcnRpY2xlL2RldGFpbHMvMTA3MTA3NjM2\">https://blog.csdn.net/weixin_44766214/article/details/107107636</span></p>\n<p><strong>学习目标：Oauth2 使用入门</strong></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAxOS8xMi8xMy9PYXV0aDIlRTQlQkQlQkYlRTclOTQlQTglRTUlODUlQTUlRTklOTclQTgv\">http://zzm.yunep.com/2019/12/13/Oauth2 使用入门 /</span></p>\n<p>仓库名称：名字_day14</p>\n<p>根据博客代码搭建 Oauth2 登录认证，把代码提交到仓库，并把演示图和重要代码放到 README.md 文件中。</p>\n<hr />\n<h3 id=\"day15\"><a class=\"anchor\" href=\"#day15\">#</a> day15：</h3>\n<p><strong>学习目标：Oauth2 结合 JWT</strong></p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qd3QuaW8v\">https://jwt.io/</span></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAxOS8xMi8xMi9PYXV0aDIlRTclQkIlOTMlRTUlOTAlODhKV1Qv\">http://zzm.yunep.com/2019/12/12/Oauth2 结合 JWT/</span></p>\n<p>复制 day14 的项目，仓库名称：名字_day15</p>\n<p>使用 JWT 存储令牌，把博客上的练习代码都试一遍，并把演示图和重要代码放到 README.md 文件中。</p>\n<hr />\n<h3 id=\"day16\"><a class=\"anchor\" href=\"#day16\">#</a> day16：</h3>\n<p><strong>学习目标：Oauth2 实现单点登录</strong></p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qd3QuaW8v\">https://jwt.io/</span></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAxOS8xMi8yNi9PYXV0aDIlRTUlQUUlOUUlRTclOEUlQjAlRTUlOEQlOTUlRTclODIlQjklRTclOTklQkIlRTUlQkQlOTUv\">http://zzm.yunep.com/2019/12/26/Oauth2 实现单点登录 /</span></p>\n<p>复制 day15 的项目，仓库名称：名字_day16</p>\n<p>把博客上的练习代码都试一遍，并把演示图和重要代码放到 README.md 文件中。</p>\n<hr />\n<h3 id=\"day17\"><a class=\"anchor\" href=\"#day17\">#</a> day17：</h3>\n<p><strong>学习目标：ElasticSearch 安装</strong></p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9lbGFzdGljc2VhcmNoLw==\">https://www.elastic.co/cn/elasticsearch/</span></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAyMC8xMS8xMy9FbGFzdGljc2VhcmNoLSVFNSU4NSVBNSVFOSU5NyVBOCVFNSVBRSU4OSVFOCVBMyU4NS8=\">http://zzm.yunep.com/2020/11/13/Elasticsearch - 入门安装 /</span></p>\n<p>仓库名称：名字_day17</p>\n<p>把安装流程和安装完成演示图放到 README.md 文件中。</p>\n<hr />\n<h3 id=\"day18\"><a class=\"anchor\" href=\"#day18\">#</a> day18：</h3>\n<p>简简单单 Day 系列小任务，主要完成项目开发。</p>\n<p><strong>学习目标：ElasticSearch 核心概念和中文分词器配置</strong></p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9lbGFzdGljc2VhcmNoLw==\">https://www.elastic.co/cn/elasticsearch/</span></p>\n<p>中文分词器官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWsvcmVsZWFzZXMvdGFnL3Y3LjEwLjA=\">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.10.0</span></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS55dW5lcC5jb20vMjAyMC8xMS8xNy9FbGFzdGljU2VhcmNoJUU2JUEwJUI4JUU1JUJGJTgzJUU2JUE2JTgyJUU1JUJGJUI1JUU1JTkyJThDJUU0JUI4JUFEJUU2JTk2JTg3JUU1JTg4JTg2JUU4JUFGJThEJUU1JTk5JUE4Lw==\">http://zzm.yunep.com/2020/11/17/ElasticSearch 核心概念和中文分词器 /</span></p>\n<p>仓库名称：名字_day18</p>\n<p>把完成演示图放到 README.md 文件中。</p>\n<hr />\n<h3 id=\"day19\"><a class=\"anchor\" href=\"#day19\">#</a> day19：</h3>\n<p>简简单单 Day 系列小任务，主要完成项目开发。</p>\n<p><strong>学习目标：ElasticSearch 索引操作</strong></p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9lbGFzdGljc2VhcmNoLw==\">https://www.elastic.co/cn/elasticsearch/</span></p>\n<p>阅读博客：<span class=\"exturl\" data-url=\"aHR0cDovL3p6bS5sd2Vpc2hpLmNvbS8yMDIwLzExLzE3L0VsYXN0aWNTZWFyY2gtJUU3JUI0JUEyJUU1JUJDJTk1JUU1JTlGJUJBJUU2JTlDJUFDJUU2JTkzJThEJUU0JUJEJTlDLw==\">http://zzm.lweishi.com/2020/11/17/ElasticSearch - 索引基本操作 /</span></p>\n<p>仓库名称：名字_day19</p>\n<p>把完成演示图放到 README.md 文件中。</p>\n",
            "tags": [
                "计算机学习",
                "后端",
                "SpringBoot",
                "Springboot"
            ]
        }
    ]
}
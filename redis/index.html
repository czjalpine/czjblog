<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/zxy/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/zxy/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="失心耀的博客" href="https://xinyao_idiot.gitee.io/zxy/rss.xml"><link rel="alternate" type="application/atom+xml" title="失心耀的博客" href="https://xinyao_idiot.gitee.io/zxy/atom.xml"><link rel="alternate" type="application/json" title="失心耀的博客" href="https://xinyao_idiot.gitee.io/zxy/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/zxy/css/app.css?v=0.2.5"><meta name="keywords" content="Redis"><link rel="canonical" href="https://xinyao_idiot.gitee.io/zxy/redis/"><title>Redis初步学习 - Redis - 后端 - 计算机学习 | zxy Shoka = 失心耀的博客</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Redis初步学习</h1><div class="meta"><span class="item" title="创建时间：2021-05-13 16:30:03"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-05-13T16:30:03+08:00">2021-05-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>44k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>40 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/zxy/" rel="start">zxy Shoka</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciub8ja1j20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipesng5oej20zk0m87d4.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciusoyjnj219g0u0x56.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giph47e9vtj20zk0m8x6l.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeyonbf9j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicli9lfebj20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/zxy/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/zxy/categories/skill/" itemprop="item" rel="index" title="分类于 计算机学习"><span itemprop="name">计算机学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" itemprop="item" rel="index" title="分类于 后端"><span itemprop="name">后端</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/Redis/" itemprop="item" rel="index" title="分类于 Redis"><span itemprop="name">Redis</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://xinyao_idiot.gitee.io/zxy/redis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/zxy/images/avatar.jpg"><meta itemprop="name" content="失心耀"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="失心耀的博客"></span><div class="body md" itemprop="articleBody"><p><span id="more"></span></p><blockquote><p>Bilibili 搜索关注：狂神说（所有课程免费） 公众号：狂神说（日更文章）</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVM1NHkxUjdTQj9wPTE=">bilibili 狂神聊 redis</span></p><h1 id="狂神聊redis"><a class="anchor" href="#狂神聊redis">#</a> 狂神聊 Redis</h1><p>学习方式：不是为了面试和工作学习！仅仅是为了兴趣！兴趣才是最好的老师！</p><ul><li>基本的理论先学习，然后将知识融汇贯通！</li></ul><p><strong>狂神的 Redis 课程安排：</strong></p><ul><li>nosql 讲解</li><li>阿里巴巴架构演进</li><li>nosql 数据模型</li><li>Nosql 四大分类</li><li>CAP</li><li>BASE</li><li>Redis 入门</li><li>Redis 安装（Window &amp; Linux 服务器）</li><li>五大基本数据类型<ul><li>String</li><li>List</li><li>Set</li><li>Hash</li><li>Zset</li></ul></li><li>三种特殊数据类型<ul><li>geo</li><li>hyperloglog</li><li>bitmap</li></ul></li><li>Redis 配置详解</li><li>Redis 持久化<ul><li>RDB</li><li>AOF</li></ul></li><li>Redis 事务操作</li><li>Redis 实现订阅发布（消息队列）</li><li>Redis 主从复制</li><li>Redis 哨兵模式（现在公司中所有的集群都用哨兵模式）</li><li>缓存穿透及解决方案</li><li>缓存击穿及解决方案</li><li>缓存雪崩及解决方案</li><li>基础 API 之 Jedis 详解</li><li>SpringBoot 集成 Redis 操作</li><li>Redis 的实践分析</li></ul><h1 id="nosql概述"><a class="anchor" href="#nosql概述">#</a> Nosql 概述</h1><h2 id="为什么要用nosql"><a class="anchor" href="#为什么要用nosql">#</a> 为什么要用 Nosql</h2><blockquote><p>1 、单机 MySQL 的年代！</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515205042567.png" alt="image-20210515205042567"></p><p>90 年代，一个基本的网站访问量一般不会太大，单个数据库完全足够！</p><p>那个时候，更多的去使用静态网页 Html ~ 服务器根本没有太大的压力！</p><p>思考一下，这种情况下：整个网站的瓶颈是什么？</p><p>1 、数据量如果太大、一个机器放不下了！</p><p>2 、数据的索引 （B+ Tree），一个机器内存也放不下</p><p>3 、访问量（读写混合），一个服务器承受不了～</p><p>只要你开始出现以上的三种情况之一，那么你就必须要晋级！</p><blockquote><p>2 、Memcached（缓存） + MySQL + 垂直拆分 （读写分离）</p></blockquote><p>网站 80% 的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率！</p><p>发展过程： 优化数据结构和索引 --&gt; 文件缓存（IO）---&gt; Memcached（当时最热门的技术！）</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515210046188.png" alt="image-20210515210046188"></p><blockquote><p>3 、分库分表 + 水平拆分 + MySQL 集群</p></blockquote><p>技术和业务在发展的同时，对人的要求也越来越高！</p><p><mark>本质：数据库（读、写）</mark></p><p>早些年 MyISAM：表锁（100 万 张三 -- 密码），十分影响效率！高并发下就会出现严重的锁问题</p><p>转战 Innodb：行锁（每次查询只锁一行）</p><p>慢慢地就开始使用分库分表来解决写的压力！MySQL 在那个年代推出了表分区！这个并没有多少公司使用！</p><p>MySQL 的集群，很好满足那个年代的所有需求！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515210907927.png" alt="image-20210515210907927"></p><blockquote><p>4 、如今最近的年代</p></blockquote><p>2010--2020 十年之间，世界已经发生了翻天覆地的变化；（定位，也是一种数据，音乐，热榜！）</p><p>MySQL 等关系型数据库就不够用了！数据量很多，变化很快～！</p><p>MySQL 有的使用它来存储一些比较大的文件，博客，图片！数据库表很大，效率就低了！如果有一种数据库来专门处理这种数据，</p><p>MySQL 压力就变得十分小（研究如何处理这些问题！）大数据的 IO 压力下，表几乎没法更大！</p><blockquote><p>目前一个基本的互联网项目！</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515212827051.png" alt="image-20210515212827051"></p><blockquote><p>为什么要用 NoSQL！</p></blockquote><p>用户的个人信息、社交网络、地理位置、用户自己产生的数据、用户日志等等爆发式增长！</p><p>这时候我们就需要使用 NoSQL 数据库的，Nosql 可以很好的处理以上的情况！</p><h2 id="什么是nosql"><a class="anchor" href="#什么是nosql">#</a> 什么是 NoSQL</h2><blockquote><p>NoSQL</p></blockquote><p>NoSQL = Not Only SQL （不仅仅是 SQL）</p><p>关系型数据库：表格 ，行 ，列</p><p>泛指非关系型数据库的，随着 web2.0 互联网的诞生！传统的关系型数据库很难对付 web2.0 时代！尤其是超大规模的高并发的社区！ 暴露出来很多难以克服的问题，NoSQL 在当今大数据环境下发展的十分迅速，Redis 是发展最快的，而且是我们当下必须要掌握的一个技术！</p><p>很多的数据类型用户的个人信息，社交网络，地理位置。这些数据类型的存储不需要一个固定的格式！<br>不需要多余的操作就可以横向扩展的 ！ Map&lt;String,Object&gt; 使用键值对来控制！</p><blockquote><p>NoSQL 特点</p></blockquote><p>解耦！</p><p>1 、方便扩展（数据之间没有关系，很好扩展！）</p><p>2 、大数据量高性能（Redis 一秒写 8 万次，读取 11 万，NoSQL 的缓存记录级，是一种细粒度的缓存，性能会比较高！）</p><p>3 、数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据量十分大的表，很多人就无法设计了！）</p><p>4 、传统 RDBMS 和 NoSQL</p><pre><code>传统的RDBMS
- 结构化组织
- SQL
- 数据和关系都存在单独的表中 row col
- 数据操作，数据定义语言
- 严格的一致性
- 基础的事务
- ......
</code></pre><pre><code>Nosql
- 不仅仅是数据
- 没有固定的查询语言
- 键值对存储，列存储，文档存储，图形数据库（社交关系）
- 最终一致性
- CAP定理 和BASE理论（异地多活）初级架构师！（只要学不死，就往死里学）
- 高性能，高可用，高可扩展
- ......
</code></pre><blockquote><p>了解：3V+3 高</p></blockquote><p>大数据时代的 3V：主要是描述问题的</p><ol><li>海量 Volume</li><li>多样 Variety</li><li>实时 Velocity</li></ol><p>大数据时代的 3 高：主要是对程序的要求</p><ol><li>高并发</li><li>高可扩（随时水平拆分，机器不够了，可以扩展机器来解决）</li><li>高性能（保证用户体验和性能！）</li></ol><p>真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的，阿里巴巴的架构演进！</p><p>技术没有高低之分，就看你如何去使用！（提升内功，思维的提高！）</p><h2 id="阿里巴巴演进分析"><a class="anchor" href="#阿里巴巴演进分析">#</a> 阿里巴巴演进分析</h2><p>思考问题：这么多东西难道都是在一个数据库中的吗？</p><p>技术急不得，越是慢慢学，才能越扎实！</p><p>开源才是技术的王道！</p><p><mark>任何一家互联网的公司，都不可能只是简简单单让用户能用就好了！</mark></p><p>大量公司做的都是相同的业务；（竞品协议）</p><p>随着这样的竞争，业务是越来越完善，然后对于开发者的要求也是越来越高！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515220434523.png" alt="image-20210515220434523"></p><p>如果你未来相当一个架构师： 没有什么是加一层解决不了的！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1、商品的基本信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    名称、价格、商家信息：</pre></td></tr><tr><td data-num="3"></td><td><pre>    关系型数据库就可以解决了！MySQL/Oracle（淘宝早年就去IOE了！-王坚：推荐文章：阿里云的这群分子）</pre></td></tr><tr><td data-num="4"></td><td><pre>    淘宝内部的 MySQL 不是大家用的 MySQL</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 2、商品的描述、评论（文字比较多）</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	文档型数据库中，Redis/MongoDB</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 3、图片</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	分布式文件系统 FastDFS</pre></td></tr><tr><td data-num="9"></td><td><pre>	- 淘宝自己的  TFS</pre></td></tr><tr><td data-num="10"></td><td><pre>	- Gooale的   GFS</pre></td></tr><tr><td data-num="11"></td><td><pre>	- Hadoop    HDFS</pre></td></tr><tr><td data-num="12"></td><td><pre>	- 阿里云的    oss</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 4、商品的关键字（搜索）</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	- 搜索引擎 solr elasticsearch</pre></td></tr><tr><td data-num="15"></td><td><pre>	- ISerach：多隆（多去了解一下这些技术大佬）</pre></td></tr><tr><td data-num="16"></td><td><pre>	所有牛逼的人都有一段苦逼的岁月！但是你只要想SB一样的去坚持，终将牛逼！</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 5、商品热门的波段信息</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	- 内存数据库</pre></td></tr><tr><td data-num="19"></td><td><pre>	- Redis  Tair、Memache<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 6、商品的交易，外部的支付接口</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	- 三方应用</pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9hcnRpY2xlLzY1MzUxMQ==">阿里云的这群疯子</span></p><p>要知道，一个简单的网页背后的技术一定不是大家所想的那么简单！</p><p>大型互联网应用问题：</p><ul><li>数据类型太多了！</li><li>数据源繁多。经常重构！</li><li>数据要改造，大面积改造比较麻烦</li><li>解决问题:</li></ul><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515222041025.png" alt="image-20210515222041025"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515222408406.png" alt="image-20210515222408406"></p><p>这里以上都是 NoSQL 入门概述，不仅能够提高大家的知识，还可以帮助大家了解大厂的工作内容！</p><h2 id="nosql的四大分类"><a class="anchor" href="#nosql的四大分类">#</a> NoSQL 的四大分类</h2><blockquote><p><strong>KV 键值对：</strong></p></blockquote><ul><li><p>新浪： Redis</p></li><li><p>美团：Redis + Tair</p></li><li><p>阿里、百度：Redis + memacache</p></li></ul><blockquote><p><strong>文档型数据库（bson 格式 和 json 一样）：</strong></p></blockquote><ul><li>MongoDB （一般必须要掌握）<ul><li>MongoDB 是一个基于分布式文件存储的数据库，C++ 编写，主要用来处理大量的文档！</li><li>MongoDB 是一个介于关系型数据库和非关系型数据中中间的产品！MongoDB 是非关系型数据库中功能最丰富，最像关系型数据库的！</li></ul></li><li>ConthDB</li></ul><blockquote><p><strong>列存储数据库</strong></p></blockquote><ul><li>HBase</li><li>分布式文件系统</li></ul><blockquote><p><strong>图关系数据库</strong></p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515223344089.png" alt="image-20210515223344089"></p><ul><li><p>他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐！</p></li><li><p>Neo4j ，InfoGrid；</p></li></ul><blockquote><p><strong>四者对比！</strong></p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515223913698.png" alt="image-20210515223913698"></p><p>敬畏之心可以使人进步！宇宙！科幻！</p><p>活着的意义？ 追求幸福（帮助他人，感恩之心），探索未知（努力的学习，不要这个社会抛弃）</p><h1 id="redis入门"><a class="anchor" href="#redis入门">#</a> Redis 入门</h1><h2 id="概述"><a class="anchor" href="#概述">#</a> 概述</h2><blockquote><p>Redis 是什么？</p></blockquote><p>Redis（<mark>Re</mark>mote <mark>Di</mark>ctionary <mark>S</mark>erver )，即远程字典服务！</p><p>是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value 数据库，并提供多种语言的 API。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515225216671.png" alt="image-20210515225216671"></p><p>免费和开源！是当下最热门的 NoSQL 技术之一！也被人们称之为结构化数据库！</p><p>redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了<br>master-slave (主从) 同步。</p><blockquote><p>Redis 能干嘛？</p></blockquote><p>1 、内存存储、持久化，内存中是断电即失、所以说持久化很重要（rdb、aof）</p><p>2 、效率高，可以用于高速缓存</p><p>3 、发布订阅系统</p><p>4 、地图信息分析</p><p>5 、计时器、计数器（浏览量！）</p><p>6 、........</p><blockquote><p>特性</p></blockquote><p>1 、多样的数据类型</p><p>2 、持久化</p><p>3 、集群</p><p>4 、事务</p><p>......</p><blockquote><p>学习中需要用到的东西</p></blockquote><p>1 、狂神的公众号：狂神说</p><p>2 、官网：<span class="exturl" data-url="aHR0cHM6Ly9yZWRpcy5pby8=">https://redis.io/</span></p><p>3 、中文网：<span class="exturl" data-url="aHR0cDovL3d3dy5yZWRpcy5jbi8=">http://www.redis.cn/</span></p><p>4 、下载地址：通过官网下载即可！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515225832019.png" alt="image-20210515225832019"></p><p>注意：Wdinow 在 Github 上下载（停更很久了！）</p><p><mark>Redis 推荐都是在 Linux 服务器上搭建的，我们是基于 Linux 学习！</mark></p><h2 id="windows安装"><a class="anchor" href="#windows安装">#</a> Windows 安装</h2><p>1 、下载安装包：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RtYWpraWMvcmVkaXMvcmVsZWFzZXM=">https://github.com/dmajkic/redis/releases</span></p><p>2 、下载完毕得到压缩包：</p><p>3 、解压到自己电脑上的环境目录下的就可以的！Redis 十分的小，只有 5M</p><p>4 、开启 Redis，双击运行服务即可！</p><p>5 、使用 redis 客户单来来连接 redis</p><p>记住一句话，Window 下使用确实简单，但是 Redis 推荐我们使用 Linux 去开发使用！</p><h2 id="linux安装"><a class="anchor" href="#linux安装">#</a> Linux 安装</h2><p>1 、下载安装包！ <code>redis-5.0.8.tar.gz</code></p><p>2 、解压 Redis 的安装包！ 程序一般放到 /opt 目录下</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mv</span> redis-6.2.3.tar.gz /opt</pre></td></tr></table></figure><p>3 、进入解压后的文件，可以看到我们 redis 的配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">tar</span> -zxvf redis-6.2.3.tar.gz</pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231004876.png" alt="image-20210515231004876"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231111463.png" alt="image-20210515231111463"></p><p>4 、基本的环境安装</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>yum <span class="token function">install</span> gcc-c++</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">make</span> <span class="token function">install</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231552495.png" alt="image-20210515231552495"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231737409.png" alt="image-20210515231737409"></p><p>5 、redis 的默认安装路径 <code>/usr/local/bin</code></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515231925392.png" alt="image-20210515231925392"></p><p>6 、将 redis 配置文件。复制到我们当前目录下</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232123274.png" alt="image-20210515232123274"></p><p>7 、redis 默认不是后台启动的，修改配置文件！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232321291.png" alt="image-20210515232321291"></p><p>8 、启动 Redis 服务！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lloam bin<span class="token punctuation">]</span><span class="token comment"># redis-server maoconfig/redis.conf</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232453274.png" alt="image-20210515232453274"></p><p>9 、使用 redis-cli 进行连接测试！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lloam bin<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515232759601.png" alt="image-20210515232759601"></p><p>10 、查看 redis 的进程是否开启！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233041587.png" alt="image-20210515233041587"></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lloam /<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span></pre></td></tr></table></figure><p>11 、如何关闭 Redis 服务呢？ shutdown</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233158652.png" alt="image-20210515233158652"></p><p>12 、再次查看进程是否存在</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233211116.png" alt="image-20210515233211116"></p><p>13 、后面我们会使用单机多 Redis 启动集群测试！</p><h2 id="测试性能"><a class="anchor" href="#测试性能">#</a> 测试性能</h2><p><strong>redis-benchmark</strong> 是一个压力测试工具！</p><p>官方自带的性能测试工具！</p><p>redis-benchmark 命令参数！</p><p>图片来自菜鸟教程：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515233448855.png" alt="image-20210515233448855"></p><p>我们来简单测试下：</p><p>如何查看这些分析呢？</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 测试： 100 个并发连接 100000 请求</span></pre></td></tr><tr><td data-num="2"></td><td><pre>redis-benchmark -h localhost -p <span class="token number">6379</span> -c <span class="token number">100</span> -n <span class="token number">100000</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234105056.png" alt="image-20210515234105056"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234452037.png" alt="image-20210515234452037"></p><p>查看这些分析？</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210515234613748.png" alt="image-20210515234613748"></p><h2 id="基础的知识"><a class="anchor" href="#基础的知识">#</a> 基础的知识</h2><p>redis 默认有 16 个数据库</p><p><strong>默认使用的是第 0 个</strong></p><p>可以使用 select 进行切换数据库！</p><p>清除当前数据库 flushdb</p><p>清除全部数据库的内容 FLUSHALL</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token keyword">select</span> <span class="token number">3</span> <span class="token comment"># 切换数据库</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127</span> .0.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">></span> DBSIZE  <span class="token comment"># 查看 DB 大小！</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516200010388.png" alt="image-20210516200010388"></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127</span> .0.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">></span> keys *  <span class="token comment"># 查看数据库所有的 key</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr></table></figure><p>清除当前的数据库 <code>flushdb</code></p><p>清空全部数据库 <code>flushall</code></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">></span> flushdb</pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">></span> keys *</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>empty array<span class="token punctuation">)</span></pre></td></tr></table></figure><p>思考：为什么 redis 是 6379 ！粉丝效应！（了解一下即可！）</p><blockquote><p>Redis 是单线程的！</p></blockquote><p>明白 Redis 是很快的，官方表示，Redis 是基于内存操作，CPU 不是 Redis 性能瓶颈，Redis 的瓶颈是根据机器的内存和网络带宽，既然可以使用单线程来实现，就使用单线程了！所以就使用了单线程了！</p><p>Redis 是 C 语言写的，官方提供的数据为 100000+ 的 QPS，完全不比同样是使用 key-vale 的 Memecache 差！</p><p><strong>Redis 为什么单线程还这么快？</strong></p><p>1 、误区 1 ：高性能的服务器一定是多线程的？</p><p>2 、误区 2 ：多线程（CPU 上下文会切换！）一定比单线程效率高！</p><p>先去 CPU &gt; 内存 &gt; 硬盘的速度要有所了解！</p><p>核心：redis 是将所有的数据全部放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU 上下文会切换：耗时的操作！！！），对于内存系统来说，如果没有上下文切换效率就是最高<br>的！多次读写都是在一个 CPU 上的，在内存情况下，这个就是最佳的方案！</p><h1 id="五大数据类型"><a class="anchor" href="#五大数据类型">#</a> 五大数据类型</h1><blockquote><p>官网文档</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516201315950.png" alt="image-20210516201315950"></p><p><code>全段翻译：</code></p><p>Redis 是一个开源（BSD 许可）的，内存中的数据结构存储系统，它可以用作<mark>数据库、缓存和消息中间件 MQ</mark>。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合<br>（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA 脚本（Lua scripting）， LRU 驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis 哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p><blockquote><p>移动 key</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> move name <span class="token number">1</span> <span class="token comment"># 将 key 为 name 的 key 移动到 1 号数据库</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token keyword">select</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>OK</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> keys *</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr></table></figure><blockquote><p>我们现在讲解的所有命令大家一定要全部记住，后面我们使用 SpringBoot。Jedis，所有的方法就是这些命令！</p><p>单点登录</p></blockquote><h2 id="redis-key"><a class="anchor" href="#redis-key">#</a> Redis-Key</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *  <span class="token comment"># 查看所有的 key</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> name kuangshen  <span class="token comment"># set key</span></pre></td></tr><tr><td data-num="4"></td><td><pre>OK</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> age <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>OK</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> EXISTS name  <span class="token comment"># 判断当前的 key 是否存在</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> EXISTS name</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> move name <span class="token number">1</span> <span class="token comment"># 将 key 为 name 的 key 移动到 1 号数据库</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#################################################</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token keyword">select</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="23"></td><td><pre>OK</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> keys *</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> name qinjiang</pre></td></tr><tr><td data-num="27"></td><td><pre>OK</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token function">clear</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token string">"age"</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token string">"name"</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get name</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token string">"qinjiang"</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> EXPIRE name <span class="token number">10</span> <span class="token comment"># 设置 key 的过期时间，单位是秒</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl name  <span class="token comment"># 查看当前 key 的剩余时间</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl name</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl name</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl name</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl name</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get name</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">type</span> name  <span class="token comment"># 查看当前 key 的一个类型！</span></pre></td></tr><tr><td data-num="52"></td><td><pre>string</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">127</span> .0.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">type</span> age</pre></td></tr><tr><td data-num="54"></td><td><pre>string</pre></td></tr></table></figure><p>后面如果遇到不会的命令，可以在官网查看帮助文档！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516202657996.png" alt="image-20210516202657996"></p><h2 id="string字符串"><a class="anchor" href="#string字符串">#</a> String（字符串）</h2><p>90% 的 java 程序员使用 redis 只会使用一个 String 类型！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> key1 v1		<span class="token comment"># 设置值</span></pre></td></tr><tr><td data-num="3"></td><td><pre>OK</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key1		<span class="token comment"># 获得值</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"v1"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *			<span class="token comment"># 获得所有的 key</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"key1"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> exists key1		<span class="token comment"># 判断某一个 key 是否存在</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> append key1 hello  <span class="token comment"># 追加字符串，如果当前 key 不存在，就相当于 set key</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key1</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token string">"v1hello"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> strlen key1		<span class="token comment"># 获取字符串的长度</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> append key1 mao</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> strlen key1</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key1</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token string">"v1hellomao"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># i++</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 步长 i+=</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> views <span class="token number">0</span></pre></td></tr><tr><td data-num="26"></td><td><pre>OK</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get views</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token string">"0"</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> incr views		<span class="token comment"># 自增 1  浏览量为 1</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> incr views</pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get views</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token string">"2"</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> decr views		<span class="token comment"># 自减 1   浏览量 - 1</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> decr views</pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> decr views</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -1</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get views</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token string">"-1"</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> incrby views <span class="token number">10</span>		<span class="token comment">#可以设置步长，指定增量</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">9</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> decrby views <span class="token number">5</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment"># 字符串范围 range</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> key1 hello,mao		<span class="token comment"># 设置 key1 的值</span></pre></td></tr><tr><td data-num="50"></td><td><pre>OK</pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key1</pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token string">"hello,mao"</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getrange key1 <span class="token number">0</span> <span class="token number">3</span>		<span class="token comment"># 截取字符串 [0,3]</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token string">"hell"</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getrange key1 <span class="token number">0</span> -1		<span class="token comment"># 获取全部的字符串 和 get key 是一样的</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token string">"hello,mao"</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment"># 替换！</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> key2 abcdefg</pre></td></tr><tr><td data-num="60"></td><td><pre>OK</pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key2</pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token string">"abcdefg"</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> setrange key2 <span class="token number">1</span> XX		<span class="token comment">#替换指定位置开始的字符串</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key2</pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token string">"aXXdefg"</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment"># setex (set with expire) # 设置过期时间</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment"># setnx (set if not exist) # 不存在再设置 (在分布式锁中常常使用)</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> setex key3 <span class="token number">30</span> hello		<span class="token comment"># 设置 key3 的值为 hello，30 秒后过期</span></pre></td></tr><tr><td data-num="71"></td><td><pre>OK</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl key3</pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">26</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key3</pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token string">"hello"</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> setnx mykey redis		<span class="token comment"># 如果 mykey 不存在，创建 mykey</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"key2"</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"mykey"</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"key1"</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ttl key3</pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2</pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> setnx mykey MongoDB		<span class="token comment"># 如果 mykey 存在，创建失败</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get mykey</pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token string">"redis"</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment"># mset</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment"># mget</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mset k1 v1 k2 v2 k3 v3		<span class="token comment">#同时设置多个值</span></pre></td></tr><tr><td data-num="92"></td><td><pre>OK</pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k2"</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k3"</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k1"</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mget k1 k2 k3		<span class="token comment"># 同时获取多个值</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v2"</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v3"</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> msetnx k1 v1 k4 v4		<span class="token comment"># msetnx 是一个原子性的操作，要么一起成功，要么一起失败</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k4</pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment"># 对象</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token builtin class-name">set</span> user:1<span class="token punctuation">&#123;</span>name:zhangsan,age:3<span class="token punctuation">&#125;</span>  <span class="token comment"># 设置一个 user：1 对象 值为 json 字符来保存一个对象！</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token comment"># 这里的 key 是一个巧妙地设计：user:&#123;id&#125;:&#123;filed&#125;, 如此设计在 Redis 中是完全 OK 了！</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mset user:1:name zhangsan user:1:age <span class="token number">2</span></pre></td></tr><tr><td data-num="110"></td><td><pre>OK</pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> mget user:1:name user:1:age</pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="115"></td><td><pre>getset <span class="token comment"># 先 get 然后再 set</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getset db redis		<span class="token comment"># 如果不存在值，则返回 nil</span></pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get db</pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token string">"redis"</span></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getset db MongoDB		<span class="token comment"># 如果存在值，获取原来的值，并设置新的值</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token string">"redis"</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get db</pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token string">"MongoDB"</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr></table></figure><p>数据结构是相通的！</p><p>String 类似的使用场景：value 除了是我们的字符串还可以是我们的数字！</p><ul><li>计数器</li><li>统计多单位的数量</li><li>粉丝数</li><li>对象缓存存储！</li></ul><h2 id="list列表"><a class="anchor" href="#list列表">#</a> List（列表）</h2><p>基本的数据类型，列表</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210516211032480.png" alt="image-20210516211032480"></p><p>在 redis 里面，我们可以把 list 玩成 ，栈、队列、阻塞队列！</p><p>所有的 list 命令都是用 l 开头的，Redis 不区分大小命令</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list one		<span class="token comment">#将一个值或多个值插入到列表的头部（左）</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list two</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list three</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1		<span class="token comment"># 获取 list 中的值！</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> <span class="token number">1</span>		<span class="token comment"># 通过区间获取具体的值！</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush list right		<span class="token comment">#将一个值或多个插入到列表尾部（右）</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"right"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="23"></td><td><pre>lpop</pre></td></tr><tr><td data-num="24"></td><td><pre>rpop</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"right"</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpop list 		<span class="token comment"># 移除 list 的第一个元素</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token string">"three"</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpop list		<span class="token comment"># 移除 list 的最后一个元素</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token string">"right"</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="38"></td><td><pre>Lindex</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lindex list <span class="token number">1</span>		<span class="token comment"># 通过下标获得 list 中的某一个值！</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token string">"one"</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lindex list <span class="token number">0</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token string">"two"</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="47"></td><td><pre>Llen</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list one</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list two</pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list three</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> llen list		<span class="token comment"># 返回列表的长度</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="57"></td><td><pre>移除指定的值！</pre></td></tr><tr><td data-num="58"></td><td><pre>lrem</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrem list <span class="token number">1</span> one		<span class="token comment"># 移除 list 集合中指定个数的 value，精确匹配</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrem list <span class="token number">2</span> three</pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> -1	<span class="token comment"># 移除 list 集合中指定个数的 value，移除 2 个 three</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="75"></td><td><pre>trim 修剪：list 截断</pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello1</pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello2</pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello3</pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ltrim mylist <span class="token number">1</span> <span class="token number">2</span>	<span class="token comment"># 通过下标截取指定的长度，这个 list 已经被改变了，截断了只剩下截取的元素！</span></pre></td></tr><tr><td data-num="85"></td><td><pre>OK</pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange mylist <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello1"</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello2"</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="91"></td><td><pre>rpoplpush <span class="token comment"># 移除列表的最后一个元素并移动到新的列表当中</span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello1</pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello2</pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpoplpush mylist myotherlist	 <span class="token comment"># 移除列表的最后一个元素，并移动到新的列表当中！</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token string">"hello2"</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange mylist <span class="token number">0</span> -1	<span class="token comment">#查看原来的列表</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello1"</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange myotherlist <span class="token number">0</span> -1	<span class="token comment">#查看目标列表中，确实存在该值</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello2"</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="106"></td><td><pre>lset <span class="token comment"># 将列表中指定下标的值替换为另外一个值，更新操作</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> exists list		<span class="token comment"># 判断这个列表是否存在</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lset list <span class="token number">0</span> item	<span class="token comment"># 如果不存在列表我们去更新就会报错</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR no such key</pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lpush list value1</pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"value1"</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lset list <span class="token number">0</span> item	<span class="token comment"># 如果存在，就更新下标的值</span></pre></td></tr><tr><td data-num="116"></td><td><pre>OK</pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange list <span class="token number">0</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"item"</span></pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lset list <span class="token number">1</span> other	<span class="token comment"># 如果存在列表，但不存在值也会报错</span></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR index out of range</pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="122"></td><td><pre>linsert	<span class="token comment"># 将某个具体的 value 插入到列表中某个元素的前面后者后面</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist hello</pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> rpush mylist world</pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> linsert mylist before world other	<span class="token comment"># 在 world 前面插入 other</span></pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange mylist <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="130"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="131"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"other"</span></pre></td></tr><tr><td data-num="132"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="133"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> linsert mylist after world new	<span class="token comment"># 在 world 后面插入 new</span></pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> lrange mylist <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"other"</span></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="139"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"new"</span></pre></td></tr><tr><td data-num="140"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr></table></figure><blockquote><p>小结</p></blockquote><ul><li>他实际上是一个链表，before Node after ， 它的 left，right 都可以插入值</li><li>如果 key 不存在，创建新的链表</li><li>如果 key 存在，新增内容</li><li>如果移除了所有值，空链表，也代表不存在！</li><li>在两边插入或者改动值效率最高！如果操作中间元素，相对来说效率会低一点</li></ul><p>消息排队！消息队列 （Lpush，Rpop），栈（Lpush，Lpop）</p><h2 id="set集合"><a class="anchor" href="#set集合">#</a> Set（集合）</h2><p>set 中的值是不能重读的！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset hello		<span class="token comment"># set 集合中添加元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset mao</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset lovemao</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> smembers myset		<span class="token comment"># 查看指定 set 的所有值</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SISMEMBER myset hello	<span class="token comment">#判断某一个值是不是在 set 集合中！，存在返回 1，不存在返回 0</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SISMEMBER myset world</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SCARD myset		<span class="token comment"># 获取 set 集合中的内容元素个数</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset lovemao2</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> scard myset</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="24"></td><td><pre>srem</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> srem myset hello		<span class="token comment"># 移除 set 集合中的指定元素</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> scard myset</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token builtin class-name">set</span> <span class="token comment"># 无序不重复集合。抽随机！</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset		<span class="token comment"># 随机抽选出一个元素</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset</pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset <span class="token number">2</span>		<span class="token comment">#随机抽选出指定个数的元素</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset <span class="token number">2</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SRANDMEMBER myset <span class="token number">2</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="58"></td><td><pre>删除指定的key：srem，随机删除key：spop！</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> spop myset		<span class="token comment"># 随机删除一些 set 集合中的元素！</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token string">"lovemao"</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> spop myset</pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token string">"mao"</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lovemao2"</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment"># 将一个指定的值移动到另外一个 set 集合中</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset hello</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset</pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'sadd'</span> <span class="token builtin class-name">command</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset world</pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset mao</pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd myset2 set2</pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> smove myset myset2 mao	<span class="token comment"># 将一个指定的值，移动到另外一个 set 集合中</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset</pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SMEMBERS myset2</pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"set2"</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="90"></td><td><pre>微博，B站，共同关注！<span class="token punctuation">(</span>并集<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>数字集合类：</pre></td></tr><tr><td data-num="92"></td><td><pre> - 差集 SDIFF</pre></td></tr><tr><td data-num="93"></td><td><pre> - 交集 SINTER</pre></td></tr><tr><td data-num="94"></td><td><pre> - 并集 SUNION</pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd key1 b</pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd key1 c</pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd key2 c</pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd key2 d</pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> sadd key2 e</pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SDIFF key1 key2		<span class="token comment"># 差集</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SINTER key1 key2		<span class="token comment"># 交集   共同好友就可以这样实现</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"c"</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SUNION key1 key2		<span class="token comment"># 并集</span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"c"</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"e"</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"a"</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"d"</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr></table></figure><p>微博，A 用户将所有关注的人放在一个 set 集合中！将他的粉丝也放在一个集合中！</p><p>共同关注，共同爱好，二度好友（六度分割理论）</p><h2 id="hash哈希"><a class="anchor" href="#hash哈希">#</a> Hash（哈希）</h2><p>Map 集合，key-map! 时候这个值是一个 map 集合！ 本质和 String 类型没有太大区别，还是一个简单的 key-value！</p><p>set myhash field mao</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hset myhash field1 mao	<span class="token comment"># set 一个具体的 key-value</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hget myhash field1	<span class="token comment"># 获取一个字段值</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"mao"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hmset myhash field1 hello field2 world	<span class="token comment"># set 多个 key-value</span></pre></td></tr><tr><td data-num="7"></td><td><pre>OK</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hmget myhash field1 field2	<span class="token comment"># 获取多个字段值</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hgetall myhash	<span class="token comment"># 获取全部的数据</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"field1"</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"field2"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hdel myhash field1	<span class="token comment"># 删除 hash 指定的 key 字段！对应的 value 值也就消失了！</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hgetall myhash</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"field2"</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="22"></td><td><pre>hlen <span class="token comment"># 获取 hash 表的字段数量！</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hmset myhash field1 hello field2 world</pre></td></tr><tr><td data-num="24"></td><td><pre>OK</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hgetall myhash</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"field2"</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"field1"</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hlen myhash	<span class="token comment"># 获取 hash 表的字段数量！</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> HEXISTS myhash field1	<span class="token comment"># 判断 hash 中指定字段是否存在！</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> HEXISTS myhash field3</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 只获得所有 field</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment"># 只获得所有 value</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hkeys myhash	<span class="token comment"># 只获得所有 field</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"field2"</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"field1"</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hvals myhash	<span class="token comment"># 只获得所有 value</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"world"</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hello"</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="47"></td><td><pre>incr  decr</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hset myhash field3 <span class="token number">5</span>	<span class="token comment"># 指定增量</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> HINCRBY myhash field3 <span class="token number">1</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> HINCRBY myhash field3 -1</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hsetnx myhash field4 hello	<span class="token comment">#如果不存在则可以设置</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> hsetnx myhash field4 hello	<span class="token comment"># 如果存在则不能设置</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr></table></figure><p>hash 变更的数据 user name age，尤其是用户信息之类的，经常变动的信息！hash 更适合于对象的存储，而 string 更加适合字符串的存储！</p><h2 id="zset有序集合"><a class="anchor" href="#zset有序集合">#</a> Zset（有序集合）</h2><p>在 set 的基础上，增加了一个值，set k1 v1 zset k1 score1 v1</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myset <span class="token number">1</span> one		<span class="token comment">#添加一个值</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myset <span class="token number">2</span> two <span class="token number">3</span> three	<span class="token comment">#添加多个值</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ZRANGE myset <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"one"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"three"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="11"></td><td><pre>排序如何实现</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd salary <span class="token number">2500</span> xiaohong	<span class="token comment"># 添加三个用户</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd salary <span class="token number">5000</span> zhangsan</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd salary <span class="token number">500</span> mao</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># ZRANGEBYSCORE key min max</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ZRANGEBYSCORE salary -inf +inf	<span class="token comment">#显示全部的用户 从小到大</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ZREVRANGE salary <span class="token number">0</span> -1	<span class="token comment"># 从大到小进行排序</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ZRANGEBYSCORE salary -inf +inf withscores	<span class="token comment"># 显示全部的用户并且附带成绩</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"500"</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"2500"</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> ZRANGEBYSCORE salary -inf <span class="token number">2500</span> withscores	<span class="token comment"># 显示工资小于 2500 员工的升序排列</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"500"</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"2500"</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 移除 rem 中的元素</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange salary <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xiaohong"</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrem salary xiaohong	<span class="token comment"># 移除有序集合中的指定的元素</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange salary <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"mao"</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zcard salary		<span class="token comment"># 获取有序集合中的个数</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myset <span class="token number">1</span> hello</pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zadd myset <span class="token number">2</span> world <span class="token number">3</span> mao</pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zcount myset <span class="token number">1</span> <span class="token number">3</span>	<span class="token comment"># 获取指定区间的成员数量</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zcount myset <span class="token number">1</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr></table></figure><p>其余的一些 API，通过我们的学习，剩下的如果工作中又需要，这个时候可以去查看官方文档！</p><p>案例思路：set 排序 存储班级成绩表 工资表排序！</p><p>普通消息，1，重要消息，2，带权重进行判断！</p><p>排行榜应用实现，取 Top 值</p><h1 id="三种特殊数据类型"><a class="anchor" href="#三种特殊数据类型">#</a> 三种特殊数据类型</h1><h2 id="geospatial-地理位置"><a class="anchor" href="#geospatial-地理位置">#</a> Geospatial 地理位置</h2><p>朋友的定位，附近的人，打车距离计算？</p><p>Redis 的 Geo 在 Redis3.2 版本就推出了！ 这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人！</p><p>可以查询一些测试数据：<span class="exturl" data-url="aHR0cHM6Ly9qaW5nd2VpZHUuYm1jeC5jb20v">https://jingweidu.bmcx.com/</span></p><p>只有 六个命令：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210517220126455.png" alt="image-20210517220126455"></p><blockquote><p>geoadd</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210517221324145.png" alt="image-20210517221324145"></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##########################################################</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># geoadd 添加地理位置</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 规则：两级无法直接添加，我们一般会下载城市数据，直接通过 java 程序一次性导入</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 参数 key 值（经度，维度，名称）</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 由 EPSG：900913 / EPSG：3785 / OSGEO：41001 指定的确切限制如下：</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 有效经度为 - 180 至 180 度。</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 有效纬度为 - 85.05112878 至 85.05112878 度。</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 当用户尝试索引超出指定范围的坐标时，该命令将报告错误。</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">34.23</span> <span class="token number">108.93</span> nanchang</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR invalid longitude,latitude pair <span class="token number">34.230000</span>,108.930000</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">116.23</span> <span class="token number">40.22</span> beijing</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">121.48</span> <span class="token number">31.40</span> shanghai</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">106.54</span> <span class="token number">29.40</span> chongqing</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">113.88</span> <span class="token number">22.55</span> shenzhen</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">120.21</span> <span class="token number">30.20</span> hangzhou</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geoadd china:city <span class="token number">108.93</span> <span class="token number">34.23</span> xian</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr></table></figure><blockquote><p>geopos</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEOPOS china:city beijing	<span class="token comment"># 获取指定的城市的经度和纬度！</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"116.23000055551528931"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"40.2200010338739844"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEOPOS china:city chongqing</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.54000014066696167"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.39999880018641676"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEOPOS china:city beijing chongqing</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"116.23000055551528931"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"40.2200010338739844"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.54000014066696167"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.39999880018641676"</span></pre></td></tr></table></figure><blockquote><p>GEODIST</p></blockquote><p>两人之间的距离</p><p>单位：</p><ul><li><strong>m</strong> 表示单位为米。</li><li><strong>km</strong> 表示单位为千米。</li><li><strong>mi</strong> 表示单位为英里。</li><li><strong>ft</strong> 表示单位为英尺。</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEODIST china:city beijing shanghai km	<span class="token comment"># 查看上海到北京的直线距离</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token string">"1088.7854"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEODIST china:city beijing chongqing km	<span class="token comment"># 查看重庆到北京的直线距离</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"1491.6716"</span></pre></td></tr></table></figure><blockquote><p>GEORADIUS 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p></blockquote><p>我附近的人？（获得所有附近的人的地址，定位！) 通过半径来查询！</p><p>获得指定数量的人，200</p><p>所有的数据应该录入：china:city，才会让结果更加清晰！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km	<span class="token comment"># 以 110，30 这个经纬度为中心，寻找方圆 1000km 内的城市</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"shenzhen"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist	<span class="token comment"># 显示到中心距离的位置</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"340.8679"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"481.1540"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withcoord	<span class="token comment"># 显示他人的定位信息</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.54000014066696167"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.39999880018641676"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"108.92999857664108276"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"34.23000121926852302"</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist withcoord count <span class="token number">1</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"340.8679"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.54000014066696167"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.39999880018641676"</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUS china:city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist withcoord count <span class="token number">2</span>	<span class="token comment"># 筛选出指定的结果！</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"340.8679"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"106.54000014066696167"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.39999880018641676"</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"481.1540"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"108.92999857664108276"</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"34.23000121926852302"</span></pre></td></tr></table></figure><blockquote><p>GEORADIUSBYMEMBER</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 找出位于指定元素周围的其他元素！</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUSBYMEMBER china:city beijing <span class="token number">1000</span> km</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> GEORADIUSBYMEMBER china:city shanghai <span class="token number">400</span> km</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span></pre></td></tr></table></figure><blockquote><p>GEOHASH 返回一个或多个位置元素的 Geohash 表示。</p></blockquote><p>该命令将返回 11 个字符的 Geohash 字符串</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 将二维的经纬度转换为一维的字符串，如果两个字符串越接近，那么则距离越近！</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> geohash china:city beijing chongqing</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"wx4sucu47r0"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"wm5z22h53v0"</span></pre></td></tr></table></figure><blockquote><p>GEO 底层的实现原理其实就是 Zset！我们可以使用 Zset 命令来操作 geo！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange china:city <span class="token number">0</span> -1	<span class="token comment"># 查看地图中全部的元素</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"shenzhen"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"beijing"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrem china:city beijing		<span class="token comment"># 移除指定的元素</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> zrange china:city <span class="token number">0</span> -1</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"chongqing"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"xian"</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"shenzhen"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"hangzhou"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"shanghai"</span></pre></td></tr></table></figure><h2 id="hyperloglog"><a class="anchor" href="#hyperloglog">#</a> Hyperloglog</h2><blockquote><p>什么是基数？</p></blockquote><p 1,3,5,7,8,7="">A</p><p 1,3,5,7,8="">B</p><p>基数（不重复的元素） = 5，可以接受误差！</p><blockquote><p>简介</p></blockquote><p>Redis 2.8.9 版本就更新了 Hyperloglog 数据结构！</p><p>Redis Hyperloglog 基数统计的算法！</p><p>找出位于指定元素周围的其他元素！</p><p><strong>优点：占用的内存是固定，2^64 不同的元素的技术，只需要废 12KB 内存！如果要从内存角度来比较的话 Hyperloglog 首选！</strong></p><p><strong>网页的 UV （一个人访问一个网站多次，但是还是算作一个人！）</strong></p><p>传统的方式， set 保存用户的 id，然后就可以统计 set 中的元素数量作为标准判断！</p><p>这个方式如果保存大量的用户 id，就会比较麻烦！我们的目的是为了计数，而不是保存用户 id；</p><p>大概有 0.81% 错误率！ 统计 UV 任务，可以忽略不计的！</p><blockquote><p>测试使用</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> pfadd myset a b c d e f g h i j	<span class="token comment"># 创建第一组元素</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PFCOUNT myset	<span class="token comment"># 统计 mykey 中元素的基数数量</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> pfadd myset2 i jj z x c <span class="token function">v</span> b n m	<span class="token comment">#创建第二组元素 mykey2</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PFCOUNT myset2</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">9</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> pfmerge mykey3 myset myset2	<span class="token comment"># 合并两组 mykey mykey2 =》mykey3 并集</span></pre></td></tr><tr><td data-num="10"></td><td><pre>OK</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> pfcount mykey3	<span class="token comment"># 查看并集的数量</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">16</span></pre></td></tr></table></figure><p>如果允许容错，那么一定可以使用 Hyperloglog ！</p><p>如果不允许容错，就使用 set 或者自己的数据类型即可！</p><h2 id="bitmap"><a class="anchor" href="#bitmap">#</a> Bitmap</h2><p>为什么其他教程都不喜欢讲这些？这些在生活中或者开发中，都有十分多的应用场景，学习了，就是多一个思路！技多不压身！</p><blockquote><p>位存储</p></blockquote><p>统计用户信息，活跃，不活跃！ 登录 、 未登录！ 打卡， 365 打卡！ 两个状态的，都可以使用 Bitmaps！</p><p>Bitmap 位图，数据结构！ 都是操作二进制位来进行记录，就只有 0 和 1 两个状态！</p><p>365 天 = 365 bit 1 字节 = 8bit 46 个字节左右！</p><blockquote><p>测试</p></blockquote><p>使用 bitmap 来记录 周一到周日的打卡！</p><p>周一打卡：1 周二打卡：1....</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518202441951.png" alt="image-20210518202441951"></p><p>查看某一天是否打卡！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getbit sign <span class="token number">3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> getbit sign <span class="token number">5</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span></pre></td></tr></table></figure><p>统计操作，统计打卡的天数！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> bitcount sign	<span class="token comment"># 统计这周的打卡天数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span></pre></td></tr></table></figure><h1 id="事务"><a class="anchor" href="#事务">#</a> 事务</h1><p>Redis 事务本质：一组命令的集合！ 一个事务中的所有命令都会被序列化，在事务执行过程的中，会按照顺序执行！</p><p>一次性、顺序性、排他性！执行一些列的命令！</p><p>Redis 事务没有没有隔离级别的概念！</p><p>所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！Exec</p><p><mark>Redis 单条命令是保存原子性的，但是事务不保证原子性！</mark></p><p>redis 的事务：</p><ul><li>开启事务（multi）</li><li>命令入队（......）</li><li>执行事务（exec）</li></ul><blockquote><p>正常执行事务！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi		<span class="token comment"># 开启事务</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k1 v1</pre></td></tr><tr><td data-num="4"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k2 v2</pre></td></tr><tr><td data-num="6"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> get k2</pre></td></tr><tr><td data-num="8"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k3 v3</pre></td></tr><tr><td data-num="10"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">exec</span>		<span class="token comment"># 执行事务</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> OK</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> OK</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v2"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> OK</pre></td></tr></table></figure><blockquote><p>放弃事务！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi		<span class="token comment"># 开启事务</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k1 v1</pre></td></tr><tr><td data-num="4"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k2 v2</pre></td></tr><tr><td data-num="6"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k4 v4</pre></td></tr><tr><td data-num="8"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> DISCARD		<span class="token comment"># 取消事务</span></pre></td></tr><tr><td data-num="10"></td><td><pre>OK</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k4		<span class="token comment"># 事务队列中的命令都不会被执行！</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>编译型异常（代码有问题！命令有错！），事务中所有的命令都不会被执行！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi</pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k1 v1</pre></td></tr><tr><td data-num="4"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k2 v2</pre></td></tr><tr><td data-num="6"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k3 v3</pre></td></tr><tr><td data-num="8"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> getset k3		<span class="token comment"># 错误的命令</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'getset'</span> <span class="token builtin class-name">command</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k4 v4</pre></td></tr><tr><td data-num="12"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k5 v5</pre></td></tr><tr><td data-num="14"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">exec</span>		<span class="token comment"># 执行事务报错！</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k5		<span class="token comment"># 所有的命令都不会被执行！</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>运行时异常（1/0）， 如果事务队列中存在语法性，那么执行命令的时候，其他命令是可以正常执行的，错误命令抛出异常！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> k1 <span class="token string">"v1"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi</pre></td></tr><tr><td data-num="4"></td><td><pre>OK</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> incr k1		<span class="token comment"># 执行的时候失败</span></pre></td></tr><tr><td data-num="6"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k2 v2</pre></td></tr><tr><td data-num="8"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">set</span> k3 v3</pre></td></tr><tr><td data-num="10"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> get k3</pre></td></tr><tr><td data-num="12"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">exec</span>		<span class="token comment"># 虽然第一天命令报错，但依旧正常执行成功了</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> OK</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> OK</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v3"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k2</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token string">"v2"</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k3</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token string">"v3"</span></pre></td></tr></table></figure><blockquote><p>监控！Watch（面试常问！）</p></blockquote><p><strong>悲观锁：</strong></p><ul><li>很悲观，认为什么时候都会出问题，无论做什么都会加锁！</li></ul><p><strong>乐观锁：</strong></p><ul><li><p>很乐观，认为什么时候都不会出问题，所以不会上锁！ 更新数据的时候去判断一下，在此期间是否有人修改过这个数据，</p></li><li><p>获取 version</p></li><li><p>更新的时候比较 version</p></li></ul><blockquote><p>Redis 测监视测试</p></blockquote><p>正常执行成功！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> money <span class="token number">100</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> out <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre>OK</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token function">watch</span> money		<span class="token comment"># 监视 money 对象</span></pre></td></tr><tr><td data-num="6"></td><td><pre>OK</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi		<span class="token comment"># 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span></pre></td></tr><tr><td data-num="8"></td><td><pre>OK</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> DECRBY money <span class="token number">20</span></pre></td></tr><tr><td data-num="10"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> INCRBY out <span class="token number">20</span></pre></td></tr><tr><td data-num="12"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">exec</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">80</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">20</span></pre></td></tr></table></figure><p>测试多线程修改值，使用 watch 可以当做 redis 的乐观锁操作！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token function">watch</span> money		<span class="token comment"># 监视 money</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi</pre></td></tr><tr><td data-num="4"></td><td><pre>OK</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> DECRBY money <span class="token number">10</span></pre></td></tr><tr><td data-num="6"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> INCRBY out <span class="token number">10</span></pre></td></tr><tr><td data-num="8"></td><td><pre>QUEUED</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">></span> <span class="token builtin class-name">exec</span>		<span class="token comment"># 执行之前另外一个线程修改了这个 money，就会导致事务执行失败！</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">(</span>nil<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>如果修改失败，获取最新的值就好</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518205812951.png" alt="image-20210518205812951"></p><h1 id="jedis"><a class="anchor" href="#jedis">#</a> Jedis</h1><p>我们要使用 Java 来操作 Redis，知其然并知其所以然，授人以渔！ 学习不能急躁，慢慢来会很快！</p><blockquote><p>什么是 Jedis 是 Redis 官方推荐的 java 连接开发工具！ 使用 Java 操作 Redis 中间件！如果你要使用 java 操作 redis，那么一定要对 Jedis 十分的熟悉！</p></blockquote><blockquote><p>测试</p></blockquote><p>1 、导入对应的依赖</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- 导入 jedis 的包 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">&lt;!--fastjson--></span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.60<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>2 、编码测试：</p><ul><li><p>连接数据库</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPing</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token comment">// 1、new Jedis 对象即可</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">//jedis 所有的命令就是我们之前学习的所有指令</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>操作命令</p></li><li><p>断开连接！</p></li><li><p>输出：</p></li></ul><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210518211611577.png" alt="image-20210518211611577"></p><h3 id="常用的api"><a class="anchor" href="#常用的api">#</a> 常用的 API</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbGxvYW1oaC9yZWRpcy1zdHVkeQ==">代码</span></p><p>String</p><p>List</p><p>Set</p><p>Hash</p><p>Zset</p><blockquote><p>所有的 api 命令，就是我们对应的上面学习的指令，一个都没有变化！</p></blockquote><h3 id="事务-2"><a class="anchor" href="#事务-2">#</a> 事务</h3><h1 id="springboot整合"><a class="anchor" href="#springboot整合">#</a> SpringBoot 整合</h1><p>SpringBoot 操作数据：spring-data jpa jdbc mongodb redis！</p><p>SpringData 也是和 SpringBoot 齐名的项目！</p><p>说明： 在 SpringBoot2.x 之后，原来使用的 jedis 被替换为了 lettuce?</p><p>jedis : 采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用 jedis pool 连接池！ 更像 BIO 模式</p><p>lettuce : 采用 netty，实例可以再多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据了，更像 NIO 模式</p><p>源码分析：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"redisTemplate"</span><span class="token punctuation">)</span>	<span class="token comment">// 我们可以自己定义一个 redisTemplate 来替换这个默认的！</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 默认的 RedisTemplate 没有过多的设置，redis 对象都是需要序列化！</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 两个泛型都是 Object，Object 的类型，我们要使用需要强制转换 &lt;String, Object></span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token keyword">return</span> template<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>	<span class="token comment">// 由于 String 是 redis 中最常用使用的类型，所以说单独提出来了一个 bean！</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token keyword">return</span> template<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>整合测试一下</p></blockquote><p>1 、导入依赖</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>2 、配置连接</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Springboot 所有的配置类，都有一个自动配置类 RedisAutoConfiguration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 自动配置类都会绑定一个 properties 配置文件 RedisProperties</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 配置 redis</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">redis</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span></pre></td></tr></table></figure><p>3 、测试！</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@SpringBootTest</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Redis02SpringbootApplicationTests</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token comment">//redisTemplate 操作不同的数据类型，api 和我们的指令是一样的</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token comment">//opsForValue 操作字符串 类似 String</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token comment">//opsForList 操作 List 类型 List</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token comment">// opsForSet</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token comment">// opsForHash</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token comment">// opsForZSet</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token comment">// opsForGeo</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token comment">// opsForHyperLogLog</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token comment">// 除了基本的操作，我们常用的方法都可以直接通过 redisTemplate 操作，比如事务，和基本的 crud</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token comment">/* 获取 redis 的连接对象</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		RedisConnection connection = redisTemplate.getConnectionFactory ().getConnection ();</pre></td></tr><tr><td data-num="22"></td><td><pre>		connection.flushDb ();</pre></td></tr><tr><td data-num="23"></td><td><pre>		connection.flushAll ();*/</pre></td></tr><tr><td data-num="24"></td><td><pre>		redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"mykey"</span><span class="token punctuation">,</span><span class="token string">"关注狂神说公众号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"mykey"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519205527214.png" alt="image-20210519205527214"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519205732105.png" alt="image-20210519205732105"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519210859444.png" alt="image-20210519210859444"></p><p>我们来编写一个自己的 RedisTemplate</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">//RedisTemplate 序列化配置 -- >  注意要使用 @Qualifier ("redisTemplate") 避免歧义（测试类中有使用案例）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 我们为了自己开发方便，一般直接使用 &lt;String, Object></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// Json 序列化配置</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// String 的序列化</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token comment">//key 采用 String 的序列化方式</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">//hash 的 key 也采用 String 的序列化方式</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">//value 序列化方式采用 jackson</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">//hash 的 value 序列化方式采用 jackson</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">return</span> template<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>所有的 redis 操作，其实对于 java 开发人员来说，十分的简单，更重要的是要去理解 redis 的思想和每一种数据结构的用处和作用场景！</p><h1 id="redisconf详解"><a class="anchor" href="#redisconf详解">#</a> Redis.conf 详解</h1><p>启动的时候，就通过配置文件来启动！</p><p>工作中，一些小小的配置，可以让你脱颖而出！</p><p><mark>行家有没有，出手就知道</mark></p><blockquote><p>单位</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519214335523.png" alt="image-20210519214335523"></p><p>1、配置文件 unit 单位对大小写不敏感！</p><blockquote><p>包含</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210519214516731.png" alt="image-20210519214516731"></p><p>就是好比我们学习 Spring、Import、include 可以将多个配置文件包含</p><blockquote><p>网络</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 -::1 <span class="token comment"># 绑定的 ip</span></pre></td></tr><tr><td data-num="2"></td><td><pre>protected-mode <span class="token function">yes</span>	<span class="token comment"># 保护模式</span></pre></td></tr><tr><td data-num="3"></td><td><pre>port <span class="token number">6379</span>	<span class="token comment"># 端口设置</span></pre></td></tr></table></figure><blockquote><p>通用 GENERAL</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>daemonize <span class="token function">yes</span>	<span class="token comment"># 以守护进程的方式运行，默认是 no，我们需要自己开启为 yes！</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>pidfile /var/run/redis_6379.pid	<span class="token comment"># 如果以后台的方式运行，我们就需要指定一个 pid 文件</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 日志</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># Specify the server verbosity level.</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># This can be one of:</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># debug (a lot of information, useful for development/testing)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># notice (moderately verbose, what you want in production probably) 生产环境适用</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># warning (only very important / critical messages are logged)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num="13"></td><td><pre>logfile <span class="token string">""</span>	<span class="token comment"># 日志的文件位置名</span></pre></td></tr><tr><td data-num="14"></td><td><pre>databases <span class="token number">16</span>	<span class="token comment"># 数据库的数量，默认是 16 个数据库</span></pre></td></tr><tr><td data-num="15"></td><td><pre>always-show-logo no	<span class="token comment"># 是否总是显示 logo</span></pre></td></tr></table></figure><blockquote><p>快照 SNAPSHOTTING</p></blockquote><p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 .rdb .aof</p><p>redis 是内存数据库，如果没有持久化，那么数据断电即失</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 如果 3600 秒内，如果至少有一个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>save <span class="token number">3600</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 如果 300 秒内，如果至少有 10 个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num="4"></td><td><pre>save <span class="token number">300</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 如果 60 秒内，如果至少有 10000 个 key 进行了修改，我们就进行持久化操作</span></pre></td></tr><tr><td data-num="6"></td><td><pre>save <span class="token number">60</span> <span class="token number">10000</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 我们之后学习持久化，会自己定义这个设置！</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>stop-writes-on-bgsave-error <span class="token function">yes</span>	<span class="token comment"># 持久化如果出错，是否还需要继续工作！</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>rdbcompression <span class="token function">yes</span>	<span class="token comment"># 是否压缩 rdb 文件，需要消耗一些 cpu 资源</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>rdbchecksum <span class="token function">yes</span>	<span class="token comment"># 保存 rdb 的时候，进行错误的检查校验！</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">dir</span> ./	<span class="token comment"># rdb 文件保存的目录！</span></pre></td></tr></table></figure><blockquote><p>REPLICATION 主从复制，我们后面讲解主从复制的时候再进行讲解</p></blockquote><blockquote><p>SECURITY 安全</p></blockquote><p>可以在这里设置 redis 的密码，默认是没有密码！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> config get requirepass	<span class="token comment"># 获取 redis 的密码</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"requirepass"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> config <span class="token builtin class-name">set</span> requirepass <span class="token string">"lloam"</span>	<span class="token comment"># 设置 redis 的密码</span></pre></td></tr><tr><td data-num="5"></td><td><pre>OK</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> config get requirepass</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"requirepass"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"lloam"</span></pre></td></tr></table></figure><blockquote><p>CLIENTS 限制</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>maxclients <span class="token number">10000</span>	<span class="token comment"># 设置能连接上 redis 的最大客户端的数量！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">></span>	<span class="token comment"># redis 配置最大的内存容量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>maxmemory-policy noeviction	<span class="token comment"># 内存达到上限之后的处理策略</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment"># 移除一些过期的 key</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment"># 报错</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment"># ...</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token number">1</span> 、volatile-lru：只对设置了过期时间的key进行LRU（默认值）</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token number">2</span> 、allkeys-lru ： 删除lru算法的key</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token number">3</span> 、volatile-random：随机删除即将过期key</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token number">4</span> 、allkeys-random：随机删除</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token number">5</span> 、volatile-ttl ： 删除即将过期的</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token number">6</span> 、noeviction ： 永不过期，返回错误</pre></td></tr></table></figure><blockquote><p>APPEND ONLY MODE 模式 aof 配置</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>appendonly no	<span class="token comment"># 默认是不开启 aof 模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>appendfilename <span class="token string">"appendonly.aof"</span>	<span class="token comment"># 持久化的文件的名字</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># appendfsync always	# 每次修改都会同步数据，消耗性能</span></pre></td></tr><tr><td data-num="5"></td><td><pre>appendfsync everysec	<span class="token comment"># 每秒执行一次 也就是每秒同步一次 sync，可能会丢失这 1s 的数据！</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># appendfsync no	# 不执行同步，这个时候操作系统自己同步数据，速度最快！</span></pre></td></tr></table></figure><p>具体的配置，我们在 Redis 持久化中去给大家详细讲解！</p><h1 id="redis持久化"><a class="anchor" href="#redis持久化">#</a> Redis 持久化</h1><p>面试和工作，持久化都是重点！</p><p>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。所以 Redis 提供了持久化功能！</p><h2 id="rdbredis-database"><a class="anchor" href="#rdbredis-database">#</a> RDB（Redis DataBase）</h2><blockquote><p>什么是 RDB</p></blockquote><p>在主从复制中，rdb 就是备用了！从机上面！</p><p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的 Snapshot 快照，它恢复时是将快照文件直接读到内存里。Redis 会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何 IO 操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加的高效。RDB 的缺点是最后一次持久化后的数据可能丢失。我们默认的就是 RDB，一般情况下不需要修改这个配置！</p><p>有时候在生产环境我们会将这个文件进行备份！</p><p><mark>rdb 保存的文件是 dump.rdb</mark></p><p>都是在我们的配置文件中快照中进行配置的！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520195804095.png" alt="image-20210520195804095"></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520200107454.png" alt="image-20210520200107454"></p><blockquote><p>触发机制</p></blockquote><p>1 、save 的规则满足的情况下，会自动触发 rdb 规则</p><p>2 、执行 flushall 命令，也会触发我们的 rdb 规则！</p><p>3 、退出 redis，也会产生 rdb 文件！</p><p>备份就自动生成一个 dump.rdb</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520200658389.png" alt="image-20210520200658389"></p><blockquote><p>如何恢复 rdb 文件！</p></blockquote><p>1 、只需要将 rdb 文件放在我们 redis 启动目录就可以，redis 启动的时候会自动检查 dump.rdb 恢复其中的数据！</p><p>2 、查看需要存在的位置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> config get <span class="token function">dir</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"dir"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"/usr/local/bin"</span>	<span class="token comment"># 如果在这个目录下存在 dump.rdb 文件，启动就会自动恢复其中的数据</span></pre></td></tr></table></figure><blockquote><p>几乎就他自己默认的配置就够用了，但是我们还是需要去学习！</p></blockquote><p>优点：</p><p>1 、适合大规模的数据恢复！</p><p>2 、对数据的完整性要不高！</p><p>缺点：</p><p>1 、需要一定的时间间隔进程操作！如果 redis 意外宕机了，这个最后一次修改数据就没有的了！</p><p>2 、fork 进程的时候，会占用一定的内存空间！！</p><h2 id="aofappend-only-file"><a class="anchor" href="#aofappend-only-file">#</a> AOF（Append Only File）</h2><p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件全部在执行一遍！</p><blockquote><p>是什么</p></blockquote><p>以日志的形式来记录每个写操作，将 Redis 执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis 启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p><p>Aof 保存的是 appendonly.aof 文件</p><blockquote><p>append</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520201705996.png" alt="image-20210520201705996"></p><p>默认是不开启的，我们需要手动进行配置！我们只需要将 appendonly 改为 yes 就开启了 aof！</p><p>重启，redis 就可以生效了！</p><p>如果这个 aof 文件有错误，这时候 redis 是启动不起来的吗，我们需要修复这个 aof 文件</p><p>redis 给我们提供了一个工具 <code>redis-check-aof --fix</code></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520202444654.png" alt="image-20210520202444654"></p><p>如果文件正常，重启就可以直接恢复了！</p><blockquote><p>重写规则说明</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520203003627.png" alt="image-20210520203003627"></p><p>aof 默认就是文件的无限追加，文件会越来越大！</p><p>如果 aof 文件大于 64m，太大了！ 就会 fork 一个新的进程来将我们的文件进行重写！</p><blockquote><p>优点和缺点！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>appendonly no	<span class="token comment"># 默认是不开启 aof 模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>appendfilename <span class="token string">"appendonly.aof"</span>	<span class="token comment"># 持久化的文件的名字</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># appendfsync always	# 每次修改都会同步数据，消耗性能</span></pre></td></tr><tr><td data-num="5"></td><td><pre>appendfsync everysec	<span class="token comment"># 每秒执行一次 也就是每秒同步一次 sync，可能会丢失这 1s 的数据！</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># appendfsync no	# 不执行同步，这个时候操作系统自己同步数据，速度最快！</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># rewrite</span></pre></td></tr></table></figure><p>优点：</p><p>1 、每一次修改都同步，文件的完整会更加好！</p><p>2 、每秒同步一次，可能会丢失一秒的数据</p><p>3 、从不同步，效率最高的！</p><p>缺点：</p><p>1 、相对于数据文件来说，aof 远远大于 rdb，修复的速度也比 rdb 慢！</p><p>2 、Aof 运行效率也要比 rdb 慢，所以我们 redis 默认的配置就是 rdb 持久化！</p><h4 id="扩展"><a class="anchor" href="#扩展">#</a> 扩展：</h4><p>1 、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p><p>2 、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF 命令以 Redis 协议追加保存每次写的操作到文件末尾，Redis 还能对 AOF 文件进行后台重写，使得 AOF 文件的体积不至于过大。</p><p>3 、<mark>只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</mark></p><p>4 、同时开启两种持久化方式</p><ul><li>在这种情况下，当 redis 重启的时候会优先载入 AOF 文件来恢复原始的数据，因为在通常情况下 AOF 文件保存的数据集要比 RDB 文件保存的数据集要完整。</li><li>RDB 的数据不实时，同时使用两者时服务器重启也只会找 AOF 文件，那要不要只使用 AOF 呢？作者建议不要，因为 RDB 更适合用于备份数据库（AOF 在不断变化不好备份），快速重启，而且不会有 AOF 可能潜在的 Bug，留着作为一个万一的手段。</li></ul><p>5 、性能建议</p><ul><li>因为 RDB 文件只用作后备用途，建议只在 Slave 上持久化 RDB 文件，而且只要 15 分钟备份一次就够了，只保留 save 900 1 这条规则。</li><li>如果 Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只 load 自己的 AOF 文件就可以了，代价一是带来了持续的 IO，二是 AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少 AOF rewrite 的频率，AOF 重写的基础大小默认值 64M 太小了，可以设到 5G 以上，默认超过原大小 100% 大小重写可以改到适当的数值。</li><li>如果不 Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔 IO，也减少了 rewrite 时带来的系统波动。代价是如果 Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB 文件，载入较新的那个，微博就是这种架构。</li></ul><h1 id="redis发布订阅"><a class="anchor" href="#redis发布订阅">#</a> Redis 发布订阅</h1><p>Redis 发布订阅 (pub/sub) 是一种<mark>消息通信模式</mark>：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。微信、微博、关注系统！</p><p>Redis 客户端可以订阅任意数量的频道。</p><p>订阅 / 发布消息图：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205008926.png" alt="image-20210520205008926"></p><p>第一个：消息发送者， 第二个：频道， 第三个：消息订阅者！</p><p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205141004.png" alt="image-20210520205141004"></p><p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户<br>端：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205209640.png" alt="image-20210520205209640"></p><blockquote><p>命令</p></blockquote><p>这些命令被广泛用于构建即时通信应用，比如网络聊天室 (chatroom) 和实时广播、实时提醒等。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520205303771.png" alt="image-20210520205303771"></p><blockquote><p>测试</p></blockquote><p>订阅端：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SUBSCRIBE kuangshenshuo	<span class="token comment">#订阅一个频道 kuangshenshuo</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 等待读取推送的信息</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>		<span class="token comment">#消息</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>		<span class="token comment">#哪个频道的消息</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello,kuangshen"</span>		<span class="token comment"># 消息的具体内容</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello,redis"</span></pre></td></tr></table></figure><p>发送端：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PUBLISH kuangshenshuo <span class="token string">"hello,kuangshen"</span>	<span class="token comment"># 发布者发送消息到频道！</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PUBLISH kuangshenshuo <span class="token string">"hello,redis"</span>	<span class="token comment"># 发布者发送消息到频道！</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span></pre></td></tr></table></figure><blockquote><p>原理</p></blockquote><p>Redis 是使用 C 实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，籍此加深对 Redis 的理解。</p><p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p><p>微信：</p><p>通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 频道！而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键，就是将客户端添加到给定 channel 的订阅链表中。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520210737723.png" alt="image-20210520210737723"></p><p>通过 PUBLISH 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520210838355.png" alt="image-20210520210838355"></p><p>Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在 Redis 中，你可以设定对某一个 key 值进行消息发布及消息订阅，当一个 key 值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p><p><strong>使用场景：</strong></p><p>1 、实时消息系统！</p><p>2 、事实聊天！（频道当做聊天室，将信息回显给所有人即可！）</p><p>3 、订阅，关注系统都是可以的！</p><p>稍微复杂的场景我们就会使用 消息中间件 MQ</p><h1 id="redis主从复制"><a class="anchor" href="#redis主从复制">#</a> Redis 主从复制</h1><h3 id="概念"><a class="anchor" href="#概念">#</a> 概念</h3><p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点<br>(master/leader)，后者称为从节点 (slave/follower)；== 数据的复制是单向的，只能由主节点到从节点。==Master 以写为主，Slave 以读为主。</p><p><mark>默认情况下，每台 Redis 服务器都是主节点；</mark></p><p>且一个主节点可以有多个从节点 (或没有从节点)，但一个从节点只能有一个主节点。（）</p><p><strong>主从复制的作用主要包括：</strong></p><p>1 、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p><p>2 、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</p><p>3 、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务 ==（即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点）==，分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量。</p><p>4 、高可用（集群）基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础。</p><p>一般来说，要将 Redis 运用于工程项目中，只使用一台 Redis 是万万不能的（会宕机，一般一主二从），原因如下：</p><p>1 、从结构上，单个 Redis 服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p><p>2 、从容量上，单个 Redis 服务器内存容量有限，就算一台 Redis 服务器内存容量为 256G，也不能将所有内存用作 Redis 存储内存，一般来说，<mark>单台 Redis 最大使用内存不应该超过 20G。</mark></p><p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是 &quot;多读少写&quot;。</p><p>对于这种场景，我们可以使如下这种架构：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520211238731.png" alt="image-20210520211238731"></p><p>主从复制，读写分离！ 80% 的情况下都是在进行读操作！减缓服务器的压力！架构中经常使用！ 一主二从！</p><p>只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用 Redis！</p><h2 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h2><p>只配置从库，不用配置主库！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info replication		<span class="token comment">#查看当前库的信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># Replication</span></pre></td></tr><tr><td data-num="3"></td><td><pre>role:master		<span class="token comment"># 角色  master</span></pre></td></tr><tr><td data-num="4"></td><td><pre>connected_slaves:0		<span class="token comment"># 没有从机</span></pre></td></tr><tr><td data-num="5"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num="6"></td><td><pre>master_replid:30a335d3ec84363d738343b2e57607f0ef6cca90</pre></td></tr><tr><td data-num="7"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num="8"></td><td><pre>master_repl_offset:0</pre></td></tr><tr><td data-num="9"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num="10"></td><td><pre>repl_backlog_active:0</pre></td></tr><tr><td data-num="11"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num="12"></td><td><pre>repl_backlog_first_byte_offset:0</pre></td></tr><tr><td data-num="13"></td><td><pre>repl_backlog_histlen:0</pre></td></tr></table></figure><p>复制 3 个配置文件，然后修改对应的信息</p><p>1 、端口</p><p>2 、pid 名字</p><p>3 、log 文件名字</p><p>4 、dump.rdb 名字</p><p>修改完毕之后，启动我们的 3 个 redis 服务器，可以通过进程信息查看！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520213559496.png" alt="image-20210520213559496"></p><h3 id="一主二从"><a class="anchor" href="#一主二从">#</a> 一主二从</h3><p><mark>默认情况下，每台 Redis 服务器都是主节点；</mark> 我们一般情况下只用配置从机就好了！</p><p>认老大！ 一主 （ 79 ）二从（ 80 ， 81 ）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>></span> SLAVEOF <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>		<span class="token comment"># SLAVEOF host 6379 找谁当自己的老大！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>OK</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>></span> info replication</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Replication</span></pre></td></tr><tr><td data-num="5"></td><td><pre>role:slave		<span class="token comment"># 当前角色是从机</span></pre></td></tr><tr><td data-num="6"></td><td><pre>master_host:127.0.0.1		<span class="token comment"># 可以看到主机的信息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num="8"></td><td><pre>master_link_status:up</pre></td></tr><tr><td data-num="9"></td><td><pre>master_last_io_seconds_ago:6</pre></td></tr><tr><td data-num="10"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num="11"></td><td><pre>slave_repl_offset:0</pre></td></tr><tr><td data-num="12"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num="13"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num="14"></td><td><pre>replica_announced:1</pre></td></tr><tr><td data-num="15"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num="16"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num="17"></td><td><pre>master_replid:6c48ecaf27edad5631781b5432548f10acde2cec</pre></td></tr><tr><td data-num="18"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num="19"></td><td><pre>master_repl_offset:0</pre></td></tr><tr><td data-num="20"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num="21"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num="22"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num="23"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num="24"></td><td><pre>repl_backlog_histlen:0</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">###############################################################</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 在主机中查看！</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info replication</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># Replication</span></pre></td></tr><tr><td data-num="29"></td><td><pre>role:master</pre></td></tr><tr><td data-num="30"></td><td><pre>connected_slaves:1		<span class="token comment"># 多了从机的配置</span></pre></td></tr><tr><td data-num="31"></td><td><pre>slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">28</span>,lag<span class="token operator">=</span><span class="token number">1</span>		<span class="token comment"># 多了从机的配置</span></pre></td></tr><tr><td data-num="32"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num="33"></td><td><pre>master_replid:6c48ecaf27edad5631781b5432548f10acde2cec</pre></td></tr><tr><td data-num="34"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num="35"></td><td><pre>master_repl_offset:28</pre></td></tr><tr><td data-num="36"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num="37"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num="38"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num="39"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num="40"></td><td><pre>repl_backlog_histlen:28</pre></td></tr></table></figure><p>如果两个都配置完了，就是有两个从机的</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214352916.png" alt="image-20210520214352916"></p><p>真实的从主配置应该在配置文件中配置，这样的话是永久的，我们这里使用的是命令，暂时的！关闭 redis 服务后再重启就没有了。</p><blockquote><p>细节</p></blockquote><p>== 主机可以写，从机不能写只能读！== 主机中的所有信息和数据，都会自动被从机保存！</p><p>主机写：</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214917078.png" alt="image-20210520214917078"></p><p>从机只能读取内容！</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520214957623.png" alt="image-20210520214957623"></p><p>测试：主机断开连接，从机依旧连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依旧可以直接获取到主机写的信息！</p><p>如果是使用命令行，来配置的主从，这个时候如果重启了，就会变回主机！只要变为从机，立马就会从主机中获取值！</p><blockquote><p>复制原理</p></blockquote><p>Slave 启动成功连接到 master 后会发送一个 sync 同步命令</p><p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集的命令，在后台进程执行完毕之后，master 将传送整个数据文件到 slave，并完成一次完全同步。</p><p><mark>全量复制</mark>：而 slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p><p><mark>增量复制</mark>：Master 继续将新的所有收集到的修改命令依次传给 slave，完成同步</p><p>但是只要是重新连接 master，一次完全同步（全量复制）将被自动执行！ 我们的数据一定可以在从机中看到！</p><blockquote><p>层层链路</p></blockquote><p><strong>上一个 M 链接下一个 S！</strong></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520220346763.png" alt="image-20210520220346763"></p><p>这时候也可以完成我们的主从复制！</p><blockquote><p>如果没有老大了，这个时候能不能选择一个老大出来呢？ 没有哨兵模式情况下需要手动配置！</p></blockquote><p><strong><mark>谋朝篡位</mark></strong></p><p>如果主机断开了连接，我们可以使用 <code>SLAVEOF no one</code> 让自己变成主机！其他的节点就可以手动连接到最新的这个主节点（手动）！如果这个时候老大修复了，那就重新连接！</p><h2 id="哨兵模式"><a class="anchor" href="#哨兵模式">#</a> 哨兵模式</h2><p>（自动选举老大的模式）</p><p>概述</p><p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis 从 2.8 开始正式提供了 Sentinel（哨兵） 架构来解决这个问题。</p><p>谋朝篡位的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</p><p>哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是 <strong>哨兵通过发送命令，等待 Redis 服务器响应，从而监控运行的多个 Redis 实例。</strong></p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520221658955.png" alt="image-20210520221658955"></p><p>这里的哨兵有两个作用</p><ul><li>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器。</li><li>当哨兵监测到 master 宕机，会自动将 slave 切换成 master，然后通过 发布订阅模式 通知其他的从服务器，修改配置文件，让它们切换主机。</li></ul><p>然而一个哨兵进程对 Redis 服务器进行监控，可能会出现问题（哨兵宕机），为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520221919792.png" alt="image-20210520221919792"></p><p>假设主服务器宕机，哨兵 1 先检测到这个结果，系统并不会马上进行 failover 选举过程，仅仅是哨兵 1 主观的认为主服务器不可用，这个现象成为 <strong>主观下线</strong> 。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 failover [故障转移] 操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong> 。</p><blockquote><p>测试！</p></blockquote><p>我们目前的状态是 一主二从！</p><p>1 、配置哨兵配置文件 sentinel.conf</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># sentinel monitor 被监控的名称 host port 1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sentinel monitor myredis <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span></pre></td></tr></table></figure><p><mark>后面的这个数字 1 ，表示至少要多少个 sentinel 哨兵一致认为主机挂掉了，那么才会触发 failover【故障转移】操作</mark>，我们这里因为只有一个 sentinel 哨兵，假设有三个哨兵，那么这个数字就可以设置为 2。哨兵投票看让谁接替成为主机，票数最多的，就会成为主机！</p><p>2 、启动哨兵！</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lloam bin<span class="token punctuation">]</span><span class="token comment"># redis-sentinel maoconfig/sentinel.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.879 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.879 <span class="token comment"># Redis version=6.2.3, bits=64, commit=00000000, modified=0, pid=19968, just started</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.879 <span class="token comment"># Configuration loaded</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.879 * monotonic clock: POSIX clock_gettime</pre></td></tr><tr><td data-num="6"></td><td><pre>                _._                                                  </pre></td></tr><tr><td data-num="7"></td><td><pre>           _.-`<span class="token variable"><span class="token variable">`</span>__ <span class="token string">''</span>-._                                             </span></pre></td></tr><tr><td data-num="8"></td><td><pre>      _.-<span class="token variable">`</span><span class="token variable"><span class="token variable">`</span>    <span class="token variable">`</span></span><span class="token builtin class-name">.</span>  <span class="token variable"><span class="token variable">`</span>_.  <span class="token string">''</span>-._           Redis <span class="token number">6.2</span>.3 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> <span class="token number">64</span> bit</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  .-<span class="token variable">`</span><span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token punctuation">\</span>/    _.,_ <span class="token string">''</span>-._                                  </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token punctuation">(</span>    '      ,       .-<span class="token variable">`</span>  <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>,    <span class="token punctuation">)</span>     Running <span class="token keyword">in</span> sentinel mode</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token operator">|</span><span class="token variable">`</span>-._<span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">..</span>.-<span class="token variable">`</span></span> __<span class="token punctuation">..</span>.-.`<span class="token variable"><span class="token variable">`</span>-._<span class="token operator">|</span>'<span class="token variable">`</span></span> _.-<span class="token string">'|     Port: 26379</span></pre></td></tr><tr><td data-num="12"></td><td><pre> |    <span class="token variable"><span class="token variable">`</span>-._   <span class="token variable">`</span></span>._    /     _.-'    <span class="token operator">|</span>     PID: <span class="token number">19968</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-./  _.-<span class="token string">'    _.-'</span>                                   </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token operator">|</span><span class="token variable">`</span>-._<span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-<span class="token string">'    _.-'</span>_.-<span class="token string">'|                                  </span></pre></td></tr><tr><td data-num="15"></td><td><pre> |    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._        _.-'_.-<span class="token string">'    |           https://redis.io       </span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'_.-'</span>    _.-'                                   </span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token operator">|</span><span class="token variable">`</span>-._<span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-'    _.-<span class="token string">'_.-'</span><span class="token operator">|</span>                                  </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token operator">|</span>    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._        _.-<span class="token string">'_.-'</span>    <span class="token operator">|</span>                                  </pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'_.-'</span>    _.-'                                   </span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token variable">`</span>-._    <span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'    _.-'</span>                                       </span></pre></td></tr><tr><td data-num="21"></td><td><pre>          <span class="token variable">`</span>-._        _.-'                                           </pre></td></tr><tr><td data-num="22"></td><td><pre>              `-.__.-'                                               </pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.880 <span class="token comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.882 <span class="token comment"># Sentinel ID is 3555ee07f208305027d0e90ca9a47de93b3c99f3</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.882 <span class="token comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.883 * +slave slave <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> @ myredis <span class="token number">127.0</span>.0.1 <span class="token number">6379</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">19968</span>:X <span class="token number">20</span> May <span class="token number">2021</span> <span class="token number">22</span>:35:51.885 * +slave slave <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1 <span class="token number">6381</span> @ myredis <span class="token number">127.0</span>.0.1 <span class="token number">6379</span></pre></td></tr></table></figure><p>如果 Master 节点断开了，这个时候就会从从机中随机选择一个服务器！ （这里面有一个投票算法！）</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520224201764.png" alt="image-20210520224201764"></p><blockquote><p>哨兵日志！</p></blockquote><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210520224334799.png" alt="image-20210520224334799"></p><p>如果主机此时回来了，只能归并到新的主机下，当做从机，这就是哨兵模式的规则！</p><blockquote><p>哨兵模式</p></blockquote><p>优点：</p><p>1 、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p><p>2 、 主从可以切换，故障可以转移，系统的可用性就会更好</p><p>3 、哨兵模式就是主从模式的升级，手动到自动，更加健壮！</p><p>缺点：</p><p>1 、Redis 不好在线扩容的，集群容量一旦到达上限，在线扩容就十分麻烦！</p><p>2 、实现哨兵模式的配置其实是很麻烦的，里面有很多选择！</p><blockquote><p>哨兵模式的全部配置！</p></blockquote><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Example sentinel.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 哨兵 sentinel 实例运行的端口 默认 26379</span></pre></td></tr><tr><td data-num="4"></td><td><pre>port <span class="token number">26379</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 哨兵 sentinel 的工作目录</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">dir</span> /tmp</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 哨兵 sentinel 监控的 redis 主节点的 ip port</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># master-name 可以自己命名的主节点名字 只能由字母 A-z、数字 0-9 、这三个字符 ".-_" 组成。</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># quorum 配置多少个 sentinel 哨兵统一认为 master 主节点失联 那么这时客观上认为主节点失联了</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span></pre></td></tr><tr><td data-num="13"></td><td><pre>sentinel monitor mymaster <span class="token number">127</span> .0.0.1 <span class="token number">6379</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 当在 Redis 实例中开启了 requirepass foobared 授权密码 这样所有连接 Redis 实例的客户端都要提供</span></pre></td></tr><tr><td data-num="16"></td><td><pre>密码</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 设置哨兵 sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># sentinel auth-pass &lt;master-name> &lt;password></span></pre></td></tr><tr><td data-num="19"></td><td><pre>sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 指定多少毫秒之后 主节点没有应答哨兵 sentinel 此时 哨兵主观上认为主节点下线 默认 30 秒</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num="23"></td><td><pre>sentinel down-after-milliseconds mymaster <span class="token number">30000</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 这个配置项指定了在发生 failover 主备切换时最多可以有多少个 slave 同时对新的 master 进行 同步，</span></pre></td></tr><tr><td data-num="26"></td><td><pre>这个数字越小，完成failover所需的时间就越长，</pre></td></tr><tr><td data-num="27"></td><td><pre>但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</pre></td></tr><tr><td data-num="28"></td><td><pre>可以通过将这个值设为 <span class="token number">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># sentinel parallel-syncs &lt;master-name> &lt;numslaves></span></pre></td></tr><tr><td data-num="30"></td><td><pre>sentinel parallel-syncs mymaster <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">#1. 同一个 sentinel 对同一个 master 两次 failover 之间的间隔时间。</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">#2. 当一个 slave 从一个错误的 master 那里同步数据开始计算时间。直到 slave 被纠正为向正确的 master 那</span></pre></td></tr><tr><td data-num="35"></td><td><pre>里同步数据时。</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">#3. 当想要取消一个正在进行的 failover 所需要的时间。</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">#4. 当进行 failover 时，配置所有 slaves 指向新的 master 所需的最大时间。不过，即使过了这个超时，</span></pre></td></tr><tr><td data-num="38"></td><td><pre>slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment"># 默认三分钟</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># sentinel failover-timeout &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>sentinel failover-timeout mymaster <span class="token number">180000</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment"># SCRIPTS EXECUTION</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知</span></pre></td></tr><tr><td data-num="47"></td><td><pre>相关人员。</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment">#对于脚本的运行结果有以下规则：</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">#若脚本执行后返回 1 ，那么该脚本稍后将会被再次执行，重复次数目前默认为 10</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">#若脚本执行后返回 2 ，或者比 2 更高的一个返回值，脚本将不会重复执行。</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为 1 时的行为相同。</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">#一个脚本的最大执行时间为 60s，如果超过这个时间，脚本将会被一个 SIGKILL 信号终止，之后重新执行。</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">#通知型脚本：当 sentinel 有任何警告级别的事件发生时（比如说 redis 实例的主观失效和客观失效等等），</span></pre></td></tr><tr><td data-num="55"></td><td><pre>将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信</pre></td></tr><tr><td data-num="56"></td><td><pre>息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配</pre></td></tr><tr><td data-num="57"></td><td><pre>置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无</pre></td></tr><tr><td data-num="58"></td><td><pre>法正常启动成功。</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">#通知脚本</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment"># shell 编程</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment"># sentinel notification-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num="62"></td><td><pre>sentinel notification-script mymaster /var/redis/notify.sh</pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token comment"># 客户端重新配置主节点参数脚本</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment"># 当一个 master 由于 failover 而发生改变时，这个脚本将会被调用，通知相关的客户端关于 master 地址已</span></pre></td></tr><tr><td data-num="66"></td><td><pre>经发生改变的信息。</pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment"># 以下参数将会在调用脚本时传给脚本:</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment"># &lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment"># 目前 & lt;state > 总是 “failover”,</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment"># &lt;role > 是 “leader” 或者 “observer” 中的一个。</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment"># 参数 from-ip, from-port, to-ip, to-port 是用来和旧的 master 和新的 master (即旧的 slave) 通</span></pre></td></tr><tr><td data-num="72"></td><td><pre>信的</pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token comment"># sentinel client-reconfig-script &lt;master-name> &lt;script-path></span></pre></td></tr><tr><td data-num="75"></td><td><pre>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh <span class="token comment"># 一般都是由运维来配置！</span></pre></td></tr></table></figure><p><mark>社会目前程序员饱和（初级和中级）、高级程序员重金难求！（提升自己！）</mark></p><h1 id="redis缓存穿透和雪崩"><a class="anchor" href="#redis缓存穿透和雪崩">#</a> Redis 缓存穿透和雪崩</h1><blockquote><p>服务的高可用问题！</p></blockquote><p>在这里我们不会详细的区分析解决方案的底层！</p><p>Redis 缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。</p><p>另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521204551606.png" alt="image-20210521204551606"></p><h2 id="缓存穿透查不到"><a class="anchor" href="#缓存穿透查不到">#</a> 缓存穿透（查不到）</h2><blockquote><p>概念</p></blockquote><p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis 内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀！），于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p><blockquote><p>解决方案</p></blockquote><h4 id="布隆过滤器"><a class="anchor" href="#布隆过滤器">#</a> 布隆过滤器</h4><p>布隆过滤器是一种数据结构，对所有可能查询的参数以 hash 形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力；</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521205047971.png" alt="image-20210521205047971"></p><h4 id="缓存空对象"><a class="anchor" href="#缓存空对象">#</a> 缓存空对象</h4><p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源；</p><p>但是这种方法会存在两个问题：</p><p>1 、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；</p><p>2 、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p><h2 id="缓存击穿量太大缓存过期"><a class="anchor" href="#缓存击穿量太大缓存过期">#</a> 缓存击穿（量太大，缓存过期！）</h2><blockquote><p>概述</p></blockquote><p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个 key 非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个 key 在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p><p>当某个 key 在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p><blockquote><p>解决方案</p></blockquote><p><strong>设置热点数据永不过期</strong></p><p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p><p><strong>加互斥锁</strong></p><p>分布式锁：使用分布式锁，保证对于每个 key 同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521210320816.png" alt="image-20210521210320816"></p><h2 id="缓存雪崩"><a class="anchor" href="#缓存雪崩">#</a> 缓存雪崩</h2><blockquote><p>概念</p></blockquote><p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis 宕机！</p><p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p><p><img data-src="https://gitee.com/lloamhh/spring-img/raw/master/img/redis/image-20210521210743763.png" alt="image-20210521210743763"></p><p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p><blockquote><p>解决方案</p></blockquote><p><strong>redis 高可用</strong></p><p>这个思想的含义是，既然 redis 有可能挂掉，那我多增设几台 redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群。（异地多活！）</p><p><strong>限流降级（在 SpringCloud 讲解过！）</strong></p><p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。</p><p><strong>数据预热</strong></p><p>数据预热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p><blockquote><p>小结</p></blockquote><p>关注公众号：狂神说，每日更新动态！</p><p>所有看我视频学习的小伙伴，分享或者写笔记的时候，可以带上我的视频连接，表示尊重！</p><p>后面的课程安排：bilibili 免费直播，<span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vOTUyNTY0NDk=">https://space.bilibili.com/95256449</span></p><div class="tags"><a href="/zxy/tags/Redis/" rel="tag"><i class="ic i-tag"></i> Redis</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-06-22 16:42:40" itemprop="dateModified" datetime="2021-06-22T16:42:40+08:00">2021-06-22</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/zxy/images/wechatpay.png" alt="失心耀 微信支付"><p>微信支付</p></div><div><img data-src="/zxy/images/alipay.png" alt="失心耀 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>失心耀 <i class="ic i-at"><em>@</em></i>失心耀的博客</li><li class="link"><strong>本文链接：</strong> <a href="https://xinyao_idiot.gitee.io/zxy/redis/" title="Redis初步学习">https://xinyao_idiot.gitee.io/zxy/redis/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciuv0socj20zk0m8qes.jpg" title="RabbitMQ 高级特性"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Rabbitmq</span><h3>RabbitMQ 高级特性</h3></a></div><div class="item right"><a href="/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciundwu5j20zk0m8n9e.jpg" title="springboot笔记心得"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> SpringBoot</span><h3>springboot笔记心得</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8B%82%E7%A5%9E%E8%81%8Aredis"><span class="toc-number">1.</span> <span class="toc-text">狂神聊 Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nosql%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">Nosql 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8nosql"><span class="toc-number">2.1.</span> <span class="toc-text">为什么要用 Nosql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFnosql"><span class="toc-number">2.2.</span> <span class="toc-text">什么是 NoSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E6%BC%94%E8%BF%9B%E5%88%86%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">阿里巴巴演进分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql%E7%9A%84%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB"><span class="toc-number">2.4.</span> <span class="toc-text">NoSQL 的四大分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E5%85%A5%E9%97%A8"><span class="toc-number">3.</span> <span class="toc-text">Redis 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">Windows 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E5%AE%89%E8%A3%85"><span class="toc-number">3.3.</span> <span class="toc-text">Linux 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD"><span class="toc-number">3.4.</span> <span class="toc-text">测试性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9A%84%E7%9F%A5%E8%AF%86"><span class="toc-number">3.5.</span> <span class="toc-text">基础的知识</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">五大数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-key"><span class="toc-number">4.1.</span> <span class="toc-text">Redis-Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.2.</span> <span class="toc-text">String（字符串）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list%E5%88%97%E8%A1%A8"><span class="toc-number">4.3.</span> <span class="toc-text">List（列表）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set%E9%9B%86%E5%90%88"><span class="toc-number">4.4.</span> <span class="toc-text">Set（集合）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hash%E5%93%88%E5%B8%8C"><span class="toc-number">4.5.</span> <span class="toc-text">Hash（哈希）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">4.6.</span> <span class="toc-text">Zset（有序集合）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">三种特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#geospatial-%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">Geospatial 地理位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hyperloglog"><span class="toc-number">5.2.</span> <span class="toc-text">Hyperloglog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bitmap"><span class="toc-number">5.3.</span> <span class="toc-text">Bitmap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jedis"><span class="toc-number">7.</span> <span class="toc-text">Jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84api"><span class="toc-number">7.0.1.</span> <span class="toc-text">常用的 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-2"><span class="toc-number">7.0.2.</span> <span class="toc-text">事务</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88"><span class="toc-number">8.</span> <span class="toc-text">SpringBoot 整合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redisconf%E8%AF%A6%E8%A7%A3"><span class="toc-number">9.</span> <span class="toc-text">Redis.conf 详解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">10.</span> <span class="toc-text">Redis 持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#rdbredis-database"><span class="toc-number">10.1.</span> <span class="toc-text">RDB（Redis DataBase）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aofappend-only-file"><span class="toc-number">10.2.</span> <span class="toc-text">AOF（Append Only File）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">10.2.0.1.</span> <span class="toc-text">扩展：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">11.</span> <span class="toc-text">Redis 发布订阅</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">12.</span> <span class="toc-text">Redis 主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">12.0.1.</span> <span class="toc-text">概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">12.1.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E"><span class="toc-number">12.1.1.</span> <span class="toc-text">一主二从</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.2.</span> <span class="toc-text">哨兵模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><span class="toc-number">13.</span> <span class="toc-text">Redis 缓存穿透和雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E6%9F%A5%E4%B8%8D%E5%88%B0"><span class="toc-number">13.1.</span> <span class="toc-text">缓存穿透（查不到）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">13.1.0.1.</span> <span class="toc-text">布隆过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">13.1.0.2.</span> <span class="toc-text">缓存空对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%E9%87%8F%E5%A4%AA%E5%A4%A7%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F"><span class="toc-number">13.2.</span> <span class="toc-text">缓存击穿（量太大，缓存过期！）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">13.3.</span> <span class="toc-text">缓存雪崩</span></a></li></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/zxy/redis/" rel="bookmark" title="Redis初步学习">Redis初步学习</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="失心耀" data-src="/zxy/images/avatar.jpg"><p class="name" itemprop="name">失心耀</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/zxy/archives/"><span class="count">18</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/zxy/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/zxy/tags/"><span class="count">15</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3p4eS0wMTE2L3p4eS0wMTE2LmdpdGh1Yi5pbw==" title="https:&#x2F;&#x2F;github.com&#x2F;zxy-0116&#x2F;zxy-0116.github.io"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE0NTgyOTk1NTI=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1458299552"><i class="ic i-cloud-music"></i></span> <span class="exturl item gitee" data-url="aHR0cHM6Ly9naXRlZS5jb20veGlueWFvX2lkaW90" title="https:&#x2F;&#x2F;gitee.com&#x2F;xinyao_idiot"><i class="ic i-address-card"></i></span> <span class="exturl item QQ" data-url="aHR0cHM6Ly93cGEucXEuY29tL21zZ3JkP3Y9MyZ1aW49MTAzMTU3NDIxMSZzaXRlPXFxJm1lbnU9eWVz" title="https:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;1031574211&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="ic i-qq"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMTEwNjM3ODU=" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;11063785"><i class="ic i-paper-plane"></i></span></div><ul class="menu"><li class="item"><a href="/zxy/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/zxy/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/zxy/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/zxy/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/zxy/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/zxy/links/" rel="section"><i class="ic i-paper-plane"></i>分享</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/Git/" title="分类于 Git">Git</a></div><span><a href="/zxy/Git%E5%8D%8F%E5%90%8C%E4%B8%8E%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/" title="Git协同与提交规范">Git协同与提交规范</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/SpringCloud/" title="分类于 SpringCloud">SpringCloud</a></div><span><a href="/zxy/SpringCloud%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/" title="SpringCloud笔记心得">SpringCloud笔记心得</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" title="分类于 安装教程">安装教程</a></div><span><a href="/zxy/Hexo%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/" title="Hexo安装过程">Hexo安装过程</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/Rabbitmq/" title="分类于 Rabbitmq">Rabbitmq</a></div><span><a href="/zxy/RabbitMQ-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" title="RabbitMQ 高级特性">RabbitMQ 高级特性</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/SpringBoot/" title="分类于 SpringBoot">SpringBoot</a></div><span><a href="/zxy/SpringBoot%E7%AC%94%E8%AE%B0%E5%BF%83%E5%BE%97/" title="springboot笔记心得">springboot笔记心得</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/Life/" title="分类于 人生经历">人生经历</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/Life/%E6%9C%AC%E7%A7%91/" title="分类于 本科">本科</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/Life/%E6%9C%AC%E7%A7%91/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" title="分类于 计算机科学与技术">计算机科学与技术</a></div><span><a href="/zxy/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" title="数据库系统原理">数据库系统原理</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/Rabbitmq/" title="分类于 Rabbitmq">Rabbitmq</a></div><span><a href="/zxy/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="RabbitMQ 入门及使用">RabbitMQ 入门及使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" title="分类于 安装教程">安装教程</a></div><span><a href="/zxy/Java%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/" title="Java安装过程">Java安装过程</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/skill/%E5%90%8E%E7%AB%AF/ElasticSearch/" title="分类于 ElasticSearch">ElasticSearch</a></div><span><a href="/zxy/ElasticSearch%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/" title="ElasticSearch初步学习">ElasticSearch初步学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/zxy/categories/Life/" title="分类于 人生经历">人生经历</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/Life/%E6%9C%AC%E7%A7%91/" title="分类于 本科">本科</a> <i class="ic i-angle-right"></i> <a href="/zxy/categories/Life/%E6%9C%AC%E7%A7%91/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" title="分类于 计算机科学与技术">计算机科学与技术</a></div><span><a href="/zxy/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/" title="操作系统概论">操作系统概论</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">失心耀 @ zxy Shoka</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">355k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">5:23</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"redis/",favicon:{show:"（●´3｀●）復活成功",hide:"(´Д｀)瀏覽器崩潰啦"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/zxy/js/app.js?v=0.2.5"></script></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="陈智杰的博客" href="https://czjalpine.gitee.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="陈智杰的博客" href="https://czjalpine.gitee.io/atom.xml"><link rel="alternate" type="application/json" title="陈智杰的博客" href="https://czjalpine.gitee.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Kubernetes"><link rel="canonical" href="https://czjalpine.gitee.io/2022/06/06/Kubernetes%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><title>Kubernetes集群搭建 - Kubernetes - 运维 - 计算机学习 | Czj Alpine = 陈智杰的博客</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Kubernetes集群搭建</h1><div class="meta"><span class="item" title="创建时间：2022-06-06 15:43:11"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-06-06T15:43:11+08:00">2022-06-06</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.2k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Czj Alpine</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeyonbf9j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipexbei4hj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipewf5l51j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeuv80yoj20zk0m8kjl.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciuv0socj20zk0m8qes.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/skill/" itemprop="item" rel="index" title="分类于 计算机学习"><span itemprop="name">计算机学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/skill/%E8%BF%90%E7%BB%B4/" itemprop="item" rel="index" title="分类于 运维"><span itemprop="name">运维</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/skill/%E8%BF%90%E7%BB%B4/Kubernetes/" itemprop="item" rel="index" title="分类于 Kubernetes"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://czjalpine.gitee.io/2022/06/06/Kubernetes%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="陈智杰"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="陈智杰的博客"></span><div class="body md" itemprop="articleBody"><p><span id="more"></span></p><h1 id="ubuntu搭建kubernetes"><a class="anchor" href="#ubuntu搭建kubernetes">#</a> Ubuntu 搭建 Kubernetes</h1><h2 id="环境"><a class="anchor" href="#环境">#</a> 环境：</h2><ol><li>节点需要装好 docker 环境<br>官方文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvdWJ1bnR1Lw==">https://docs.docker.com/engine/install/ubuntu/</span></li><li>ubuntu18.04</li></ol><h2 id="节点环境初始化master节点和node节点都要执行"><a class="anchor" href="#节点环境初始化master节点和node节点都要执行">#</a> 节点环境初始化（master 节点和 node 节点都要执行）</h2><h3 id="分别为节点设置主机名称-以实际-ip-为准"><a class="anchor" href="#分别为节点设置主机名称-以实际-ip-为准">#</a> 分别为节点设置主机名称 （以实际 IP 为准）</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hostnamectl set-hostname k8s-master </pre></td></tr><tr><td data-num="2"></td><td><pre>hostnamectl set-hostname k8s-node1 </pre></td></tr><tr><td data-num="3"></td><td><pre>hostnamectl set-hostname k8s-node2</pre></td></tr></table></figure><h3 id="分别在-节点上配置主机映射-ip-地址根据实际情况修改"><a class="anchor" href="#分别在-节点上配置主机映射-ip-地址根据实际情况修改">#</a> 分别在 节点上配置主机映射 （IP 地址根据实际情况修改）</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/hosts</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>10.1.55.177 k8s-master</pre></td></tr><tr><td data-num="3"></td><td><pre>10.1.55.178 k8s-node1</pre></td></tr><tr><td data-num="4"></td><td><pre>10.1.55.179 k8s-node2 </pre></td></tr><tr><td data-num="5"></td><td><pre>EOF</pre></td></tr></table></figure><h3 id="节点基础配置"><a class="anchor" href="#节点基础配置">#</a> 节点基础配置</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 停用防火墙（防止后续实验中 k8s-master 和 worker 通信异常）</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ufw disable </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#master 上设置秘钥免密登录其他节点 </span></pre></td></tr><tr><td data-num="5"></td><td><pre>ssh-keygen -t rsa</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">>></span> ~/.ssh/authorized_keys</pre></td></tr><tr><td data-num="7"></td><td><pre>ssh-copy-id k8s-node-1</pre></td></tr><tr><td data-num="8"></td><td><pre>ssh-copy-id k8s-node-2</pre></td></tr><tr><td data-num="9"></td><td><pre>ssh-copy-id k8s-node-3</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#关闭 swap（kubernetes 不支持 swap）</span></pre></td></tr><tr><td data-num="12"></td><td><pre>swapoff -a <span class="token operator">&amp;&amp;</span> sysctl -w vm.swappiness<span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">sed</span> -i <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">cat</span> /etc/fstab</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">#修改内核参数</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">bash</span> -c <span class="token string">"cat >> /etc/sysctl.conf"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF</span></pre></td></tr><tr><td data-num="18"></td><td><pre>net.ipv4.ip_forward = 1</pre></td></tr><tr><td data-num="19"></td><td><pre>net.bridge.bridge-nf-call-iptables = 1</pre></td></tr><tr><td data-num="20"></td><td><pre>EOF</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">#添加配置内核参数</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/sysctl.d/k8s.conf </span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>net.bridge.bridge-nf-call-ip6tables = 1 </pre></td></tr><tr><td data-num="25"></td><td><pre>net.bridge.bridge-nf-call-iptables = 1 </pre></td></tr><tr><td data-num="26"></td><td><pre>EOF </pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">#加载 br_netfilter</span></pre></td></tr><tr><td data-num="29"></td><td><pre>kubernetes 安装需要 br_netfilter 模块。 启用此内核模块，以便遍历桥的数据包由 iptables</pre></td></tr><tr><td data-num="30"></td><td><pre>进行处理以进行过滤和端口转发，并且群集中的 kubernetes pod 可以相互通信。</pre></td></tr><tr><td data-num="31"></td><td><pre>modprobe br_netfilter </pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">#加载配置</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token function">sudo</span> sysctl --system</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token function">sudo</span> sysctl -p</pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">#输入如下命令，查看是否生成相关文件</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token function">ls</span> /proc/sys/net/bridge</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment">#配置 selinux</span></pre></td></tr><tr><td data-num="42"></td><td><pre>ubuntu selinux 默认为关闭</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">#更新源</span></pre></td></tr><tr><td data-num="45"></td><td><pre>deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</pre></td></tr><tr><td data-num="46"></td><td><pre>deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</pre></td></tr><tr><td data-num="47"></td><td><pre>deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</pre></td></tr><tr><td data-num="48"></td><td><pre>deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</pre></td></tr><tr><td data-num="49"></td><td><pre>deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</pre></td></tr><tr><td data-num="50"></td><td><pre>deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</pre></td></tr><tr><td data-num="51"></td><td><pre>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</pre></td></tr><tr><td data-num="52"></td><td><pre>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</pre></td></tr><tr><td data-num="53"></td><td><pre>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</pre></td></tr><tr><td data-num="54"></td><td><pre>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token function">apt-get</span> upgrade</pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token function">vim</span> <span class="token function">curl</span> net-tools</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">#安装必要的软件包，以允许 apt 通过 https ca-certificates software-properties-common</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-https ca-certificates software-properties-common gnupg  lsb-release</pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">#配置 docker 安装源 - 添加 docker 的 GPG key</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token function">curl</span> -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -</pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">#设置 docker 的镜像源</span></pre></td></tr><tr><td data-num="66"></td><td><pre>add-apt-repository <span class="token string">"deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">#安装指定版本的 Docker</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> -y docker-ce<span class="token operator">=</span><span class="token number">5</span>:20.10.2~3-0~ubuntu-bionic</pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment">#配置 Docker</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token function">bash</span> -c <span class="token string">"cat > /etc/docker/daemon.json"</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="73"></td><td><pre>&#123;</pre></td></tr><tr><td data-num="74"></td><td><pre>  "exec-opts": ["native.cgroupdriver=systemd"],</pre></td></tr><tr><td data-num="75"></td><td><pre>  "registry-mirrors": ["https://wxnrx160.mirror.aliyuncs.com"]</pre></td></tr><tr><td data-num="76"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="77"></td><td><pre>EOF</pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token comment">#启动 docker</span></pre></td></tr><tr><td data-num="80"></td><td><pre>systemctl daemon-reload <span class="token operator">&amp;&amp;</span> systemctl restart docker <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> docker</pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="83"></td><td><pre>docker -v</pre></td></tr></table></figure><h2 id="安装k8s相关组件-master和node-都要"><a class="anchor" href="#安装k8s相关组件-master和node-都要">#</a> 安装 k8s 相关组件 （master 和 node 都要）</h2><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-https   </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">curl</span> -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> - </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">bash</span> -c <span class="token string">"cat > /etc/apt/sources.list.d/kubernetes.list"</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="5"></td><td><pre>deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main</pre></td></tr><tr><td data-num="6"></td><td><pre>EOF</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#查看源中有哪些版本</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">apt-cache</span> madison kubeadm</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token assign-left variable">kubelet</span><span class="token operator">=</span><span class="token number">1.20</span>.0-00 <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token number">1.20</span>.0-00 <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token number">1.20</span>.0-00</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">#启动 kubelet</span></pre></td></tr><tr><td data-num="15"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet</pre></td></tr></table></figure><h2 id="master的配置"><a class="anchor" href="#master的配置">#</a> master 的配置</h2><h3 id="查看指定的kubernetes所需镜像及对应版本"><a class="anchor" href="#查看指定的kubernetes所需镜像及对应版本">#</a> 查看指定的 kubernetes 所需镜像及对应版本</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm config images list --kubernetes-version v1.20.0   //查看所需镜像及对应版本</pre></td></tr></table></figure><h3 id="1-执行installsh"><a class="anchor" href="#1-执行installsh">#</a> 1、<span class="exturl" data-url="aHR0cDovL3huLS1pbnN0YWxsLXl4N25uMjR5LnNo">执行 install.sh</span></h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.21.0 </pre></td></tr><tr><td data-num="4"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.21.0</pre></td></tr><tr><td data-num="5"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.21.0</pre></td></tr><tr><td data-num="6"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="7"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1</pre></td></tr><tr><td data-num="8"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.21.0  k8s.gcr.io/kube-apiserver:v1.21.0 </pre></td></tr><tr><td data-num="12"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.21.0 k8s.gcr.io/kube-controller-manager:v1.21.0</pre></td></tr><tr><td data-num="13"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.21.0 k8s.gcr.io/kube-scheduler:v1.21.0</pre></td></tr><tr><td data-num="14"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0 k8s.gcr.io/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="15"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1 k8s.gcr.io/pause:3.4.1</pre></td></tr><tr><td data-num="16"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0 k8s.gcr.io/etcd:3.4.13-0</pre></td></tr><tr><td data-num="17"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.0 k8s.gcr.io/coredns/coredns:v1.8.0</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.21.0 </pre></td></tr><tr><td data-num="21"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.21.0</pre></td></tr><tr><td data-num="22"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.21.0</pre></td></tr><tr><td data-num="23"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="24"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1</pre></td></tr><tr><td data-num="25"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0</pre></td></tr><tr><td data-num="26"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.0</pre></td></tr></table></figure><h3 id="2-初始化方式一"><a class="anchor" href="#2-初始化方式一">#</a> 2、初始化方式一</h3><h4 id="1-生成配置文件"><a class="anchor" href="#1-生成配置文件">#</a> 1. 生成配置文件</h4><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm config print init-defaults <span class="token operator">></span> kubeadm-config.yaml </pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">vim</span> kubeadm-config.yaml </pre></td></tr><tr><td data-num="4"></td><td><pre>修改： </pre></td></tr><tr><td data-num="5"></td><td><pre>  advertiseAddress: <span class="token number">192.168</span>.91.210	//master_IP </pre></td></tr><tr><td data-num="6"></td><td><pre>  imageRepository: registry.aliyuncs.com/google_containers  <span class="token comment">#修改集群组件镜像地址为阿里云</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  dnsDomain: ***.*** </pre></td></tr><tr><td data-num="8"></td><td><pre>  podSubnet: <span class="token number">10.244</span>.0.0/16 <span class="token comment">#指定 pod 使用的网络</span></pre></td></tr></table></figure><h4 id="2-使用-kubeadmin-初始化-k8s-master-节点"><a class="anchor" href="#2-使用-kubeadmin-初始化-k8s-master-节点">#</a> 2. 使用 kubeadmin 初始化 k8s-master 节点</h4><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm init --config kubeadm-config.yaml <span class="token operator">|</span> <span class="token function">tee</span> <span class="token environment constant">$HOME</span>/k8s.txt</pre></td></tr></table></figure><h3 id="22-初始化二-以实际情况为准"><a class="anchor" href="#22-初始化二-以实际情况为准">#</a> 2.2、初始化二 (以实际情况为准)</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm init --kubernetes-version<span class="token operator">=</span>v1.21.0 --pod-network-cidr<span class="token operator">=</span><span class="token number">10.1</span>.55.0/24 --apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.1</span>.55.177 <span class="token operator">|</span> <span class="token function">tee</span> <span class="token environment constant">$HOME</span>/k8s.txt</pre></td></tr></table></figure><p><strong>#说明：</strong></p><p>//kubernetes-version = 版本</p><p>//apiserver-advertise-address=masterIP</p><h3><a class="anchor" href="#">#</a></h3><h3 id="3-master初始化成功后会生成如下信息保存下来以实际-信息为准"><a class="anchor" href="#3-master初始化成功后会生成如下信息保存下来以实际-信息为准">#</a> 3、master 初始化成功后会生成如下信息，保存下来（以实际 信息为准）</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.0.10:6443 --token teq2pv.f34xghxbexoun5rf <span class="token punctuation">\</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>    --discovery-token-ca-cert-hash sha256:edca62f5952c998dafc7d53c6564ca4fd770c09a0443b3053aca74da597be906</pre></td></tr></table></figure><h3 id="4-输入以下命令授权非-root-用户使用-kubectl-命令这也是-kubeadm-init-输出的一部分"><a class="anchor" href="#4-输入以下命令授权非-root-用户使用-kubectl-命令这也是-kubeadm-init-输出的一部分">#</a> 4、输入以下命令授权非 root 用户使用 kubectl 命令（这也是 kubeadm init 输出的一部分）</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">## 配置集群访问</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#授权非 root 用户</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config </pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#如果是 root 帐号 </span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"export KUBECONFIG=/etc/kubernetes/admin.conf"</span> <span class="token operator">>></span> /root/.bashrc </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">source</span> /root/.bashrc</pre></td></tr></table></figure><h4 id="注若不执行步骤-4-可能会出现以下错误"><a class="anchor" href="#注若不执行步骤-4-可能会出现以下错误">#</a> 注：若不执行步骤 4 可能会出现以下错误：</h4><pre><code>The connection to the server localhost:8080 was refused - did you specify the right host or port? 
</code></pre><h3 id="5-若初始化失败则还原查明问题后重新初始化"><a class="anchor" href="#5-若初始化失败则还原查明问题后重新初始化">#</a> 5、若初始化失败则还原，查明问题后重新初始化。</h3><pre><code>kubeadm reset -f
</code></pre><h4 id="注此命令会重置kubernetes的环境和会完全清除已创建的集群配置仅在初始化失败使用"><a class="anchor" href="#注此命令会重置kubernetes的环境和会完全清除已创建的集群配置仅在初始化失败使用">#</a> 注：此命令会重置 kubernetes 的环境和会完全清除已创建的集群配置，仅在初始化失败使用</h4><h3 id="6-master上安装网络插件flannel"><a class="anchor" href="#6-master上安装网络插件flannel">#</a> 6、master 上安装网络插件 flannel</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</pre></td></tr></table></figure><h4 id="等待状态为ready"><a class="anchor" href="#等待状态为ready">#</a> 等待状态为 Ready</h4><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@k8s-master:~<span class="token comment"># kubectl get node</span></pre></td></tr><tr><td data-num="2"></td><td><pre>NAME         STATUS   ROLES                  AGE   VERSION</pre></td></tr><tr><td data-num="3"></td><td><pre>k8s-master   Ready    control-plane,master   51m   v1.21.0</pre></td></tr></table></figure><h3 id="7-部署-calico-网络仅在-k8s-master-执行"><a class="anchor" href="#7-部署-calico-网络仅在-k8s-master-执行">#</a> 7、部署 calico 网络（仅在 k8s-master 执行）</h3><ol><li><p>部署网络前查看集群状态，此时因为网络问题，状态均异常。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl get node</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl get pods -n kube-system</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#部署前需要确保 /etc/hosts 有以下内容</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</pre></td></tr><tr><td data-num="6"></td><td><pre>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">## 否则</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Readiness probe failed: Get <span class="token string">"http://localhost:9099/readiness"</span><span class="token builtin class-name">:</span> dial tcp <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:9099: connect: connection refused</pre></td></tr><tr><td data-num="10"></td><td><pre>  Warning  Unhealthy  41s <span class="token punctuation">(</span>x6 over 91s<span class="token punctuation">)</span>  kubelet            Liveness probe failed: calico/node is not ready: Felix is not live: Get http://localhost:9099/liveness: dial tcp: lookup localhost on <span class="token number">114.114</span>.114.114:53: no such <span class="token function">host</span></pre></td></tr></table></figure></li><li><p>部署 calico</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> https://docs.projectcalico.org/v3.10/manifests/canal.yaml -O</pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl apply -f canal.yaml</pre></td></tr></table></figure></li><li><p>部署结束后等待一段时间，再查看 node 和 pod 状态，若正常则单节点 k8s-master 安装成功</p></li></ol><h2 id="node节点执行"><a class="anchor" href="#node节点执行">#</a> node 节点执行</h2><h3 id="1-node节点加入集群-方法一"><a class="anchor" href="#1-node节点加入集群-方法一">#</a> 1、node 节点加入集群 -- 方法一</h3><pre><code>#生成节点的kubeadm-config.yaml文件，在node节点操作
kubeadm config print join-defaults &gt; kubeadm-config.yaml 
修改：apiServerEndpoint: 192.168.91.210:6443
#加入集群
kubeadm join --config kubeadm-config.yaml
</code></pre><h3 id="2-执行脚本-安装集群方法二"><a class="anchor" href="#2-执行脚本-安装集群方法二">#</a> 2、执行脚本 -- 安装集群方法二</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="3"></td><td><pre>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0 k8s.gcr.io/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="7"></td><td><pre>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1 k8s.gcr.io/pause:3.4.1</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.21.0</pre></td></tr><tr><td data-num="11"></td><td><pre>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1</pre></td></tr></table></figure><h3 id="3-运行初始化-master-之后的回显-加入集群方法二"><a class="anchor" href="#3-运行初始化-master-之后的回显-加入集群方法二">#</a> 3、运行初始化 master 之后的回显 -- 加入集群方法二</h3><h3 id="也可以根据此命令的回显-kubeadm-token-create-print-join-command"><a class="anchor" href="#也可以根据此命令的回显-kubeadm-token-create-print-join-command">#</a> 也可以根据此命令的回显： kubeadm token create --print-join-command</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.0.10:6443 --token teq2pv.f34xghxbexoun5rf <span class="token punctuation">\</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>--discovery-token-ca-cert-hash sha256:edca62f5952c998dafc7d53c6564ca4fd770c09a0443b3053aca74da597be906</pre></td></tr></table></figure><h3 id="4-配置自动补全-master上"><a class="anchor" href="#4-配置自动补全-master上">#</a> 4、配置自动补全 - master 上</h3><pre><code>echo 'source &lt;(kubectl completion bash)' &gt;&gt;~/.bashrc
source ~/.bashrc
</code></pre><h2 id="在master上查看-node-状态和-pod-状态"><a class="anchor" href="#在master上查看-node-状态和-pod-状态">#</a> 在 master 上查看 Node 状态和 Pod 状态</h2><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>journalctl -f -u kubelet</pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#查看 Node 状态，需要等待一段时间</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl get node</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#查看 Pod 状态，需要等待一段时间</span></pre></td></tr><tr><td data-num="4"></td><td><pre>kubectl get pods --namespace<span class="token operator">=</span>kube-system</pre></td></tr></table></figure><h3 id="出错删除节点"><a class="anchor" href="#出错删除节点">#</a> 出错删除节点</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl drain node名字 --force --ignore-daemonsets --delete-local-data</pre></td></tr></table></figure><h2 id="kubernetes命令补全"><a class="anchor" href="#kubernetes命令补全">#</a> Kubernetes 命令补全</h2><ol><li><p>安装 bash-completion</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> -y <span class="token function">install</span> bash-completion </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">source</span> /usr/share/bash-completion/bash_completion</pre></td></tr></table></figure></li><li><p>添加 kubectl 命令补全功能（在 K8s-master 节点添加即可）</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'source &lt;(kubectl completion bash)'</span> <span class="token operator">>></span>~/.bashrc </pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl completion <span class="token function">bash</span> <span class="token operator">></span>/etc/bash_completion.d/kubectl</pre></td></tr></table></figure></li><li><p>关联别名</p></li></ol><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'alias k=kubectl'</span> <span class="token operator">>></span>~/.bashrc </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'alias kgp=kubectl get pods'</span> <span class="token operator">>></span>~/.bashrc </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'alias kgs=kubectl get svc'</span> <span class="token operator">>></span>~/.bashrc </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">'complete -F __start_kubectl k'</span> <span class="token operator">>></span>~/.bashrc </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">source</span> ~/.bashrc</pre></td></tr></table></figure><h1 id="ubuntu清除集群"><a class="anchor" href="#ubuntu清除集群">#</a> ubuntu 清除集群</h1><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm reset -f</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#删除目录</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">rm</span> -rf <span class="token environment constant">$HOME</span>/.kube</pre></td></tr></table></figure><h1 id="linux关闭被占用的端口"><a class="anchor" href="#linux关闭被占用的端口">#</a> linux 关闭被占用的端口</h1><h2 id="1-查找被占用的端口"><a class="anchor" href="#1-查找被占用的端口">#</a> 1、查找被占用的端口</h2><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">netstat</span> -tln <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8000</span></pre></td></tr></table></figure><h2 id="2-查看被占用端口的pid"><a class="anchor" href="#2-查看被占用端口的pid">#</a> 2、查看被占用端口的 PID</h2><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">lsof</span> -i:8000</pre></td></tr></table></figure><h2 id="3-kill掉该进程"><a class="anchor" href="#3-kill掉该进程">#</a> 3、kill 掉该进程</h2><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">kill</span> -9 PID</pre></td></tr></table></figure><pre><code>download script curl -O https://cdn.jsdelivr.net/gh/mzz2017/v2rayA@master/install/go.sh
</code></pre><div class="tags"><a href="/tags/Kubernetes/" rel="tag"><i class="ic i-tag"></i> Kubernetes</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-06-06 15:51:05" itemprop="dateModified" datetime="2022-06-06T15:51:05+08:00">2022-06-06</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="陈智杰 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="陈智杰 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>陈智杰 <i class="ic i-at"><em>@</em></i>陈智杰的博客</li><li class="link"><strong>本文链接：</strong> <a href="https://czjalpine.gitee.io/2022/06/06/Kubernetes%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="Kubernetes集群搭建">https://czjalpine.gitee.io/2022/06/06/Kubernetes集群搭建/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/29/README/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclhtuo6nj20zk0m8ttm.jpg" title="未命名"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>未命名</h3></a></div><div class="item right"><a href="/2022/06/06/Gitlab%E5%AE%89%E8%A3%85/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclhtuo6nj20zk0m8ttm.jpg" title="Gitlab安装"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Gitlab</span><h3>Gitlab安装</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ubuntu%E6%90%AD%E5%BB%BAkubernetes"><span class="toc-number">1.</span> <span class="toc-text">Ubuntu 搭建 Kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">环境：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96master%E8%8A%82%E7%82%B9%E5%92%8Cnode%E8%8A%82%E7%82%B9%E9%83%BD%E8%A6%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.</span> <span class="toc-text">节点环境初始化（master 节点和 node 节点都要执行）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E4%B8%BA%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%A7%B0-%E4%BB%A5%E5%AE%9E%E9%99%85-ip-%E4%B8%BA%E5%87%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">分别为节点设置主机名称 （以实际 IP 为准）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E5%9C%A8-%E8%8A%82%E7%82%B9%E4%B8%8A%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E6%98%A0%E5%B0%84-ip-%E5%9C%B0%E5%9D%80%E6%A0%B9%E6%8D%AE%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E4%BF%AE%E6%94%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">分别在 节点上配置主机映射 （IP 地址根据实际情况修改）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">节点基础配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85k8s%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6-master%E5%92%8Cnode-%E9%83%BD%E8%A6%81"><span class="toc-number">1.3.</span> <span class="toc-text">安装 k8s 相关组件 （master 和 node 都要）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#master%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">master 的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%9A%84kubernetes%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F%E5%8F%8A%E5%AF%B9%E5%BA%94%E7%89%88%E6%9C%AC"><span class="toc-number">1.4.1.</span> <span class="toc-text">查看指定的 kubernetes 所需镜像及对应版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%89%A7%E8%A1%8Cinstallsh"><span class="toc-number">1.4.2.</span> <span class="toc-text">1、执行 install.sh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-number">1.4.3.</span> <span class="toc-text">2、初始化方式一</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">1. 生成配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-kubeadmin-%E5%88%9D%E5%A7%8B%E5%8C%96-k8s-master-%E8%8A%82%E7%82%B9"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">2. 使用 kubeadmin 初始化 k8s-master 节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%8C-%E4%BB%A5%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E4%B8%BA%E5%87%86"><span class="toc-number">1.4.4.</span> <span class="toc-text">2.2、初始化二 (以实际情况为准)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.4.5.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-master%E5%88%9D%E5%A7%8B%E5%8C%96%E6%88%90%E5%8A%9F%E5%90%8E%E4%BC%9A%E7%94%9F%E6%88%90%E5%A6%82%E4%B8%8B%E4%BF%A1%E6%81%AF%E4%BF%9D%E5%AD%98%E4%B8%8B%E6%9D%A5%E4%BB%A5%E5%AE%9E%E9%99%85-%E4%BF%A1%E6%81%AF%E4%B8%BA%E5%87%86"><span class="toc-number">1.4.6.</span> <span class="toc-text">3、master 初始化成功后会生成如下信息，保存下来（以实际 信息为准）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E6%8E%88%E6%9D%83%E9%9D%9E-root-%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8-kubectl-%E5%91%BD%E4%BB%A4%E8%BF%99%E4%B9%9F%E6%98%AF-kubeadm-init-%E8%BE%93%E5%87%BA%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86"><span class="toc-number">1.4.7.</span> <span class="toc-text">4、输入以下命令授权非 root 用户使用 kubectl 命令（这也是 kubeadm init 输出的一部分）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%8B%A5%E4%B8%8D%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4-4-%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E9%94%99%E8%AF%AF"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">注：若不执行步骤 4 可能会出现以下错误：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%8B%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%B1%E8%B4%A5%E5%88%99%E8%BF%98%E5%8E%9F%E6%9F%A5%E6%98%8E%E9%97%AE%E9%A2%98%E5%90%8E%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.4.8.</span> <span class="toc-text">5、若初始化失败则还原，查明问题后重新初始化。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%AD%A4%E5%91%BD%E4%BB%A4%E4%BC%9A%E9%87%8D%E7%BD%AEkubernetes%E7%9A%84%E7%8E%AF%E5%A2%83%E5%92%8C%E4%BC%9A%E5%AE%8C%E5%85%A8%E6%B8%85%E9%99%A4%E5%B7%B2%E5%88%9B%E5%BB%BA%E7%9A%84%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E4%BB%85%E5%9C%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%B1%E8%B4%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">注：此命令会重置 kubernetes 的环境和会完全清除已创建的集群配置，仅在初始化失败使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-master%E4%B8%8A%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6flannel"><span class="toc-number">1.4.9.</span> <span class="toc-text">6、master 上安装网络插件 flannel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E7%8A%B6%E6%80%81%E4%B8%BAready"><span class="toc-number">1.4.9.1.</span> <span class="toc-text">等待状态为 Ready</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E9%83%A8%E7%BD%B2-calico-%E7%BD%91%E7%BB%9C%E4%BB%85%E5%9C%A8-k8s-master-%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.10.</span> <span class="toc-text">7、部署 calico 网络（仅在 k8s-master 执行）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.</span> <span class="toc-text">node 节点执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-node%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4-%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、node 节点加入集群 -- 方法一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">1.5.2.</span> <span class="toc-text">2、执行脚本 -- 安装集群方法二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BF%90%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96-master-%E4%B9%8B%E5%90%8E%E7%9A%84%E5%9B%9E%E6%98%BE-%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">1.5.3.</span> <span class="toc-text">3、运行初始化 master 之后的回显 -- 加入集群方法二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E6%AD%A4%E5%91%BD%E4%BB%A4%E7%9A%84%E5%9B%9E%E6%98%BE-kubeadm-token-create-print-join-command"><span class="toc-number">1.5.4.</span> <span class="toc-text">也可以根据此命令的回显： kubeadm token create --print-join-command</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8-master%E4%B8%8A"><span class="toc-number">1.5.5.</span> <span class="toc-text">4、配置自动补全 - master 上</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8master%E4%B8%8A%E6%9F%A5%E7%9C%8B-node-%E7%8A%B6%E6%80%81%E5%92%8C-pod-%E7%8A%B6%E6%80%81"><span class="toc-number">1.6.</span> <span class="toc-text">在 master 上查看 Node 状态和 Pod 状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BA%E9%94%99%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">出错删除节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubernetes%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8"><span class="toc-number">1.7.</span> <span class="toc-text">Kubernetes 命令补全</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ubuntu%E6%B8%85%E9%99%A4%E9%9B%86%E7%BE%A4"><span class="toc-number">2.</span> <span class="toc-text">ubuntu 清除集群</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#linux%E5%85%B3%E9%97%AD%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">linux 关闭被占用的端口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9F%A5%E6%89%BE%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.1.</span> <span class="toc-text">1、查找被占用的端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%AB%AF%E5%8F%A3%E7%9A%84pid"><span class="toc-number">3.2.</span> <span class="toc-text">2、查看被占用端口的 PID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-kill%E6%8E%89%E8%AF%A5%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">3、kill 掉该进程</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2022/06/06/Kubernetes%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Kubernetes集群搭建">Kubernetes集群搭建</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="陈智杰" data-src="/images/avatar.jpg"><p class="name" itemprop="name">陈智杰</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">9</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N6amFscGluZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;czjalpine"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIxMDQ2Nzc5NTM=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2104677953"><i class="ic i-cloud-music"></i></span> <span class="exturl item gitee" data-url="aHR0cHM6Ly9naXRlZS5jb20vY3pqYWxwaW5l" title="https:&#x2F;&#x2F;gitee.com&#x2F;czjalpine"><i class="ic i-address-card"></i></span> <span class="exturl item QQ" data-url="aHR0cHM6Ly93cGEucXEuY29tL21zZ3JkP3Y9MyZ1aW49Mjk3MTUxNjc4NSZzaXRlPXFxJm1lbnU9eWVz" title="https:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2971516785&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="ic i-qq"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzk1OTMxMDA3" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;395931007"><i class="ic i-paper-plane"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/links/" rel="section"><i class="ic i-paper-plane"></i>分享</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/29/README/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/06/06/Gitlab%E5%AE%89%E8%A3%85/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/ElasticSearch/" title="分类于 ElasticSearch">ElasticSearch</a></div><span><a href="/2021/06/22/ElasticSearch/" title="ElasticSearch初步学习">ElasticSearch初步学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/Gitlab/" title="分类于 Gitlab">Gitlab</a></div><span><a href="/2022/06/06/Gitlab%E5%AE%89%E8%A3%85/" title="Gitlab安装">Gitlab安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" title="分类于 安装教程">安装教程</a></div><span><a href="/2021/03/01/Java%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/" title="Java安装过程">Java安装过程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/Redis/" title="分类于 Redis">Redis</a></div><span><a href="/2021/05/13/redis/" title="Redis初步学习">Redis初步学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/Kubernetes/" title="分类于 Kubernetes">Kubernetes</a></div><span><a href="/2022/06/06/Kubernetes%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="Kubernetes集群搭建">Kubernetes集群搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/Nginx/" title="分类于 Nginx">Nginx</a></div><span><a href="/2021/04/02/nginx/" title="Nginx初步学习">Nginx初步学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E8%BF%90%E7%BB%B4/linux/" title="分类于 linux">linux</a></div><span><a href="/2021/04/01/Linux/" title="Linux初步学习">Linux初步学习</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2021/12/29/README/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/skill/" title="分类于 计算机学习">计算机学习</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/categories/skill/%E5%90%8E%E7%AB%AF/Rabbitmq/" title="分类于 Rabbitmq">Rabbitmq</a></div><span><a href="/2021/05/10/RabbitMQ-%E5%85%A5%E9%97%A8%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="RabbitMQ 入门及使用">RabbitMQ 入门及使用</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">陈智杰 @ Czj Alpine</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">140k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:08</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/06/06/Kubernetes集群搭建/",favicon:{show:"（●´3｀●）復活成功",hide:"(´Д｀)瀏覽器崩潰啦"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>